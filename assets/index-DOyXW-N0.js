var rS=Object.defineProperty;var aS=(r,e,t)=>e in r?rS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Lr=(r,e,t)=>aS(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();function so(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Nd={exports:{}},gi={},$d={exports:{}},Pe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ay;function sS(){if(Ay)return Pe;Ay=1;var r=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.iterator;function _(x){return x===null||typeof x!="object"?null:(x=y&&x[y]||x["@@iterator"],typeof x=="function"?x:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,S={};function E(x,$,ne){this.props=x,this.context=$,this.refs=S,this.updater=ne||b}E.prototype.isReactComponent={},E.prototype.setState=function(x,$){if(typeof x!="object"&&typeof x!="function"&&x!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,x,$,"setState")},E.prototype.forceUpdate=function(x){this.updater.enqueueForceUpdate(this,x,"forceUpdate")};function P(){}P.prototype=E.prototype;function C(x,$,ne){this.props=x,this.context=$,this.refs=S,this.updater=ne||b}var T=C.prototype=new P;T.constructor=C,w(T,E.prototype),T.isPureReactComponent=!0;var M=Array.isArray,j=Object.prototype.hasOwnProperty,D={current:null},V={key:!0,ref:!0,__self:!0,__source:!0};function q(x,$,ne){var le,ce={},be=null,Ce=null;if($!=null)for(le in $.ref!==void 0&&(Ce=$.ref),$.key!==void 0&&(be=""+$.key),$)j.call($,le)&&!V.hasOwnProperty(le)&&(ce[le]=$[le]);var Ie=arguments.length-2;if(Ie===1)ce.children=ne;else if(1<Ie){for(var Ue=Array(Ie),mt=0;mt<Ie;mt++)Ue[mt]=arguments[mt+2];ce.children=Ue}if(x&&x.defaultProps)for(le in Ie=x.defaultProps,Ie)ce[le]===void 0&&(ce[le]=Ie[le]);return{$$typeof:r,type:x,key:be,ref:Ce,props:ce,_owner:D.current}}function me(x,$){return{$$typeof:r,type:x.type,key:$,ref:x.ref,props:x.props,_owner:x._owner}}function ve(x){return typeof x=="object"&&x!==null&&x.$$typeof===r}function ye(x){var $={"=":"=0",":":"=2"};return"$"+x.replace(/[=:]/g,function(ne){return $[ne]})}var qe=/\/+/g;function Ze(x,$){return typeof x=="object"&&x!==null&&x.key!=null?ye(""+x.key):$.toString(36)}function K(x,$,ne,le,ce){var be=typeof x;(be==="undefined"||be==="boolean")&&(x=null);var Ce=!1;if(x===null)Ce=!0;else switch(be){case"string":case"number":Ce=!0;break;case"object":switch(x.$$typeof){case r:case e:Ce=!0}}if(Ce)return Ce=x,ce=ce(Ce),x=le===""?"."+Ze(Ce,0):le,M(ce)?(ne="",x!=null&&(ne=x.replace(qe,"$&/")+"/"),K(ce,$,ne,"",function(mt){return mt})):ce!=null&&(ve(ce)&&(ce=me(ce,ne+(!ce.key||Ce&&Ce.key===ce.key?"":(""+ce.key).replace(qe,"$&/")+"/")+x)),$.push(ce)),1;if(Ce=0,le=le===""?".":le+":",M(x))for(var Ie=0;Ie<x.length;Ie++){be=x[Ie];var Ue=le+Ze(be,Ie);Ce+=K(be,$,ne,Ue,ce)}else if(Ue=_(x),typeof Ue=="function")for(x=Ue.call(x),Ie=0;!(be=x.next()).done;)be=be.value,Ue=le+Ze(be,Ie++),Ce+=K(be,$,ne,Ue,ce);else if(be==="object")throw $=String(x),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.");return Ce}function G(x,$,ne){if(x==null)return x;var le=[],ce=0;return K(x,le,"","",function(be){return $.call(ne,be,ce++)}),le}function te(x){if(x._status===-1){var $=x._result;$=$(),$.then(function(ne){(x._status===0||x._status===-1)&&(x._status=1,x._result=ne)},function(ne){(x._status===0||x._status===-1)&&(x._status=2,x._result=ne)}),x._status===-1&&(x._status=0,x._result=$)}if(x._status===1)return x._result.default;throw x._result}var Q={current:null},F={transition:null},z={ReactCurrentDispatcher:Q,ReactCurrentBatchConfig:F,ReactCurrentOwner:D};function U(){throw Error("act(...) is not supported in production builds of React.")}return Pe.Children={map:G,forEach:function(x,$,ne){G(x,function(){$.apply(this,arguments)},ne)},count:function(x){var $=0;return G(x,function(){$++}),$},toArray:function(x){return G(x,function($){return $})||[]},only:function(x){if(!ve(x))throw Error("React.Children.only expected to receive a single React element child.");return x}},Pe.Component=E,Pe.Fragment=t,Pe.Profiler=a,Pe.PureComponent=C,Pe.StrictMode=n,Pe.Suspense=f,Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,Pe.act=U,Pe.cloneElement=function(x,$,ne){if(x==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+x+".");var le=w({},x.props),ce=x.key,be=x.ref,Ce=x._owner;if($!=null){if($.ref!==void 0&&(be=$.ref,Ce=D.current),$.key!==void 0&&(ce=""+$.key),x.type&&x.type.defaultProps)var Ie=x.type.defaultProps;for(Ue in $)j.call($,Ue)&&!V.hasOwnProperty(Ue)&&(le[Ue]=$[Ue]===void 0&&Ie!==void 0?Ie[Ue]:$[Ue])}var Ue=arguments.length-2;if(Ue===1)le.children=ne;else if(1<Ue){Ie=Array(Ue);for(var mt=0;mt<Ue;mt++)Ie[mt]=arguments[mt+2];le.children=Ie}return{$$typeof:r,type:x.type,key:ce,ref:be,props:le,_owner:Ce}},Pe.createContext=function(x){return x={$$typeof:u,_currentValue:x,_currentValue2:x,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},x.Provider={$$typeof:o,_context:x},x.Consumer=x},Pe.createElement=q,Pe.createFactory=function(x){var $=q.bind(null,x);return $.type=x,$},Pe.createRef=function(){return{current:null}},Pe.forwardRef=function(x){return{$$typeof:c,render:x}},Pe.isValidElement=ve,Pe.lazy=function(x){return{$$typeof:m,_payload:{_status:-1,_result:x},_init:te}},Pe.memo=function(x,$){return{$$typeof:h,type:x,compare:$===void 0?null:$}},Pe.startTransition=function(x){var $=F.transition;F.transition={};try{x()}finally{F.transition=$}},Pe.unstable_act=U,Pe.useCallback=function(x,$){return Q.current.useCallback(x,$)},Pe.useContext=function(x){return Q.current.useContext(x)},Pe.useDebugValue=function(){},Pe.useDeferredValue=function(x){return Q.current.useDeferredValue(x)},Pe.useEffect=function(x,$){return Q.current.useEffect(x,$)},Pe.useId=function(){return Q.current.useId()},Pe.useImperativeHandle=function(x,$,ne){return Q.current.useImperativeHandle(x,$,ne)},Pe.useInsertionEffect=function(x,$){return Q.current.useInsertionEffect(x,$)},Pe.useLayoutEffect=function(x,$){return Q.current.useLayoutEffect(x,$)},Pe.useMemo=function(x,$){return Q.current.useMemo(x,$)},Pe.useReducer=function(x,$,ne){return Q.current.useReducer(x,$,ne)},Pe.useRef=function(x){return Q.current.useRef(x)},Pe.useState=function(x){return Q.current.useState(x)},Pe.useSyncExternalStore=function(x,$,ne){return Q.current.useSyncExternalStore(x,$,ne)},Pe.useTransition=function(){return Q.current.useTransition()},Pe.version="18.3.1",Pe}var Iy;function Hh(){return Iy||(Iy=1,$d.exports=sS()),$d.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ry;function iS(){if(Ry)return gi;Ry=1;var r=Hh(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function u(c,f,h){var m,y={},_=null,b=null;h!==void 0&&(_=""+h),f.key!==void 0&&(_=""+f.key),f.ref!==void 0&&(b=f.ref);for(m in f)n.call(f,m)&&!o.hasOwnProperty(m)&&(y[m]=f[m]);if(c&&c.defaultProps)for(m in f=c.defaultProps,f)y[m]===void 0&&(y[m]=f[m]);return{$$typeof:e,type:c,key:_,ref:b,props:y,_owner:a.current}}return gi.Fragment=t,gi.jsx=u,gi.jsxs=u,gi}var Ny;function oS(){return Ny||(Ny=1,Nd.exports=iS()),Nd.exports}var qt=oS(),dh=Hh(),Tu={},jd={exports:{}},Bt={},Ld={exports:{}},Md={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $y;function uS(){return $y||($y=1,function(r){function e(F,z){var U=F.length;F.push(z);e:for(;0<U;){var x=U-1>>>1,$=F[x];if(0<a($,z))F[x]=z,F[U]=$,U=x;else break e}}function t(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var z=F[0],U=F.pop();if(U!==z){F[0]=U;e:for(var x=0,$=F.length,ne=$>>>1;x<ne;){var le=2*(x+1)-1,ce=F[le],be=le+1,Ce=F[be];if(0>a(ce,U))be<$&&0>a(Ce,ce)?(F[x]=Ce,F[be]=U,x=be):(F[x]=ce,F[le]=U,x=le);else if(be<$&&0>a(Ce,U))F[x]=Ce,F[be]=U,x=be;else break e}}return z}function a(F,z){var U=F.sortIndex-z.sortIndex;return U!==0?U:F.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;r.unstable_now=function(){return o.now()}}else{var u=Date,c=u.now();r.unstable_now=function(){return u.now()-c}}var f=[],h=[],m=1,y=null,_=3,b=!1,w=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(F){for(var z=t(h);z!==null;){if(z.callback===null)n(h);else if(z.startTime<=F)n(h),z.sortIndex=z.expirationTime,e(f,z);else break;z=t(h)}}function M(F){if(S=!1,T(F),!w)if(t(f)!==null)w=!0,te(j);else{var z=t(h);z!==null&&Q(M,z.startTime-F)}}function j(F,z){w=!1,S&&(S=!1,P(q),q=-1),b=!0;var U=_;try{for(T(z),y=t(f);y!==null&&(!(y.expirationTime>z)||F&&!ye());){var x=y.callback;if(typeof x=="function"){y.callback=null,_=y.priorityLevel;var $=x(y.expirationTime<=z);z=r.unstable_now(),typeof $=="function"?y.callback=$:y===t(f)&&n(f),T(z)}else n(f);y=t(f)}if(y!==null)var ne=!0;else{var le=t(h);le!==null&&Q(M,le.startTime-z),ne=!1}return ne}finally{y=null,_=U,b=!1}}var D=!1,V=null,q=-1,me=5,ve=-1;function ye(){return!(r.unstable_now()-ve<me)}function qe(){if(V!==null){var F=r.unstable_now();ve=F;var z=!0;try{z=V(!0,F)}finally{z?Ze():(D=!1,V=null)}}else D=!1}var Ze;if(typeof C=="function")Ze=function(){C(qe)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,G=K.port2;K.port1.onmessage=qe,Ze=function(){G.postMessage(null)}}else Ze=function(){E(qe,0)};function te(F){V=F,D||(D=!0,Ze())}function Q(F,z){q=E(function(){F(r.unstable_now())},z)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(F){F.callback=null},r.unstable_continueExecution=function(){w||b||(w=!0,te(j))},r.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):me=0<F?Math.floor(1e3/F):5},r.unstable_getCurrentPriorityLevel=function(){return _},r.unstable_getFirstCallbackNode=function(){return t(f)},r.unstable_next=function(F){switch(_){case 1:case 2:case 3:var z=3;break;default:z=_}var U=_;_=z;try{return F()}finally{_=U}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(F,z){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var U=_;_=F;try{return z()}finally{_=U}},r.unstable_scheduleCallback=function(F,z,U){var x=r.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?x+U:x):U=x,F){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=U+$,F={id:m++,callback:z,priorityLevel:F,startTime:U,expirationTime:$,sortIndex:-1},U>x?(F.sortIndex=U,e(h,F),t(f)===null&&F===t(h)&&(S?(P(q),q=-1):S=!0,Q(M,U-x))):(F.sortIndex=$,e(f,F),w||b||(w=!0,te(j))),F},r.unstable_shouldYield=ye,r.unstable_wrapCallback=function(F){var z=_;return function(){var U=_;_=z;try{return F.apply(this,arguments)}finally{_=U}}}}(Md)),Md}var jy;function lS(){return jy||(jy=1,Ld.exports=uS()),Ld.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ly;function cS(){if(Ly)return Bt;Ly=1;var r=Hh(),e=lS();function t(s){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+s,l=1;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,a={};function o(s,i){u(s,i),u(s+"Capture",i)}function u(s,i){for(a[s]=i,s=0;s<i.length;s++)n.add(i[s])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),f=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},y={};function _(s){return f.call(y,s)?!0:f.call(m,s)?!1:h.test(s)?y[s]=!0:(m[s]=!0,!1)}function b(s,i,l,d){if(l!==null&&l.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return d?!1:l!==null?!l.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function w(s,i,l,d){if(i===null||typeof i>"u"||b(s,i,l,d))return!0;if(d)return!1;if(l!==null)switch(l.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function S(s,i,l,d,p,g,v){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=d,this.attributeNamespace=p,this.mustUseProperty=l,this.propertyName=s,this.type=i,this.sanitizeURL=g,this.removeEmptyString=v}var E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){E[s]=new S(s,0,!1,s,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var i=s[0];E[i]=new S(i,1,!1,s[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(s){E[s]=new S(s,2,!1,s.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){E[s]=new S(s,2,!1,s,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){E[s]=new S(s,3,!1,s.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(s){E[s]=new S(s,3,!0,s,null,!1,!1)}),["capture","download"].forEach(function(s){E[s]=new S(s,4,!1,s,null,!1,!1)}),["cols","rows","size","span"].forEach(function(s){E[s]=new S(s,6,!1,s,null,!1,!1)}),["rowSpan","start"].forEach(function(s){E[s]=new S(s,5,!1,s.toLowerCase(),null,!1,!1)});var P=/[\-:]([a-z])/g;function C(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var i=s.replace(P,C);E[i]=new S(i,1,!1,s,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var i=s.replace(P,C);E[i]=new S(i,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(s){var i=s.replace(P,C);E[i]=new S(i,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(s){E[s]=new S(s,1,!1,s.toLowerCase(),null,!1,!1)}),E.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(s){E[s]=new S(s,1,!1,s.toLowerCase(),null,!0,!0)});function T(s,i,l,d){var p=E.hasOwnProperty(i)?E[i]:null;(p!==null?p.type!==0:d||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(w(i,l,p,d)&&(l=null),d||p===null?_(i)&&(l===null?s.removeAttribute(i):s.setAttribute(i,""+l)):p.mustUseProperty?s[p.propertyName]=l===null?p.type===3?!1:"":l:(i=p.attributeName,d=p.attributeNamespace,l===null?s.removeAttribute(i):(p=p.type,l=p===3||p===4&&l===!0?"":""+l,d?s.setAttributeNS(d,i,l):s.setAttribute(i,l))))}var M=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),D=Symbol.for("react.portal"),V=Symbol.for("react.fragment"),q=Symbol.for("react.strict_mode"),me=Symbol.for("react.profiler"),ve=Symbol.for("react.provider"),ye=Symbol.for("react.context"),qe=Symbol.for("react.forward_ref"),Ze=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),te=Symbol.for("react.lazy"),Q=Symbol.for("react.offscreen"),F=Symbol.iterator;function z(s){return s===null||typeof s!="object"?null:(s=F&&s[F]||s["@@iterator"],typeof s=="function"?s:null)}var U=Object.assign,x;function $(s){if(x===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);x=i&&i[1]||""}return`
`+x+s}var ne=!1;function le(s,i){if(!s||ne)return"";ne=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(N){var d=N}Reflect.construct(s,[],i)}else{try{i.call()}catch(N){d=N}s.call(i.prototype)}else{try{throw Error()}catch(N){d=N}s()}}catch(N){if(N&&d&&typeof N.stack=="string"){for(var p=N.stack.split(`
`),g=d.stack.split(`
`),v=p.length-1,k=g.length-1;1<=v&&0<=k&&p[v]!==g[k];)k--;for(;1<=v&&0<=k;v--,k--)if(p[v]!==g[k]){if(v!==1||k!==1)do if(v--,k--,0>k||p[v]!==g[k]){var O=`
`+p[v].replace(" at new "," at ");return s.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",s.displayName)),O}while(1<=v&&0<=k);break}}}finally{ne=!1,Error.prepareStackTrace=l}return(s=s?s.displayName||s.name:"")?$(s):""}function ce(s){switch(s.tag){case 5:return $(s.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return s=le(s.type,!1),s;case 11:return s=le(s.type.render,!1),s;case 1:return s=le(s.type,!0),s;default:return""}}function be(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case V:return"Fragment";case D:return"Portal";case me:return"Profiler";case q:return"StrictMode";case Ze:return"Suspense";case K:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case ye:return(s.displayName||"Context")+".Consumer";case ve:return(s._context.displayName||"Context")+".Provider";case qe:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case G:return i=s.displayName||null,i!==null?i:be(s.type)||"Memo";case te:i=s._payload,s=s._init;try{return be(s(i))}catch{}}return null}function Ce(s){var i=s.type;switch(s.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=i.render,s=s.displayName||s.name||"",i.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return be(i);case 8:return i===q?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Ie(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ue(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function mt(s){var i=Ue(s)?"checked":"value",l=Object.getOwnPropertyDescriptor(s.constructor.prototype,i),d=""+s[i];if(!s.hasOwnProperty(i)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var p=l.get,g=l.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return p.call(this)},set:function(v){d=""+v,g.call(this,v)}}),Object.defineProperty(s,i,{enumerable:l.enumerable}),{getValue:function(){return d},setValue:function(v){d=""+v},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function Pa(s){s._valueTracker||(s._valueTracker=mt(s))}function Lp(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var l=i.getValue(),d="";return s&&(d=Ue(s)?s.checked?"true":"false":s.value),s=d,s!==l?(i.setValue(s),!0):!1}function wo(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Ul(s,i){var l=i.checked;return U({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??s._wrapperState.initialChecked})}function Mp(s,i){var l=i.defaultValue==null?"":i.defaultValue,d=i.checked!=null?i.checked:i.defaultChecked;l=Ie(i.value!=null?i.value:l),s._wrapperState={initialChecked:d,initialValue:l,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Fp(s,i){i=i.checked,i!=null&&T(s,"checked",i,!1)}function zl(s,i){Fp(s,i);var l=Ie(i.value),d=i.type;if(l!=null)d==="number"?(l===0&&s.value===""||s.value!=l)&&(s.value=""+l):s.value!==""+l&&(s.value=""+l);else if(d==="submit"||d==="reset"){s.removeAttribute("value");return}i.hasOwnProperty("value")?Bl(s,i.type,l):i.hasOwnProperty("defaultValue")&&Bl(s,i.type,Ie(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(s.defaultChecked=!!i.defaultChecked)}function Dp(s,i,l){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var d=i.type;if(!(d!=="submit"&&d!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+s._wrapperState.initialValue,l||i===s.value||(s.value=i),s.defaultValue=i}l=s.name,l!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,l!==""&&(s.name=l)}function Bl(s,i,l){(i!=="number"||wo(s.ownerDocument)!==s)&&(l==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+l&&(s.defaultValue=""+l))}var Is=Array.isArray;function Oa(s,i,l,d){if(s=s.options,i){i={};for(var p=0;p<l.length;p++)i["$"+l[p]]=!0;for(l=0;l<s.length;l++)p=i.hasOwnProperty("$"+s[l].value),s[l].selected!==p&&(s[l].selected=p),p&&d&&(s[l].defaultSelected=!0)}else{for(l=""+Ie(l),i=null,p=0;p<s.length;p++){if(s[p].value===l){s[p].selected=!0,d&&(s[p].defaultSelected=!0);return}i!==null||s[p].disabled||(i=s[p])}i!==null&&(i.selected=!0)}}function Vl(s,i){if(i.dangerouslySetInnerHTML!=null)throw Error(t(91));return U({},i,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function Up(s,i){var l=i.value;if(l==null){if(l=i.children,i=i.defaultValue,l!=null){if(i!=null)throw Error(t(92));if(Is(l)){if(1<l.length)throw Error(t(93));l=l[0]}i=l}i==null&&(i=""),l=i}s._wrapperState={initialValue:Ie(l)}}function zp(s,i){var l=Ie(i.value),d=Ie(i.defaultValue);l!=null&&(l=""+l,l!==s.value&&(s.value=l),i.defaultValue==null&&s.defaultValue!==l&&(s.defaultValue=l)),d!=null&&(s.defaultValue=""+d)}function Bp(s){var i=s.textContent;i===s._wrapperState.initialValue&&i!==""&&i!==null&&(s.value=i)}function Vp(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hl(s,i){return s==null||s==="http://www.w3.org/1999/xhtml"?Vp(i):s==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var vo,Hp=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,l,d,p){MSApp.execUnsafeLocalFunction(function(){return s(i,l,d,p)})}:s}(function(s,i){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=i;else{for(vo=vo||document.createElement("div"),vo.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=vo.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;i.firstChild;)s.appendChild(i.firstChild)}});function Rs(s,i){if(i){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=i;return}}s.textContent=i}var Ns={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},u0=["Webkit","ms","Moz","O"];Object.keys(Ns).forEach(function(s){u0.forEach(function(i){i=i+s.charAt(0).toUpperCase()+s.substring(1),Ns[i]=Ns[s]})});function qp(s,i,l){return i==null||typeof i=="boolean"||i===""?"":l||typeof i!="number"||i===0||Ns.hasOwnProperty(s)&&Ns[s]?(""+i).trim():i+"px"}function Zp(s,i){s=s.style;for(var l in i)if(i.hasOwnProperty(l)){var d=l.indexOf("--")===0,p=qp(l,i[l],d);l==="float"&&(l="cssFloat"),d?s.setProperty(l,p):s[l]=p}}var l0=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ql(s,i){if(i){if(l0[s]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(t(137,s));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(t(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(t(61))}if(i.style!=null&&typeof i.style!="object")throw Error(t(62))}}function Zl(s,i){if(s.indexOf("-")===-1)return typeof i.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wl=null;function Gl(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Jl=null,xa=null,Ta=null;function Wp(s){if(s=ti(s)){if(typeof Jl!="function")throw Error(t(280));var i=s.stateNode;i&&(i=Vo(i),Jl(s.stateNode,s.type,i))}}function Gp(s){xa?Ta?Ta.push(s):Ta=[s]:xa=s}function Jp(){if(xa){var s=xa,i=Ta;if(Ta=xa=null,Wp(s),i)for(s=0;s<i.length;s++)Wp(i[s])}}function Kp(s,i){return s(i)}function Qp(){}var Kl=!1;function Xp(s,i,l){if(Kl)return s(i,l);Kl=!0;try{return Kp(s,i,l)}finally{Kl=!1,(xa!==null||Ta!==null)&&(Qp(),Jp())}}function $s(s,i){var l=s.stateNode;if(l===null)return null;var d=Vo(l);if(d===null)return null;l=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(s=s.type,d=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!d;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(t(231,i,typeof l));return l}var Ql=!1;if(c)try{var js={};Object.defineProperty(js,"passive",{get:function(){Ql=!0}}),window.addEventListener("test",js,js),window.removeEventListener("test",js,js)}catch{Ql=!1}function c0(s,i,l,d,p,g,v,k,O){var N=Array.prototype.slice.call(arguments,3);try{i.apply(l,N)}catch(H){this.onError(H)}}var Ls=!1,bo=null,Eo=!1,Xl=null,d0={onError:function(s){Ls=!0,bo=s}};function f0(s,i,l,d,p,g,v,k,O){Ls=!1,bo=null,c0.apply(d0,arguments)}function h0(s,i,l,d,p,g,v,k,O){if(f0.apply(this,arguments),Ls){if(Ls){var N=bo;Ls=!1,bo=null}else throw Error(t(198));Eo||(Eo=!0,Xl=N)}}function Qr(s){var i=s,l=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,i.flags&4098&&(l=i.return),s=i.return;while(s)}return i.tag===3?l:null}function Yp(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function em(s){if(Qr(s)!==s)throw Error(t(188))}function p0(s){var i=s.alternate;if(!i){if(i=Qr(s),i===null)throw Error(t(188));return i!==s?null:s}for(var l=s,d=i;;){var p=l.return;if(p===null)break;var g=p.alternate;if(g===null){if(d=p.return,d!==null){l=d;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===l)return em(p),s;if(g===d)return em(p),i;g=g.sibling}throw Error(t(188))}if(l.return!==d.return)l=p,d=g;else{for(var v=!1,k=p.child;k;){if(k===l){v=!0,l=p,d=g;break}if(k===d){v=!0,d=p,l=g;break}k=k.sibling}if(!v){for(k=g.child;k;){if(k===l){v=!0,l=g,d=p;break}if(k===d){v=!0,d=g,l=p;break}k=k.sibling}if(!v)throw Error(t(189))}}if(l.alternate!==d)throw Error(t(190))}if(l.tag!==3)throw Error(t(188));return l.stateNode.current===l?s:i}function tm(s){return s=p0(s),s!==null?nm(s):null}function nm(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var i=nm(s);if(i!==null)return i;s=s.sibling}return null}var rm=e.unstable_scheduleCallback,am=e.unstable_cancelCallback,m0=e.unstable_shouldYield,g0=e.unstable_requestPaint,Ye=e.unstable_now,y0=e.unstable_getCurrentPriorityLevel,Yl=e.unstable_ImmediatePriority,sm=e.unstable_UserBlockingPriority,So=e.unstable_NormalPriority,_0=e.unstable_LowPriority,im=e.unstable_IdlePriority,ko=null,Bn=null;function w0(s){if(Bn&&typeof Bn.onCommitFiberRoot=="function")try{Bn.onCommitFiberRoot(ko,s,void 0,(s.current.flags&128)===128)}catch{}}var mn=Math.clz32?Math.clz32:E0,v0=Math.log,b0=Math.LN2;function E0(s){return s>>>=0,s===0?32:31-(v0(s)/b0|0)|0}var Po=64,Oo=4194304;function Ms(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function xo(s,i){var l=s.pendingLanes;if(l===0)return 0;var d=0,p=s.suspendedLanes,g=s.pingedLanes,v=l&268435455;if(v!==0){var k=v&~p;k!==0?d=Ms(k):(g&=v,g!==0&&(d=Ms(g)))}else v=l&~p,v!==0?d=Ms(v):g!==0&&(d=Ms(g));if(d===0)return 0;if(i!==0&&i!==d&&!(i&p)&&(p=d&-d,g=i&-i,p>=g||p===16&&(g&4194240)!==0))return i;if(d&4&&(d|=l&16),i=s.entangledLanes,i!==0)for(s=s.entanglements,i&=d;0<i;)l=31-mn(i),p=1<<l,d|=s[l],i&=~p;return d}function S0(s,i){switch(s){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function k0(s,i){for(var l=s.suspendedLanes,d=s.pingedLanes,p=s.expirationTimes,g=s.pendingLanes;0<g;){var v=31-mn(g),k=1<<v,O=p[v];O===-1?(!(k&l)||k&d)&&(p[v]=S0(k,i)):O<=i&&(s.expiredLanes|=k),g&=~k}}function ec(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function om(){var s=Po;return Po<<=1,!(Po&4194240)&&(Po=64),s}function tc(s){for(var i=[],l=0;31>l;l++)i.push(s);return i}function Fs(s,i,l){s.pendingLanes|=i,i!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,i=31-mn(i),s[i]=l}function P0(s,i){var l=s.pendingLanes&~i;s.pendingLanes=i,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=i,s.mutableReadLanes&=i,s.entangledLanes&=i,i=s.entanglements;var d=s.eventTimes;for(s=s.expirationTimes;0<l;){var p=31-mn(l),g=1<<p;i[p]=0,d[p]=-1,s[p]=-1,l&=~g}}function nc(s,i){var l=s.entangledLanes|=i;for(s=s.entanglements;l;){var d=31-mn(l),p=1<<d;p&i|s[d]&i&&(s[d]|=i),l&=~p}}var Me=0;function um(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var lm,rc,cm,dm,fm,ac=!1,To=[],yr=null,_r=null,wr=null,Ds=new Map,Us=new Map,vr=[],O0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hm(s,i){switch(s){case"focusin":case"focusout":yr=null;break;case"dragenter":case"dragleave":_r=null;break;case"mouseover":case"mouseout":wr=null;break;case"pointerover":case"pointerout":Ds.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Us.delete(i.pointerId)}}function zs(s,i,l,d,p,g){return s===null||s.nativeEvent!==g?(s={blockedOn:i,domEventName:l,eventSystemFlags:d,nativeEvent:g,targetContainers:[p]},i!==null&&(i=ti(i),i!==null&&rc(i)),s):(s.eventSystemFlags|=d,i=s.targetContainers,p!==null&&i.indexOf(p)===-1&&i.push(p),s)}function x0(s,i,l,d,p){switch(i){case"focusin":return yr=zs(yr,s,i,l,d,p),!0;case"dragenter":return _r=zs(_r,s,i,l,d,p),!0;case"mouseover":return wr=zs(wr,s,i,l,d,p),!0;case"pointerover":var g=p.pointerId;return Ds.set(g,zs(Ds.get(g)||null,s,i,l,d,p)),!0;case"gotpointercapture":return g=p.pointerId,Us.set(g,zs(Us.get(g)||null,s,i,l,d,p)),!0}return!1}function pm(s){var i=Xr(s.target);if(i!==null){var l=Qr(i);if(l!==null){if(i=l.tag,i===13){if(i=Yp(l),i!==null){s.blockedOn=i,fm(s.priority,function(){cm(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Co(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var l=ic(s.domEventName,s.eventSystemFlags,i[0],s.nativeEvent);if(l===null){l=s.nativeEvent;var d=new l.constructor(l.type,l);Wl=d,l.target.dispatchEvent(d),Wl=null}else return i=ti(l),i!==null&&rc(i),s.blockedOn=l,!1;i.shift()}return!0}function mm(s,i,l){Co(s)&&l.delete(i)}function T0(){ac=!1,yr!==null&&Co(yr)&&(yr=null),_r!==null&&Co(_r)&&(_r=null),wr!==null&&Co(wr)&&(wr=null),Ds.forEach(mm),Us.forEach(mm)}function Bs(s,i){s.blockedOn===i&&(s.blockedOn=null,ac||(ac=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,T0)))}function Vs(s){function i(p){return Bs(p,s)}if(0<To.length){Bs(To[0],s);for(var l=1;l<To.length;l++){var d=To[l];d.blockedOn===s&&(d.blockedOn=null)}}for(yr!==null&&Bs(yr,s),_r!==null&&Bs(_r,s),wr!==null&&Bs(wr,s),Ds.forEach(i),Us.forEach(i),l=0;l<vr.length;l++)d=vr[l],d.blockedOn===s&&(d.blockedOn=null);for(;0<vr.length&&(l=vr[0],l.blockedOn===null);)pm(l),l.blockedOn===null&&vr.shift()}var Ca=M.ReactCurrentBatchConfig,Ao=!0;function C0(s,i,l,d){var p=Me,g=Ca.transition;Ca.transition=null;try{Me=1,sc(s,i,l,d)}finally{Me=p,Ca.transition=g}}function A0(s,i,l,d){var p=Me,g=Ca.transition;Ca.transition=null;try{Me=4,sc(s,i,l,d)}finally{Me=p,Ca.transition=g}}function sc(s,i,l,d){if(Ao){var p=ic(s,i,l,d);if(p===null)Sc(s,i,d,Io,l),hm(s,d);else if(x0(p,s,i,l,d))d.stopPropagation();else if(hm(s,d),i&4&&-1<O0.indexOf(s)){for(;p!==null;){var g=ti(p);if(g!==null&&lm(g),g=ic(s,i,l,d),g===null&&Sc(s,i,d,Io,l),g===p)break;p=g}p!==null&&d.stopPropagation()}else Sc(s,i,d,null,l)}}var Io=null;function ic(s,i,l,d){if(Io=null,s=Gl(d),s=Xr(s),s!==null)if(i=Qr(s),i===null)s=null;else if(l=i.tag,l===13){if(s=Yp(i),s!==null)return s;s=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null);return Io=s,null}function gm(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(y0()){case Yl:return 1;case sm:return 4;case So:case _0:return 16;case im:return 536870912;default:return 16}default:return 16}}var br=null,oc=null,Ro=null;function ym(){if(Ro)return Ro;var s,i=oc,l=i.length,d,p="value"in br?br.value:br.textContent,g=p.length;for(s=0;s<l&&i[s]===p[s];s++);var v=l-s;for(d=1;d<=v&&i[l-d]===p[g-d];d++);return Ro=p.slice(s,1<d?1-d:void 0)}function No(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function $o(){return!0}function _m(){return!1}function Kt(s){function i(l,d,p,g,v){this._reactName=l,this._targetInst=p,this.type=d,this.nativeEvent=g,this.target=v,this.currentTarget=null;for(var k in s)s.hasOwnProperty(k)&&(l=s[k],this[k]=l?l(g):g[k]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?$o:_m,this.isPropagationStopped=_m,this}return U(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=$o)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=$o)},persist:function(){},isPersistent:$o}),i}var Aa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uc=Kt(Aa),Hs=U({},Aa,{view:0,detail:0}),I0=Kt(Hs),lc,cc,qs,jo=U({},Hs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fc,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==qs&&(qs&&s.type==="mousemove"?(lc=s.screenX-qs.screenX,cc=s.screenY-qs.screenY):cc=lc=0,qs=s),lc)},movementY:function(s){return"movementY"in s?s.movementY:cc}}),wm=Kt(jo),R0=U({},jo,{dataTransfer:0}),N0=Kt(R0),$0=U({},Hs,{relatedTarget:0}),dc=Kt($0),j0=U({},Aa,{animationName:0,elapsedTime:0,pseudoElement:0}),L0=Kt(j0),M0=U({},Aa,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),F0=Kt(M0),D0=U({},Aa,{data:0}),vm=Kt(D0),U0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},z0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},B0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function V0(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=B0[s])?!!i[s]:!1}function fc(){return V0}var H0=U({},Hs,{key:function(s){if(s.key){var i=U0[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=No(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?z0[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fc,charCode:function(s){return s.type==="keypress"?No(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?No(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),q0=Kt(H0),Z0=U({},jo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bm=Kt(Z0),W0=U({},Hs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fc}),G0=Kt(W0),J0=U({},Aa,{propertyName:0,elapsedTime:0,pseudoElement:0}),K0=Kt(J0),Q0=U({},jo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),X0=Kt(Q0),Y0=[9,13,27,32],hc=c&&"CompositionEvent"in window,Zs=null;c&&"documentMode"in document&&(Zs=document.documentMode);var eE=c&&"TextEvent"in window&&!Zs,Em=c&&(!hc||Zs&&8<Zs&&11>=Zs),Sm=" ",km=!1;function Pm(s,i){switch(s){case"keyup":return Y0.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Om(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Ia=!1;function tE(s,i){switch(s){case"compositionend":return Om(i);case"keypress":return i.which!==32?null:(km=!0,Sm);case"textInput":return s=i.data,s===Sm&&km?null:s;default:return null}}function nE(s,i){if(Ia)return s==="compositionend"||!hc&&Pm(s,i)?(s=ym(),Ro=oc=br=null,Ia=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Em&&i.locale!=="ko"?null:i.data;default:return null}}var rE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xm(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!rE[s.type]:i==="textarea"}function Tm(s,i,l,d){Gp(d),i=Uo(i,"onChange"),0<i.length&&(l=new uc("onChange","change",null,l,d),s.push({event:l,listeners:i}))}var Ws=null,Gs=null;function aE(s){Zm(s,0)}function Lo(s){var i=La(s);if(Lp(i))return s}function sE(s,i){if(s==="change")return i}var Cm=!1;if(c){var pc;if(c){var mc="oninput"in document;if(!mc){var Am=document.createElement("div");Am.setAttribute("oninput","return;"),mc=typeof Am.oninput=="function"}pc=mc}else pc=!1;Cm=pc&&(!document.documentMode||9<document.documentMode)}function Im(){Ws&&(Ws.detachEvent("onpropertychange",Rm),Gs=Ws=null)}function Rm(s){if(s.propertyName==="value"&&Lo(Gs)){var i=[];Tm(i,Gs,s,Gl(s)),Xp(aE,i)}}function iE(s,i,l){s==="focusin"?(Im(),Ws=i,Gs=l,Ws.attachEvent("onpropertychange",Rm)):s==="focusout"&&Im()}function oE(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Lo(Gs)}function uE(s,i){if(s==="click")return Lo(i)}function lE(s,i){if(s==="input"||s==="change")return Lo(i)}function cE(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var gn=typeof Object.is=="function"?Object.is:cE;function Js(s,i){if(gn(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var l=Object.keys(s),d=Object.keys(i);if(l.length!==d.length)return!1;for(d=0;d<l.length;d++){var p=l[d];if(!f.call(i,p)||!gn(s[p],i[p]))return!1}return!0}function Nm(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function $m(s,i){var l=Nm(s);s=0;for(var d;l;){if(l.nodeType===3){if(d=s+l.textContent.length,s<=i&&d>=i)return{node:l,offset:i-s};s=d}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Nm(l)}}function jm(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?jm(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function Lm(){for(var s=window,i=wo();i instanceof s.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)s=i.contentWindow;else break;i=wo(s.document)}return i}function gc(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}function dE(s){var i=Lm(),l=s.focusedElem,d=s.selectionRange;if(i!==l&&l&&l.ownerDocument&&jm(l.ownerDocument.documentElement,l)){if(d!==null&&gc(l)){if(i=d.start,s=d.end,s===void 0&&(s=i),"selectionStart"in l)l.selectionStart=i,l.selectionEnd=Math.min(s,l.value.length);else if(s=(i=l.ownerDocument||document)&&i.defaultView||window,s.getSelection){s=s.getSelection();var p=l.textContent.length,g=Math.min(d.start,p);d=d.end===void 0?g:Math.min(d.end,p),!s.extend&&g>d&&(p=d,d=g,g=p),p=$m(l,g);var v=$m(l,d);p&&v&&(s.rangeCount!==1||s.anchorNode!==p.node||s.anchorOffset!==p.offset||s.focusNode!==v.node||s.focusOffset!==v.offset)&&(i=i.createRange(),i.setStart(p.node,p.offset),s.removeAllRanges(),g>d?(s.addRange(i),s.extend(v.node,v.offset)):(i.setEnd(v.node,v.offset),s.addRange(i)))}}for(i=[],s=l;s=s.parentNode;)s.nodeType===1&&i.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<i.length;l++)s=i[l],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var fE=c&&"documentMode"in document&&11>=document.documentMode,Ra=null,yc=null,Ks=null,_c=!1;function Mm(s,i,l){var d=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;_c||Ra==null||Ra!==wo(d)||(d=Ra,"selectionStart"in d&&gc(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Ks&&Js(Ks,d)||(Ks=d,d=Uo(yc,"onSelect"),0<d.length&&(i=new uc("onSelect","select",null,i,l),s.push({event:i,listeners:d}),i.target=Ra)))}function Mo(s,i){var l={};return l[s.toLowerCase()]=i.toLowerCase(),l["Webkit"+s]="webkit"+i,l["Moz"+s]="moz"+i,l}var Na={animationend:Mo("Animation","AnimationEnd"),animationiteration:Mo("Animation","AnimationIteration"),animationstart:Mo("Animation","AnimationStart"),transitionend:Mo("Transition","TransitionEnd")},wc={},Fm={};c&&(Fm=document.createElement("div").style,"AnimationEvent"in window||(delete Na.animationend.animation,delete Na.animationiteration.animation,delete Na.animationstart.animation),"TransitionEvent"in window||delete Na.transitionend.transition);function Fo(s){if(wc[s])return wc[s];if(!Na[s])return s;var i=Na[s],l;for(l in i)if(i.hasOwnProperty(l)&&l in Fm)return wc[s]=i[l];return s}var Dm=Fo("animationend"),Um=Fo("animationiteration"),zm=Fo("animationstart"),Bm=Fo("transitionend"),Vm=new Map,Hm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Er(s,i){Vm.set(s,i),o(i,[s])}for(var vc=0;vc<Hm.length;vc++){var bc=Hm[vc],hE=bc.toLowerCase(),pE=bc[0].toUpperCase()+bc.slice(1);Er(hE,"on"+pE)}Er(Dm,"onAnimationEnd"),Er(Um,"onAnimationIteration"),Er(zm,"onAnimationStart"),Er("dblclick","onDoubleClick"),Er("focusin","onFocus"),Er("focusout","onBlur"),Er(Bm,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qs));function qm(s,i,l){var d=s.type||"unknown-event";s.currentTarget=l,h0(d,i,void 0,s),s.currentTarget=null}function Zm(s,i){i=(i&4)!==0;for(var l=0;l<s.length;l++){var d=s[l],p=d.event;d=d.listeners;e:{var g=void 0;if(i)for(var v=d.length-1;0<=v;v--){var k=d[v],O=k.instance,N=k.currentTarget;if(k=k.listener,O!==g&&p.isPropagationStopped())break e;qm(p,k,N),g=O}else for(v=0;v<d.length;v++){if(k=d[v],O=k.instance,N=k.currentTarget,k=k.listener,O!==g&&p.isPropagationStopped())break e;qm(p,k,N),g=O}}}if(Eo)throw s=Xl,Eo=!1,Xl=null,s}function Ve(s,i){var l=i[Cc];l===void 0&&(l=i[Cc]=new Set);var d=s+"__bubble";l.has(d)||(Wm(i,s,2,!1),l.add(d))}function Ec(s,i,l){var d=0;i&&(d|=4),Wm(l,s,d,i)}var Do="_reactListening"+Math.random().toString(36).slice(2);function Xs(s){if(!s[Do]){s[Do]=!0,n.forEach(function(l){l!=="selectionchange"&&(mE.has(l)||Ec(l,!1,s),Ec(l,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[Do]||(i[Do]=!0,Ec("selectionchange",!1,i))}}function Wm(s,i,l,d){switch(gm(i)){case 1:var p=C0;break;case 4:p=A0;break;default:p=sc}l=p.bind(null,i,l,s),p=void 0,!Ql||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(p=!0),d?p!==void 0?s.addEventListener(i,l,{capture:!0,passive:p}):s.addEventListener(i,l,!0):p!==void 0?s.addEventListener(i,l,{passive:p}):s.addEventListener(i,l,!1)}function Sc(s,i,l,d,p){var g=d;if(!(i&1)&&!(i&2)&&d!==null)e:for(;;){if(d===null)return;var v=d.tag;if(v===3||v===4){var k=d.stateNode.containerInfo;if(k===p||k.nodeType===8&&k.parentNode===p)break;if(v===4)for(v=d.return;v!==null;){var O=v.tag;if((O===3||O===4)&&(O=v.stateNode.containerInfo,O===p||O.nodeType===8&&O.parentNode===p))return;v=v.return}for(;k!==null;){if(v=Xr(k),v===null)return;if(O=v.tag,O===5||O===6){d=g=v;continue e}k=k.parentNode}}d=d.return}Xp(function(){var N=g,H=Gl(l),Z=[];e:{var B=Vm.get(s);if(B!==void 0){var Y=uc,ae=s;switch(s){case"keypress":if(No(l)===0)break e;case"keydown":case"keyup":Y=q0;break;case"focusin":ae="focus",Y=dc;break;case"focusout":ae="blur",Y=dc;break;case"beforeblur":case"afterblur":Y=dc;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=wm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=N0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=G0;break;case Dm:case Um:case zm:Y=L0;break;case Bm:Y=K0;break;case"scroll":Y=I0;break;case"wheel":Y=X0;break;case"copy":case"cut":case"paste":Y=F0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=bm}var se=(i&4)!==0,et=!se&&s==="scroll",I=se?B!==null?B+"Capture":null:B;se=[];for(var A=N,R;A!==null;){R=A;var J=R.stateNode;if(R.tag===5&&J!==null&&(R=J,I!==null&&(J=$s(A,I),J!=null&&se.push(Ys(A,J,R)))),et)break;A=A.return}0<se.length&&(B=new Y(B,ae,null,l,H),Z.push({event:B,listeners:se}))}}if(!(i&7)){e:{if(B=s==="mouseover"||s==="pointerover",Y=s==="mouseout"||s==="pointerout",B&&l!==Wl&&(ae=l.relatedTarget||l.fromElement)&&(Xr(ae)||ae[er]))break e;if((Y||B)&&(B=H.window===H?H:(B=H.ownerDocument)?B.defaultView||B.parentWindow:window,Y?(ae=l.relatedTarget||l.toElement,Y=N,ae=ae?Xr(ae):null,ae!==null&&(et=Qr(ae),ae!==et||ae.tag!==5&&ae.tag!==6)&&(ae=null)):(Y=null,ae=N),Y!==ae)){if(se=wm,J="onMouseLeave",I="onMouseEnter",A="mouse",(s==="pointerout"||s==="pointerover")&&(se=bm,J="onPointerLeave",I="onPointerEnter",A="pointer"),et=Y==null?B:La(Y),R=ae==null?B:La(ae),B=new se(J,A+"leave",Y,l,H),B.target=et,B.relatedTarget=R,J=null,Xr(H)===N&&(se=new se(I,A+"enter",ae,l,H),se.target=R,se.relatedTarget=et,J=se),et=J,Y&&ae)t:{for(se=Y,I=ae,A=0,R=se;R;R=$a(R))A++;for(R=0,J=I;J;J=$a(J))R++;for(;0<A-R;)se=$a(se),A--;for(;0<R-A;)I=$a(I),R--;for(;A--;){if(se===I||I!==null&&se===I.alternate)break t;se=$a(se),I=$a(I)}se=null}else se=null;Y!==null&&Gm(Z,B,Y,se,!1),ae!==null&&et!==null&&Gm(Z,et,ae,se,!0)}}e:{if(B=N?La(N):window,Y=B.nodeName&&B.nodeName.toLowerCase(),Y==="select"||Y==="input"&&B.type==="file")var ie=sE;else if(xm(B))if(Cm)ie=lE;else{ie=oE;var fe=iE}else(Y=B.nodeName)&&Y.toLowerCase()==="input"&&(B.type==="checkbox"||B.type==="radio")&&(ie=uE);if(ie&&(ie=ie(s,N))){Tm(Z,ie,l,H);break e}fe&&fe(s,B,N),s==="focusout"&&(fe=B._wrapperState)&&fe.controlled&&B.type==="number"&&Bl(B,"number",B.value)}switch(fe=N?La(N):window,s){case"focusin":(xm(fe)||fe.contentEditable==="true")&&(Ra=fe,yc=N,Ks=null);break;case"focusout":Ks=yc=Ra=null;break;case"mousedown":_c=!0;break;case"contextmenu":case"mouseup":case"dragend":_c=!1,Mm(Z,l,H);break;case"selectionchange":if(fE)break;case"keydown":case"keyup":Mm(Z,l,H)}var he;if(hc)e:{switch(s){case"compositionstart":var ge="onCompositionStart";break e;case"compositionend":ge="onCompositionEnd";break e;case"compositionupdate":ge="onCompositionUpdate";break e}ge=void 0}else Ia?Pm(s,l)&&(ge="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(ge="onCompositionStart");ge&&(Em&&l.locale!=="ko"&&(Ia||ge!=="onCompositionStart"?ge==="onCompositionEnd"&&Ia&&(he=ym()):(br=H,oc="value"in br?br.value:br.textContent,Ia=!0)),fe=Uo(N,ge),0<fe.length&&(ge=new vm(ge,s,null,l,H),Z.push({event:ge,listeners:fe}),he?ge.data=he:(he=Om(l),he!==null&&(ge.data=he)))),(he=eE?tE(s,l):nE(s,l))&&(N=Uo(N,"onBeforeInput"),0<N.length&&(H=new vm("onBeforeInput","beforeinput",null,l,H),Z.push({event:H,listeners:N}),H.data=he))}Zm(Z,i)})}function Ys(s,i,l){return{instance:s,listener:i,currentTarget:l}}function Uo(s,i){for(var l=i+"Capture",d=[];s!==null;){var p=s,g=p.stateNode;p.tag===5&&g!==null&&(p=g,g=$s(s,l),g!=null&&d.unshift(Ys(s,g,p)),g=$s(s,i),g!=null&&d.push(Ys(s,g,p))),s=s.return}return d}function $a(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function Gm(s,i,l,d,p){for(var g=i._reactName,v=[];l!==null&&l!==d;){var k=l,O=k.alternate,N=k.stateNode;if(O!==null&&O===d)break;k.tag===5&&N!==null&&(k=N,p?(O=$s(l,g),O!=null&&v.unshift(Ys(l,O,k))):p||(O=$s(l,g),O!=null&&v.push(Ys(l,O,k)))),l=l.return}v.length!==0&&s.push({event:i,listeners:v})}var gE=/\r\n?/g,yE=/\u0000|\uFFFD/g;function Jm(s){return(typeof s=="string"?s:""+s).replace(gE,`
`).replace(yE,"")}function zo(s,i,l){if(i=Jm(i),Jm(s)!==i&&l)throw Error(t(425))}function Bo(){}var kc=null,Pc=null;function Oc(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var xc=typeof setTimeout=="function"?setTimeout:void 0,_E=typeof clearTimeout=="function"?clearTimeout:void 0,Km=typeof Promise=="function"?Promise:void 0,wE=typeof queueMicrotask=="function"?queueMicrotask:typeof Km<"u"?function(s){return Km.resolve(null).then(s).catch(vE)}:xc;function vE(s){setTimeout(function(){throw s})}function Tc(s,i){var l=i,d=0;do{var p=l.nextSibling;if(s.removeChild(l),p&&p.nodeType===8)if(l=p.data,l==="/$"){if(d===0){s.removeChild(p),Vs(i);return}d--}else l!=="$"&&l!=="$?"&&l!=="$!"||d++;l=p}while(l);Vs(i)}function Sr(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return s}function Qm(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"){if(i===0)return s;i--}else l==="/$"&&i++}s=s.previousSibling}return null}var ja=Math.random().toString(36).slice(2),Vn="__reactFiber$"+ja,ei="__reactProps$"+ja,er="__reactContainer$"+ja,Cc="__reactEvents$"+ja,bE="__reactListeners$"+ja,EE="__reactHandles$"+ja;function Xr(s){var i=s[Vn];if(i)return i;for(var l=s.parentNode;l;){if(i=l[er]||l[Vn]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(s=Qm(s);s!==null;){if(l=s[Vn])return l;s=Qm(s)}return i}s=l,l=s.parentNode}return null}function ti(s){return s=s[Vn]||s[er],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function La(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(t(33))}function Vo(s){return s[ei]||null}var Ac=[],Ma=-1;function kr(s){return{current:s}}function He(s){0>Ma||(s.current=Ac[Ma],Ac[Ma]=null,Ma--)}function Be(s,i){Ma++,Ac[Ma]=s.current,s.current=i}var Pr={},bt=kr(Pr),Mt=kr(!1),Yr=Pr;function Fa(s,i){var l=s.type.contextTypes;if(!l)return Pr;var d=s.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===i)return d.__reactInternalMemoizedMaskedChildContext;var p={},g;for(g in l)p[g]=i[g];return d&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=i,s.__reactInternalMemoizedMaskedChildContext=p),p}function Ft(s){return s=s.childContextTypes,s!=null}function Ho(){He(Mt),He(bt)}function Xm(s,i,l){if(bt.current!==Pr)throw Error(t(168));Be(bt,i),Be(Mt,l)}function Ym(s,i,l){var d=s.stateNode;if(i=i.childContextTypes,typeof d.getChildContext!="function")return l;d=d.getChildContext();for(var p in d)if(!(p in i))throw Error(t(108,Ce(s)||"Unknown",p));return U({},l,d)}function qo(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Pr,Yr=bt.current,Be(bt,s),Be(Mt,Mt.current),!0}function eg(s,i,l){var d=s.stateNode;if(!d)throw Error(t(169));l?(s=Ym(s,i,Yr),d.__reactInternalMemoizedMergedChildContext=s,He(Mt),He(bt),Be(bt,s)):He(Mt),Be(Mt,l)}var tr=null,Zo=!1,Ic=!1;function tg(s){tr===null?tr=[s]:tr.push(s)}function SE(s){Zo=!0,tg(s)}function Or(){if(!Ic&&tr!==null){Ic=!0;var s=0,i=Me;try{var l=tr;for(Me=1;s<l.length;s++){var d=l[s];do d=d(!0);while(d!==null)}tr=null,Zo=!1}catch(p){throw tr!==null&&(tr=tr.slice(s+1)),rm(Yl,Or),p}finally{Me=i,Ic=!1}}return null}var Da=[],Ua=0,Wo=null,Go=0,on=[],un=0,ea=null,nr=1,rr="";function ta(s,i){Da[Ua++]=Go,Da[Ua++]=Wo,Wo=s,Go=i}function ng(s,i,l){on[un++]=nr,on[un++]=rr,on[un++]=ea,ea=s;var d=nr;s=rr;var p=32-mn(d)-1;d&=~(1<<p),l+=1;var g=32-mn(i)+p;if(30<g){var v=p-p%5;g=(d&(1<<v)-1).toString(32),d>>=v,p-=v,nr=1<<32-mn(i)+p|l<<p|d,rr=g+s}else nr=1<<g|l<<p|d,rr=s}function Rc(s){s.return!==null&&(ta(s,1),ng(s,1,0))}function Nc(s){for(;s===Wo;)Wo=Da[--Ua],Da[Ua]=null,Go=Da[--Ua],Da[Ua]=null;for(;s===ea;)ea=on[--un],on[un]=null,rr=on[--un],on[un]=null,nr=on[--un],on[un]=null}var Qt=null,Xt=null,We=!1,yn=null;function rg(s,i){var l=fn(5,null,null,0);l.elementType="DELETED",l.stateNode=i,l.return=s,i=s.deletions,i===null?(s.deletions=[l],s.flags|=16):i.push(l)}function ag(s,i){switch(s.tag){case 5:var l=s.type;return i=i.nodeType!==1||l.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(s.stateNode=i,Qt=s,Xt=Sr(i.firstChild),!0):!1;case 6:return i=s.pendingProps===""||i.nodeType!==3?null:i,i!==null?(s.stateNode=i,Qt=s,Xt=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(l=ea!==null?{id:nr,overflow:rr}:null,s.memoizedState={dehydrated:i,treeContext:l,retryLane:1073741824},l=fn(18,null,null,0),l.stateNode=i,l.return=s,s.child=l,Qt=s,Xt=null,!0):!1;default:return!1}}function $c(s){return(s.mode&1)!==0&&(s.flags&128)===0}function jc(s){if(We){var i=Xt;if(i){var l=i;if(!ag(s,i)){if($c(s))throw Error(t(418));i=Sr(l.nextSibling);var d=Qt;i&&ag(s,i)?rg(d,l):(s.flags=s.flags&-4097|2,We=!1,Qt=s)}}else{if($c(s))throw Error(t(418));s.flags=s.flags&-4097|2,We=!1,Qt=s}}}function sg(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Qt=s}function Jo(s){if(s!==Qt)return!1;if(!We)return sg(s),We=!0,!1;var i;if((i=s.tag!==3)&&!(i=s.tag!==5)&&(i=s.type,i=i!=="head"&&i!=="body"&&!Oc(s.type,s.memoizedProps)),i&&(i=Xt)){if($c(s))throw ig(),Error(t(418));for(;i;)rg(s,i),i=Sr(i.nextSibling)}if(sg(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(t(317));e:{for(s=s.nextSibling,i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="/$"){if(i===0){Xt=Sr(s.nextSibling);break e}i--}else l!=="$"&&l!=="$!"&&l!=="$?"||i++}s=s.nextSibling}Xt=null}}else Xt=Qt?Sr(s.stateNode.nextSibling):null;return!0}function ig(){for(var s=Xt;s;)s=Sr(s.nextSibling)}function za(){Xt=Qt=null,We=!1}function Lc(s){yn===null?yn=[s]:yn.push(s)}var kE=M.ReactCurrentBatchConfig;function ni(s,i,l){if(s=l.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(t(309));var d=l.stateNode}if(!d)throw Error(t(147,s));var p=d,g=""+s;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===g?i.ref:(i=function(v){var k=p.refs;v===null?delete k[g]:k[g]=v},i._stringRef=g,i)}if(typeof s!="string")throw Error(t(284));if(!l._owner)throw Error(t(290,s))}return s}function Ko(s,i){throw s=Object.prototype.toString.call(i),Error(t(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s))}function og(s){var i=s._init;return i(s._payload)}function ug(s){function i(I,A){if(s){var R=I.deletions;R===null?(I.deletions=[A],I.flags|=16):R.push(A)}}function l(I,A){if(!s)return null;for(;A!==null;)i(I,A),A=A.sibling;return null}function d(I,A){for(I=new Map;A!==null;)A.key!==null?I.set(A.key,A):I.set(A.index,A),A=A.sibling;return I}function p(I,A){return I=$r(I,A),I.index=0,I.sibling=null,I}function g(I,A,R){return I.index=R,s?(R=I.alternate,R!==null?(R=R.index,R<A?(I.flags|=2,A):R):(I.flags|=2,A)):(I.flags|=1048576,A)}function v(I){return s&&I.alternate===null&&(I.flags|=2),I}function k(I,A,R,J){return A===null||A.tag!==6?(A=xd(R,I.mode,J),A.return=I,A):(A=p(A,R),A.return=I,A)}function O(I,A,R,J){var ie=R.type;return ie===V?H(I,A,R.props.children,J,R.key):A!==null&&(A.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===te&&og(ie)===A.type)?(J=p(A,R.props),J.ref=ni(I,A,R),J.return=I,J):(J=vu(R.type,R.key,R.props,null,I.mode,J),J.ref=ni(I,A,R),J.return=I,J)}function N(I,A,R,J){return A===null||A.tag!==4||A.stateNode.containerInfo!==R.containerInfo||A.stateNode.implementation!==R.implementation?(A=Td(R,I.mode,J),A.return=I,A):(A=p(A,R.children||[]),A.return=I,A)}function H(I,A,R,J,ie){return A===null||A.tag!==7?(A=la(R,I.mode,J,ie),A.return=I,A):(A=p(A,R),A.return=I,A)}function Z(I,A,R){if(typeof A=="string"&&A!==""||typeof A=="number")return A=xd(""+A,I.mode,R),A.return=I,A;if(typeof A=="object"&&A!==null){switch(A.$$typeof){case j:return R=vu(A.type,A.key,A.props,null,I.mode,R),R.ref=ni(I,null,A),R.return=I,R;case D:return A=Td(A,I.mode,R),A.return=I,A;case te:var J=A._init;return Z(I,J(A._payload),R)}if(Is(A)||z(A))return A=la(A,I.mode,R,null),A.return=I,A;Ko(I,A)}return null}function B(I,A,R,J){var ie=A!==null?A.key:null;if(typeof R=="string"&&R!==""||typeof R=="number")return ie!==null?null:k(I,A,""+R,J);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case j:return R.key===ie?O(I,A,R,J):null;case D:return R.key===ie?N(I,A,R,J):null;case te:return ie=R._init,B(I,A,ie(R._payload),J)}if(Is(R)||z(R))return ie!==null?null:H(I,A,R,J,null);Ko(I,R)}return null}function Y(I,A,R,J,ie){if(typeof J=="string"&&J!==""||typeof J=="number")return I=I.get(R)||null,k(A,I,""+J,ie);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case j:return I=I.get(J.key===null?R:J.key)||null,O(A,I,J,ie);case D:return I=I.get(J.key===null?R:J.key)||null,N(A,I,J,ie);case te:var fe=J._init;return Y(I,A,R,fe(J._payload),ie)}if(Is(J)||z(J))return I=I.get(R)||null,H(A,I,J,ie,null);Ko(A,J)}return null}function ae(I,A,R,J){for(var ie=null,fe=null,he=A,ge=A=0,dt=null;he!==null&&ge<R.length;ge++){he.index>ge?(dt=he,he=null):dt=he.sibling;var Re=B(I,he,R[ge],J);if(Re===null){he===null&&(he=dt);break}s&&he&&Re.alternate===null&&i(I,he),A=g(Re,A,ge),fe===null?ie=Re:fe.sibling=Re,fe=Re,he=dt}if(ge===R.length)return l(I,he),We&&ta(I,ge),ie;if(he===null){for(;ge<R.length;ge++)he=Z(I,R[ge],J),he!==null&&(A=g(he,A,ge),fe===null?ie=he:fe.sibling=he,fe=he);return We&&ta(I,ge),ie}for(he=d(I,he);ge<R.length;ge++)dt=Y(he,I,ge,R[ge],J),dt!==null&&(s&&dt.alternate!==null&&he.delete(dt.key===null?ge:dt.key),A=g(dt,A,ge),fe===null?ie=dt:fe.sibling=dt,fe=dt);return s&&he.forEach(function(jr){return i(I,jr)}),We&&ta(I,ge),ie}function se(I,A,R,J){var ie=z(R);if(typeof ie!="function")throw Error(t(150));if(R=ie.call(R),R==null)throw Error(t(151));for(var fe=ie=null,he=A,ge=A=0,dt=null,Re=R.next();he!==null&&!Re.done;ge++,Re=R.next()){he.index>ge?(dt=he,he=null):dt=he.sibling;var jr=B(I,he,Re.value,J);if(jr===null){he===null&&(he=dt);break}s&&he&&jr.alternate===null&&i(I,he),A=g(jr,A,ge),fe===null?ie=jr:fe.sibling=jr,fe=jr,he=dt}if(Re.done)return l(I,he),We&&ta(I,ge),ie;if(he===null){for(;!Re.done;ge++,Re=R.next())Re=Z(I,Re.value,J),Re!==null&&(A=g(Re,A,ge),fe===null?ie=Re:fe.sibling=Re,fe=Re);return We&&ta(I,ge),ie}for(he=d(I,he);!Re.done;ge++,Re=R.next())Re=Y(he,I,ge,Re.value,J),Re!==null&&(s&&Re.alternate!==null&&he.delete(Re.key===null?ge:Re.key),A=g(Re,A,ge),fe===null?ie=Re:fe.sibling=Re,fe=Re);return s&&he.forEach(function(nS){return i(I,nS)}),We&&ta(I,ge),ie}function et(I,A,R,J){if(typeof R=="object"&&R!==null&&R.type===V&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case j:e:{for(var ie=R.key,fe=A;fe!==null;){if(fe.key===ie){if(ie=R.type,ie===V){if(fe.tag===7){l(I,fe.sibling),A=p(fe,R.props.children),A.return=I,I=A;break e}}else if(fe.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===te&&og(ie)===fe.type){l(I,fe.sibling),A=p(fe,R.props),A.ref=ni(I,fe,R),A.return=I,I=A;break e}l(I,fe);break}else i(I,fe);fe=fe.sibling}R.type===V?(A=la(R.props.children,I.mode,J,R.key),A.return=I,I=A):(J=vu(R.type,R.key,R.props,null,I.mode,J),J.ref=ni(I,A,R),J.return=I,I=J)}return v(I);case D:e:{for(fe=R.key;A!==null;){if(A.key===fe)if(A.tag===4&&A.stateNode.containerInfo===R.containerInfo&&A.stateNode.implementation===R.implementation){l(I,A.sibling),A=p(A,R.children||[]),A.return=I,I=A;break e}else{l(I,A);break}else i(I,A);A=A.sibling}A=Td(R,I.mode,J),A.return=I,I=A}return v(I);case te:return fe=R._init,et(I,A,fe(R._payload),J)}if(Is(R))return ae(I,A,R,J);if(z(R))return se(I,A,R,J);Ko(I,R)}return typeof R=="string"&&R!==""||typeof R=="number"?(R=""+R,A!==null&&A.tag===6?(l(I,A.sibling),A=p(A,R),A.return=I,I=A):(l(I,A),A=xd(R,I.mode,J),A.return=I,I=A),v(I)):l(I,A)}return et}var Ba=ug(!0),lg=ug(!1),Qo=kr(null),Xo=null,Va=null,Mc=null;function Fc(){Mc=Va=Xo=null}function Dc(s){var i=Qo.current;He(Qo),s._currentValue=i}function Uc(s,i,l){for(;s!==null;){var d=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),s===l)break;s=s.return}}function Ha(s,i){Xo=s,Mc=Va=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&i&&(Dt=!0),s.firstContext=null)}function ln(s){var i=s._currentValue;if(Mc!==s)if(s={context:s,memoizedValue:i,next:null},Va===null){if(Xo===null)throw Error(t(308));Va=s,Xo.dependencies={lanes:0,firstContext:s}}else Va=Va.next=s;return i}var na=null;function zc(s){na===null?na=[s]:na.push(s)}function cg(s,i,l,d){var p=i.interleaved;return p===null?(l.next=l,zc(i)):(l.next=p.next,p.next=l),i.interleaved=l,ar(s,d)}function ar(s,i){s.lanes|=i;var l=s.alternate;for(l!==null&&(l.lanes|=i),l=s,s=s.return;s!==null;)s.childLanes|=i,l=s.alternate,l!==null&&(l.childLanes|=i),l=s,s=s.return;return l.tag===3?l.stateNode:null}var xr=!1;function Bc(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dg(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function sr(s,i){return{eventTime:s,lane:i,tag:0,payload:null,callback:null,next:null}}function Tr(s,i,l){var d=s.updateQueue;if(d===null)return null;if(d=d.shared,Ae&2){var p=d.pending;return p===null?i.next=i:(i.next=p.next,p.next=i),d.pending=i,ar(s,l)}return p=d.interleaved,p===null?(i.next=i,zc(d)):(i.next=p.next,p.next=i),d.interleaved=i,ar(s,l)}function Yo(s,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194240)!==0)){var d=i.lanes;d&=s.pendingLanes,l|=d,i.lanes=l,nc(s,l)}}function fg(s,i){var l=s.updateQueue,d=s.alternate;if(d!==null&&(d=d.updateQueue,l===d)){var p=null,g=null;if(l=l.firstBaseUpdate,l!==null){do{var v={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};g===null?p=g=v:g=g.next=v,l=l.next}while(l!==null);g===null?p=g=i:g=g.next=i}else p=g=i;l={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:d.shared,effects:d.effects},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=i:s.next=i,l.lastBaseUpdate=i}function eu(s,i,l,d){var p=s.updateQueue;xr=!1;var g=p.firstBaseUpdate,v=p.lastBaseUpdate,k=p.shared.pending;if(k!==null){p.shared.pending=null;var O=k,N=O.next;O.next=null,v===null?g=N:v.next=N,v=O;var H=s.alternate;H!==null&&(H=H.updateQueue,k=H.lastBaseUpdate,k!==v&&(k===null?H.firstBaseUpdate=N:k.next=N,H.lastBaseUpdate=O))}if(g!==null){var Z=p.baseState;v=0,H=N=O=null,k=g;do{var B=k.lane,Y=k.eventTime;if((d&B)===B){H!==null&&(H=H.next={eventTime:Y,lane:0,tag:k.tag,payload:k.payload,callback:k.callback,next:null});e:{var ae=s,se=k;switch(B=i,Y=l,se.tag){case 1:if(ae=se.payload,typeof ae=="function"){Z=ae.call(Y,Z,B);break e}Z=ae;break e;case 3:ae.flags=ae.flags&-65537|128;case 0:if(ae=se.payload,B=typeof ae=="function"?ae.call(Y,Z,B):ae,B==null)break e;Z=U({},Z,B);break e;case 2:xr=!0}}k.callback!==null&&k.lane!==0&&(s.flags|=64,B=p.effects,B===null?p.effects=[k]:B.push(k))}else Y={eventTime:Y,lane:B,tag:k.tag,payload:k.payload,callback:k.callback,next:null},H===null?(N=H=Y,O=Z):H=H.next=Y,v|=B;if(k=k.next,k===null){if(k=p.shared.pending,k===null)break;B=k,k=B.next,B.next=null,p.lastBaseUpdate=B,p.shared.pending=null}}while(!0);if(H===null&&(O=Z),p.baseState=O,p.firstBaseUpdate=N,p.lastBaseUpdate=H,i=p.shared.interleaved,i!==null){p=i;do v|=p.lane,p=p.next;while(p!==i)}else g===null&&(p.shared.lanes=0);sa|=v,s.lanes=v,s.memoizedState=Z}}function hg(s,i,l){if(s=i.effects,i.effects=null,s!==null)for(i=0;i<s.length;i++){var d=s[i],p=d.callback;if(p!==null){if(d.callback=null,d=l,typeof p!="function")throw Error(t(191,p));p.call(d)}}}var ri={},Hn=kr(ri),ai=kr(ri),si=kr(ri);function ra(s){if(s===ri)throw Error(t(174));return s}function Vc(s,i){switch(Be(si,i),Be(ai,s),Be(Hn,ri),s=i.nodeType,s){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Hl(null,"");break;default:s=s===8?i.parentNode:i,i=s.namespaceURI||null,s=s.tagName,i=Hl(i,s)}He(Hn),Be(Hn,i)}function qa(){He(Hn),He(ai),He(si)}function pg(s){ra(si.current);var i=ra(Hn.current),l=Hl(i,s.type);i!==l&&(Be(ai,s),Be(Hn,l))}function Hc(s){ai.current===s&&(He(Hn),He(ai))}var Ge=kr(0);function tu(s){for(var i=s;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var qc=[];function Zc(){for(var s=0;s<qc.length;s++)qc[s]._workInProgressVersionPrimary=null;qc.length=0}var nu=M.ReactCurrentDispatcher,Wc=M.ReactCurrentBatchConfig,aa=0,Je=null,at=null,lt=null,ru=!1,ii=!1,oi=0,PE=0;function Et(){throw Error(t(321))}function Gc(s,i){if(i===null)return!1;for(var l=0;l<i.length&&l<s.length;l++)if(!gn(s[l],i[l]))return!1;return!0}function Jc(s,i,l,d,p,g){if(aa=g,Je=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,nu.current=s===null||s.memoizedState===null?CE:AE,s=l(d,p),ii){g=0;do{if(ii=!1,oi=0,25<=g)throw Error(t(301));g+=1,lt=at=null,i.updateQueue=null,nu.current=IE,s=l(d,p)}while(ii)}if(nu.current=iu,i=at!==null&&at.next!==null,aa=0,lt=at=Je=null,ru=!1,i)throw Error(t(300));return s}function Kc(){var s=oi!==0;return oi=0,s}function qn(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lt===null?Je.memoizedState=lt=s:lt=lt.next=s,lt}function cn(){if(at===null){var s=Je.alternate;s=s!==null?s.memoizedState:null}else s=at.next;var i=lt===null?Je.memoizedState:lt.next;if(i!==null)lt=i,at=s;else{if(s===null)throw Error(t(310));at=s,s={memoizedState:at.memoizedState,baseState:at.baseState,baseQueue:at.baseQueue,queue:at.queue,next:null},lt===null?Je.memoizedState=lt=s:lt=lt.next=s}return lt}function ui(s,i){return typeof i=="function"?i(s):i}function Qc(s){var i=cn(),l=i.queue;if(l===null)throw Error(t(311));l.lastRenderedReducer=s;var d=at,p=d.baseQueue,g=l.pending;if(g!==null){if(p!==null){var v=p.next;p.next=g.next,g.next=v}d.baseQueue=p=g,l.pending=null}if(p!==null){g=p.next,d=d.baseState;var k=v=null,O=null,N=g;do{var H=N.lane;if((aa&H)===H)O!==null&&(O=O.next={lane:0,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null}),d=N.hasEagerState?N.eagerState:s(d,N.action);else{var Z={lane:H,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null};O===null?(k=O=Z,v=d):O=O.next=Z,Je.lanes|=H,sa|=H}N=N.next}while(N!==null&&N!==g);O===null?v=d:O.next=k,gn(d,i.memoizedState)||(Dt=!0),i.memoizedState=d,i.baseState=v,i.baseQueue=O,l.lastRenderedState=d}if(s=l.interleaved,s!==null){p=s;do g=p.lane,Je.lanes|=g,sa|=g,p=p.next;while(p!==s)}else p===null&&(l.lanes=0);return[i.memoizedState,l.dispatch]}function Xc(s){var i=cn(),l=i.queue;if(l===null)throw Error(t(311));l.lastRenderedReducer=s;var d=l.dispatch,p=l.pending,g=i.memoizedState;if(p!==null){l.pending=null;var v=p=p.next;do g=s(g,v.action),v=v.next;while(v!==p);gn(g,i.memoizedState)||(Dt=!0),i.memoizedState=g,i.baseQueue===null&&(i.baseState=g),l.lastRenderedState=g}return[g,d]}function mg(){}function gg(s,i){var l=Je,d=cn(),p=i(),g=!gn(d.memoizedState,p);if(g&&(d.memoizedState=p,Dt=!0),d=d.queue,Yc(wg.bind(null,l,d,s),[s]),d.getSnapshot!==i||g||lt!==null&&lt.memoizedState.tag&1){if(l.flags|=2048,li(9,_g.bind(null,l,d,p,i),void 0,null),ct===null)throw Error(t(349));aa&30||yg(l,i,p)}return p}function yg(s,i,l){s.flags|=16384,s={getSnapshot:i,value:l},i=Je.updateQueue,i===null?(i={lastEffect:null,stores:null},Je.updateQueue=i,i.stores=[s]):(l=i.stores,l===null?i.stores=[s]:l.push(s))}function _g(s,i,l,d){i.value=l,i.getSnapshot=d,vg(i)&&bg(s)}function wg(s,i,l){return l(function(){vg(i)&&bg(s)})}function vg(s){var i=s.getSnapshot;s=s.value;try{var l=i();return!gn(s,l)}catch{return!0}}function bg(s){var i=ar(s,1);i!==null&&bn(i,s,1,-1)}function Eg(s){var i=qn();return typeof s=="function"&&(s=s()),i.memoizedState=i.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ui,lastRenderedState:s},i.queue=s,s=s.dispatch=TE.bind(null,Je,s),[i.memoizedState,s]}function li(s,i,l,d){return s={tag:s,create:i,destroy:l,deps:d,next:null},i=Je.updateQueue,i===null?(i={lastEffect:null,stores:null},Je.updateQueue=i,i.lastEffect=s.next=s):(l=i.lastEffect,l===null?i.lastEffect=s.next=s:(d=l.next,l.next=s,s.next=d,i.lastEffect=s)),s}function Sg(){return cn().memoizedState}function au(s,i,l,d){var p=qn();Je.flags|=s,p.memoizedState=li(1|i,l,void 0,d===void 0?null:d)}function su(s,i,l,d){var p=cn();d=d===void 0?null:d;var g=void 0;if(at!==null){var v=at.memoizedState;if(g=v.destroy,d!==null&&Gc(d,v.deps)){p.memoizedState=li(i,l,g,d);return}}Je.flags|=s,p.memoizedState=li(1|i,l,g,d)}function kg(s,i){return au(8390656,8,s,i)}function Yc(s,i){return su(2048,8,s,i)}function Pg(s,i){return su(4,2,s,i)}function Og(s,i){return su(4,4,s,i)}function xg(s,i){if(typeof i=="function")return s=s(),i(s),function(){i(null)};if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function Tg(s,i,l){return l=l!=null?l.concat([s]):null,su(4,4,xg.bind(null,i,s),l)}function ed(){}function Cg(s,i){var l=cn();i=i===void 0?null:i;var d=l.memoizedState;return d!==null&&i!==null&&Gc(i,d[1])?d[0]:(l.memoizedState=[s,i],s)}function Ag(s,i){var l=cn();i=i===void 0?null:i;var d=l.memoizedState;return d!==null&&i!==null&&Gc(i,d[1])?d[0]:(s=s(),l.memoizedState=[s,i],s)}function Ig(s,i,l){return aa&21?(gn(l,i)||(l=om(),Je.lanes|=l,sa|=l,s.baseState=!0),i):(s.baseState&&(s.baseState=!1,Dt=!0),s.memoizedState=l)}function OE(s,i){var l=Me;Me=l!==0&&4>l?l:4,s(!0);var d=Wc.transition;Wc.transition={};try{s(!1),i()}finally{Me=l,Wc.transition=d}}function Rg(){return cn().memoizedState}function xE(s,i,l){var d=Rr(s);if(l={lane:d,action:l,hasEagerState:!1,eagerState:null,next:null},Ng(s))$g(i,l);else if(l=cg(s,i,l,d),l!==null){var p=At();bn(l,s,d,p),jg(l,i,d)}}function TE(s,i,l){var d=Rr(s),p={lane:d,action:l,hasEagerState:!1,eagerState:null,next:null};if(Ng(s))$g(i,p);else{var g=s.alternate;if(s.lanes===0&&(g===null||g.lanes===0)&&(g=i.lastRenderedReducer,g!==null))try{var v=i.lastRenderedState,k=g(v,l);if(p.hasEagerState=!0,p.eagerState=k,gn(k,v)){var O=i.interleaved;O===null?(p.next=p,zc(i)):(p.next=O.next,O.next=p),i.interleaved=p;return}}catch{}finally{}l=cg(s,i,p,d),l!==null&&(p=At(),bn(l,s,d,p),jg(l,i,d))}}function Ng(s){var i=s.alternate;return s===Je||i!==null&&i===Je}function $g(s,i){ii=ru=!0;var l=s.pending;l===null?i.next=i:(i.next=l.next,l.next=i),s.pending=i}function jg(s,i,l){if(l&4194240){var d=i.lanes;d&=s.pendingLanes,l|=d,i.lanes=l,nc(s,l)}}var iu={readContext:ln,useCallback:Et,useContext:Et,useEffect:Et,useImperativeHandle:Et,useInsertionEffect:Et,useLayoutEffect:Et,useMemo:Et,useReducer:Et,useRef:Et,useState:Et,useDebugValue:Et,useDeferredValue:Et,useTransition:Et,useMutableSource:Et,useSyncExternalStore:Et,useId:Et,unstable_isNewReconciler:!1},CE={readContext:ln,useCallback:function(s,i){return qn().memoizedState=[s,i===void 0?null:i],s},useContext:ln,useEffect:kg,useImperativeHandle:function(s,i,l){return l=l!=null?l.concat([s]):null,au(4194308,4,xg.bind(null,i,s),l)},useLayoutEffect:function(s,i){return au(4194308,4,s,i)},useInsertionEffect:function(s,i){return au(4,2,s,i)},useMemo:function(s,i){var l=qn();return i=i===void 0?null:i,s=s(),l.memoizedState=[s,i],s},useReducer:function(s,i,l){var d=qn();return i=l!==void 0?l(i):i,d.memoizedState=d.baseState=i,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:i},d.queue=s,s=s.dispatch=xE.bind(null,Je,s),[d.memoizedState,s]},useRef:function(s){var i=qn();return s={current:s},i.memoizedState=s},useState:Eg,useDebugValue:ed,useDeferredValue:function(s){return qn().memoizedState=s},useTransition:function(){var s=Eg(!1),i=s[0];return s=OE.bind(null,s[1]),qn().memoizedState=s,[i,s]},useMutableSource:function(){},useSyncExternalStore:function(s,i,l){var d=Je,p=qn();if(We){if(l===void 0)throw Error(t(407));l=l()}else{if(l=i(),ct===null)throw Error(t(349));aa&30||yg(d,i,l)}p.memoizedState=l;var g={value:l,getSnapshot:i};return p.queue=g,kg(wg.bind(null,d,g,s),[s]),d.flags|=2048,li(9,_g.bind(null,d,g,l,i),void 0,null),l},useId:function(){var s=qn(),i=ct.identifierPrefix;if(We){var l=rr,d=nr;l=(d&~(1<<32-mn(d)-1)).toString(32)+l,i=":"+i+"R"+l,l=oi++,0<l&&(i+="H"+l.toString(32)),i+=":"}else l=PE++,i=":"+i+"r"+l.toString(32)+":";return s.memoizedState=i},unstable_isNewReconciler:!1},AE={readContext:ln,useCallback:Cg,useContext:ln,useEffect:Yc,useImperativeHandle:Tg,useInsertionEffect:Pg,useLayoutEffect:Og,useMemo:Ag,useReducer:Qc,useRef:Sg,useState:function(){return Qc(ui)},useDebugValue:ed,useDeferredValue:function(s){var i=cn();return Ig(i,at.memoizedState,s)},useTransition:function(){var s=Qc(ui)[0],i=cn().memoizedState;return[s,i]},useMutableSource:mg,useSyncExternalStore:gg,useId:Rg,unstable_isNewReconciler:!1},IE={readContext:ln,useCallback:Cg,useContext:ln,useEffect:Yc,useImperativeHandle:Tg,useInsertionEffect:Pg,useLayoutEffect:Og,useMemo:Ag,useReducer:Xc,useRef:Sg,useState:function(){return Xc(ui)},useDebugValue:ed,useDeferredValue:function(s){var i=cn();return at===null?i.memoizedState=s:Ig(i,at.memoizedState,s)},useTransition:function(){var s=Xc(ui)[0],i=cn().memoizedState;return[s,i]},useMutableSource:mg,useSyncExternalStore:gg,useId:Rg,unstable_isNewReconciler:!1};function _n(s,i){if(s&&s.defaultProps){i=U({},i),s=s.defaultProps;for(var l in s)i[l]===void 0&&(i[l]=s[l]);return i}return i}function td(s,i,l,d){i=s.memoizedState,l=l(d,i),l=l==null?i:U({},i,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var ou={isMounted:function(s){return(s=s._reactInternals)?Qr(s)===s:!1},enqueueSetState:function(s,i,l){s=s._reactInternals;var d=At(),p=Rr(s),g=sr(d,p);g.payload=i,l!=null&&(g.callback=l),i=Tr(s,g,p),i!==null&&(bn(i,s,p,d),Yo(i,s,p))},enqueueReplaceState:function(s,i,l){s=s._reactInternals;var d=At(),p=Rr(s),g=sr(d,p);g.tag=1,g.payload=i,l!=null&&(g.callback=l),i=Tr(s,g,p),i!==null&&(bn(i,s,p,d),Yo(i,s,p))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var l=At(),d=Rr(s),p=sr(l,d);p.tag=2,i!=null&&(p.callback=i),i=Tr(s,p,d),i!==null&&(bn(i,s,d,l),Yo(i,s,d))}};function Lg(s,i,l,d,p,g,v){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(d,g,v):i.prototype&&i.prototype.isPureReactComponent?!Js(l,d)||!Js(p,g):!0}function Mg(s,i,l){var d=!1,p=Pr,g=i.contextType;return typeof g=="object"&&g!==null?g=ln(g):(p=Ft(i)?Yr:bt.current,d=i.contextTypes,g=(d=d!=null)?Fa(s,p):Pr),i=new i(l,g),s.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=ou,s.stateNode=i,i._reactInternals=s,d&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=p,s.__reactInternalMemoizedMaskedChildContext=g),i}function Fg(s,i,l,d){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,d),i.state!==s&&ou.enqueueReplaceState(i,i.state,null)}function nd(s,i,l,d){var p=s.stateNode;p.props=l,p.state=s.memoizedState,p.refs={},Bc(s);var g=i.contextType;typeof g=="object"&&g!==null?p.context=ln(g):(g=Ft(i)?Yr:bt.current,p.context=Fa(s,g)),p.state=s.memoizedState,g=i.getDerivedStateFromProps,typeof g=="function"&&(td(s,i,g,l),p.state=s.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(i=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),i!==p.state&&ou.enqueueReplaceState(p,p.state,null),eu(s,l,p,d),p.state=s.memoizedState),typeof p.componentDidMount=="function"&&(s.flags|=4194308)}function Za(s,i){try{var l="",d=i;do l+=ce(d),d=d.return;while(d);var p=l}catch(g){p=`
Error generating stack: `+g.message+`
`+g.stack}return{value:s,source:i,stack:p,digest:null}}function rd(s,i,l){return{value:s,source:null,stack:l??null,digest:i??null}}function ad(s,i){try{console.error(i.value)}catch(l){setTimeout(function(){throw l})}}var RE=typeof WeakMap=="function"?WeakMap:Map;function Dg(s,i,l){l=sr(-1,l),l.tag=3,l.payload={element:null};var d=i.value;return l.callback=function(){pu||(pu=!0,wd=d),ad(s,i)},l}function Ug(s,i,l){l=sr(-1,l),l.tag=3;var d=s.type.getDerivedStateFromError;if(typeof d=="function"){var p=i.value;l.payload=function(){return d(p)},l.callback=function(){ad(s,i)}}var g=s.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(l.callback=function(){ad(s,i),typeof d!="function"&&(Ar===null?Ar=new Set([this]):Ar.add(this));var v=i.stack;this.componentDidCatch(i.value,{componentStack:v!==null?v:""})}),l}function zg(s,i,l){var d=s.pingCache;if(d===null){d=s.pingCache=new RE;var p=new Set;d.set(i,p)}else p=d.get(i),p===void 0&&(p=new Set,d.set(i,p));p.has(l)||(p.add(l),s=ZE.bind(null,s,i,l),i.then(s,s))}function Bg(s){do{var i;if((i=s.tag===13)&&(i=s.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return s;s=s.return}while(s!==null);return null}function Vg(s,i,l,d,p){return s.mode&1?(s.flags|=65536,s.lanes=p,s):(s===i?s.flags|=65536:(s.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(i=sr(-1,1),i.tag=2,Tr(l,i,1))),l.lanes|=1),s)}var NE=M.ReactCurrentOwner,Dt=!1;function Ct(s,i,l,d){i.child=s===null?lg(i,null,l,d):Ba(i,s.child,l,d)}function Hg(s,i,l,d,p){l=l.render;var g=i.ref;return Ha(i,p),d=Jc(s,i,l,d,g,p),l=Kc(),s!==null&&!Dt?(i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~p,ir(s,i,p)):(We&&l&&Rc(i),i.flags|=1,Ct(s,i,d,p),i.child)}function qg(s,i,l,d,p){if(s===null){var g=l.type;return typeof g=="function"&&!Od(g)&&g.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(i.tag=15,i.type=g,Zg(s,i,g,d,p)):(s=vu(l.type,null,d,i,i.mode,p),s.ref=i.ref,s.return=i,i.child=s)}if(g=s.child,!(s.lanes&p)){var v=g.memoizedProps;if(l=l.compare,l=l!==null?l:Js,l(v,d)&&s.ref===i.ref)return ir(s,i,p)}return i.flags|=1,s=$r(g,d),s.ref=i.ref,s.return=i,i.child=s}function Zg(s,i,l,d,p){if(s!==null){var g=s.memoizedProps;if(Js(g,d)&&s.ref===i.ref)if(Dt=!1,i.pendingProps=d=g,(s.lanes&p)!==0)s.flags&131072&&(Dt=!0);else return i.lanes=s.lanes,ir(s,i,p)}return sd(s,i,l,d,p)}function Wg(s,i,l){var d=i.pendingProps,p=d.children,g=s!==null?s.memoizedState:null;if(d.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},Be(Ga,Yt),Yt|=l;else{if(!(l&1073741824))return s=g!==null?g.baseLanes|l:l,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:s,cachePool:null,transitions:null},i.updateQueue=null,Be(Ga,Yt),Yt|=s,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=g!==null?g.baseLanes:l,Be(Ga,Yt),Yt|=d}else g!==null?(d=g.baseLanes|l,i.memoizedState=null):d=l,Be(Ga,Yt),Yt|=d;return Ct(s,i,p,l),i.child}function Gg(s,i){var l=i.ref;(s===null&&l!==null||s!==null&&s.ref!==l)&&(i.flags|=512,i.flags|=2097152)}function sd(s,i,l,d,p){var g=Ft(l)?Yr:bt.current;return g=Fa(i,g),Ha(i,p),l=Jc(s,i,l,d,g,p),d=Kc(),s!==null&&!Dt?(i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~p,ir(s,i,p)):(We&&d&&Rc(i),i.flags|=1,Ct(s,i,l,p),i.child)}function Jg(s,i,l,d,p){if(Ft(l)){var g=!0;qo(i)}else g=!1;if(Ha(i,p),i.stateNode===null)lu(s,i),Mg(i,l,d),nd(i,l,d,p),d=!0;else if(s===null){var v=i.stateNode,k=i.memoizedProps;v.props=k;var O=v.context,N=l.contextType;typeof N=="object"&&N!==null?N=ln(N):(N=Ft(l)?Yr:bt.current,N=Fa(i,N));var H=l.getDerivedStateFromProps,Z=typeof H=="function"||typeof v.getSnapshotBeforeUpdate=="function";Z||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(k!==d||O!==N)&&Fg(i,v,d,N),xr=!1;var B=i.memoizedState;v.state=B,eu(i,d,v,p),O=i.memoizedState,k!==d||B!==O||Mt.current||xr?(typeof H=="function"&&(td(i,l,H,d),O=i.memoizedState),(k=xr||Lg(i,l,k,d,B,O,N))?(Z||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(i.flags|=4194308)):(typeof v.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=O),v.props=d,v.state=O,v.context=N,d=k):(typeof v.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{v=i.stateNode,dg(s,i),k=i.memoizedProps,N=i.type===i.elementType?k:_n(i.type,k),v.props=N,Z=i.pendingProps,B=v.context,O=l.contextType,typeof O=="object"&&O!==null?O=ln(O):(O=Ft(l)?Yr:bt.current,O=Fa(i,O));var Y=l.getDerivedStateFromProps;(H=typeof Y=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(k!==Z||B!==O)&&Fg(i,v,d,O),xr=!1,B=i.memoizedState,v.state=B,eu(i,d,v,p);var ae=i.memoizedState;k!==Z||B!==ae||Mt.current||xr?(typeof Y=="function"&&(td(i,l,Y,d),ae=i.memoizedState),(N=xr||Lg(i,l,N,d,B,ae,O)||!1)?(H||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(d,ae,O),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(d,ae,O)),typeof v.componentDidUpdate=="function"&&(i.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof v.componentDidUpdate!="function"||k===s.memoizedProps&&B===s.memoizedState||(i.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&B===s.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=ae),v.props=d,v.state=ae,v.context=O,d=N):(typeof v.componentDidUpdate!="function"||k===s.memoizedProps&&B===s.memoizedState||(i.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&B===s.memoizedState||(i.flags|=1024),d=!1)}return id(s,i,l,d,g,p)}function id(s,i,l,d,p,g){Gg(s,i);var v=(i.flags&128)!==0;if(!d&&!v)return p&&eg(i,l,!1),ir(s,i,g);d=i.stateNode,NE.current=i;var k=v&&typeof l.getDerivedStateFromError!="function"?null:d.render();return i.flags|=1,s!==null&&v?(i.child=Ba(i,s.child,null,g),i.child=Ba(i,null,k,g)):Ct(s,i,k,g),i.memoizedState=d.state,p&&eg(i,l,!0),i.child}function Kg(s){var i=s.stateNode;i.pendingContext?Xm(s,i.pendingContext,i.pendingContext!==i.context):i.context&&Xm(s,i.context,!1),Vc(s,i.containerInfo)}function Qg(s,i,l,d,p){return za(),Lc(p),i.flags|=256,Ct(s,i,l,d),i.child}var od={dehydrated:null,treeContext:null,retryLane:0};function ud(s){return{baseLanes:s,cachePool:null,transitions:null}}function Xg(s,i,l){var d=i.pendingProps,p=Ge.current,g=!1,v=(i.flags&128)!==0,k;if((k=v)||(k=s!==null&&s.memoizedState===null?!1:(p&2)!==0),k?(g=!0,i.flags&=-129):(s===null||s.memoizedState!==null)&&(p|=1),Be(Ge,p&1),s===null)return jc(i),s=i.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(i.mode&1?s.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(v=d.children,s=d.fallback,g?(d=i.mode,g=i.child,v={mode:"hidden",children:v},!(d&1)&&g!==null?(g.childLanes=0,g.pendingProps=v):g=bu(v,d,0,null),s=la(s,d,l,null),g.return=i,s.return=i,g.sibling=s,i.child=g,i.child.memoizedState=ud(l),i.memoizedState=od,s):ld(i,v));if(p=s.memoizedState,p!==null&&(k=p.dehydrated,k!==null))return $E(s,i,v,d,k,p,l);if(g){g=d.fallback,v=i.mode,p=s.child,k=p.sibling;var O={mode:"hidden",children:d.children};return!(v&1)&&i.child!==p?(d=i.child,d.childLanes=0,d.pendingProps=O,i.deletions=null):(d=$r(p,O),d.subtreeFlags=p.subtreeFlags&14680064),k!==null?g=$r(k,g):(g=la(g,v,l,null),g.flags|=2),g.return=i,d.return=i,d.sibling=g,i.child=d,d=g,g=i.child,v=s.child.memoizedState,v=v===null?ud(l):{baseLanes:v.baseLanes|l,cachePool:null,transitions:v.transitions},g.memoizedState=v,g.childLanes=s.childLanes&~l,i.memoizedState=od,d}return g=s.child,s=g.sibling,d=$r(g,{mode:"visible",children:d.children}),!(i.mode&1)&&(d.lanes=l),d.return=i,d.sibling=null,s!==null&&(l=i.deletions,l===null?(i.deletions=[s],i.flags|=16):l.push(s)),i.child=d,i.memoizedState=null,d}function ld(s,i){return i=bu({mode:"visible",children:i},s.mode,0,null),i.return=s,s.child=i}function uu(s,i,l,d){return d!==null&&Lc(d),Ba(i,s.child,null,l),s=ld(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function $E(s,i,l,d,p,g,v){if(l)return i.flags&256?(i.flags&=-257,d=rd(Error(t(422))),uu(s,i,v,d)):i.memoizedState!==null?(i.child=s.child,i.flags|=128,null):(g=d.fallback,p=i.mode,d=bu({mode:"visible",children:d.children},p,0,null),g=la(g,p,v,null),g.flags|=2,d.return=i,g.return=i,d.sibling=g,i.child=d,i.mode&1&&Ba(i,s.child,null,v),i.child.memoizedState=ud(v),i.memoizedState=od,g);if(!(i.mode&1))return uu(s,i,v,null);if(p.data==="$!"){if(d=p.nextSibling&&p.nextSibling.dataset,d)var k=d.dgst;return d=k,g=Error(t(419)),d=rd(g,d,void 0),uu(s,i,v,d)}if(k=(v&s.childLanes)!==0,Dt||k){if(d=ct,d!==null){switch(v&-v){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=p&(d.suspendedLanes|v)?0:p,p!==0&&p!==g.retryLane&&(g.retryLane=p,ar(s,p),bn(d,s,p,-1))}return Pd(),d=rd(Error(t(421))),uu(s,i,v,d)}return p.data==="$?"?(i.flags|=128,i.child=s.child,i=WE.bind(null,s),p._reactRetry=i,null):(s=g.treeContext,Xt=Sr(p.nextSibling),Qt=i,We=!0,yn=null,s!==null&&(on[un++]=nr,on[un++]=rr,on[un++]=ea,nr=s.id,rr=s.overflow,ea=i),i=ld(i,d.children),i.flags|=4096,i)}function Yg(s,i,l){s.lanes|=i;var d=s.alternate;d!==null&&(d.lanes|=i),Uc(s.return,i,l)}function cd(s,i,l,d,p){var g=s.memoizedState;g===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:l,tailMode:p}:(g.isBackwards=i,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=l,g.tailMode=p)}function ey(s,i,l){var d=i.pendingProps,p=d.revealOrder,g=d.tail;if(Ct(s,i,d.children,l),d=Ge.current,d&2)d=d&1|2,i.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Yg(s,l,i);else if(s.tag===19)Yg(s,l,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}d&=1}if(Be(Ge,d),!(i.mode&1))i.memoizedState=null;else switch(p){case"forwards":for(l=i.child,p=null;l!==null;)s=l.alternate,s!==null&&tu(s)===null&&(p=l),l=l.sibling;l=p,l===null?(p=i.child,i.child=null):(p=l.sibling,l.sibling=null),cd(i,!1,p,l,g);break;case"backwards":for(l=null,p=i.child,i.child=null;p!==null;){if(s=p.alternate,s!==null&&tu(s)===null){i.child=p;break}s=p.sibling,p.sibling=l,l=p,p=s}cd(i,!0,l,null,g);break;case"together":cd(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function lu(s,i){!(i.mode&1)&&s!==null&&(s.alternate=null,i.alternate=null,i.flags|=2)}function ir(s,i,l){if(s!==null&&(i.dependencies=s.dependencies),sa|=i.lanes,!(l&i.childLanes))return null;if(s!==null&&i.child!==s.child)throw Error(t(153));if(i.child!==null){for(s=i.child,l=$r(s,s.pendingProps),i.child=l,l.return=i;s.sibling!==null;)s=s.sibling,l=l.sibling=$r(s,s.pendingProps),l.return=i;l.sibling=null}return i.child}function jE(s,i,l){switch(i.tag){case 3:Kg(i),za();break;case 5:pg(i);break;case 1:Ft(i.type)&&qo(i);break;case 4:Vc(i,i.stateNode.containerInfo);break;case 10:var d=i.type._context,p=i.memoizedProps.value;Be(Qo,d._currentValue),d._currentValue=p;break;case 13:if(d=i.memoizedState,d!==null)return d.dehydrated!==null?(Be(Ge,Ge.current&1),i.flags|=128,null):l&i.child.childLanes?Xg(s,i,l):(Be(Ge,Ge.current&1),s=ir(s,i,l),s!==null?s.sibling:null);Be(Ge,Ge.current&1);break;case 19:if(d=(l&i.childLanes)!==0,s.flags&128){if(d)return ey(s,i,l);i.flags|=128}if(p=i.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Be(Ge,Ge.current),d)break;return null;case 22:case 23:return i.lanes=0,Wg(s,i,l)}return ir(s,i,l)}var ty,dd,ny,ry;ty=function(s,i){for(var l=i.child;l!==null;){if(l.tag===5||l.tag===6)s.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===i)break;for(;l.sibling===null;){if(l.return===null||l.return===i)return;l=l.return}l.sibling.return=l.return,l=l.sibling}},dd=function(){},ny=function(s,i,l,d){var p=s.memoizedProps;if(p!==d){s=i.stateNode,ra(Hn.current);var g=null;switch(l){case"input":p=Ul(s,p),d=Ul(s,d),g=[];break;case"select":p=U({},p,{value:void 0}),d=U({},d,{value:void 0}),g=[];break;case"textarea":p=Vl(s,p),d=Vl(s,d),g=[];break;default:typeof p.onClick!="function"&&typeof d.onClick=="function"&&(s.onclick=Bo)}ql(l,d);var v;l=null;for(N in p)if(!d.hasOwnProperty(N)&&p.hasOwnProperty(N)&&p[N]!=null)if(N==="style"){var k=p[N];for(v in k)k.hasOwnProperty(v)&&(l||(l={}),l[v]="")}else N!=="dangerouslySetInnerHTML"&&N!=="children"&&N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&N!=="autoFocus"&&(a.hasOwnProperty(N)?g||(g=[]):(g=g||[]).push(N,null));for(N in d){var O=d[N];if(k=p!=null?p[N]:void 0,d.hasOwnProperty(N)&&O!==k&&(O!=null||k!=null))if(N==="style")if(k){for(v in k)!k.hasOwnProperty(v)||O&&O.hasOwnProperty(v)||(l||(l={}),l[v]="");for(v in O)O.hasOwnProperty(v)&&k[v]!==O[v]&&(l||(l={}),l[v]=O[v])}else l||(g||(g=[]),g.push(N,l)),l=O;else N==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,k=k?k.__html:void 0,O!=null&&k!==O&&(g=g||[]).push(N,O)):N==="children"?typeof O!="string"&&typeof O!="number"||(g=g||[]).push(N,""+O):N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&(a.hasOwnProperty(N)?(O!=null&&N==="onScroll"&&Ve("scroll",s),g||k===O||(g=[])):(g=g||[]).push(N,O))}l&&(g=g||[]).push("style",l);var N=g;(i.updateQueue=N)&&(i.flags|=4)}},ry=function(s,i,l,d){l!==d&&(i.flags|=4)};function ci(s,i){if(!We)switch(s.tailMode){case"hidden":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:d.sibling=null}}function St(s){var i=s.alternate!==null&&s.alternate.child===s.child,l=0,d=0;if(i)for(var p=s.child;p!==null;)l|=p.lanes|p.childLanes,d|=p.subtreeFlags&14680064,d|=p.flags&14680064,p.return=s,p=p.sibling;else for(p=s.child;p!==null;)l|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=s,p=p.sibling;return s.subtreeFlags|=d,s.childLanes=l,i}function LE(s,i,l){var d=i.pendingProps;switch(Nc(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return St(i),null;case 1:return Ft(i.type)&&Ho(),St(i),null;case 3:return d=i.stateNode,qa(),He(Mt),He(bt),Zc(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(s===null||s.child===null)&&(Jo(i)?i.flags|=4:s===null||s.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,yn!==null&&(Ed(yn),yn=null))),dd(s,i),St(i),null;case 5:Hc(i);var p=ra(si.current);if(l=i.type,s!==null&&i.stateNode!=null)ny(s,i,l,d,p),s.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!d){if(i.stateNode===null)throw Error(t(166));return St(i),null}if(s=ra(Hn.current),Jo(i)){d=i.stateNode,l=i.type;var g=i.memoizedProps;switch(d[Vn]=i,d[ei]=g,s=(i.mode&1)!==0,l){case"dialog":Ve("cancel",d),Ve("close",d);break;case"iframe":case"object":case"embed":Ve("load",d);break;case"video":case"audio":for(p=0;p<Qs.length;p++)Ve(Qs[p],d);break;case"source":Ve("error",d);break;case"img":case"image":case"link":Ve("error",d),Ve("load",d);break;case"details":Ve("toggle",d);break;case"input":Mp(d,g),Ve("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!g.multiple},Ve("invalid",d);break;case"textarea":Up(d,g),Ve("invalid",d)}ql(l,g),p=null;for(var v in g)if(g.hasOwnProperty(v)){var k=g[v];v==="children"?typeof k=="string"?d.textContent!==k&&(g.suppressHydrationWarning!==!0&&zo(d.textContent,k,s),p=["children",k]):typeof k=="number"&&d.textContent!==""+k&&(g.suppressHydrationWarning!==!0&&zo(d.textContent,k,s),p=["children",""+k]):a.hasOwnProperty(v)&&k!=null&&v==="onScroll"&&Ve("scroll",d)}switch(l){case"input":Pa(d),Dp(d,g,!0);break;case"textarea":Pa(d),Bp(d);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(d.onclick=Bo)}d=p,i.updateQueue=d,d!==null&&(i.flags|=4)}else{v=p.nodeType===9?p:p.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=Vp(l)),s==="http://www.w3.org/1999/xhtml"?l==="script"?(s=v.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof d.is=="string"?s=v.createElement(l,{is:d.is}):(s=v.createElement(l),l==="select"&&(v=s,d.multiple?v.multiple=!0:d.size&&(v.size=d.size))):s=v.createElementNS(s,l),s[Vn]=i,s[ei]=d,ty(s,i,!1,!1),i.stateNode=s;e:{switch(v=Zl(l,d),l){case"dialog":Ve("cancel",s),Ve("close",s),p=d;break;case"iframe":case"object":case"embed":Ve("load",s),p=d;break;case"video":case"audio":for(p=0;p<Qs.length;p++)Ve(Qs[p],s);p=d;break;case"source":Ve("error",s),p=d;break;case"img":case"image":case"link":Ve("error",s),Ve("load",s),p=d;break;case"details":Ve("toggle",s),p=d;break;case"input":Mp(s,d),p=Ul(s,d),Ve("invalid",s);break;case"option":p=d;break;case"select":s._wrapperState={wasMultiple:!!d.multiple},p=U({},d,{value:void 0}),Ve("invalid",s);break;case"textarea":Up(s,d),p=Vl(s,d),Ve("invalid",s);break;default:p=d}ql(l,p),k=p;for(g in k)if(k.hasOwnProperty(g)){var O=k[g];g==="style"?Zp(s,O):g==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&Hp(s,O)):g==="children"?typeof O=="string"?(l!=="textarea"||O!=="")&&Rs(s,O):typeof O=="number"&&Rs(s,""+O):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(a.hasOwnProperty(g)?O!=null&&g==="onScroll"&&Ve("scroll",s):O!=null&&T(s,g,O,v))}switch(l){case"input":Pa(s),Dp(s,d,!1);break;case"textarea":Pa(s),Bp(s);break;case"option":d.value!=null&&s.setAttribute("value",""+Ie(d.value));break;case"select":s.multiple=!!d.multiple,g=d.value,g!=null?Oa(s,!!d.multiple,g,!1):d.defaultValue!=null&&Oa(s,!!d.multiple,d.defaultValue,!0);break;default:typeof p.onClick=="function"&&(s.onclick=Bo)}switch(l){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return St(i),null;case 6:if(s&&i.stateNode!=null)ry(s,i,s.memoizedProps,d);else{if(typeof d!="string"&&i.stateNode===null)throw Error(t(166));if(l=ra(si.current),ra(Hn.current),Jo(i)){if(d=i.stateNode,l=i.memoizedProps,d[Vn]=i,(g=d.nodeValue!==l)&&(s=Qt,s!==null))switch(s.tag){case 3:zo(d.nodeValue,l,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&zo(d.nodeValue,l,(s.mode&1)!==0)}g&&(i.flags|=4)}else d=(l.nodeType===9?l:l.ownerDocument).createTextNode(d),d[Vn]=i,i.stateNode=d}return St(i),null;case 13:if(He(Ge),d=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(We&&Xt!==null&&i.mode&1&&!(i.flags&128))ig(),za(),i.flags|=98560,g=!1;else if(g=Jo(i),d!==null&&d.dehydrated!==null){if(s===null){if(!g)throw Error(t(318));if(g=i.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(t(317));g[Vn]=i}else za(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;St(i),g=!1}else yn!==null&&(Ed(yn),yn=null),g=!0;if(!g)return i.flags&65536?i:null}return i.flags&128?(i.lanes=l,i):(d=d!==null,d!==(s!==null&&s.memoizedState!==null)&&d&&(i.child.flags|=8192,i.mode&1&&(s===null||Ge.current&1?st===0&&(st=3):Pd())),i.updateQueue!==null&&(i.flags|=4),St(i),null);case 4:return qa(),dd(s,i),s===null&&Xs(i.stateNode.containerInfo),St(i),null;case 10:return Dc(i.type._context),St(i),null;case 17:return Ft(i.type)&&Ho(),St(i),null;case 19:if(He(Ge),g=i.memoizedState,g===null)return St(i),null;if(d=(i.flags&128)!==0,v=g.rendering,v===null)if(d)ci(g,!1);else{if(st!==0||s!==null&&s.flags&128)for(s=i.child;s!==null;){if(v=tu(s),v!==null){for(i.flags|=128,ci(g,!1),d=v.updateQueue,d!==null&&(i.updateQueue=d,i.flags|=4),i.subtreeFlags=0,d=l,l=i.child;l!==null;)g=l,s=d,g.flags&=14680066,v=g.alternate,v===null?(g.childLanes=0,g.lanes=s,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=v.childLanes,g.lanes=v.lanes,g.child=v.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=v.memoizedProps,g.memoizedState=v.memoizedState,g.updateQueue=v.updateQueue,g.type=v.type,s=v.dependencies,g.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),l=l.sibling;return Be(Ge,Ge.current&1|2),i.child}s=s.sibling}g.tail!==null&&Ye()>Ja&&(i.flags|=128,d=!0,ci(g,!1),i.lanes=4194304)}else{if(!d)if(s=tu(v),s!==null){if(i.flags|=128,d=!0,l=s.updateQueue,l!==null&&(i.updateQueue=l,i.flags|=4),ci(g,!0),g.tail===null&&g.tailMode==="hidden"&&!v.alternate&&!We)return St(i),null}else 2*Ye()-g.renderingStartTime>Ja&&l!==1073741824&&(i.flags|=128,d=!0,ci(g,!1),i.lanes=4194304);g.isBackwards?(v.sibling=i.child,i.child=v):(l=g.last,l!==null?l.sibling=v:i.child=v,g.last=v)}return g.tail!==null?(i=g.tail,g.rendering=i,g.tail=i.sibling,g.renderingStartTime=Ye(),i.sibling=null,l=Ge.current,Be(Ge,d?l&1|2:l&1),i):(St(i),null);case 22:case 23:return kd(),d=i.memoizedState!==null,s!==null&&s.memoizedState!==null!==d&&(i.flags|=8192),d&&i.mode&1?Yt&1073741824&&(St(i),i.subtreeFlags&6&&(i.flags|=8192)):St(i),null;case 24:return null;case 25:return null}throw Error(t(156,i.tag))}function ME(s,i){switch(Nc(i),i.tag){case 1:return Ft(i.type)&&Ho(),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return qa(),He(Mt),He(bt),Zc(),s=i.flags,s&65536&&!(s&128)?(i.flags=s&-65537|128,i):null;case 5:return Hc(i),null;case 13:if(He(Ge),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(t(340));za()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return He(Ge),null;case 4:return qa(),null;case 10:return Dc(i.type._context),null;case 22:case 23:return kd(),null;case 24:return null;default:return null}}var cu=!1,kt=!1,FE=typeof WeakSet=="function"?WeakSet:Set,re=null;function Wa(s,i){var l=s.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(d){Xe(s,i,d)}else l.current=null}function fd(s,i,l){try{l()}catch(d){Xe(s,i,d)}}var ay=!1;function DE(s,i){if(kc=Ao,s=Lm(),gc(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var d=l.getSelection&&l.getSelection();if(d&&d.rangeCount!==0){l=d.anchorNode;var p=d.anchorOffset,g=d.focusNode;d=d.focusOffset;try{l.nodeType,g.nodeType}catch{l=null;break e}var v=0,k=-1,O=-1,N=0,H=0,Z=s,B=null;t:for(;;){for(var Y;Z!==l||p!==0&&Z.nodeType!==3||(k=v+p),Z!==g||d!==0&&Z.nodeType!==3||(O=v+d),Z.nodeType===3&&(v+=Z.nodeValue.length),(Y=Z.firstChild)!==null;)B=Z,Z=Y;for(;;){if(Z===s)break t;if(B===l&&++N===p&&(k=v),B===g&&++H===d&&(O=v),(Y=Z.nextSibling)!==null)break;Z=B,B=Z.parentNode}Z=Y}l=k===-1||O===-1?null:{start:k,end:O}}else l=null}l=l||{start:0,end:0}}else l=null;for(Pc={focusedElem:s,selectionRange:l},Ao=!1,re=i;re!==null;)if(i=re,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,re=s;else for(;re!==null;){i=re;try{var ae=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(ae!==null){var se=ae.memoizedProps,et=ae.memoizedState,I=i.stateNode,A=I.getSnapshotBeforeUpdate(i.elementType===i.type?se:_n(i.type,se),et);I.__reactInternalSnapshotBeforeUpdate=A}break;case 3:var R=i.stateNode.containerInfo;R.nodeType===1?R.textContent="":R.nodeType===9&&R.documentElement&&R.removeChild(R.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(J){Xe(i,i.return,J)}if(s=i.sibling,s!==null){s.return=i.return,re=s;break}re=i.return}return ae=ay,ay=!1,ae}function di(s,i,l){var d=i.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var p=d=d.next;do{if((p.tag&s)===s){var g=p.destroy;p.destroy=void 0,g!==void 0&&fd(i,l,g)}p=p.next}while(p!==d)}}function du(s,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var l=i=i.next;do{if((l.tag&s)===s){var d=l.create;l.destroy=d()}l=l.next}while(l!==i)}}function hd(s){var i=s.ref;if(i!==null){var l=s.stateNode;switch(s.tag){case 5:s=l;break;default:s=l}typeof i=="function"?i(s):i.current=s}}function sy(s){var i=s.alternate;i!==null&&(s.alternate=null,sy(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&(delete i[Vn],delete i[ei],delete i[Cc],delete i[bE],delete i[EE])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function iy(s){return s.tag===5||s.tag===3||s.tag===4}function oy(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||iy(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function pd(s,i,l){var d=s.tag;if(d===5||d===6)s=s.stateNode,i?l.nodeType===8?l.parentNode.insertBefore(s,i):l.insertBefore(s,i):(l.nodeType===8?(i=l.parentNode,i.insertBefore(s,l)):(i=l,i.appendChild(s)),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=Bo));else if(d!==4&&(s=s.child,s!==null))for(pd(s,i,l),s=s.sibling;s!==null;)pd(s,i,l),s=s.sibling}function md(s,i,l){var d=s.tag;if(d===5||d===6)s=s.stateNode,i?l.insertBefore(s,i):l.appendChild(s);else if(d!==4&&(s=s.child,s!==null))for(md(s,i,l),s=s.sibling;s!==null;)md(s,i,l),s=s.sibling}var gt=null,wn=!1;function Cr(s,i,l){for(l=l.child;l!==null;)uy(s,i,l),l=l.sibling}function uy(s,i,l){if(Bn&&typeof Bn.onCommitFiberUnmount=="function")try{Bn.onCommitFiberUnmount(ko,l)}catch{}switch(l.tag){case 5:kt||Wa(l,i);case 6:var d=gt,p=wn;gt=null,Cr(s,i,l),gt=d,wn=p,gt!==null&&(wn?(s=gt,l=l.stateNode,s.nodeType===8?s.parentNode.removeChild(l):s.removeChild(l)):gt.removeChild(l.stateNode));break;case 18:gt!==null&&(wn?(s=gt,l=l.stateNode,s.nodeType===8?Tc(s.parentNode,l):s.nodeType===1&&Tc(s,l),Vs(s)):Tc(gt,l.stateNode));break;case 4:d=gt,p=wn,gt=l.stateNode.containerInfo,wn=!0,Cr(s,i,l),gt=d,wn=p;break;case 0:case 11:case 14:case 15:if(!kt&&(d=l.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){p=d=d.next;do{var g=p,v=g.destroy;g=g.tag,v!==void 0&&(g&2||g&4)&&fd(l,i,v),p=p.next}while(p!==d)}Cr(s,i,l);break;case 1:if(!kt&&(Wa(l,i),d=l.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=l.memoizedProps,d.state=l.memoizedState,d.componentWillUnmount()}catch(k){Xe(l,i,k)}Cr(s,i,l);break;case 21:Cr(s,i,l);break;case 22:l.mode&1?(kt=(d=kt)||l.memoizedState!==null,Cr(s,i,l),kt=d):Cr(s,i,l);break;default:Cr(s,i,l)}}function ly(s){var i=s.updateQueue;if(i!==null){s.updateQueue=null;var l=s.stateNode;l===null&&(l=s.stateNode=new FE),i.forEach(function(d){var p=GE.bind(null,s,d);l.has(d)||(l.add(d),d.then(p,p))})}}function vn(s,i){var l=i.deletions;if(l!==null)for(var d=0;d<l.length;d++){var p=l[d];try{var g=s,v=i,k=v;e:for(;k!==null;){switch(k.tag){case 5:gt=k.stateNode,wn=!1;break e;case 3:gt=k.stateNode.containerInfo,wn=!0;break e;case 4:gt=k.stateNode.containerInfo,wn=!0;break e}k=k.return}if(gt===null)throw Error(t(160));uy(g,v,p),gt=null,wn=!1;var O=p.alternate;O!==null&&(O.return=null),p.return=null}catch(N){Xe(p,i,N)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)cy(i,s),i=i.sibling}function cy(s,i){var l=s.alternate,d=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(vn(i,s),Zn(s),d&4){try{di(3,s,s.return),du(3,s)}catch(se){Xe(s,s.return,se)}try{di(5,s,s.return)}catch(se){Xe(s,s.return,se)}}break;case 1:vn(i,s),Zn(s),d&512&&l!==null&&Wa(l,l.return);break;case 5:if(vn(i,s),Zn(s),d&512&&l!==null&&Wa(l,l.return),s.flags&32){var p=s.stateNode;try{Rs(p,"")}catch(se){Xe(s,s.return,se)}}if(d&4&&(p=s.stateNode,p!=null)){var g=s.memoizedProps,v=l!==null?l.memoizedProps:g,k=s.type,O=s.updateQueue;if(s.updateQueue=null,O!==null)try{k==="input"&&g.type==="radio"&&g.name!=null&&Fp(p,g),Zl(k,v);var N=Zl(k,g);for(v=0;v<O.length;v+=2){var H=O[v],Z=O[v+1];H==="style"?Zp(p,Z):H==="dangerouslySetInnerHTML"?Hp(p,Z):H==="children"?Rs(p,Z):T(p,H,Z,N)}switch(k){case"input":zl(p,g);break;case"textarea":zp(p,g);break;case"select":var B=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!g.multiple;var Y=g.value;Y!=null?Oa(p,!!g.multiple,Y,!1):B!==!!g.multiple&&(g.defaultValue!=null?Oa(p,!!g.multiple,g.defaultValue,!0):Oa(p,!!g.multiple,g.multiple?[]:"",!1))}p[ei]=g}catch(se){Xe(s,s.return,se)}}break;case 6:if(vn(i,s),Zn(s),d&4){if(s.stateNode===null)throw Error(t(162));p=s.stateNode,g=s.memoizedProps;try{p.nodeValue=g}catch(se){Xe(s,s.return,se)}}break;case 3:if(vn(i,s),Zn(s),d&4&&l!==null&&l.memoizedState.isDehydrated)try{Vs(i.containerInfo)}catch(se){Xe(s,s.return,se)}break;case 4:vn(i,s),Zn(s);break;case 13:vn(i,s),Zn(s),p=s.child,p.flags&8192&&(g=p.memoizedState!==null,p.stateNode.isHidden=g,!g||p.alternate!==null&&p.alternate.memoizedState!==null||(_d=Ye())),d&4&&ly(s);break;case 22:if(H=l!==null&&l.memoizedState!==null,s.mode&1?(kt=(N=kt)||H,vn(i,s),kt=N):vn(i,s),Zn(s),d&8192){if(N=s.memoizedState!==null,(s.stateNode.isHidden=N)&&!H&&s.mode&1)for(re=s,H=s.child;H!==null;){for(Z=re=H;re!==null;){switch(B=re,Y=B.child,B.tag){case 0:case 11:case 14:case 15:di(4,B,B.return);break;case 1:Wa(B,B.return);var ae=B.stateNode;if(typeof ae.componentWillUnmount=="function"){d=B,l=B.return;try{i=d,ae.props=i.memoizedProps,ae.state=i.memoizedState,ae.componentWillUnmount()}catch(se){Xe(d,l,se)}}break;case 5:Wa(B,B.return);break;case 22:if(B.memoizedState!==null){hy(Z);continue}}Y!==null?(Y.return=B,re=Y):hy(Z)}H=H.sibling}e:for(H=null,Z=s;;){if(Z.tag===5){if(H===null){H=Z;try{p=Z.stateNode,N?(g=p.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(k=Z.stateNode,O=Z.memoizedProps.style,v=O!=null&&O.hasOwnProperty("display")?O.display:null,k.style.display=qp("display",v))}catch(se){Xe(s,s.return,se)}}}else if(Z.tag===6){if(H===null)try{Z.stateNode.nodeValue=N?"":Z.memoizedProps}catch(se){Xe(s,s.return,se)}}else if((Z.tag!==22&&Z.tag!==23||Z.memoizedState===null||Z===s)&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===s)break e;for(;Z.sibling===null;){if(Z.return===null||Z.return===s)break e;H===Z&&(H=null),Z=Z.return}H===Z&&(H=null),Z.sibling.return=Z.return,Z=Z.sibling}}break;case 19:vn(i,s),Zn(s),d&4&&ly(s);break;case 21:break;default:vn(i,s),Zn(s)}}function Zn(s){var i=s.flags;if(i&2){try{e:{for(var l=s.return;l!==null;){if(iy(l)){var d=l;break e}l=l.return}throw Error(t(160))}switch(d.tag){case 5:var p=d.stateNode;d.flags&32&&(Rs(p,""),d.flags&=-33);var g=oy(s);md(s,g,p);break;case 3:case 4:var v=d.stateNode.containerInfo,k=oy(s);pd(s,k,v);break;default:throw Error(t(161))}}catch(O){Xe(s,s.return,O)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function UE(s,i,l){re=s,dy(s)}function dy(s,i,l){for(var d=(s.mode&1)!==0;re!==null;){var p=re,g=p.child;if(p.tag===22&&d){var v=p.memoizedState!==null||cu;if(!v){var k=p.alternate,O=k!==null&&k.memoizedState!==null||kt;k=cu;var N=kt;if(cu=v,(kt=O)&&!N)for(re=p;re!==null;)v=re,O=v.child,v.tag===22&&v.memoizedState!==null?py(p):O!==null?(O.return=v,re=O):py(p);for(;g!==null;)re=g,dy(g),g=g.sibling;re=p,cu=k,kt=N}fy(s)}else p.subtreeFlags&8772&&g!==null?(g.return=p,re=g):fy(s)}}function fy(s){for(;re!==null;){var i=re;if(i.flags&8772){var l=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:kt||du(5,i);break;case 1:var d=i.stateNode;if(i.flags&4&&!kt)if(l===null)d.componentDidMount();else{var p=i.elementType===i.type?l.memoizedProps:_n(i.type,l.memoizedProps);d.componentDidUpdate(p,l.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var g=i.updateQueue;g!==null&&hg(i,g,d);break;case 3:var v=i.updateQueue;if(v!==null){if(l=null,i.child!==null)switch(i.child.tag){case 5:l=i.child.stateNode;break;case 1:l=i.child.stateNode}hg(i,v,l)}break;case 5:var k=i.stateNode;if(l===null&&i.flags&4){l=k;var O=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&l.focus();break;case"img":O.src&&(l.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var N=i.alternate;if(N!==null){var H=N.memoizedState;if(H!==null){var Z=H.dehydrated;Z!==null&&Vs(Z)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}kt||i.flags&512&&hd(i)}catch(B){Xe(i,i.return,B)}}if(i===s){re=null;break}if(l=i.sibling,l!==null){l.return=i.return,re=l;break}re=i.return}}function hy(s){for(;re!==null;){var i=re;if(i===s){re=null;break}var l=i.sibling;if(l!==null){l.return=i.return,re=l;break}re=i.return}}function py(s){for(;re!==null;){var i=re;try{switch(i.tag){case 0:case 11:case 15:var l=i.return;try{du(4,i)}catch(O){Xe(i,l,O)}break;case 1:var d=i.stateNode;if(typeof d.componentDidMount=="function"){var p=i.return;try{d.componentDidMount()}catch(O){Xe(i,p,O)}}var g=i.return;try{hd(i)}catch(O){Xe(i,g,O)}break;case 5:var v=i.return;try{hd(i)}catch(O){Xe(i,v,O)}}}catch(O){Xe(i,i.return,O)}if(i===s){re=null;break}var k=i.sibling;if(k!==null){k.return=i.return,re=k;break}re=i.return}}var zE=Math.ceil,fu=M.ReactCurrentDispatcher,gd=M.ReactCurrentOwner,dn=M.ReactCurrentBatchConfig,Ae=0,ct=null,tt=null,yt=0,Yt=0,Ga=kr(0),st=0,fi=null,sa=0,hu=0,yd=0,hi=null,Ut=null,_d=0,Ja=1/0,or=null,pu=!1,wd=null,Ar=null,mu=!1,Ir=null,gu=0,pi=0,vd=null,yu=-1,_u=0;function At(){return Ae&6?Ye():yu!==-1?yu:yu=Ye()}function Rr(s){return s.mode&1?Ae&2&&yt!==0?yt&-yt:kE.transition!==null?(_u===0&&(_u=om()),_u):(s=Me,s!==0||(s=window.event,s=s===void 0?16:gm(s.type)),s):1}function bn(s,i,l,d){if(50<pi)throw pi=0,vd=null,Error(t(185));Fs(s,l,d),(!(Ae&2)||s!==ct)&&(s===ct&&(!(Ae&2)&&(hu|=l),st===4&&Nr(s,yt)),zt(s,d),l===1&&Ae===0&&!(i.mode&1)&&(Ja=Ye()+500,Zo&&Or()))}function zt(s,i){var l=s.callbackNode;k0(s,i);var d=xo(s,s===ct?yt:0);if(d===0)l!==null&&am(l),s.callbackNode=null,s.callbackPriority=0;else if(i=d&-d,s.callbackPriority!==i){if(l!=null&&am(l),i===1)s.tag===0?SE(gy.bind(null,s)):tg(gy.bind(null,s)),wE(function(){!(Ae&6)&&Or()}),l=null;else{switch(um(d)){case 1:l=Yl;break;case 4:l=sm;break;case 16:l=So;break;case 536870912:l=im;break;default:l=So}l=ky(l,my.bind(null,s))}s.callbackPriority=i,s.callbackNode=l}}function my(s,i){if(yu=-1,_u=0,Ae&6)throw Error(t(327));var l=s.callbackNode;if(Ka()&&s.callbackNode!==l)return null;var d=xo(s,s===ct?yt:0);if(d===0)return null;if(d&30||d&s.expiredLanes||i)i=wu(s,d);else{i=d;var p=Ae;Ae|=2;var g=_y();(ct!==s||yt!==i)&&(or=null,Ja=Ye()+500,oa(s,i));do try{HE();break}catch(k){yy(s,k)}while(!0);Fc(),fu.current=g,Ae=p,tt!==null?i=0:(ct=null,yt=0,i=st)}if(i!==0){if(i===2&&(p=ec(s),p!==0&&(d=p,i=bd(s,p))),i===1)throw l=fi,oa(s,0),Nr(s,d),zt(s,Ye()),l;if(i===6)Nr(s,d);else{if(p=s.current.alternate,!(d&30)&&!BE(p)&&(i=wu(s,d),i===2&&(g=ec(s),g!==0&&(d=g,i=bd(s,g))),i===1))throw l=fi,oa(s,0),Nr(s,d),zt(s,Ye()),l;switch(s.finishedWork=p,s.finishedLanes=d,i){case 0:case 1:throw Error(t(345));case 2:ua(s,Ut,or);break;case 3:if(Nr(s,d),(d&130023424)===d&&(i=_d+500-Ye(),10<i)){if(xo(s,0)!==0)break;if(p=s.suspendedLanes,(p&d)!==d){At(),s.pingedLanes|=s.suspendedLanes&p;break}s.timeoutHandle=xc(ua.bind(null,s,Ut,or),i);break}ua(s,Ut,or);break;case 4:if(Nr(s,d),(d&4194240)===d)break;for(i=s.eventTimes,p=-1;0<d;){var v=31-mn(d);g=1<<v,v=i[v],v>p&&(p=v),d&=~g}if(d=p,d=Ye()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*zE(d/1960))-d,10<d){s.timeoutHandle=xc(ua.bind(null,s,Ut,or),d);break}ua(s,Ut,or);break;case 5:ua(s,Ut,or);break;default:throw Error(t(329))}}}return zt(s,Ye()),s.callbackNode===l?my.bind(null,s):null}function bd(s,i){var l=hi;return s.current.memoizedState.isDehydrated&&(oa(s,i).flags|=256),s=wu(s,i),s!==2&&(i=Ut,Ut=l,i!==null&&Ed(i)),s}function Ed(s){Ut===null?Ut=s:Ut.push.apply(Ut,s)}function BE(s){for(var i=s;;){if(i.flags&16384){var l=i.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var d=0;d<l.length;d++){var p=l[d],g=p.getSnapshot;p=p.value;try{if(!gn(g(),p))return!1}catch{return!1}}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Nr(s,i){for(i&=~yd,i&=~hu,s.suspendedLanes|=i,s.pingedLanes&=~i,s=s.expirationTimes;0<i;){var l=31-mn(i),d=1<<l;s[l]=-1,i&=~d}}function gy(s){if(Ae&6)throw Error(t(327));Ka();var i=xo(s,0);if(!(i&1))return zt(s,Ye()),null;var l=wu(s,i);if(s.tag!==0&&l===2){var d=ec(s);d!==0&&(i=d,l=bd(s,d))}if(l===1)throw l=fi,oa(s,0),Nr(s,i),zt(s,Ye()),l;if(l===6)throw Error(t(345));return s.finishedWork=s.current.alternate,s.finishedLanes=i,ua(s,Ut,or),zt(s,Ye()),null}function Sd(s,i){var l=Ae;Ae|=1;try{return s(i)}finally{Ae=l,Ae===0&&(Ja=Ye()+500,Zo&&Or())}}function ia(s){Ir!==null&&Ir.tag===0&&!(Ae&6)&&Ka();var i=Ae;Ae|=1;var l=dn.transition,d=Me;try{if(dn.transition=null,Me=1,s)return s()}finally{Me=d,dn.transition=l,Ae=i,!(Ae&6)&&Or()}}function kd(){Yt=Ga.current,He(Ga)}function oa(s,i){s.finishedWork=null,s.finishedLanes=0;var l=s.timeoutHandle;if(l!==-1&&(s.timeoutHandle=-1,_E(l)),tt!==null)for(l=tt.return;l!==null;){var d=l;switch(Nc(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&Ho();break;case 3:qa(),He(Mt),He(bt),Zc();break;case 5:Hc(d);break;case 4:qa();break;case 13:He(Ge);break;case 19:He(Ge);break;case 10:Dc(d.type._context);break;case 22:case 23:kd()}l=l.return}if(ct=s,tt=s=$r(s.current,null),yt=Yt=i,st=0,fi=null,yd=hu=sa=0,Ut=hi=null,na!==null){for(i=0;i<na.length;i++)if(l=na[i],d=l.interleaved,d!==null){l.interleaved=null;var p=d.next,g=l.pending;if(g!==null){var v=g.next;g.next=p,d.next=v}l.pending=d}na=null}return s}function yy(s,i){do{var l=tt;try{if(Fc(),nu.current=iu,ru){for(var d=Je.memoizedState;d!==null;){var p=d.queue;p!==null&&(p.pending=null),d=d.next}ru=!1}if(aa=0,lt=at=Je=null,ii=!1,oi=0,gd.current=null,l===null||l.return===null){st=1,fi=i,tt=null;break}e:{var g=s,v=l.return,k=l,O=i;if(i=yt,k.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var N=O,H=k,Z=H.tag;if(!(H.mode&1)&&(Z===0||Z===11||Z===15)){var B=H.alternate;B?(H.updateQueue=B.updateQueue,H.memoizedState=B.memoizedState,H.lanes=B.lanes):(H.updateQueue=null,H.memoizedState=null)}var Y=Bg(v);if(Y!==null){Y.flags&=-257,Vg(Y,v,k,g,i),Y.mode&1&&zg(g,N,i),i=Y,O=N;var ae=i.updateQueue;if(ae===null){var se=new Set;se.add(O),i.updateQueue=se}else ae.add(O);break e}else{if(!(i&1)){zg(g,N,i),Pd();break e}O=Error(t(426))}}else if(We&&k.mode&1){var et=Bg(v);if(et!==null){!(et.flags&65536)&&(et.flags|=256),Vg(et,v,k,g,i),Lc(Za(O,k));break e}}g=O=Za(O,k),st!==4&&(st=2),hi===null?hi=[g]:hi.push(g),g=v;do{switch(g.tag){case 3:g.flags|=65536,i&=-i,g.lanes|=i;var I=Dg(g,O,i);fg(g,I);break e;case 1:k=O;var A=g.type,R=g.stateNode;if(!(g.flags&128)&&(typeof A.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(Ar===null||!Ar.has(R)))){g.flags|=65536,i&=-i,g.lanes|=i;var J=Ug(g,k,i);fg(g,J);break e}}g=g.return}while(g!==null)}vy(l)}catch(ie){i=ie,tt===l&&l!==null&&(tt=l=l.return);continue}break}while(!0)}function _y(){var s=fu.current;return fu.current=iu,s===null?iu:s}function Pd(){(st===0||st===3||st===2)&&(st=4),ct===null||!(sa&268435455)&&!(hu&268435455)||Nr(ct,yt)}function wu(s,i){var l=Ae;Ae|=2;var d=_y();(ct!==s||yt!==i)&&(or=null,oa(s,i));do try{VE();break}catch(p){yy(s,p)}while(!0);if(Fc(),Ae=l,fu.current=d,tt!==null)throw Error(t(261));return ct=null,yt=0,st}function VE(){for(;tt!==null;)wy(tt)}function HE(){for(;tt!==null&&!m0();)wy(tt)}function wy(s){var i=Sy(s.alternate,s,Yt);s.memoizedProps=s.pendingProps,i===null?vy(s):tt=i,gd.current=null}function vy(s){var i=s;do{var l=i.alternate;if(s=i.return,i.flags&32768){if(l=ME(l,i),l!==null){l.flags&=32767,tt=l;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{st=6,tt=null;return}}else if(l=LE(l,i,Yt),l!==null){tt=l;return}if(i=i.sibling,i!==null){tt=i;return}tt=i=s}while(i!==null);st===0&&(st=5)}function ua(s,i,l){var d=Me,p=dn.transition;try{dn.transition=null,Me=1,qE(s,i,l,d)}finally{dn.transition=p,Me=d}return null}function qE(s,i,l,d){do Ka();while(Ir!==null);if(Ae&6)throw Error(t(327));l=s.finishedWork;var p=s.finishedLanes;if(l===null)return null;if(s.finishedWork=null,s.finishedLanes=0,l===s.current)throw Error(t(177));s.callbackNode=null,s.callbackPriority=0;var g=l.lanes|l.childLanes;if(P0(s,g),s===ct&&(tt=ct=null,yt=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||mu||(mu=!0,ky(So,function(){return Ka(),null})),g=(l.flags&15990)!==0,l.subtreeFlags&15990||g){g=dn.transition,dn.transition=null;var v=Me;Me=1;var k=Ae;Ae|=4,gd.current=null,DE(s,l),cy(l,s),dE(Pc),Ao=!!kc,Pc=kc=null,s.current=l,UE(l),g0(),Ae=k,Me=v,dn.transition=g}else s.current=l;if(mu&&(mu=!1,Ir=s,gu=p),g=s.pendingLanes,g===0&&(Ar=null),w0(l.stateNode),zt(s,Ye()),i!==null)for(d=s.onRecoverableError,l=0;l<i.length;l++)p=i[l],d(p.value,{componentStack:p.stack,digest:p.digest});if(pu)throw pu=!1,s=wd,wd=null,s;return gu&1&&s.tag!==0&&Ka(),g=s.pendingLanes,g&1?s===vd?pi++:(pi=0,vd=s):pi=0,Or(),null}function Ka(){if(Ir!==null){var s=um(gu),i=dn.transition,l=Me;try{if(dn.transition=null,Me=16>s?16:s,Ir===null)var d=!1;else{if(s=Ir,Ir=null,gu=0,Ae&6)throw Error(t(331));var p=Ae;for(Ae|=4,re=s.current;re!==null;){var g=re,v=g.child;if(re.flags&16){var k=g.deletions;if(k!==null){for(var O=0;O<k.length;O++){var N=k[O];for(re=N;re!==null;){var H=re;switch(H.tag){case 0:case 11:case 15:di(8,H,g)}var Z=H.child;if(Z!==null)Z.return=H,re=Z;else for(;re!==null;){H=re;var B=H.sibling,Y=H.return;if(sy(H),H===N){re=null;break}if(B!==null){B.return=Y,re=B;break}re=Y}}}var ae=g.alternate;if(ae!==null){var se=ae.child;if(se!==null){ae.child=null;do{var et=se.sibling;se.sibling=null,se=et}while(se!==null)}}re=g}}if(g.subtreeFlags&2064&&v!==null)v.return=g,re=v;else e:for(;re!==null;){if(g=re,g.flags&2048)switch(g.tag){case 0:case 11:case 15:di(9,g,g.return)}var I=g.sibling;if(I!==null){I.return=g.return,re=I;break e}re=g.return}}var A=s.current;for(re=A;re!==null;){v=re;var R=v.child;if(v.subtreeFlags&2064&&R!==null)R.return=v,re=R;else e:for(v=A;re!==null;){if(k=re,k.flags&2048)try{switch(k.tag){case 0:case 11:case 15:du(9,k)}}catch(ie){Xe(k,k.return,ie)}if(k===v){re=null;break e}var J=k.sibling;if(J!==null){J.return=k.return,re=J;break e}re=k.return}}if(Ae=p,Or(),Bn&&typeof Bn.onPostCommitFiberRoot=="function")try{Bn.onPostCommitFiberRoot(ko,s)}catch{}d=!0}return d}finally{Me=l,dn.transition=i}}return!1}function by(s,i,l){i=Za(l,i),i=Dg(s,i,1),s=Tr(s,i,1),i=At(),s!==null&&(Fs(s,1,i),zt(s,i))}function Xe(s,i,l){if(s.tag===3)by(s,s,l);else for(;i!==null;){if(i.tag===3){by(i,s,l);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ar===null||!Ar.has(d))){s=Za(l,s),s=Ug(i,s,1),i=Tr(i,s,1),s=At(),i!==null&&(Fs(i,1,s),zt(i,s));break}}i=i.return}}function ZE(s,i,l){var d=s.pingCache;d!==null&&d.delete(i),i=At(),s.pingedLanes|=s.suspendedLanes&l,ct===s&&(yt&l)===l&&(st===4||st===3&&(yt&130023424)===yt&&500>Ye()-_d?oa(s,0):yd|=l),zt(s,i)}function Ey(s,i){i===0&&(s.mode&1?(i=Oo,Oo<<=1,!(Oo&130023424)&&(Oo=4194304)):i=1);var l=At();s=ar(s,i),s!==null&&(Fs(s,i,l),zt(s,l))}function WE(s){var i=s.memoizedState,l=0;i!==null&&(l=i.retryLane),Ey(s,l)}function GE(s,i){var l=0;switch(s.tag){case 13:var d=s.stateNode,p=s.memoizedState;p!==null&&(l=p.retryLane);break;case 19:d=s.stateNode;break;default:throw Error(t(314))}d!==null&&d.delete(i),Ey(s,l)}var Sy;Sy=function(s,i,l){if(s!==null)if(s.memoizedProps!==i.pendingProps||Mt.current)Dt=!0;else{if(!(s.lanes&l)&&!(i.flags&128))return Dt=!1,jE(s,i,l);Dt=!!(s.flags&131072)}else Dt=!1,We&&i.flags&1048576&&ng(i,Go,i.index);switch(i.lanes=0,i.tag){case 2:var d=i.type;lu(s,i),s=i.pendingProps;var p=Fa(i,bt.current);Ha(i,l),p=Jc(null,i,d,s,p,l);var g=Kc();return i.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Ft(d)?(g=!0,qo(i)):g=!1,i.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,Bc(i),p.updater=ou,i.stateNode=p,p._reactInternals=i,nd(i,d,s,l),i=id(null,i,d,!0,g,l)):(i.tag=0,We&&g&&Rc(i),Ct(null,i,p,l),i=i.child),i;case 16:d=i.elementType;e:{switch(lu(s,i),s=i.pendingProps,p=d._init,d=p(d._payload),i.type=d,p=i.tag=KE(d),s=_n(d,s),p){case 0:i=sd(null,i,d,s,l);break e;case 1:i=Jg(null,i,d,s,l);break e;case 11:i=Hg(null,i,d,s,l);break e;case 14:i=qg(null,i,d,_n(d.type,s),l);break e}throw Error(t(306,d,""))}return i;case 0:return d=i.type,p=i.pendingProps,p=i.elementType===d?p:_n(d,p),sd(s,i,d,p,l);case 1:return d=i.type,p=i.pendingProps,p=i.elementType===d?p:_n(d,p),Jg(s,i,d,p,l);case 3:e:{if(Kg(i),s===null)throw Error(t(387));d=i.pendingProps,g=i.memoizedState,p=g.element,dg(s,i),eu(i,d,null,l);var v=i.memoizedState;if(d=v.element,g.isDehydrated)if(g={element:d,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},i.updateQueue.baseState=g,i.memoizedState=g,i.flags&256){p=Za(Error(t(423)),i),i=Qg(s,i,d,l,p);break e}else if(d!==p){p=Za(Error(t(424)),i),i=Qg(s,i,d,l,p);break e}else for(Xt=Sr(i.stateNode.containerInfo.firstChild),Qt=i,We=!0,yn=null,l=lg(i,null,d,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(za(),d===p){i=ir(s,i,l);break e}Ct(s,i,d,l)}i=i.child}return i;case 5:return pg(i),s===null&&jc(i),d=i.type,p=i.pendingProps,g=s!==null?s.memoizedProps:null,v=p.children,Oc(d,p)?v=null:g!==null&&Oc(d,g)&&(i.flags|=32),Gg(s,i),Ct(s,i,v,l),i.child;case 6:return s===null&&jc(i),null;case 13:return Xg(s,i,l);case 4:return Vc(i,i.stateNode.containerInfo),d=i.pendingProps,s===null?i.child=Ba(i,null,d,l):Ct(s,i,d,l),i.child;case 11:return d=i.type,p=i.pendingProps,p=i.elementType===d?p:_n(d,p),Hg(s,i,d,p,l);case 7:return Ct(s,i,i.pendingProps,l),i.child;case 8:return Ct(s,i,i.pendingProps.children,l),i.child;case 12:return Ct(s,i,i.pendingProps.children,l),i.child;case 10:e:{if(d=i.type._context,p=i.pendingProps,g=i.memoizedProps,v=p.value,Be(Qo,d._currentValue),d._currentValue=v,g!==null)if(gn(g.value,v)){if(g.children===p.children&&!Mt.current){i=ir(s,i,l);break e}}else for(g=i.child,g!==null&&(g.return=i);g!==null;){var k=g.dependencies;if(k!==null){v=g.child;for(var O=k.firstContext;O!==null;){if(O.context===d){if(g.tag===1){O=sr(-1,l&-l),O.tag=2;var N=g.updateQueue;if(N!==null){N=N.shared;var H=N.pending;H===null?O.next=O:(O.next=H.next,H.next=O),N.pending=O}}g.lanes|=l,O=g.alternate,O!==null&&(O.lanes|=l),Uc(g.return,l,i),k.lanes|=l;break}O=O.next}}else if(g.tag===10)v=g.type===i.type?null:g.child;else if(g.tag===18){if(v=g.return,v===null)throw Error(t(341));v.lanes|=l,k=v.alternate,k!==null&&(k.lanes|=l),Uc(v,l,i),v=g.sibling}else v=g.child;if(v!==null)v.return=g;else for(v=g;v!==null;){if(v===i){v=null;break}if(g=v.sibling,g!==null){g.return=v.return,v=g;break}v=v.return}g=v}Ct(s,i,p.children,l),i=i.child}return i;case 9:return p=i.type,d=i.pendingProps.children,Ha(i,l),p=ln(p),d=d(p),i.flags|=1,Ct(s,i,d,l),i.child;case 14:return d=i.type,p=_n(d,i.pendingProps),p=_n(d.type,p),qg(s,i,d,p,l);case 15:return Zg(s,i,i.type,i.pendingProps,l);case 17:return d=i.type,p=i.pendingProps,p=i.elementType===d?p:_n(d,p),lu(s,i),i.tag=1,Ft(d)?(s=!0,qo(i)):s=!1,Ha(i,l),Mg(i,d,p),nd(i,d,p,l),id(null,i,d,!0,s,l);case 19:return ey(s,i,l);case 22:return Wg(s,i,l)}throw Error(t(156,i.tag))};function ky(s,i){return rm(s,i)}function JE(s,i,l,d){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fn(s,i,l,d){return new JE(s,i,l,d)}function Od(s){return s=s.prototype,!(!s||!s.isReactComponent)}function KE(s){if(typeof s=="function")return Od(s)?1:0;if(s!=null){if(s=s.$$typeof,s===qe)return 11;if(s===G)return 14}return 2}function $r(s,i){var l=s.alternate;return l===null?(l=fn(s.tag,i,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=i,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&14680064,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,i=s.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l}function vu(s,i,l,d,p,g){var v=2;if(d=s,typeof s=="function")Od(s)&&(v=1);else if(typeof s=="string")v=5;else e:switch(s){case V:return la(l.children,p,g,i);case q:v=8,p|=8;break;case me:return s=fn(12,l,i,p|2),s.elementType=me,s.lanes=g,s;case Ze:return s=fn(13,l,i,p),s.elementType=Ze,s.lanes=g,s;case K:return s=fn(19,l,i,p),s.elementType=K,s.lanes=g,s;case Q:return bu(l,p,g,i);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case ve:v=10;break e;case ye:v=9;break e;case qe:v=11;break e;case G:v=14;break e;case te:v=16,d=null;break e}throw Error(t(130,s==null?s:typeof s,""))}return i=fn(v,l,i,p),i.elementType=s,i.type=d,i.lanes=g,i}function la(s,i,l,d){return s=fn(7,s,d,i),s.lanes=l,s}function bu(s,i,l,d){return s=fn(22,s,d,i),s.elementType=Q,s.lanes=l,s.stateNode={isHidden:!1},s}function xd(s,i,l){return s=fn(6,s,null,i),s.lanes=l,s}function Td(s,i,l){return i=fn(4,s.children!==null?s.children:[],s.key,i),i.lanes=l,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}function QE(s,i,l,d,p){this.tag=i,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tc(0),this.expirationTimes=tc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tc(0),this.identifierPrefix=d,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function Cd(s,i,l,d,p,g,v,k,O){return s=new QE(s,i,l,k,O),i===1?(i=1,g===!0&&(i|=8)):i=0,g=fn(3,null,null,i),s.current=g,g.stateNode=s,g.memoizedState={element:d,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bc(g),s}function XE(s,i,l){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:d==null?null:""+d,children:s,containerInfo:i,implementation:l}}function Py(s){if(!s)return Pr;s=s._reactInternals;e:{if(Qr(s)!==s||s.tag!==1)throw Error(t(170));var i=s;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Ft(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(t(171))}if(s.tag===1){var l=s.type;if(Ft(l))return Ym(s,l,i)}return i}function Oy(s,i,l,d,p,g,v,k,O){return s=Cd(l,d,!0,s,p,g,v,k,O),s.context=Py(null),l=s.current,d=At(),p=Rr(l),g=sr(d,p),g.callback=i??null,Tr(l,g,p),s.current.lanes=p,Fs(s,p,d),zt(s,d),s}function Eu(s,i,l,d){var p=i.current,g=At(),v=Rr(p);return l=Py(l),i.context===null?i.context=l:i.pendingContext=l,i=sr(g,v),i.payload={element:s},d=d===void 0?null:d,d!==null&&(i.callback=d),s=Tr(p,i,v),s!==null&&(bn(s,p,v,g),Yo(s,p,v)),v}function Su(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function xy(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<i?l:i}}function Ad(s,i){xy(s,i),(s=s.alternate)&&xy(s,i)}var Ty=typeof reportError=="function"?reportError:function(s){console.error(s)};function Id(s){this._internalRoot=s}ku.prototype.render=Id.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(t(409));Eu(s,i,null,null)},ku.prototype.unmount=Id.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;ia(function(){Eu(null,s,null,null)}),i[er]=null}};function ku(s){this._internalRoot=s}ku.prototype.unstable_scheduleHydration=function(s){if(s){var i=dm();s={blockedOn:null,target:s,priority:i};for(var l=0;l<vr.length&&i!==0&&i<vr[l].priority;l++);vr.splice(l,0,s),l===0&&pm(s)}};function Rd(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Pu(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function Cy(){}function YE(s,i,l,d,p){if(p){if(typeof d=="function"){var g=d;d=function(){var N=Su(v);g.call(N)}}var v=Oy(i,d,s,0,null,!1,!1,"",Cy);return s._reactRootContainer=v,s[er]=v.current,Xs(s.nodeType===8?s.parentNode:s),ia(),v}for(;p=s.lastChild;)s.removeChild(p);if(typeof d=="function"){var k=d;d=function(){var N=Su(O);k.call(N)}}var O=Cd(s,0,!1,null,null,!1,!1,"",Cy);return s._reactRootContainer=O,s[er]=O.current,Xs(s.nodeType===8?s.parentNode:s),ia(function(){Eu(i,O,l,d)}),O}function Ou(s,i,l,d,p){var g=l._reactRootContainer;if(g){var v=g;if(typeof p=="function"){var k=p;p=function(){var O=Su(v);k.call(O)}}Eu(i,v,s,p)}else v=YE(l,i,s,p,d);return Su(v)}lm=function(s){switch(s.tag){case 3:var i=s.stateNode;if(i.current.memoizedState.isDehydrated){var l=Ms(i.pendingLanes);l!==0&&(nc(i,l|1),zt(i,Ye()),!(Ae&6)&&(Ja=Ye()+500,Or()))}break;case 13:ia(function(){var d=ar(s,1);if(d!==null){var p=At();bn(d,s,1,p)}}),Ad(s,1)}},rc=function(s){if(s.tag===13){var i=ar(s,134217728);if(i!==null){var l=At();bn(i,s,134217728,l)}Ad(s,134217728)}},cm=function(s){if(s.tag===13){var i=Rr(s),l=ar(s,i);if(l!==null){var d=At();bn(l,s,i,d)}Ad(s,i)}},dm=function(){return Me},fm=function(s,i){var l=Me;try{return Me=s,i()}finally{Me=l}},Jl=function(s,i,l){switch(i){case"input":if(zl(s,l),i=l.name,l.type==="radio"&&i!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<l.length;i++){var d=l[i];if(d!==s&&d.form===s.form){var p=Vo(d);if(!p)throw Error(t(90));Lp(d),zl(d,p)}}}break;case"textarea":zp(s,l);break;case"select":i=l.value,i!=null&&Oa(s,!!l.multiple,i,!1)}},Kp=Sd,Qp=ia;var eS={usingClientEntryPoint:!1,Events:[ti,La,Vo,Gp,Jp,Sd]},mi={findFiberByHostInstance:Xr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tS={bundleType:mi.bundleType,version:mi.version,rendererPackageName:mi.rendererPackageName,rendererConfig:mi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:M.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=tm(s),s===null?null:s.stateNode},findFiberByHostInstance:mi.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xu.isDisabled&&xu.supportsFiber)try{ko=xu.inject(tS),Bn=xu}catch{}}return Bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eS,Bt.createPortal=function(s,i){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rd(i))throw Error(t(200));return XE(s,i,null,l)},Bt.createRoot=function(s,i){if(!Rd(s))throw Error(t(299));var l=!1,d="",p=Ty;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onRecoverableError!==void 0&&(p=i.onRecoverableError)),i=Cd(s,1,!1,null,null,l,!1,d,p),s[er]=i.current,Xs(s.nodeType===8?s.parentNode:s),new Id(i)},Bt.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(t(188)):(s=Object.keys(s).join(","),Error(t(268,s)));return s=tm(i),s=s===null?null:s.stateNode,s},Bt.flushSync=function(s){return ia(s)},Bt.hydrate=function(s,i,l){if(!Pu(i))throw Error(t(200));return Ou(null,s,i,!0,l)},Bt.hydrateRoot=function(s,i,l){if(!Rd(s))throw Error(t(405));var d=l!=null&&l.hydratedSources||null,p=!1,g="",v=Ty;if(l!=null&&(l.unstable_strictMode===!0&&(p=!0),l.identifierPrefix!==void 0&&(g=l.identifierPrefix),l.onRecoverableError!==void 0&&(v=l.onRecoverableError)),i=Oy(i,null,s,1,l??null,p,!1,g,v),s[er]=i.current,Xs(s),d)for(s=0;s<d.length;s++)l=d[s],p=l._getVersion,p=p(l._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[l,p]:i.mutableSourceEagerHydrationData.push(l,p);return new ku(i)},Bt.render=function(s,i,l){if(!Pu(i))throw Error(t(200));return Ou(null,s,i,!1,l)},Bt.unmountComponentAtNode=function(s){if(!Pu(s))throw Error(t(40));return s._reactRootContainer?(ia(function(){Ou(null,null,s,!1,function(){s._reactRootContainer=null,s[er]=null})}),!0):!1},Bt.unstable_batchedUpdates=Sd,Bt.unstable_renderSubtreeIntoContainer=function(s,i,l,d){if(!Pu(l))throw Error(t(200));if(s==null||s._reactInternals===void 0)throw Error(t(38));return Ou(s,i,l,!1,d)},Bt.version="18.3.1-next-f1338f8080-20240426",Bt}var My;function dS(){if(My)return jd.exports;My=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),jd.exports=cS(),jd.exports}var Fy;function fS(){if(Fy)return Tu;Fy=1;var r=dS();return Tu.createRoot=r.createRoot,Tu.hydrateRoot=r.hydrateRoot,Tu}var hS=fS();const fh="RFC3986",hh={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},pS="RFC1738",mS=Array.isArray,Wn=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),Fd=1024,gS=(r,e,t,n,a)=>{if(r.length===0)return r;let o=r;if(typeof r=="symbol"?o=Symbol.prototype.toString.call(r):typeof r!="string"&&(o=String(r)),t==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});let u="";for(let c=0;c<o.length;c+=Fd){const f=o.length>=Fd?o.slice(c,c+Fd):o,h=[];for(let m=0;m<f.length;++m){let y=f.charCodeAt(m);if(y===45||y===46||y===95||y===126||y>=48&&y<=57||y>=65&&y<=90||y>=97&&y<=122||a===pS&&(y===40||y===41)){h[h.length]=f.charAt(m);continue}if(y<128){h[h.length]=Wn[y];continue}if(y<2048){h[h.length]=Wn[192|y>>6]+Wn[128|y&63];continue}if(y<55296||y>=57344){h[h.length]=Wn[224|y>>12]+Wn[128|y>>6&63]+Wn[128|y&63];continue}m+=1,y=65536+((y&1023)<<10|f.charCodeAt(m)&1023),h[h.length]=Wn[240|y>>18]+Wn[128|y>>12&63]+Wn[128|y>>6&63]+Wn[128|y&63]}u+=h.join("")}return u};function yS(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Dy(r,e){if(mS(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const _S=Object.prototype.hasOwnProperty,ev={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},Gn=Array.isArray,wS=Array.prototype.push,tv=function(r,e){wS.apply(r,Gn(e)?e:[e])},vS=Date.prototype.toISOString,ot={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:gS,encodeValuesOnly:!1,format:fh,formatter:hh[fh],indices:!1,serializeDate(r){return vS.call(r)},skipNulls:!1,strictNullHandling:!1};function bS(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const Dd={};function nv(r,e,t,n,a,o,u,c,f,h,m,y,_,b,w,S,E,P){let C=r,T=P,M=0,j=!1;for(;(T=T.get(Dd))!==void 0&&!j;){const ve=T.get(r);if(M+=1,typeof ve<"u"){if(ve===M)throw new RangeError("Cyclic object value");j=!0}typeof T.get(Dd)>"u"&&(M=0)}if(typeof h=="function"?C=h(e,C):C instanceof Date?C=_==null?void 0:_(C):t==="comma"&&Gn(C)&&(C=Dy(C,function(ve){return ve instanceof Date?_==null?void 0:_(ve):ve})),C===null){if(o)return f&&!S?f(e,ot.encoder,E,"key",b):e;C=""}if(bS(C)||yS(C)){if(f){const ve=S?e:f(e,ot.encoder,E,"key",b);return[(w==null?void 0:w(ve))+"="+(w==null?void 0:w(f(C,ot.encoder,E,"value",b)))]}return[(w==null?void 0:w(e))+"="+(w==null?void 0:w(String(C)))]}const D=[];if(typeof C>"u")return D;let V;if(t==="comma"&&Gn(C))S&&f&&(C=Dy(C,f)),V=[{value:C.length>0?C.join(",")||null:void 0}];else if(Gn(h))V=h;else{const ve=Object.keys(C);V=m?ve.sort(m):ve}const q=c?String(e).replace(/\./g,"%2E"):String(e),me=n&&Gn(C)&&C.length===1?q+"[]":q;if(a&&Gn(C)&&C.length===0)return me+"[]";for(let ve=0;ve<V.length;++ve){const ye=V[ve],qe=typeof ye=="object"&&typeof ye.value<"u"?ye.value:C[ye];if(u&&qe===null)continue;const Ze=y&&c?ye.replace(/\./g,"%2E"):ye,K=Gn(C)?typeof t=="function"?t(me,Ze):me:me+(y?"."+Ze:"["+Ze+"]");P.set(r,M);const G=new WeakMap;G.set(Dd,P),tv(D,nv(qe,K,t,n,a,o,u,c,t==="comma"&&S&&Gn(C)?null:f,h,m,y,_,b,w,S,E,G))}return D}function ES(r=ot){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||ot.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=fh;if(typeof r.format<"u"){if(!_S.call(hh,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=hh[t];let a=ot.filter;(typeof r.filter=="function"||Gn(r.filter))&&(a=r.filter);let o;if(r.arrayFormat&&r.arrayFormat in ev?o=r.arrayFormat:"indices"in r?o=r.indices?"indices":"repeat":o=ot.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const u=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:ot.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:ot.addQueryPrefix,allowDots:u,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:ot.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:ot.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?ot.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:ot.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:ot.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:ot.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:ot.encodeValuesOnly,filter:a,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:ot.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:ot.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:ot.strictNullHandling}}function SS(r,e={}){let t=r;const n=ES(e);let a,o;typeof n.filter=="function"?(o=n.filter,t=o("",t)):Gn(n.filter)&&(o=n.filter,a=o);const u=[];if(typeof t!="object"||t===null)return"";const c=ev[n.arrayFormat],f=c==="comma"&&n.commaRoundTrip;a||(a=Object.keys(t)),n.sort&&a.sort(n.sort);const h=new WeakMap;for(let _=0;_<a.length;++_){const b=a[_];n.skipNulls&&t[b]===null||tv(u,nv(t[b],b,c,f,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,h))}const m=u.join(n.delimiter);let y=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),m.length>0?y+m:""}const es="4.79.3";let Uy=!1,Ci,rv,av,ph,sv,iv,ov,uv,lv;function kS(r,e={auto:!1}){if(Uy)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(Ci)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${Ci}'\``);Uy=e.auto,Ci=r.kind,rv=r.fetch,av=r.FormData,ph=r.File,sv=r.ReadableStream,iv=r.getMultipartRequestOptions,ov=r.getDefaultAgent,uv=r.fileFromPath,lv=r.isFsReadStream}class PS{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function OS({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,a,o;try{t=fetch,n=Request,a=Response,o=Headers}catch(u){throw new Error(`this environment is missing the following Web Fetch API type: ${u.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:a,Headers:o,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(u,c)=>({...c,body:new PS(u)}),getDefaultAgent:u=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:u=>!1}}Ci||kS(OS(),{auto:!0});class Oe extends Error{}class vt extends Oe{constructor(e,t,n,a){super(`${vt.makeMessage(e,t,n)}`),this.status=e,this.headers=a,this.request_id=a==null?void 0:a["x-request-id"],this.error=t;const o=t;this.code=o==null?void 0:o.code,this.param=o==null?void 0:o.param,this.type=o==null?void 0:o.type}static makeMessage(e,t,n){const a=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,t,n,a){if(!e||!a)return new bl({message:n,cause:gh(t)});const o=t==null?void 0:t.error;return e===400?new cv(e,o,n,a):e===401?new dv(e,o,n,a):e===403?new fv(e,o,n,a):e===404?new hv(e,o,n,a):e===409?new pv(e,o,n,a):e===422?new mv(e,o,n,a):e===429?new gv(e,o,n,a):e>=500?new yv(e,o,n,a):new vt(e,o,n,a)}}class pn extends vt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class bl extends vt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class El extends bl{constructor({message:e}={}){super({message:e??"Request timed out."})}}class cv extends vt{}class dv extends vt{}class fv extends vt{}class hv extends vt{}class pv extends vt{}class mv extends vt{}class gv extends vt{}class yv extends vt{}class _v extends Oe{constructor(){super("Could not parse response content as the length limit was reached")}}class wv extends Oe{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class _a{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=_a.NEWLINE_CHARS.has(t[t.length-1]||"");let a=t.split(_a.NEWLINE_REGEXP);return n&&a.pop(),a.length===1&&!n?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),n||(this.buffer=[a.pop()||""]),a)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Oe(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Oe(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Oe("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}_a.NEWLINE_CHARS=new Set([`
`,"\r"]);_a.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Kn{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let o=!1;try{for await(const u of xS(e,t))if(!o){if(u.data.startsWith("[DONE]")){o=!0;continue}if(u.event===null){let c;try{c=JSON.parse(u.data)}catch(f){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),f}if(c&&c.error)throw new vt(void 0,c.error,void 0,void 0);yield c}else{let c;try{c=JSON.parse(u.data)}catch(f){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),f}if(u.event=="error")throw new vt(void 0,c.error,c.message,void 0);yield{event:u.event,data:c}}}o=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{o||t.abort()}}return new Kn(a,t)}static fromReadableStream(e,t){let n=!1;async function*a(){const u=new _a,c=vv(e);for await(const f of c)for(const h of u.decode(f))yield h;for(const f of u.flush())yield f}async function*o(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let u=!1;try{for await(const c of a())u||c&&(yield JSON.parse(c));u=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{u||t.abort()}}return new Kn(o,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),a=o=>({next:()=>{if(o.length===0){const u=n.next();e.push(u),t.push(u)}return o.shift()}});return[new Kn(()=>a(e),this.controller),new Kn(()=>a(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new sv({async start(){t=e[Symbol.asyncIterator]()},async pull(a){try{const{value:o,done:u}=await t.next();if(u)return a.close();const c=n.encode(JSON.stringify(o)+`
`);a.enqueue(c)}catch(o){a.error(o)}},async cancel(){var a;await((a=t.return)==null?void 0:a.call(t))}})}}async function*xS(r,e){if(!r.body)throw e.abort(),new Oe("Attempted to iterate over a response with no body");const t=new AS,n=new _a,a=vv(r.body);for await(const o of TS(a))for(const u of n.decode(o)){const c=t.decode(u);c&&(yield c)}for(const o of n.flush()){const u=t.decode(o);u&&(yield u)}}async function*TS(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let a=new Uint8Array(e.length+n.length);a.set(e),a.set(n,e.length),e=a;let o;for(;(o=CS(e))!==-1;)yield e.slice(0,o),e=e.slice(o)}e.length>0&&(yield e)}function CS(r){for(let n=0;n<r.length-2;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}class AS{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,a]=IS(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}}function IS(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}function vv(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const bv=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",Ev=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Sl(r),Sl=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",RS=r=>Ev(r)||bv(r)||lv(r);async function Sv(r,e,t){var a;if(r=await r,Ev(r))return r;if(bv(r)){const o=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const u=Sl(o)?[await o.arrayBuffer()]:[o];return new ph(u,e,t)}const n=await NS(r);if(e||(e=jS(r)??"unknown_file"),!(t!=null&&t.type)){const o=(a=n[0])==null?void 0:a.type;typeof o=="string"&&(t={...t,type:o})}return new ph(n,e,t)}async function NS(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Sl(r))e.push(await r.arrayBuffer());else if(LS(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${$S(r)}`);return e}function $S(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function jS(r){var e;return Ud(r.name)||Ud(r.filename)||((e=Ud(r.path))==null?void 0:e.split(/[\\/]/).pop())}const Ud=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},LS=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",zy=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",hs=async r=>{const e=await MS(r.body);return iv(e,r)},MS=async r=>{const e=new av;return await Promise.all(Object.entries(r||{}).map(([t,n])=>mh(e,t,n))),e},mh=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(RS(t)){const n=await Sv(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>mh(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,a])=>mh(r,`${e}[${n}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var us={},FS=function(r,e,t,n,a){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},DS=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Cu;async function kv(r){const{response:e}=r;if(r.options.stream)return ls("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):Kn.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const o=await e.json();return ls("response",e.status,e.url,e.headers,o),Pv(o,e)}const a=await e.text();return ls("response",e.status,e.url,e.headers,a),a}function Pv(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class kl extends Promise{constructor(e,t=kv){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new kl(this.responsePromise,async t=>Pv(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class US{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:a,fetch:o}){this.baseURL=e,this.maxRetries=zd("maxRetries",t),this.timeout=zd("timeout",n),this.httpAgent=a,this.fetch=o??rv}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ZS(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${KS()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async a=>{const o=a&&Sl(a==null?void 0:a.body)?new DataView(await a.body.arrayBuffer()):(a==null?void 0:a.body)instanceof DataView?a.body:(a==null?void 0:a.body)instanceof ArrayBuffer?new DataView(a.body):a&&ArrayBuffer.isView(a==null?void 0:a.body)?new DataView(a.body.buffer):a==null?void 0:a.body;return{method:e,path:t,...a,body:o}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var S;const{method:n,path:a,query:o,headers:u={}}=e,c=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:zy(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,f=this.calculateContentLength(c),h=this.buildURL(a,o);"timeout"in e&&zd("timeout",e.timeout);const m=e.timeout??this.timeout,y=e.httpAgent??this.httpAgent??ov(h),_=m+1e3;typeof((S=y==null?void 0:y.options)==null?void 0:S.timeout)=="number"&&_>(y.options.timeout??0)&&(y.options.timeout=_),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),u[this.idempotencyHeader]=e.idempotencyKey);const b=this.buildHeaders({options:e,headers:u,contentLength:f,retryCount:t});return{req:{method:n,...c&&{body:c},headers:b,...y&&{agent:y},signal:e.signal??null},url:h,timeout:m}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:a}){const o={};n&&(o["content-length"]=n);const u=this.defaultHeaders(e);return qy(o,u),qy(o,t),zy(e.body)&&Ci!=="node"&&delete o["content-type"],Wy(u,"x-stainless-retry-count")===void 0&&Wy(t,"x-stainless-retry-count")===void 0&&(o["x-stainless-retry-count"]=String(a)),this.validateHeaders(o,t),o}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,a){return vt.generate(e,t,n,a)}request(e,t=null){return new kl(this.makeRequest(e,t))}async makeRequest(e,t){var y,_;const n=await e,a=n.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(n);const{req:o,url:u,timeout:c}=this.buildRequest(n,{retryCount:a-t});if(await this.prepareRequest(o,{url:u,options:n}),ls("request",u,n,o.headers),(y=n.signal)!=null&&y.aborted)throw new pn;const f=new AbortController,h=await this.fetchWithTimeout(u,o,c,f).catch(gh);if(h instanceof Error){if((_=n.signal)!=null&&_.aborted)throw new pn;if(t)return this.retryRequest(n,t);throw h.name==="AbortError"?new El:new bl({cause:h})}const m=BS(h.headers);if(!h.ok){if(t&&this.shouldRetry(h)){const C=`retrying, ${t} attempts remaining`;return ls(`response (error; ${C})`,h.status,u,m),this.retryRequest(n,t,m)}const b=await h.text().catch(C=>gh(C).message),w=WS(b),S=w?void 0:b;throw ls(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,h.status,u,m,S),this.makeStatusError(h.status,w,S,m)}return{response:h,options:n,controller:f}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new zS(this,n,e)}buildURL(e,t){const n=JS(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return xv(a)||(t={...a,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new Oe(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,a){const{signal:o,...u}=t||{};o&&o.addEventListener("abort",()=>a.abort());const c=setTimeout(()=>a.abort(),n),f={signal:a.signal,...u};return f.method&&(f.method=f.method.toUpperCase()),this.fetch.call(void 0,e,f).finally(()=>{clearTimeout(c)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let a;const o=n==null?void 0:n["retry-after-ms"];if(o){const c=parseFloat(o);Number.isNaN(c)||(a=c)}const u=n==null?void 0:n["retry-after"];if(u&&!a){const c=parseFloat(u);Number.isNaN(c)?a=Date.parse(u)-Date.now():a=c*1e3}if(!(a&&0<=a&&a<60*1e3)){const c=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,c)}return await io(a),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const o=t-e,u=Math.min(.5*Math.pow(2,o),8),c=1-Math.random()*.25;return u*c*1e3}getUserAgent(){return`${this.constructor.name}/JS ${es}`}}class Ov{constructor(e,t,n,a){Cu.set(this,void 0),FS(this,Cu,e),this.options=a,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Oe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[a,o]of n)e.url.searchParams.set(a,o);t.query=void 0,t.path=e.url.toString()}return await DS(this,Cu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Cu=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class zS extends kl{constructor(e,t,n){super(t,async a=>new n(e,a.response,await kv(a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const BS=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),VS={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Gt=r=>typeof r=="object"&&r!==null&&!xv(r)&&Object.keys(r).every(e=>Tv(VS,e)),HS=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":Vy(Deno.build.os),"X-Stainless-Arch":By(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":Vy(process.platform),"X-Stainless-Arch":By(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=qS();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function qS(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const a=n[1]||0,o=n[2]||0,u=n[3]||0;return{browser:e,version:`${a}.${o}.${u}`}}}return null}const By=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Vy=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Hy;const ZS=()=>Hy??(Hy=HS()),WS=r=>{try{return JSON.parse(r)}catch{return}},GS=/^[a-z][a-z0-9+.-]*:/i,JS=r=>GS.test(r),io=r=>new Promise(e=>setTimeout(e,r)),zd=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Oe(`${r} must be an integer`);if(e<0)throw new Oe(`${r} must be a positive integer`);return e},gh=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},Au=r=>{var e,t,n,a;if(typeof process<"u")return((e=us==null?void 0:us[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(a=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:a.trim()};function xv(r){if(!r)return!0;for(const e in r)return!1;return!0}function Tv(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function qy(r,e){for(const t in e){if(!Tv(e,t))continue;const n=t.toLowerCase();if(!n)continue;const a=e[t];a===null?delete r[n]:a!==void 0&&(r[n]=a)}}const Zy=new Set(["authorization","api-key"]);function ls(r,...e){if(typeof process<"u"&&(us==null?void 0:us.DEBUG)==="true"){const t=e.map(n=>{if(!n)return n;if(n.headers){const o={...n,headers:{...n.headers}};for(const u in n.headers)Zy.has(u.toLowerCase())&&(o.headers[u]="REDACTED");return o}let a=null;for(const o in n)Zy.has(o.toLowerCase())&&(a??(a={...n}),a[o]="REDACTED");return a??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}const KS=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),QS=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",XS=r=>typeof(r==null?void 0:r.get)=="function",Wy=(r,e)=>{var n;const t=e.toLowerCase();if(XS(r)){const a=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(o,u,c)=>u+c.toUpperCase());for(const o of[e,t,e.toUpperCase(),a]){const u=r.get(o);if(u)return u}}for(const[a,o]of Object.entries(r))if(a.toLowerCase()===t)return Array.isArray(o)?(o.length<=1||console.warn(`Received ${o.length} entries for the ${e} header, using the first entry.`),o[0]):o};function Bd(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}class YS extends Ov{constructor(e,t,n,a){super(e,t,n,a),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Dn extends Ov{constructor(e,t,n,a){super(e,t,n,a),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class je{constructor(e){this._client=e}}let Cv=class extends je{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},qh=class extends je{constructor(){super(...arguments),this.completions=new Cv(this._client)}};qh.Completions=Cv;class Av extends je{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class Iv extends je{create(e,t){return this._client.post("/audio/transcriptions",hs({body:e,...t}))}}class Rv extends je{create(e,t){return this._client.post("/audio/translations",hs({body:e,...t}))}}class oo extends je{constructor(){super(...arguments),this.transcriptions=new Iv(this._client),this.translations=new Rv(this._client),this.speech=new Av(this._client)}}oo.Transcriptions=Iv;oo.Translations=Rv;oo.Speech=Av;class Zh extends je{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Gt(e)?this.list({},e):this._client.getAPIList("/batches",Wh,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Wh extends Dn{}Zh.BatchesPage=Wh;class Gh extends je{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Gt(e)?this.list({},e):this._client.getAPIList("/assistants",Jh,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Jh extends Dn{}Gh.AssistantsPage=Jh;function Gy(r){return typeof r.parse=="function"}const cs=r=>(r==null?void 0:r.role)==="assistant",Nv=r=>(r==null?void 0:r.role)==="function",$v=r=>(r==null?void 0:r.role)==="tool";var Tn=function(r,e,t,n,a){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!a:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?a.call(r,t):a?a.value=t:e.set(r,t),t},Ke=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},yh,Hu,qu,bi,Ei,Zu,Si,cr,ki,Xu,Yu,ts,jv;class Lv{constructor(){yh.add(this),this.controller=new AbortController,Hu.set(this,void 0),qu.set(this,()=>{}),bi.set(this,()=>{}),Ei.set(this,void 0),Zu.set(this,()=>{}),Si.set(this,()=>{}),cr.set(this,{}),ki.set(this,!1),Xu.set(this,!1),Yu.set(this,!1),ts.set(this,!1),Tn(this,Hu,new Promise((e,t)=>{Tn(this,qu,e,"f"),Tn(this,bi,t,"f")}),"f"),Tn(this,Ei,new Promise((e,t)=>{Tn(this,Zu,e,"f"),Tn(this,Si,t,"f")}),"f"),Ke(this,Hu,"f").catch(()=>{}),Ke(this,Ei,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Ke(this,yh,"m",jv).bind(this))},0)}_connected(){this.ended||(Ke(this,qu,"f").call(this),this._emit("connect"))}get ended(){return Ke(this,ki,"f")}get errored(){return Ke(this,Xu,"f")}get aborted(){return Ke(this,Yu,"f")}abort(){this.controller.abort()}on(e,t){return(Ke(this,cr,"f")[e]||(Ke(this,cr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=Ke(this,cr,"f")[e];if(!n)return this;const a=n.findIndex(o=>o.listener===t);return a>=0&&n.splice(a,1),this}once(e,t){return(Ke(this,cr,"f")[e]||(Ke(this,cr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Tn(this,ts,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Tn(this,ts,!0,"f"),await Ke(this,Ei,"f")}_emit(e,...t){if(Ke(this,ki,"f"))return;e==="end"&&(Tn(this,ki,!0,"f"),Ke(this,Zu,"f").call(this));const n=Ke(this,cr,"f")[e];if(n&&(Ke(this,cr,"f")[e]=n.filter(a=>!a.once),n.forEach(({listener:a})=>a(...t))),e==="abort"){const a=t[0];!Ke(this,ts,"f")&&!(n!=null&&n.length)&&Promise.reject(a),Ke(this,bi,"f").call(this,a),Ke(this,Si,"f").call(this,a),this._emit("end");return}if(e==="error"){const a=t[0];!Ke(this,ts,"f")&&!(n!=null&&n.length)&&Promise.reject(a),Ke(this,bi,"f").call(this,a),Ke(this,Si,"f").call(this,a),this._emit("end")}}_emitFinal(){}}Hu=new WeakMap,qu=new WeakMap,bi=new WeakMap,Ei=new WeakMap,Zu=new WeakMap,Si=new WeakMap,cr=new WeakMap,ki=new WeakMap,Xu=new WeakMap,Yu=new WeakMap,ts=new WeakMap,yh=new WeakSet,jv=function(e){if(Tn(this,Xu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new pn),e instanceof pn)return Tn(this,Yu,!0,"f"),this._emit("abort",e);if(e instanceof Oe)return this._emit("error",e);if(e instanceof Error){const t=new Oe(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Oe(String(e)))};function ek(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Mv(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function tk(r,{parser:e,callback:t}){const n={...r};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),n}function uo(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function nk(r,e){return!e||!Fv(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:Kh(r,e)}function Kh(r,e){const t=r.choices.map(n=>{var a;if(n.finish_reason==="length")throw new _v;if(n.finish_reason==="content_filter")throw new wv;return{...n,message:{...n.message,tool_calls:((a=n.message.tool_calls)==null?void 0:a.map(o=>ak(e,o)))??[],parsed:n.message.content&&!n.message.refusal?rk(e,n.message.content):null}}});return{...r,choices:t}}function rk(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function ak(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(a=>{var o;return((o=a.function)==null?void 0:o.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:uo(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function sk(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(a=>{var o;return((o=a.function)==null?void 0:o.name)===e.function.name});return uo(t)||(t==null?void 0:t.function.strict)||!1}function Fv(r){var e;return Mv(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>uo(t)||t.type==="function"&&t.function.strict===!0))??!1}function ik(r){for(const e of r??[]){if(e.type!=="function")throw new Oe(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Oe(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Ht=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Pt,_h,el,wh,vh,bh,Dv,Eh;const Jy=10;class Uv extends Lv{constructor(){super(...arguments),Pt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Nv(e)||$v(e))&&e.content)this._emit("functionCallResult",e.content);else if(cs(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(cs(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Oe("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Ht(this,Pt,"m",_h).call(this)}async finalMessage(){return await this.done(),Ht(this,Pt,"m",el).call(this)}async finalFunctionCall(){return await this.done(),Ht(this,Pt,"m",wh).call(this)}async finalFunctionCallResult(){return await this.done(),Ht(this,Pt,"m",vh).call(this)}async totalUsage(){return await this.done(),Ht(this,Pt,"m",bh).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Ht(this,Pt,"m",el).call(this);t&&this._emit("finalMessage",t);const n=Ht(this,Pt,"m",_h).call(this);n&&this._emit("finalContent",n);const a=Ht(this,Pt,"m",wh).call(this);a&&this._emit("finalFunctionCall",a);const o=Ht(this,Pt,"m",vh).call(this);o!=null&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some(u=>u.usage)&&this._emit("totalUsage",Ht(this,Pt,"m",bh).call(this))}async _createChatCompletion(e,t,n){const a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),Ht(this,Pt,"m",Dv).call(this,t);const o=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Kh(o,t))}async _runChatCompletion(e,t,n){for(const a of t.messages)this._addMessage(a,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var _;const a="function",{function_call:o="auto",stream:u,...c}=t,f=typeof o!="string"&&(o==null?void 0:o.name),{maxChatCompletions:h=Jy}=n||{},m={};for(const b of t.functions)m[b.name||b.function.name]=b;const y=t.functions.map(b=>({name:b.name||b.function.name,parameters:b.parameters,description:b.description}));for(const b of t.messages)this._addMessage(b,!1);for(let b=0;b<h;++b){const S=(_=(await this._createChatCompletion(e,{...c,function_call:o,functions:y,messages:[...this.messages]},n)).choices[0])==null?void 0:_.message;if(!S)throw new Oe("missing message in ChatCompletion response");if(!S.function_call)return;const{name:E,arguments:P}=S.function_call,C=m[E];if(C){if(f&&f!==E){const D=`Invalid function_call: ${JSON.stringify(E)}. ${JSON.stringify(f)} requested. Please try again`;this._addMessage({role:a,name:E,content:D});continue}}else{const D=`Invalid function_call: ${JSON.stringify(E)}. Available options are: ${y.map(V=>JSON.stringify(V.name)).join(", ")}. Please try again`;this._addMessage({role:a,name:E,content:D});continue}let T;try{T=Gy(C)?await C.parse(P):P}catch(D){this._addMessage({role:a,name:E,content:D instanceof Error?D.message:String(D)});continue}const M=await C.function(T,this),j=Ht(this,Pt,"m",Eh).call(this,M);if(this._addMessage({role:a,name:E,content:j}),f)return}}async _runTools(e,t,n){var b,w,S;const a="tool",{tool_choice:o="auto",stream:u,...c}=t,f=typeof o!="string"&&((b=o==null?void 0:o.function)==null?void 0:b.name),{maxChatCompletions:h=Jy}=n||{},m=t.tools.map(E=>{if(uo(E)){if(!E.$callback)throw new Oe("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:E.$callback,name:E.function.name,description:E.function.description||"",parameters:E.function.parameters,parse:E.$parseRaw,strict:!0}}}return E}),y={};for(const E of m)E.type==="function"&&(y[E.function.name||E.function.function.name]=E.function);const _="tools"in t?m.map(E=>E.type==="function"?{type:"function",function:{name:E.function.name||E.function.function.name,parameters:E.function.parameters,description:E.function.description,strict:E.function.strict}}:E):void 0;for(const E of t.messages)this._addMessage(E,!1);for(let E=0;E<h;++E){const C=(w=(await this._createChatCompletion(e,{...c,tool_choice:o,tools:_,messages:[...this.messages]},n)).choices[0])==null?void 0:w.message;if(!C)throw new Oe("missing message in ChatCompletion response");if(!((S=C.tool_calls)!=null&&S.length))return;for(const T of C.tool_calls){if(T.type!=="function")continue;const M=T.id,{name:j,arguments:D}=T.function,V=y[j];if(V){if(f&&f!==j){const ye=`Invalid tool_call: ${JSON.stringify(j)}. ${JSON.stringify(f)} requested. Please try again`;this._addMessage({role:a,tool_call_id:M,content:ye});continue}}else{const ye=`Invalid tool_call: ${JSON.stringify(j)}. Available options are: ${Object.keys(y).map(qe=>JSON.stringify(qe)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:M,content:ye});continue}let q;try{q=Gy(V)?await V.parse(D):D}catch(ye){const qe=ye instanceof Error?ye.message:String(ye);this._addMessage({role:a,tool_call_id:M,content:qe});continue}const me=await V.function(q,this),ve=Ht(this,Pt,"m",Eh).call(this,me);if(this._addMessage({role:a,tool_call_id:M,content:ve}),f)return}}}}Pt=new WeakSet,_h=function(){return Ht(this,Pt,"m",el).call(this).content??null},el=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(cs(t)){const{function_call:n,...a}=t,o={...a,content:t.content??null,refusal:t.refusal??null};return n&&(o.function_call=n),o}}throw new Oe("stream ended without producing a ChatCompletionMessage with role=assistant")},wh=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const a=this.messages[n];if(cs(a)&&(a!=null&&a.function_call))return a.function_call;if(cs(a)&&((e=a==null?void 0:a.tool_calls)!=null&&e.length))return(t=a.tool_calls.at(-1))==null?void 0:t.function}},vh=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Nv(t)&&t.content!=null||$v(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var a;return n.role==="assistant"&&((a=n.tool_calls)==null?void 0:a.some(o=>o.type==="function"&&o.id===t.tool_call_id))}))return t.content}},bh=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Dv=function(e){if(e.n!=null&&e.n>1)throw new Oe("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Eh=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Fi extends Uv{static runFunctions(e,t,n){const a=new Fi,o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,t,o)),a}static runTools(e,t,n){const a=new Fi,o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,o)),a}_addMessage(e,t=!0){super._addMessage(e,t),cs(e)&&e.content&&this._emit("content",e.content)}}const zv=1,Bv=2,Vv=4,Hv=8,qv=16,Zv=32,Wv=64,Gv=128,Jv=256,Kv=Gv|Jv,Qv=qv|Zv|Kv|Wv,Xv=zv|Bv|Qv,Yv=Vv|Hv,ok=Xv|Yv,ht={STR:zv,NUM:Bv,ARR:Vv,OBJ:Hv,NULL:qv,BOOL:Zv,NAN:Wv,INFINITY:Gv,MINUS_INFINITY:Jv,INF:Kv,SPECIAL:Qv,ATOM:Xv,COLLECTION:Yv,ALL:ok};class uk extends Error{}class lk extends Error{}function ck(r,e=ht.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return dk(r.trim(),e)}const dk=(r,e)=>{const t=r.length;let n=0;const a=_=>{throw new uk(`${_} at position ${n}`)},o=_=>{throw new lk(`${_} at position ${n}`)},u=()=>(y(),n>=t&&a("Unexpected end of input"),r[n]==='"'?c():r[n]==="{"?f():r[n]==="["?h():r.substring(n,n+4)==="null"||ht.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||ht.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||ht.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||ht.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||ht.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||ht.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):m()),c=()=>{const _=n;let b=!1;for(n++;n<t&&(r[n]!=='"'||b&&r[n-1]==="\\");)b=r[n]==="\\"?!b:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(_,++n-Number(b)))}catch(w){o(String(w))}else if(ht.STR&e)try{return JSON.parse(r.substring(_,n-Number(b))+'"')}catch{return JSON.parse(r.substring(_,r.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},f=()=>{n++,y();const _={};try{for(;r[n]!=="}";){if(y(),n>=t&&ht.OBJ&e)return _;const b=c();y(),n++;try{const w=u();Object.defineProperty(_,b,{value:w,writable:!0,enumerable:!0,configurable:!0})}catch(w){if(ht.OBJ&e)return _;throw w}y(),r[n]===","&&n++}}catch{if(ht.OBJ&e)return _;a("Expected '}' at end of object")}return n++,_},h=()=>{n++;const _=[];try{for(;r[n]!=="]";)_.push(u()),y(),r[n]===","&&n++}catch{if(ht.ARR&e)return _;a("Expected ']' at end of array")}return n++,_},m=()=>{if(n===0){r==="-"&&ht.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(r)}catch(b){if(ht.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}o(String(b))}}const _=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(ht.NUM&e)&&a("Unterminated number literal");try{return JSON.parse(r.substring(_,n))}catch{r.substring(_,n)==="-"&&ht.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(r.substring(_,r.lastIndexOf("e")))}catch(w){o(String(w))}}},y=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return u()},Ky=r=>ck(r,ht.ALL^ht.NUM);var Qa=function(r,e,t,n,a){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!a:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?a.call(r,t):a?a.value=t:e.set(r,t),t},ze=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},it,ur,Xa,Mr,Vd,Iu,Hd,qd,Zd,Ru,Wd,Qy;class Di extends Uv{constructor(e){super(),it.add(this),ur.set(this,void 0),Xa.set(this,void 0),Mr.set(this,void 0),Qa(this,ur,e,"f"),Qa(this,Xa,[],"f")}get currentChatCompletionSnapshot(){return ze(this,Mr,"f")}static fromReadableStream(e){const t=new Di(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const a=new Di(t);return a._run(()=>a._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,t,n){var u;super._createChatCompletion;const a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),ze(this,it,"m",Vd).call(this);const o=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const c of o)ze(this,it,"m",Hd).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new pn;return this._addChatCompletion(ze(this,it,"m",Ru).call(this))}async _fromReadableStream(e,t){var u;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ze(this,it,"m",Vd).call(this),this._connected();const a=Kn.fromReadableStream(e,this.controller);let o;for await(const c of a)o&&o!==c.id&&this._addChatCompletion(ze(this,it,"m",Ru).call(this)),ze(this,it,"m",Hd).call(this,c),o=c.id;if((u=a.controller.signal)!=null&&u.aborted)throw new pn;return this._addChatCompletion(ze(this,it,"m",Ru).call(this))}[(ur=new WeakMap,Xa=new WeakMap,Mr=new WeakMap,it=new WeakSet,Vd=function(){this.ended||Qa(this,Mr,void 0,"f")},Iu=function(t){let n=ze(this,Xa,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ze(this,Xa,"f")[t.index]=n,n)},Hd=function(t){var a,o,u,c,f,h,m,y,_,b,w,S,E,P,C;if(this.ended)return;const n=ze(this,it,"m",Qy).call(this,t);this._emit("chunk",t,n);for(const T of t.choices){const M=n.choices[T.index];T.delta.content!=null&&((a=M.message)==null?void 0:a.role)==="assistant"&&((o=M.message)!=null&&o.content)&&(this._emit("content",T.delta.content,M.message.content),this._emit("content.delta",{delta:T.delta.content,snapshot:M.message.content,parsed:M.message.parsed})),T.delta.refusal!=null&&((u=M.message)==null?void 0:u.role)==="assistant"&&((c=M.message)!=null&&c.refusal)&&this._emit("refusal.delta",{delta:T.delta.refusal,snapshot:M.message.refusal}),((f=T.logprobs)==null?void 0:f.content)!=null&&((h=M.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(m=T.logprobs)==null?void 0:m.content,snapshot:((y=M.logprobs)==null?void 0:y.content)??[]}),((_=T.logprobs)==null?void 0:_.refusal)!=null&&((b=M.message)==null?void 0:b.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(w=T.logprobs)==null?void 0:w.refusal,snapshot:((S=M.logprobs)==null?void 0:S.refusal)??[]});const j=ze(this,it,"m",Iu).call(this,M);M.finish_reason&&(ze(this,it,"m",Zd).call(this,M),j.current_tool_call_index!=null&&ze(this,it,"m",qd).call(this,M,j.current_tool_call_index));for(const D of T.delta.tool_calls??[])j.current_tool_call_index!==D.index&&(ze(this,it,"m",Zd).call(this,M),j.current_tool_call_index!=null&&ze(this,it,"m",qd).call(this,M,j.current_tool_call_index)),j.current_tool_call_index=D.index;for(const D of T.delta.tool_calls??[]){const V=(E=M.message.tool_calls)==null?void 0:E[D.index];V!=null&&V.type&&((V==null?void 0:V.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(P=V.function)==null?void 0:P.name,index:D.index,arguments:V.function.arguments,parsed_arguments:V.function.parsed_arguments,arguments_delta:((C=D.function)==null?void 0:C.arguments)??""}):(V==null||V.type,void 0))}}},qd=function(t,n){var u,c,f;if(ze(this,it,"m",Iu).call(this,t).done_tool_calls.has(n))return;const o=(u=t.message.tool_calls)==null?void 0:u[n];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if(o.type==="function"){const h=(f=(c=ze(this,ur,"f"))==null?void 0:c.tools)==null?void 0:f.find(m=>m.type==="function"&&m.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:n,arguments:o.function.arguments,parsed_arguments:uo(h)?h.$parseRaw(o.function.arguments):h!=null&&h.function.strict?JSON.parse(o.function.arguments):null})}else o.type},Zd=function(t){var a,o;const n=ze(this,it,"m",Iu).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const u=ze(this,it,"m",Wd).call(this);this._emit("content.done",{content:t.message.content,parsed:u?u.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(a=t.logprobs)!=null&&a.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(o=t.logprobs)!=null&&o.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Ru=function(){if(this.ended)throw new Oe("stream has ended, this shouldn't happen");const t=ze(this,Mr,"f");if(!t)throw new Oe("request ended without sending any chunks");return Qa(this,Mr,void 0,"f"),Qa(this,Xa,[],"f"),fk(t,ze(this,ur,"f"))},Wd=function(){var n;const t=(n=ze(this,ur,"f"))==null?void 0:n.response_format;return Mv(t)?t:null},Qy=function(t){var n,a,o,u;let c=ze(this,Mr,"f");const{choices:f,...h}=t;c?Object.assign(c,h):c=Qa(this,Mr,{...h,choices:[]},"f");for(const{delta:m,finish_reason:y,index:_,logprobs:b=null,...w}of t.choices){let S=c.choices[_];if(S||(S=c.choices[_]={finish_reason:y,index:_,message:{},logprobs:b,...w}),b)if(!S.logprobs)S.logprobs=Object.assign({},b);else{const{content:D,refusal:V,...q}=b;Object.assign(S.logprobs,q),D&&((n=S.logprobs).content??(n.content=[]),S.logprobs.content.push(...D)),V&&((a=S.logprobs).refusal??(a.refusal=[]),S.logprobs.refusal.push(...V))}if(y&&(S.finish_reason=y,ze(this,ur,"f")&&Fv(ze(this,ur,"f")))){if(y==="length")throw new _v;if(y==="content_filter")throw new wv}if(Object.assign(S,w),!m)continue;const{content:E,refusal:P,function_call:C,role:T,tool_calls:M,...j}=m;if(Object.assign(S.message,j),P&&(S.message.refusal=(S.message.refusal||"")+P),T&&(S.message.role=T),C&&(S.message.function_call?(C.name&&(S.message.function_call.name=C.name),C.arguments&&((o=S.message.function_call).arguments??(o.arguments=""),S.message.function_call.arguments+=C.arguments)):S.message.function_call=C),E&&(S.message.content=(S.message.content||"")+E,!S.message.refusal&&ze(this,it,"m",Wd).call(this)&&(S.message.parsed=Ky(S.message.content))),M){S.message.tool_calls||(S.message.tool_calls=[]);for(const{index:D,id:V,type:q,function:me,...ve}of M){const ye=(u=S.message.tool_calls)[D]??(u[D]={});Object.assign(ye,ve),V&&(ye.id=V),q&&(ye.type=q),me&&(ye.function??(ye.function={name:me.name??"",arguments:""})),me!=null&&me.name&&(ye.function.name=me.name),me!=null&&me.arguments&&(ye.function.arguments+=me.arguments,sk(ze(this,ur,"f"),ye)&&(ye.function.parsed_arguments=Ky(ye.function.arguments)))}}}return c},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",a=>{const o=t.shift();o?o.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(const a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,u)=>t.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Kn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function fk(r,e){const{id:t,choices:n,created:a,model:o,system_fingerprint:u,...c}=r,f={...c,id:t,choices:n.map(({message:h,finish_reason:m,index:y,logprobs:_,...b})=>{if(!m)throw new Oe(`missing finish_reason for choice ${y}`);const{content:w=null,function_call:S,tool_calls:E,...P}=h,C=h.role;if(!C)throw new Oe(`missing role for choice ${y}`);if(S){const{arguments:T,name:M}=S;if(T==null)throw new Oe(`missing function_call.arguments for choice ${y}`);if(!M)throw new Oe(`missing function_call.name for choice ${y}`);return{...b,message:{content:w,function_call:{arguments:T,name:M},role:C,refusal:h.refusal??null},finish_reason:m,index:y,logprobs:_}}return E?{...b,index:y,finish_reason:m,logprobs:_,message:{...P,role:C,content:w,refusal:h.refusal??null,tool_calls:E.map((T,M)=>{const{function:j,type:D,id:V,...q}=T,{arguments:me,name:ve,...ye}=j||{};if(V==null)throw new Oe(`missing choices[${y}].tool_calls[${M}].id
${Nu(r)}`);if(D==null)throw new Oe(`missing choices[${y}].tool_calls[${M}].type
${Nu(r)}`);if(ve==null)throw new Oe(`missing choices[${y}].tool_calls[${M}].function.name
${Nu(r)}`);if(me==null)throw new Oe(`missing choices[${y}].tool_calls[${M}].function.arguments
${Nu(r)}`);return{...q,id:V,type:D,function:{...ye,name:ve,arguments:me}}})}}:{...b,message:{...P,content:w,role:C,refusal:h.refusal??null},finish_reason:m,index:y,logprobs:_}}),created:a,model:o,object:"chat.completion",...u?{system_fingerprint:u}:{}};return nk(f,e)}function Nu(r){return JSON.stringify(r)}class ds extends Di{static fromReadableStream(e){const t=new ds(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const a=new ds(null),o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,t,o)),a}static runTools(e,t,n){const a=new ds(t),o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,o)),a}}let eb=class extends je{parse(e,t){return ik(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Kh(n,e))}runFunctions(e,t){return e.stream?ds.runFunctions(this._client,e,t):Fi.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ds.runTools(this._client,e,t):Fi.runTools(this._client,e,t)}stream(e,t){return Di.createChatCompletion(this._client,e,t)}},tb=class extends je{constructor(){super(...arguments),this.completions=new eb(this._client)}};(function(r){r.Completions=eb})(tb);class nb extends je{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Qh extends je{constructor(){super(...arguments),this.sessions=new nb(this._client)}}Qh.Sessions=nb;var de=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},en=function(r,e,t,n,a){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!a:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?a.call(r,t):a?a.value=t:e.set(r,t),t},wt,Sh,Jn,Wu,Cn,fa,rs,da,tl,nn,Gu,Ju,Ai,Pi,Oi,Xy,Yy,e_,t_,n_,r_,a_;class An extends Lv{constructor(){super(...arguments),wt.add(this),Sh.set(this,[]),Jn.set(this,{}),Wu.set(this,{}),Cn.set(this,void 0),fa.set(this,void 0),rs.set(this,void 0),da.set(this,void 0),tl.set(this,void 0),nn.set(this,void 0),Gu.set(this,void 0),Ju.set(this,void 0),Ai.set(this,void 0)}[(Sh=new WeakMap,Jn=new WeakMap,Wu=new WeakMap,Cn=new WeakMap,fa=new WeakMap,rs=new WeakMap,da=new WeakMap,tl=new WeakMap,nn=new WeakMap,Gu=new WeakMap,Ju=new WeakMap,Ai=new WeakMap,wt=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",a=>{const o=t.shift();o?o.resolve(a):e.push(a)}),this.on("end",()=>{n=!0;for(const a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),this.on("error",a=>{n=!0;for(const o of t)o.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,u)=>t.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new An;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var o;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const a=Kn.fromReadableStream(e,this.controller);for await(const u of a)de(this,wt,"m",Pi).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new pn;return this._addRun(de(this,wt,"m",Oi).call(this))}toReadableStream(){return new Kn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,a,o){const u=new An;return u._run(()=>u._runToolAssistantStream(e,t,n,a,{...o,headers:{...o==null?void 0:o.headers,"X-Stainless-Helper-Method":"stream"}})),u}async _createToolAssistantStream(e,t,n,a,o){var h;const u=o==null?void 0:o.signal;u&&(u.aborted&&this.controller.abort(),u.addEventListener("abort",()=>this.controller.abort()));const c={...a,stream:!0},f=await e.submitToolOutputs(t,n,c,{...o,signal:this.controller.signal});this._connected();for await(const m of f)de(this,wt,"m",Pi).call(this,m);if((h=f.controller.signal)!=null&&h.aborted)throw new pn;return this._addRun(de(this,wt,"m",Oi).call(this))}static createThreadAssistantStream(e,t,n){const a=new An;return a._run(()=>a._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(e,t,n,a){const o=new An;return o._run(()=>o._runAssistantStream(e,t,n,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return de(this,Gu,"f")}currentRun(){return de(this,Ju,"f")}currentMessageSnapshot(){return de(this,Cn,"f")}currentRunStepSnapshot(){return de(this,Ai,"f")}async finalRunSteps(){return await this.done(),Object.values(de(this,Jn,"f"))}async finalMessages(){return await this.done(),Object.values(de(this,Wu,"f"))}async finalRun(){if(await this.done(),!de(this,fa,"f"))throw Error("Final run was not received.");return de(this,fa,"f")}async _createThreadAssistantStream(e,t,n){var c;const a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...t,stream:!0},u=await e.createAndRun(o,{...n,signal:this.controller.signal});this._connected();for await(const f of u)de(this,wt,"m",Pi).call(this,f);if((c=u.controller.signal)!=null&&c.aborted)throw new pn;return this._addRun(de(this,wt,"m",Oi).call(this))}async _createAssistantStream(e,t,n,a){var f;const o=a==null?void 0:a.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const u={...n,stream:!0},c=await e.create(t,u,{...a,signal:this.controller.signal});this._connected();for await(const h of c)de(this,wt,"m",Pi).call(this,h);if((f=c.controller.signal)!=null&&f.aborted)throw new pn;return this._addRun(de(this,wt,"m",Oi).call(this))}static accumulateDelta(e,t){for(const[n,a]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=a;continue}let o=e[n];if(o==null){e[n]=a;continue}if(n==="index"||n==="type"){e[n]=a;continue}if(typeof o=="string"&&typeof a=="string")o+=a;else if(typeof o=="number"&&typeof a=="number")o+=a;else if(Bd(o)&&Bd(a))o=this.accumulateDelta(o,a);else if(Array.isArray(o)&&Array.isArray(a)){if(o.every(u=>typeof u=="string"||typeof u=="number")){o.push(...a);continue}for(const u of a){if(!Bd(u))throw new Error(`Expected array delta entry to be an object but got: ${u}`);const c=u.index;if(c==null)throw console.error(u),new Error("Expected array delta entry to have an `index` property");if(typeof c!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${c}`);const f=o[c];f==null?o.push(u):o[c]=this.accumulateDelta(f,u)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${a}, accValue: ${o}`);e[n]=o}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,a){return await this._createAssistantStream(t,e,n,a)}async _runToolAssistantStream(e,t,n,a,o){return await this._createToolAssistantStream(n,e,t,a,o)}}Pi=function(e){if(!this.ended)switch(en(this,Gu,e,"f"),de(this,wt,"m",e_).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":de(this,wt,"m",a_).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":de(this,wt,"m",Yy).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":de(this,wt,"m",Xy).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Oi=function(){if(this.ended)throw new Oe("stream has ended, this shouldn't happen");if(!de(this,fa,"f"))throw Error("Final run has not been received");return de(this,fa,"f")},Xy=function(e){const[t,n]=de(this,wt,"m",n_).call(this,e,de(this,Cn,"f"));en(this,Cn,t,"f"),de(this,Wu,"f")[t.id]=t;for(const a of n){const o=t.content[a.index];(o==null?void 0:o.type)=="text"&&this._emit("textCreated",o.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const a of e.data.delta.content){if(a.type=="text"&&a.text){let o=a.text,u=t.content[a.index];if(u&&u.type=="text")this._emit("textDelta",o,u.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(a.index!=de(this,rs,"f")){if(de(this,da,"f"))switch(de(this,da,"f").type){case"text":this._emit("textDone",de(this,da,"f").text,de(this,Cn,"f"));break;case"image_file":this._emit("imageFileDone",de(this,da,"f").image_file,de(this,Cn,"f"));break}en(this,rs,a.index,"f")}en(this,da,t.content[a.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(de(this,rs,"f")!==void 0){const a=e.data.content[de(this,rs,"f")];if(a)switch(a.type){case"image_file":this._emit("imageFileDone",a.image_file,de(this,Cn,"f"));break;case"text":this._emit("textDone",a.text,de(this,Cn,"f"));break}}de(this,Cn,"f")&&this._emit("messageDone",e.data),en(this,Cn,void 0,"f")}},Yy=function(e){const t=de(this,wt,"m",t_).call(this,e);switch(en(this,Ai,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const o of n.step_details.tool_calls)o.index==de(this,tl,"f")?this._emit("toolCallDelta",o,t.step_details.tool_calls[o.index]):(de(this,nn,"f")&&this._emit("toolCallDone",de(this,nn,"f")),en(this,tl,o.index,"f"),en(this,nn,t.step_details.tool_calls[o.index],"f"),de(this,nn,"f")&&this._emit("toolCallCreated",de(this,nn,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":en(this,Ai,void 0,"f"),e.data.step_details.type=="tool_calls"&&de(this,nn,"f")&&(this._emit("toolCallDone",de(this,nn,"f")),en(this,nn,void 0,"f")),this._emit("runStepDone",e.data,t);break}},e_=function(e){de(this,Sh,"f").push(e),this._emit("event",e)},t_=function(e){switch(e.event){case"thread.run.step.created":return de(this,Jn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=de(this,Jn,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const a=An.accumulateDelta(t,n.delta);de(this,Jn,"f")[e.data.id]=a}return de(this,Jn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":de(this,Jn,"f")[e.data.id]=e.data;break}if(de(this,Jn,"f")[e.data.id])return de(this,Jn,"f")[e.data.id];throw new Error("No snapshot available")},n_=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(const o of a.delta.content)if(o.index in t.content){let u=t.content[o.index];t.content[o.index]=de(this,wt,"m",r_).call(this,o,u)}else t.content[o.index]=o,n.push(o);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},r_=function(e,t){return An.accumulateDelta(t,e)},a_=function(e){switch(en(this,Ju,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":en(this,fa,e.data,"f"),de(this,nn,"f")&&(this._emit("toolCallDone",de(this,nn,"f")),en(this,nn,void 0,"f"));break}};class Xh extends je{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,a){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t={},n){return Gt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Yh,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Yh extends Dn{}Xh.MessagesPage=Yh;class ep extends je{retrieve(e,t,n,a={},o){return Gt(a)?this.retrieve(e,t,n,{},a):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:a,...o,headers:{"OpenAI-Beta":"assistants=v2",...o==null?void 0:o.headers}})}list(e,t,n={},a){return Gt(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,tp,{query:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}}class tp extends Dn{}ep.RunStepsPage=tp;class lo extends je{constructor(){super(...arguments),this.steps=new ep(this._client)}create(e,t,n){const{include:a,...o}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:a},body:o,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,a){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t={},n){return Gt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,np,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const a=await this.create(e,t,n);return await this.poll(e,a.id,n)}createAndStream(e,t,n){return An.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const a={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:u}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...a}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const f=u.headers.get("openai-poll-after-ms");if(f){const h=parseInt(f);isNaN(h)||(c=h)}}await io(c);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,t,n){return An.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,a){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,a){const o=await this.submitToolOutputs(e,t,n,a);return await this.poll(e,o.id,a)}submitToolOutputsStream(e,t,n,a){return An.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,a)}}class np extends Dn{}lo.RunsPage=np;lo.Steps=ep;lo.RunStepsPage=tp;class bs extends je{constructor(){super(...arguments),this.runs=new lo(this._client),this.messages=new Xh(this._client)}create(e={},t){return Gt(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return An.createThreadAssistantStream(e,this._client.beta.threads,t)}}bs.Runs=lo;bs.RunsPage=np;bs.Messages=Xh;bs.MessagesPage=Yh;const hk=async r=>{const e=await Promise.allSettled(r),t=e.filter(a=>a.status==="rejected");if(t.length){for(const a of t)console.error(a.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const a of e)a.status==="fulfilled"&&n.push(a.value);return n};let rp=class extends je{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},n){return Gt(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Pl,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const a=await this.create(e,t,n);return await this.poll(e,a.id,n)}async poll(e,t,n){const a={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const o=await this.retrieve(e,t,{...n,headers:a}).withResponse(),u=o.data;switch(u.status){case"in_progress":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const f=o.response.headers.get("openai-poll-after-ms");if(f){const h=parseInt(f);isNaN(h)||(c=h)}}await io(c);break;case"failed":case"completed":return u}}}async upload(e,t,n){const a=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:a.id},n)}async uploadAndPoll(e,t,n){const a=await this.upload(e,t,n);return await this.poll(e,a.id,n)}};class Pl extends Dn{}rp.VectorStoreFilesPage=Pl;class rb extends je{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const a=await this.create(e,t);return await this.poll(e,a.id,n)}listFiles(e,t,n={},a){return Gt(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Pl,{query:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}async poll(e,t,n){const a={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:u}=await this.retrieve(e,t,{...n,headers:a}).withResponse();switch(o.status){case"in_progress":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const f=u.headers.get("openai-poll-after-ms");if(f){const h=parseInt(f);isNaN(h)||(c=h)}}await io(c);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},a){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=(a==null?void 0:a.maxConcurrency)??5,u=Math.min(o,t.length),c=this._client,f=t.values(),h=[...n];async function m(_){for(let b of _){const w=await c.files.create({file:b,purpose:"assistants"},a);h.push(w.id)}}const y=Array(u).fill(f).map(m);return await hk(y),await this.createAndPoll(e,{file_ids:h})}}class Es extends je{constructor(){super(...arguments),this.files=new rp(this._client),this.fileBatches=new rb(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Gt(e)?this.list({},e):this._client.getAPIList("/vector_stores",ap,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class ap extends Dn{}Es.VectorStoresPage=ap;Es.Files=rp;Es.VectorStoreFilesPage=Pl;Es.FileBatches=rb;class Kr extends je{constructor(){super(...arguments),this.realtime=new Qh(this._client),this.vectorStores=new Es(this._client),this.chat=new tb(this._client),this.assistants=new Gh(this._client),this.threads=new bs(this._client)}}Kr.Realtime=Qh;Kr.VectorStores=Es;Kr.VectorStoresPage=ap;Kr.Assistants=Gh;Kr.AssistantsPage=Jh;Kr.Threads=bs;class ab extends je{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sb extends je{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class sp extends je{create(e,t){return this._client.post("/files",hs({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Gt(e)?this.list({},e):this._client.getAPIList("/files",ip,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const a=new Set(["processed","error","deleted"]),o=Date.now();let u=await this.retrieve(e);for(;!u.status||!a.has(u.status);)if(await io(t),u=await this.retrieve(e),Date.now()-o>n)throw new El({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return u}}class ip extends Dn{}sp.FileObjectsPage=ip;class op extends je{list(e,t={},n){return Gt(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,up,{query:t,...n})}}class up extends Dn{}op.FineTuningJobCheckpointsPage=up;class Ss extends je{constructor(){super(...arguments),this.checkpoints=new op(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Gt(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",lp,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Gt(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,cp,{query:t,...n})}}class lp extends Dn{}class cp extends Dn{}Ss.FineTuningJobsPage=lp;Ss.FineTuningJobEventsPage=cp;Ss.Checkpoints=op;Ss.FineTuningJobCheckpointsPage=up;class co extends je{constructor(){super(...arguments),this.jobs=new Ss(this._client)}}co.Jobs=Ss;co.FineTuningJobsPage=lp;co.FineTuningJobEventsPage=cp;class ib extends je{createVariation(e,t){return this._client.post("/images/variations",hs({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",hs({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class dp extends je{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",fp,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class fp extends YS{}dp.ModelsPage=fp;class ob extends je{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class ub extends je{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,hs({body:t,...n}))}}class hp extends je{constructor(){super(...arguments),this.parts=new ub(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}hp.Parts=ub;var lb;let Te=class extends US{constructor({baseURL:e=Au("OPENAI_BASE_URL"),apiKey:t=Au("OPENAI_API_KEY"),organization:n=Au("OPENAI_ORG_ID")??null,project:a=Au("OPENAI_PROJECT_ID")??null,...o}={}){if(t===void 0)throw new Oe("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const u={apiKey:t,organization:n,project:a,...o,baseURL:e||"https://api.openai.com/v1"};if(!u.dangerouslyAllowBrowser&&QS())throw new Oe(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:u.baseURL,timeout:u.timeout??6e5,httpAgent:u.httpAgent,maxRetries:u.maxRetries,fetch:u.fetch}),this.completions=new ab(this),this.chat=new qh(this),this.embeddings=new sb(this),this.files=new sp(this),this.images=new ib(this),this.audio=new oo(this),this.moderations=new ob(this),this.models=new dp(this),this.fineTuning=new co(this),this.beta=new Kr(this),this.batches=new Zh(this),this.uploads=new hp(this),this._options=u,this.apiKey=t,this.organization=n,this.project=a}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return SS(e,{arrayFormat:"brackets"})}};lb=Te;Te.OpenAI=lb;Te.DEFAULT_TIMEOUT=6e5;Te.OpenAIError=Oe;Te.APIError=vt;Te.APIConnectionError=bl;Te.APIConnectionTimeoutError=El;Te.APIUserAbortError=pn;Te.NotFoundError=hv;Te.ConflictError=pv;Te.RateLimitError=gv;Te.BadRequestError=cv;Te.AuthenticationError=dv;Te.InternalServerError=yv;Te.PermissionDeniedError=fv;Te.UnprocessableEntityError=mv;Te.toFile=Sv;Te.fileFromPath=uv;Te.Completions=ab;Te.Chat=qh;Te.Embeddings=sb;Te.Files=sp;Te.FileObjectsPage=ip;Te.Images=ib;Te.Audio=oo;Te.Moderations=ob;Te.Models=dp;Te.ModelsPage=fp;Te.FineTuning=co;Te.Beta=Kr;Te.Batches=Zh;Te.BatchesPage=Wh;Te.Uploads=hp;function s_(r,e=pp){r=r.trim();const t=/```(json)?(.*)```/s.exec(r);return e(t?t[2]:r)}function pp(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="";const t=[];let n=!1,a=!1;for(let o of r){if(n)o==='"'&&!a?n=!1:o===`
`&&!a?o="\\n":o==="\\"?a=!a:a=!1;else if(o==='"')n=!0,a=!1;else if(o==="{")t.push("}");else if(o==="[")t.push("]");else if(o==="}"||o==="]")if(t[t.length-1]===o)t.pop();else return null;e+=o}n&&(e+='"');for(let o=t.length-1;o>=0;o-=1)e+=t[o];try{return JSON.parse(e)}catch{return null}}var Gd,i_;function pk(){return i_||(i_=1,Gd=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),Gd}var mk=pk();const gk=so(mk);var $u={exports:{}},o_;function yk(){if(o_)return $u.exports;o_=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,o=new RegExp("^"+a.source),u=new RegExp(a.source+n.source,"gu"),c=new RegExp("\\d+"+n.source,"gu"),f=(_,b,w)=>{let S=!1,E=!1,P=!1;for(let C=0;C<_.length;C++){const T=_[C];S&&r.test(T)?(_=_.slice(0,C)+"-"+_.slice(C),S=!1,P=E,E=!0,C++):E&&P&&e.test(T)?(_=_.slice(0,C-1)+"-"+_.slice(C-1),P=E,E=!1,S=!0):(S=b(T)===T&&w(T)!==T,P=E,E=w(T)===T&&b(T)!==T)}return _},h=(_,b)=>(t.lastIndex=0,_.replace(t,w=>b(w))),m=(_,b)=>(u.lastIndex=0,c.lastIndex=0,_.replace(u,(w,S)=>b(S)).replace(c,w=>b(w))),y=(_,b)=>{if(!(typeof _=="string"||Array.isArray(_)))throw new TypeError("Expected the input to be `string | string[]`");if(b={pascalCase:!1,preserveConsecutiveUppercase:!1,...b},Array.isArray(_)?_=_.map(P=>P.trim()).filter(P=>P.length).join("-"):_=_.trim(),_.length===0)return"";const w=b.locale===!1?P=>P.toLowerCase():P=>P.toLocaleLowerCase(b.locale),S=b.locale===!1?P=>P.toUpperCase():P=>P.toLocaleUpperCase(b.locale);return _.length===1?b.pascalCase?S(_):w(_):(_!==w(_)&&(_=f(_,w,S)),_=_.replace(o,""),b.preserveConsecutiveUppercase?_=h(_,w):_=w(_),b.pascalCase&&(_=S(_.charAt(0))+_.slice(1)),m(_,S))};return $u.exports=y,$u.exports.default=y,$u.exports}yk();function _k(r,e){return(e==null?void 0:e[r])||gk(r)}function wk(r,e,t){const n={};for(const a in r)Object.hasOwn(r,a)&&(n[e(a,t)]=r[a]);return n}function u_(r){return Array.isArray(r)?[...r]:{...r}}function vk(r,e){const t=u_(r);for(const[n,a]of Object.entries(e)){const[o,...u]=n.split(".").reverse();let c=t;for(const f of u.reverse()){if(c[f]===void 0)break;c[f]=u_(c[f]),c=c[f]}c[o]!==void 0&&(c[o]={lc:1,type:"secret",id:[a]})}return t}function cb(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}class wa{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,cb(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof wa||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((a,o)=>(a[o]=o in this?this[o]:this.lc_kwargs[o],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(n,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(a=>{let o=this,u=n;const[c,...f]=a.split(".").reverse();for(const h of f.reverse()){if(!(h in o)||o[h]===void 0)return;(!(h in u)||u[h]===void 0)&&(typeof o[h]=="object"&&o[h]!=null?u[h]={}:Array.isArray(o[h])&&(u[h]=[])),o=o[h],u=u[h]}c in o&&o[c]!==void 0&&(u[c]=u[c]||o[c])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:wk(Object.keys(t).length?vk(n,t):n,_k,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function ks(r,e){return typeof r=="string"?typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?Ol(r,e)??[...r,...e]:[...r,{type:"text",text:e}]}function bk(r,e){return r==="error"||e==="error"?"error":"success"}function Ek(r,e){function t(n,a){if(typeof n!="object"||n===null||n===void 0)return n;if(a>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(u=>t(u,a+1));const o={};for(const u of Object.keys(n))o[u]=t(n[u],a+1);return o}return JSON.stringify(t(r,0),null,2)}class pr extends wa{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=Ek(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function Nt(r,e){const t={...r};for(const[n,a]of Object.entries(e))if(t[n]==null)t[n]=a;else{if(a==null)continue;if(typeof t[n]!=typeof a||Array.isArray(t[n])!==Array.isArray(a))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=a}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=Nt(t[n],a);else if(Array.isArray(t[n]))t[n]=Ol(t[n],a);else{if(t[n]===a)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function Ol(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const a=t.findIndex(o=>o.index===n.index);a!==-1?t[a]=Nt(t[a],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function Sk(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return Ol(r,e);if(typeof r=="object"&&typeof e=="object")return Nt(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}class Ps extends pr{}function kk(r){return typeof r.role=="string"}function xl(r){return typeof(r==null?void 0:r._getType)=="function"}function Pk(r){return xl(r)&&typeof r.concat=="function"}class Ok extends pr{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class mp extends Ps{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new mp({content:ks(this.content,e.content),additional_kwargs:Nt(this.additional_kwargs,e.additional_kwargs),response_metadata:Nt(this.response_metadata,e.response_metadata),artifact:Sk(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:bk(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function xk(r){const e=[],t=[];for(const n of r)if(n.function){const a=n.function.name;try{const o=JSON.parse(n.function.arguments),u={name:a||"",args:o||{},id:n.id};e.push(u)}catch{t.push({name:a,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}class Ui extends pr{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var a;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const o=(a=n.additional_kwargs)==null?void 0:a.tool_calls,u=n.tool_calls;o!=null&&o.length>0&&(u===void 0||u.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(o!=null&&u===void 0){const[c,f]=xk(o);n.tool_calls=c??[],n.invalid_tool_calls=f??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function gp(r){return r._getType()==="ai"}function l_(r){return r._getType()==="ai"}class Sa extends Ps{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=[],a=[];for(const o of e.tool_call_chunks){let u={};try{if(u=pp(o.args||"{}"),u===null||typeof u!="object"||Array.isArray(u))throw new Error("Malformed tool call chunk args.");n.push({name:o.name??"",args:u,id:o.id,type:"tool_call"})}catch{a.push({name:o.name,args:o.args,id:o.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:n,invalid_tool_calls:a,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var n,a,o,u,c,f,h,m,y,_,b,w,S,E,P,C,T,M,j,D,V,q,me,ve,ye,qe,Ze,K,G,te,Q,F,z,U,x,$,ne,le,ce,be;const t={content:ks(this.content,e.content),additional_kwargs:Nt(this.additional_kwargs,e.additional_kwargs),response_metadata:Nt(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const Ce=Ol(this.tool_call_chunks,e.tool_call_chunks);Ce!==void 0&&Ce.length>0&&(t.tool_call_chunks=Ce)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const Ce={...(((a=(n=this.usage_metadata)==null?void 0:n.input_token_details)==null?void 0:a.audio)!==void 0||((u=(o=e.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:u.audio)!==void 0)&&{audio:(((f=(c=this.usage_metadata)==null?void 0:c.input_token_details)==null?void 0:f.audio)??0)+(((m=(h=e.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:m.audio)??0)},...(((_=(y=this.usage_metadata)==null?void 0:y.input_token_details)==null?void 0:_.cache_read)!==void 0||((w=(b=e.usage_metadata)==null?void 0:b.input_token_details)==null?void 0:w.cache_read)!==void 0)&&{cache_read:(((E=(S=this.usage_metadata)==null?void 0:S.input_token_details)==null?void 0:E.cache_read)??0)+(((C=(P=e.usage_metadata)==null?void 0:P.input_token_details)==null?void 0:C.cache_read)??0)},...(((M=(T=this.usage_metadata)==null?void 0:T.input_token_details)==null?void 0:M.cache_creation)!==void 0||((D=(j=e.usage_metadata)==null?void 0:j.input_token_details)==null?void 0:D.cache_creation)!==void 0)&&{cache_creation:(((q=(V=this.usage_metadata)==null?void 0:V.input_token_details)==null?void 0:q.cache_creation)??0)+(((ve=(me=e.usage_metadata)==null?void 0:me.input_token_details)==null?void 0:ve.cache_creation)??0)}},Ie={...(((qe=(ye=this.usage_metadata)==null?void 0:ye.output_token_details)==null?void 0:qe.audio)!==void 0||((K=(Ze=e.usage_metadata)==null?void 0:Ze.output_token_details)==null?void 0:K.audio)!==void 0)&&{audio:(((te=(G=this.usage_metadata)==null?void 0:G.output_token_details)==null?void 0:te.audio)??0)+(((F=(Q=e.usage_metadata)==null?void 0:Q.output_token_details)==null?void 0:F.audio)??0)},...(((U=(z=this.usage_metadata)==null?void 0:z.output_token_details)==null?void 0:U.reasoning)!==void 0||(($=(x=e.usage_metadata)==null?void 0:x.output_token_details)==null?void 0:$.reasoning)!==void 0)&&{reasoning:(((le=(ne=this.usage_metadata)==null?void 0:ne.output_token_details)==null?void 0:le.reasoning)??0)+(((be=(ce=e.usage_metadata)==null?void 0:ce.output_token_details)==null?void 0:be.reasoning)??0)}},Ue=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},mt=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Pa={input_tokens:Ue.input_tokens+mt.input_tokens,output_tokens:Ue.output_tokens+mt.output_tokens,total_tokens:Ue.total_tokens+mt.total_tokens,...Object.keys(Ce).length>0&&{input_token_details:Ce},...Object.keys(Ie).length>0&&{output_token_details:Ie}};t.usage_metadata=Pa}return new Sa(t)}}class ka extends pr{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return ka}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Tl extends Ps{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Tl({content:ks(this.content,e.content),additional_kwargs:Nt(this.additional_kwargs,e.additional_kwargs),response_metadata:Nt(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class Cl extends Ps{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Cl({content:ks(this.content,e.content),additional_kwargs:Nt(this.additional_kwargs,e.additional_kwargs),response_metadata:Nt(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class Os extends pr{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Al extends Ps{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Al({content:ks(this.content,e.content),additional_kwargs:Nt(this.additional_kwargs,e.additional_kwargs),response_metadata:Nt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class kh extends pr{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class zi extends Ps{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new zi({content:ks(this.content,e.content),additional_kwargs:Nt(this.additional_kwargs,e.additional_kwargs),response_metadata:Nt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function Il(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function db(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}class Tk extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function Ck(r){return db(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function Ak(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function Jd(r){let e,t;if(Ak(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":e="unknown",t=r.kwargs}else{const{type:n,...a}=r;e=n,t=a}if(e==="human"||e==="user")return new Os(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...a}=t;if(!Array.isArray(n))return new Ui(t);const o=n.map(Ck);return new Ui({...a,tool_calls:o})}else{if(e==="system")return new kh(t);if(e==="developer")return new kh({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new Ok({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw Il(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Vr(r){if(typeof r=="string")return new Os(r);if(xl(r))return r;if(Array.isArray(r)){const[e,t]=r;return Jd({type:e,content:t})}else if(kk(r)){const{role:e,...t}=r;return Jd({...t,type:e})}else return Jd(r)}function fb(r,e="Human",t="AI"){const n=[];for(const a of r){let o;if(a._getType()==="human")o=e;else if(a._getType()==="ai")o=t;else if(a._getType()==="system")o="System";else if(a._getType()==="function")o="Function";else if(a._getType()==="tool")o="Tool";else if(a._getType()==="generic")o=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);const u=a.name?`${a.name}, `:"",c=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);n.push(`${o}: ${u}${c}`)}return n.join(`
`)}function Ik(r){var t;const e=r._getType();if(e==="human")return new Al({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),new Sa({...n})}else{if(e==="system")return new zi({...r});if(e==="function")return new Cl({...r});if(ka.isInstance(r))return new Tl({...r});throw new Error("Unknown message type.")}}var xe;(function(r){r.assertEqual=a=>a;function e(a){}r.assertIs=e;function t(a){throw new Error}r.assertNever=t,r.arrayToEnum=a=>{const o={};for(const u of a)o[u]=u;return o},r.getValidEnumValues=a=>{const o=r.objectKeys(a).filter(c=>typeof a[a[c]]!="number"),u={};for(const c of o)u[c]=a[c];return r.objectValues(u)},r.objectValues=a=>r.objectKeys(a).map(function(o){return a[o]}),r.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const o=[];for(const u in a)Object.prototype.hasOwnProperty.call(a,u)&&o.push(u);return o},r.find=(a,o)=>{for(const u of a)if(o(u))return u},r.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function n(a,o=" | "){return a.map(u=>typeof u=="string"?`'${u}'`:u).join(o)}r.joinValues=n,r.jsonStringifyReplacer=(a,o)=>typeof o=="bigint"?o.toString():o})(xe||(xe={}));var Ph;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Ph||(Ph={}));const ee=xe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),fr=r=>{switch(typeof r){case"undefined":return ee.undefined;case"string":return ee.string;case"number":return isNaN(r)?ee.nan:ee.number;case"boolean":return ee.boolean;case"function":return ee.function;case"bigint":return ee.bigint;case"symbol":return ee.symbol;case"object":return Array.isArray(r)?ee.array:r===null?ee.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?ee.promise:typeof Map<"u"&&r instanceof Map?ee.map:typeof Set<"u"&&r instanceof Set?ee.set:typeof Date<"u"&&r instanceof Date?ee.date:ee.object;default:return ee.unknown}},W=xe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Rk=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class an extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(o){return o.message},n={_errors:[]},a=o=>{for(const u of o.issues)if(u.code==="invalid_union")u.unionErrors.map(a);else if(u.code==="invalid_return_type")a(u.returnTypeError);else if(u.code==="invalid_arguments")a(u.argumentsError);else if(u.path.length===0)n._errors.push(t(u));else{let c=n,f=0;for(;f<u.path.length;){const h=u.path[f];f===u.path.length-1?(c[h]=c[h]||{_errors:[]},c[h]._errors.push(t(u))):c[h]=c[h]||{_errors:[]},c=c[h],f++}}};return a(this),n}static assert(e){if(!(e instanceof an))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,xe.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):n.push(e(a));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}an.create=r=>new an(r);const ps=(r,e)=>{let t;switch(r.code){case W.invalid_type:r.received===ee.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case W.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,xe.jsonStringifyReplacer)}`;break;case W.unrecognized_keys:t=`Unrecognized key(s) in object: ${xe.joinValues(r.keys,", ")}`;break;case W.invalid_union:t="Invalid input";break;case W.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${xe.joinValues(r.options)}`;break;case W.invalid_enum_value:t=`Invalid enum value. Expected ${xe.joinValues(r.options)}, received '${r.received}'`;break;case W.invalid_arguments:t="Invalid function arguments";break;case W.invalid_return_type:t="Invalid function return type";break;case W.invalid_date:t="Invalid date";break;case W.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:xe.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case W.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case W.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case W.custom:t="Invalid input";break;case W.invalid_intersection_types:t="Intersection results could not be merged";break;case W.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case W.not_finite:t="Number must be finite";break;default:t=e.defaultError,xe.assertNever(r)}return{message:t}};let hb=ps;function Nk(r){hb=r}function nl(){return hb}const rl=r=>{const{data:e,path:t,errorMaps:n,issueData:a}=r,o=[...t,...a.path||[]],u={...a,path:o};if(a.message!==void 0)return{...a,path:o,message:a.message};let c="";const f=n.filter(h=>!!h).slice().reverse();for(const h of f)c=h(u,{data:e,defaultError:c}).message;return{...a,path:o,message:c}},$k=[];function X(r,e){const t=nl(),n=rl({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===ps?void 0:ps].filter(a=>!!a)});r.common.issues.push(n)}class Tt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const a of t){if(a.status==="aborted")return pe;a.status==="dirty"&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const a of t){const o=await a.key,u=await a.value;n.push({key:o,value:u})}return Tt.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const a of t){const{key:o,value:u}=a;if(o.status==="aborted"||u.status==="aborted")return pe;o.status==="dirty"&&e.dirty(),u.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof u.value<"u"||a.alwaysSet)&&(n[o.value]=u.value)}return{status:e.value,value:n}}}const pe=Object.freeze({status:"aborted"}),as=r=>({status:"dirty",value:r}),$t=r=>({status:"valid",value:r}),Oh=r=>r.status==="aborted",xh=r=>r.status==="dirty",va=r=>r.status==="valid",Bi=r=>typeof Promise<"u"&&r instanceof Promise;function al(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function pb(r,e,t,n,a){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var oe;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(oe||(oe={}));var xi,Ti;class Xn{constructor(e,t,n,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const c_=(r,e)=>{if(va(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new an(r.common.issues);return this._error=t,this._error}}};function we(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:a}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(u,c)=>{var f,h;const{message:m}=r;return u.code==="invalid_enum_value"?{message:m??c.defaultError}:typeof c.data>"u"?{message:(f=m??n)!==null&&f!==void 0?f:c.defaultError}:u.code!=="invalid_type"?{message:c.defaultError}:{message:(h=m??t)!==null&&h!==void 0?h:c.defaultError}},description:a}}class ke{get description(){return this._def.description}_getType(e){return fr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:fr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Tt,ctx:{common:e.parent.common,data:e.data,parsedType:fr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Bi(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const a={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fr(e)},o=this._parseSync({data:e,path:a.path,parent:a});return c_(a,o)}"~validate"(e){var t,n;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fr(e)};if(!this["~standard"].async)try{const o=this._parseSync({data:e,path:[],parent:a});return va(o)?{value:o.value}:{issues:a.common.issues}}catch(o){!((n=(t=o==null?void 0:o.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then(o=>va(o)?{value:o.value}:{issues:a.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fr(e)},a=this._parse({data:e,path:n.path,parent:n}),o=await(Bi(a)?a:Promise.resolve(a));return c_(n,o)}refine(e,t){const n=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,o)=>{const u=e(a),c=()=>o.addIssue({code:W.custom,...n(a)});return typeof Promise<"u"&&u instanceof Promise?u.then(f=>f?!0:(c(),!1)):u?!0:(c(),!1)})}refinement(e,t){return this._refinement((n,a)=>e(n)?!0:(a.addIssue(typeof t=="function"?t(n,a):t),!1))}_refinement(e){return new Mn({schema:this,typeName:L.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return $n.create(this,this._def)}nullable(){return Wr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Nn.create(this)}promise(){return gs.create(this,this._def)}or(e){return Zi.create([this,e],this._def)}and(e){return Wi.create(this,e,this._def)}transform(e){return new Mn({...we(this._def),schema:this,typeName:L.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Xi({...we(this._def),innerType:this,defaultValue:t,typeName:L.ZodDefault})}brand(){return new yp({typeName:L.ZodBranded,type:this,...we(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Yi({...we(this._def),innerType:this,catchValue:t,typeName:L.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return fo.create(this,e)}readonly(){return eo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const jk=/^c[^\s-]{8,}$/i,Lk=/^[0-9a-z]+$/,Mk=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Fk=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Dk=/^[a-z0-9_-]{21}$/i,Uk=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,zk=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Bk=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Vk="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Kd;const Hk=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,qk=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Zk=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Wk=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Gk=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Jk=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,mb="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Kk=new RegExp(`^${mb}$`);function gb(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Qk(r){return new RegExp(`^${gb(r)}$`)}function yb(r){let e=`${mb}T${gb(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Xk(r,e){return!!((e==="v4"||!e)&&Hk.test(r)||(e==="v6"||!e)&&Zk.test(r))}function Yk(r,e){if(!Uk.test(r))return!1;try{const[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||!a.typ||!a.alg||e&&a.alg!==e)}catch{return!1}}function e1(r,e){return!!((e==="v4"||!e)&&qk.test(r)||(e==="v6"||!e)&&Wk.test(r))}class In extends ke{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ee.string){const o=this._getOrReturnCtx(e);return X(o,{code:W.invalid_type,expected:ee.string,received:o.parsedType}),pe}const n=new Tt;let a;for(const o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(a=this._getOrReturnCtx(e,a),X(a,{code:W.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="max")e.data.length>o.value&&(a=this._getOrReturnCtx(e,a),X(a,{code:W.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="length"){const u=e.data.length>o.value,c=e.data.length<o.value;(u||c)&&(a=this._getOrReturnCtx(e,a),u?X(a,{code:W.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):c&&X(a,{code:W.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),n.dirty())}else if(o.kind==="email")Bk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"email",code:W.invalid_string,message:o.message}),n.dirty());else if(o.kind==="emoji")Kd||(Kd=new RegExp(Vk,"u")),Kd.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"emoji",code:W.invalid_string,message:o.message}),n.dirty());else if(o.kind==="uuid")Fk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"uuid",code:W.invalid_string,message:o.message}),n.dirty());else if(o.kind==="nanoid")Dk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"nanoid",code:W.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid")jk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"cuid",code:W.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid2")Lk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"cuid2",code:W.invalid_string,message:o.message}),n.dirty());else if(o.kind==="ulid")Mk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"ulid",code:W.invalid_string,message:o.message}),n.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),X(a,{validation:"url",code:W.invalid_string,message:o.message}),n.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"regex",code:W.invalid_string,message:o.message}),n.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(a=this._getOrReturnCtx(e,a),X(a,{code:W.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),n.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(a=this._getOrReturnCtx(e,a),X(a,{code:W.invalid_string,validation:{startsWith:o.value},message:o.message}),n.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(a=this._getOrReturnCtx(e,a),X(a,{code:W.invalid_string,validation:{endsWith:o.value},message:o.message}),n.dirty()):o.kind==="datetime"?yb(o).test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{code:W.invalid_string,validation:"datetime",message:o.message}),n.dirty()):o.kind==="date"?Kk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{code:W.invalid_string,validation:"date",message:o.message}),n.dirty()):o.kind==="time"?Qk(o).test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{code:W.invalid_string,validation:"time",message:o.message}),n.dirty()):o.kind==="duration"?zk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"duration",code:W.invalid_string,message:o.message}),n.dirty()):o.kind==="ip"?Xk(e.data,o.version)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"ip",code:W.invalid_string,message:o.message}),n.dirty()):o.kind==="jwt"?Yk(e.data,o.alg)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"jwt",code:W.invalid_string,message:o.message}),n.dirty()):o.kind==="cidr"?e1(e.data,o.version)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"cidr",code:W.invalid_string,message:o.message}),n.dirty()):o.kind==="base64"?Gk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"base64",code:W.invalid_string,message:o.message}),n.dirty()):o.kind==="base64url"?Jk.test(e.data)||(a=this._getOrReturnCtx(e,a),X(a,{validation:"base64url",code:W.invalid_string,message:o.message}),n.dirty()):xe.assertNever(o);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(a=>e.test(a),{validation:t,code:W.invalid_string,...oe.errToObj(n)})}_addCheck(e){return new In({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...oe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...oe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...oe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...oe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...oe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...oe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...oe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...oe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...oe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...oe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...oe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...oe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...oe.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...oe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...oe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...oe.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...oe.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...oe.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...oe.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...oe.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...oe.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...oe.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...oe.errToObj(t)})}nonempty(e){return this.min(1,oe.errToObj(e))}trim(){return new In({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new In({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new In({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}In.create=r=>{var e;return new In({checks:[],typeName:L.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...we(r)})};function t1(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=t>n?t:n,o=parseInt(r.toFixed(a).replace(".","")),u=parseInt(e.toFixed(a).replace(".",""));return o%u/Math.pow(10,a)}class Hr extends ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ee.number){const o=this._getOrReturnCtx(e);return X(o,{code:W.invalid_type,expected:ee.number,received:o.parsedType}),pe}let n;const a=new Tt;for(const o of this._def.checks)o.kind==="int"?xe.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),X(n,{code:W.invalid_type,expected:"integer",received:"float",message:o.message}),a.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),X(n,{code:W.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),a.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),X(n,{code:W.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),a.dirty()):o.kind==="multipleOf"?t1(e.data,o.value)!==0&&(n=this._getOrReturnCtx(e,n),X(n,{code:W.not_multiple_of,multipleOf:o.value,message:o.message}),a.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),X(n,{code:W.not_finite,message:o.message}),a.dirty()):xe.assertNever(o);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,oe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,oe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,oe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,oe.toString(t))}setLimit(e,t,n,a){return new Hr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:oe.toString(a)}]})}_addCheck(e){return new Hr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:oe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:oe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:oe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:oe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:oe.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&xe.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Hr.create=r=>new Hr({checks:[],typeName:L.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...we(r)});class qr extends ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ee.bigint)return this._getInvalidInput(e);let n;const a=new Tt;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),X(n,{code:W.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),a.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),X(n,{code:W.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),a.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),X(n,{code:W.not_multiple_of,multipleOf:o.value,message:o.message}),a.dirty()):xe.assertNever(o);return{status:a.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return X(t,{code:W.invalid_type,expected:ee.bigint,received:t.parsedType}),pe}gte(e,t){return this.setLimit("min",e,!0,oe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,oe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,oe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,oe.toString(t))}setLimit(e,t,n,a){return new qr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:oe.toString(a)}]})}_addCheck(e){return new qr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}qr.create=r=>{var e;return new qr({checks:[],typeName:L.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...we(r)})};class Vi extends ke{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ee.boolean){const n=this._getOrReturnCtx(e);return X(n,{code:W.invalid_type,expected:ee.boolean,received:n.parsedType}),pe}return $t(e.data)}}Vi.create=r=>new Vi({typeName:L.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...we(r)});class ba extends ke{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ee.date){const o=this._getOrReturnCtx(e);return X(o,{code:W.invalid_type,expected:ee.date,received:o.parsedType}),pe}if(isNaN(e.data.getTime())){const o=this._getOrReturnCtx(e);return X(o,{code:W.invalid_date}),pe}const n=new Tt;let a;for(const o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(a=this._getOrReturnCtx(e,a),X(a,{code:W.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),n.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(a=this._getOrReturnCtx(e,a),X(a,{code:W.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),n.dirty()):xe.assertNever(o);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ba({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:oe.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:oe.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}ba.create=r=>new ba({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:L.ZodDate,...we(r)});class sl extends ke{_parse(e){if(this._getType(e)!==ee.symbol){const n=this._getOrReturnCtx(e);return X(n,{code:W.invalid_type,expected:ee.symbol,received:n.parsedType}),pe}return $t(e.data)}}sl.create=r=>new sl({typeName:L.ZodSymbol,...we(r)});class Hi extends ke{_parse(e){if(this._getType(e)!==ee.undefined){const n=this._getOrReturnCtx(e);return X(n,{code:W.invalid_type,expected:ee.undefined,received:n.parsedType}),pe}return $t(e.data)}}Hi.create=r=>new Hi({typeName:L.ZodUndefined,...we(r)});class qi extends ke{_parse(e){if(this._getType(e)!==ee.null){const n=this._getOrReturnCtx(e);return X(n,{code:W.invalid_type,expected:ee.null,received:n.parsedType}),pe}return $t(e.data)}}qi.create=r=>new qi({typeName:L.ZodNull,...we(r)});class ms extends ke{constructor(){super(...arguments),this._any=!0}_parse(e){return $t(e.data)}}ms.create=r=>new ms({typeName:L.ZodAny,...we(r)});class pa extends ke{constructor(){super(...arguments),this._unknown=!0}_parse(e){return $t(e.data)}}pa.create=r=>new pa({typeName:L.ZodUnknown,...we(r)});class gr extends ke{_parse(e){const t=this._getOrReturnCtx(e);return X(t,{code:W.invalid_type,expected:ee.never,received:t.parsedType}),pe}}gr.create=r=>new gr({typeName:L.ZodNever,...we(r)});class il extends ke{_parse(e){if(this._getType(e)!==ee.undefined){const n=this._getOrReturnCtx(e);return X(n,{code:W.invalid_type,expected:ee.void,received:n.parsedType}),pe}return $t(e.data)}}il.create=r=>new il({typeName:L.ZodVoid,...we(r)});class Nn extends ke{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),a=this._def;if(t.parsedType!==ee.array)return X(t,{code:W.invalid_type,expected:ee.array,received:t.parsedType}),pe;if(a.exactLength!==null){const u=t.data.length>a.exactLength.value,c=t.data.length<a.exactLength.value;(u||c)&&(X(t,{code:u?W.too_big:W.too_small,minimum:c?a.exactLength.value:void 0,maximum:u?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(X(t,{code:W.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(X(t,{code:W.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((u,c)=>a.type._parseAsync(new Xn(t,u,t.path,c)))).then(u=>Tt.mergeArray(n,u));const o=[...t.data].map((u,c)=>a.type._parseSync(new Xn(t,u,t.path,c)));return Tt.mergeArray(n,o)}get element(){return this._def.type}min(e,t){return new Nn({...this._def,minLength:{value:e,message:oe.toString(t)}})}max(e,t){return new Nn({...this._def,maxLength:{value:e,message:oe.toString(t)}})}length(e,t){return new Nn({...this._def,exactLength:{value:e,message:oe.toString(t)}})}nonempty(e){return this.min(1,e)}}Nn.create=(r,e)=>new Nn({type:r,minLength:null,maxLength:null,exactLength:null,typeName:L.ZodArray,...we(e)});function ns(r){if(r instanceof Qe){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=$n.create(ns(n))}return new Qe({...r._def,shape:()=>e})}else return r instanceof Nn?new Nn({...r._def,type:ns(r.element)}):r instanceof $n?$n.create(ns(r.unwrap())):r instanceof Wr?Wr.create(ns(r.unwrap())):r instanceof Yn?Yn.create(r.items.map(e=>ns(e))):r}class Qe extends ke{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=xe.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ee.object){const h=this._getOrReturnCtx(e);return X(h,{code:W.invalid_type,expected:ee.object,received:h.parsedType}),pe}const{status:n,ctx:a}=this._processInputParams(e),{shape:o,keys:u}=this._getCached(),c=[];if(!(this._def.catchall instanceof gr&&this._def.unknownKeys==="strip"))for(const h in a.data)u.includes(h)||c.push(h);const f=[];for(const h of u){const m=o[h],y=a.data[h];f.push({key:{status:"valid",value:h},value:m._parse(new Xn(a,y,a.path,h)),alwaysSet:h in a.data})}if(this._def.catchall instanceof gr){const h=this._def.unknownKeys;if(h==="passthrough")for(const m of c)f.push({key:{status:"valid",value:m},value:{status:"valid",value:a.data[m]}});else if(h==="strict")c.length>0&&(X(a,{code:W.unrecognized_keys,keys:c}),n.dirty());else if(h!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const h=this._def.catchall;for(const m of c){const y=a.data[m];f.push({key:{status:"valid",value:m},value:h._parse(new Xn(a,y,a.path,m)),alwaysSet:m in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const h=[];for(const m of f){const y=await m.key,_=await m.value;h.push({key:y,value:_,alwaysSet:m.alwaysSet})}return h}).then(h=>Tt.mergeObjectSync(n,h)):Tt.mergeObjectSync(n,f)}get shape(){return this._def.shape()}strict(e){return oe.errToObj,new Qe({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var a,o,u,c;const f=(u=(o=(a=this._def).errorMap)===null||o===void 0?void 0:o.call(a,t,n).message)!==null&&u!==void 0?u:n.defaultError;return t.code==="unrecognized_keys"?{message:(c=oe.errToObj(e).message)!==null&&c!==void 0?c:f}:{message:f}}}:{}})}strip(){return new Qe({...this._def,unknownKeys:"strip"})}passthrough(){return new Qe({...this._def,unknownKeys:"passthrough"})}extend(e){return new Qe({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Qe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:L.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Qe({...this._def,catchall:e})}pick(e){const t={};return xe.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new Qe({...this._def,shape:()=>t})}omit(e){const t={};return xe.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new Qe({...this._def,shape:()=>t})}deepPartial(){return ns(this)}partial(e){const t={};return xe.objectKeys(this.shape).forEach(n=>{const a=this.shape[n];e&&!e[n]?t[n]=a:t[n]=a.optional()}),new Qe({...this._def,shape:()=>t})}required(e){const t={};return xe.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let o=this.shape[n];for(;o instanceof $n;)o=o._def.innerType;t[n]=o}}),new Qe({...this._def,shape:()=>t})}keyof(){return _b(xe.objectKeys(this.shape))}}Qe.create=(r,e)=>new Qe({shape:()=>r,unknownKeys:"strip",catchall:gr.create(),typeName:L.ZodObject,...we(e)});Qe.strictCreate=(r,e)=>new Qe({shape:()=>r,unknownKeys:"strict",catchall:gr.create(),typeName:L.ZodObject,...we(e)});Qe.lazycreate=(r,e)=>new Qe({shape:r,unknownKeys:"strip",catchall:gr.create(),typeName:L.ZodObject,...we(e)});class Zi extends ke{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function a(o){for(const c of o)if(c.result.status==="valid")return c.result;for(const c of o)if(c.result.status==="dirty")return t.common.issues.push(...c.ctx.common.issues),c.result;const u=o.map(c=>new an(c.ctx.common.issues));return X(t,{code:W.invalid_union,unionErrors:u}),pe}if(t.common.async)return Promise.all(n.map(async o=>{const u={...t,common:{...t.common,issues:[]},parent:null};return{result:await o._parseAsync({data:t.data,path:t.path,parent:u}),ctx:u}})).then(a);{let o;const u=[];for(const f of n){const h={...t,common:{...t.common,issues:[]},parent:null},m=f._parseSync({data:t.data,path:t.path,parent:h});if(m.status==="valid")return m;m.status==="dirty"&&!o&&(o={result:m,ctx:h}),h.common.issues.length&&u.push(h.common.issues)}if(o)return t.common.issues.push(...o.ctx.common.issues),o.result;const c=u.map(f=>new an(f));return X(t,{code:W.invalid_union,unionErrors:c}),pe}}get options(){return this._def.options}}Zi.create=(r,e)=>new Zi({options:r,typeName:L.ZodUnion,...we(e)});const dr=r=>r instanceof Ji?dr(r.schema):r instanceof Mn?dr(r.innerType()):r instanceof Ki?[r.value]:r instanceof Zr?r.options:r instanceof Qi?xe.objectValues(r.enum):r instanceof Xi?dr(r._def.innerType):r instanceof Hi?[void 0]:r instanceof qi?[null]:r instanceof $n?[void 0,...dr(r.unwrap())]:r instanceof Wr?[null,...dr(r.unwrap())]:r instanceof yp||r instanceof eo?dr(r.unwrap()):r instanceof Yi?dr(r._def.innerType):[];class Rl extends ke{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ee.object)return X(t,{code:W.invalid_type,expected:ee.object,received:t.parsedType}),pe;const n=this.discriminator,a=t.data[n],o=this.optionsMap.get(a);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):(X(t,{code:W.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),pe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const a=new Map;for(const o of t){const u=dr(o.shape[e]);if(!u.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const c of u){if(a.has(c))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(c)}`);a.set(c,o)}}return new Rl({typeName:L.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...we(n)})}}function Th(r,e){const t=fr(r),n=fr(e);if(r===e)return{valid:!0,data:r};if(t===ee.object&&n===ee.object){const a=xe.objectKeys(e),o=xe.objectKeys(r).filter(c=>a.indexOf(c)!==-1),u={...r,...e};for(const c of o){const f=Th(r[c],e[c]);if(!f.valid)return{valid:!1};u[c]=f.data}return{valid:!0,data:u}}else if(t===ee.array&&n===ee.array){if(r.length!==e.length)return{valid:!1};const a=[];for(let o=0;o<r.length;o++){const u=r[o],c=e[o],f=Th(u,c);if(!f.valid)return{valid:!1};a.push(f.data)}return{valid:!0,data:a}}else return t===ee.date&&n===ee.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Wi extends ke{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=(o,u)=>{if(Oh(o)||Oh(u))return pe;const c=Th(o.value,u.value);return c.valid?((xh(o)||xh(u))&&t.dirty(),{status:t.value,value:c.data}):(X(n,{code:W.invalid_intersection_types}),pe)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,u])=>a(o,u)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Wi.create=(r,e,t)=>new Wi({left:r,right:e,typeName:L.ZodIntersection,...we(t)});class Yn extends ke{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.array)return X(n,{code:W.invalid_type,expected:ee.array,received:n.parsedType}),pe;if(n.data.length<this._def.items.length)return X(n,{code:W.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),pe;!this._def.rest&&n.data.length>this._def.items.length&&(X(n,{code:W.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const o=[...n.data].map((u,c)=>{const f=this._def.items[c]||this._def.rest;return f?f._parse(new Xn(n,u,n.path,c)):null}).filter(u=>!!u);return n.common.async?Promise.all(o).then(u=>Tt.mergeArray(t,u)):Tt.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new Yn({...this._def,rest:e})}}Yn.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Yn({items:r,typeName:L.ZodTuple,rest:null,...we(e)})};class Gi extends ke{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.object)return X(n,{code:W.invalid_type,expected:ee.object,received:n.parsedType}),pe;const a=[],o=this._def.keyType,u=this._def.valueType;for(const c in n.data)a.push({key:o._parse(new Xn(n,c,n.path,c)),value:u._parse(new Xn(n,n.data[c],n.path,c)),alwaysSet:c in n.data});return n.common.async?Tt.mergeObjectAsync(t,a):Tt.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof ke?new Gi({keyType:e,valueType:t,typeName:L.ZodRecord,...we(n)}):new Gi({keyType:In.create(),valueType:e,typeName:L.ZodRecord,...we(t)})}}class ol extends ke{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.map)return X(n,{code:W.invalid_type,expected:ee.map,received:n.parsedType}),pe;const a=this._def.keyType,o=this._def.valueType,u=[...n.data.entries()].map(([c,f],h)=>({key:a._parse(new Xn(n,c,n.path,[h,"key"])),value:o._parse(new Xn(n,f,n.path,[h,"value"]))}));if(n.common.async){const c=new Map;return Promise.resolve().then(async()=>{for(const f of u){const h=await f.key,m=await f.value;if(h.status==="aborted"||m.status==="aborted")return pe;(h.status==="dirty"||m.status==="dirty")&&t.dirty(),c.set(h.value,m.value)}return{status:t.value,value:c}})}else{const c=new Map;for(const f of u){const h=f.key,m=f.value;if(h.status==="aborted"||m.status==="aborted")return pe;(h.status==="dirty"||m.status==="dirty")&&t.dirty(),c.set(h.value,m.value)}return{status:t.value,value:c}}}}ol.create=(r,e,t)=>new ol({valueType:e,keyType:r,typeName:L.ZodMap,...we(t)});class Ea extends ke{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.set)return X(n,{code:W.invalid_type,expected:ee.set,received:n.parsedType}),pe;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(X(n,{code:W.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(X(n,{code:W.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const o=this._def.valueType;function u(f){const h=new Set;for(const m of f){if(m.status==="aborted")return pe;m.status==="dirty"&&t.dirty(),h.add(m.value)}return{status:t.value,value:h}}const c=[...n.data.values()].map((f,h)=>o._parse(new Xn(n,f,n.path,h)));return n.common.async?Promise.all(c).then(f=>u(f)):u(c)}min(e,t){return new Ea({...this._def,minSize:{value:e,message:oe.toString(t)}})}max(e,t){return new Ea({...this._def,maxSize:{value:e,message:oe.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ea.create=(r,e)=>new Ea({valueType:r,minSize:null,maxSize:null,typeName:L.ZodSet,...we(e)});class fs extends ke{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ee.function)return X(t,{code:W.invalid_type,expected:ee.function,received:t.parsedType}),pe;function n(c,f){return rl({data:c,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,nl(),ps].filter(h=>!!h),issueData:{code:W.invalid_arguments,argumentsError:f}})}function a(c,f){return rl({data:c,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,nl(),ps].filter(h=>!!h),issueData:{code:W.invalid_return_type,returnTypeError:f}})}const o={errorMap:t.common.contextualErrorMap},u=t.data;if(this._def.returns instanceof gs){const c=this;return $t(async function(...f){const h=new an([]),m=await c._def.args.parseAsync(f,o).catch(b=>{throw h.addIssue(n(f,b)),h}),y=await Reflect.apply(u,this,m);return await c._def.returns._def.type.parseAsync(y,o).catch(b=>{throw h.addIssue(a(y,b)),h})})}else{const c=this;return $t(function(...f){const h=c._def.args.safeParse(f,o);if(!h.success)throw new an([n(f,h.error)]);const m=Reflect.apply(u,this,h.data),y=c._def.returns.safeParse(m,o);if(!y.success)throw new an([a(m,y.error)]);return y.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new fs({...this._def,args:Yn.create(e).rest(pa.create())})}returns(e){return new fs({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new fs({args:e||Yn.create([]).rest(pa.create()),returns:t||pa.create(),typeName:L.ZodFunction,...we(n)})}}class Ji extends ke{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ji.create=(r,e)=>new Ji({getter:r,typeName:L.ZodLazy,...we(e)});class Ki extends ke{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return X(t,{received:t.data,code:W.invalid_literal,expected:this._def.value}),pe}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ki.create=(r,e)=>new Ki({value:r,typeName:L.ZodLiteral,...we(e)});function _b(r,e){return new Zr({values:r,typeName:L.ZodEnum,...we(e)})}class Zr extends ke{constructor(){super(...arguments),xi.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return X(t,{expected:xe.joinValues(n),received:t.parsedType,code:W.invalid_type}),pe}if(al(this,xi)||pb(this,xi,new Set(this._def.values)),!al(this,xi).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return X(t,{received:t.data,code:W.invalid_enum_value,options:n}),pe}return $t(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Zr.create(e,{...this._def,...t})}exclude(e,t=this._def){return Zr.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}xi=new WeakMap;Zr.create=_b;class Qi extends ke{constructor(){super(...arguments),Ti.set(this,void 0)}_parse(e){const t=xe.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==ee.string&&n.parsedType!==ee.number){const a=xe.objectValues(t);return X(n,{expected:xe.joinValues(a),received:n.parsedType,code:W.invalid_type}),pe}if(al(this,Ti)||pb(this,Ti,new Set(xe.getValidEnumValues(this._def.values))),!al(this,Ti).has(e.data)){const a=xe.objectValues(t);return X(n,{received:n.data,code:W.invalid_enum_value,options:a}),pe}return $t(e.data)}get enum(){return this._def.values}}Ti=new WeakMap;Qi.create=(r,e)=>new Qi({values:r,typeName:L.ZodNativeEnum,...we(e)});class gs extends ke{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ee.promise&&t.common.async===!1)return X(t,{code:W.invalid_type,expected:ee.promise,received:t.parsedType}),pe;const n=t.parsedType===ee.promise?t.data:Promise.resolve(t.data);return $t(n.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}}gs.create=(r,e)=>new gs({type:r,typeName:L.ZodPromise,...we(e)});class Mn extends ke{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===L.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=this._def.effect||null,o={addIssue:u=>{X(n,u),u.fatal?t.abort():t.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),a.type==="preprocess"){const u=a.transform(n.data,o);if(n.common.async)return Promise.resolve(u).then(async c=>{if(t.value==="aborted")return pe;const f=await this._def.schema._parseAsync({data:c,path:n.path,parent:n});return f.status==="aborted"?pe:f.status==="dirty"||t.value==="dirty"?as(f.value):f});{if(t.value==="aborted")return pe;const c=this._def.schema._parseSync({data:u,path:n.path,parent:n});return c.status==="aborted"?pe:c.status==="dirty"||t.value==="dirty"?as(c.value):c}}if(a.type==="refinement"){const u=c=>{const f=a.refinement(c,o);if(n.common.async)return Promise.resolve(f);if(f instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(n.common.async===!1){const c=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return c.status==="aborted"?pe:(c.status==="dirty"&&t.dirty(),u(c.value),{status:t.value,value:c.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(c=>c.status==="aborted"?pe:(c.status==="dirty"&&t.dirty(),u(c.value).then(()=>({status:t.value,value:c.value}))))}if(a.type==="transform")if(n.common.async===!1){const u=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!va(u))return u;const c=a.transform(u.value,o);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:c}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(u=>va(u)?Promise.resolve(a.transform(u.value,o)).then(c=>({status:t.value,value:c})):u);xe.assertNever(a)}}Mn.create=(r,e,t)=>new Mn({schema:r,typeName:L.ZodEffects,effect:e,...we(t)});Mn.createWithPreprocess=(r,e,t)=>new Mn({schema:e,effect:{type:"preprocess",transform:r},typeName:L.ZodEffects,...we(t)});class $n extends ke{_parse(e){return this._getType(e)===ee.undefined?$t(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}$n.create=(r,e)=>new $n({innerType:r,typeName:L.ZodOptional,...we(e)});class Wr extends ke{_parse(e){return this._getType(e)===ee.null?$t(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Wr.create=(r,e)=>new Wr({innerType:r,typeName:L.ZodNullable,...we(e)});class Xi extends ke{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===ee.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Xi.create=(r,e)=>new Xi({innerType:r,typeName:L.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...we(e)});class Yi extends ke{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Bi(a)?a.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new an(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new an(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Yi.create=(r,e)=>new Yi({innerType:r,typeName:L.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...we(e)});class ul extends ke{_parse(e){if(this._getType(e)!==ee.nan){const n=this._getOrReturnCtx(e);return X(n,{code:W.invalid_type,expected:ee.nan,received:n.parsedType}),pe}return{status:"valid",value:e.data}}}ul.create=r=>new ul({typeName:L.ZodNaN,...we(r)});const n1=Symbol("zod_brand");class yp extends ke{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class fo extends ke{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?pe:o.status==="dirty"?(t.dirty(),as(o.value)):this._def.out._parseAsync({data:o.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?pe:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,t){return new fo({in:e,out:t,typeName:L.ZodPipeline})}}class eo extends ke{_parse(e){const t=this._def.innerType._parse(e),n=a=>(va(a)&&(a.value=Object.freeze(a.value)),a);return Bi(t)?t.then(a=>n(a)):n(t)}unwrap(){return this._def.innerType}}eo.create=(r,e)=>new eo({innerType:r,typeName:L.ZodReadonly,...we(e)});function wb(r,e={},t){return r?ms.create().superRefine((n,a)=>{var o,u;if(!r(n)){const c=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,f=(u=(o=c.fatal)!==null&&o!==void 0?o:t)!==null&&u!==void 0?u:!0,h=typeof c=="string"?{message:c}:c;a.addIssue({code:"custom",...h,fatal:f})}}):ms.create()}const r1={object:Qe.lazycreate};var L;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(L||(L={}));const a1=(r,e={message:`Input not instance of ${r.name}`})=>wb(t=>t instanceof r,e),vb=In.create,bb=Hr.create,s1=ul.create,i1=qr.create,Eb=Vi.create,o1=ba.create,u1=sl.create,l1=Hi.create,c1=qi.create,d1=ms.create,f1=pa.create,h1=gr.create,p1=il.create,m1=Nn.create,g1=Qe.create,y1=Qe.strictCreate,_1=Zi.create,w1=Rl.create,v1=Wi.create,b1=Yn.create,E1=Gi.create,S1=ol.create,k1=Ea.create,P1=fs.create,O1=Ji.create,x1=Ki.create,T1=Zr.create,C1=Qi.create,A1=gs.create,d_=Mn.create,I1=$n.create,R1=Wr.create,N1=Mn.createWithPreprocess,$1=fo.create,j1=()=>vb().optional(),L1=()=>bb().optional(),M1=()=>Eb().optional(),F1={string:r=>In.create({...r,coerce:!0}),number:r=>Hr.create({...r,coerce:!0}),boolean:r=>Vi.create({...r,coerce:!0}),bigint:r=>qr.create({...r,coerce:!0}),date:r=>ba.create({...r,coerce:!0})},D1=pe;var ma=Object.freeze({__proto__:null,defaultErrorMap:ps,setErrorMap:Nk,getErrorMap:nl,makeIssue:rl,EMPTY_PATH:$k,addIssueToContext:X,ParseStatus:Tt,INVALID:pe,DIRTY:as,OK:$t,isAborted:Oh,isDirty:xh,isValid:va,isAsync:Bi,get util(){return xe},get objectUtil(){return Ph},ZodParsedType:ee,getParsedType:fr,ZodType:ke,datetimeRegex:yb,ZodString:In,ZodNumber:Hr,ZodBigInt:qr,ZodBoolean:Vi,ZodDate:ba,ZodSymbol:sl,ZodUndefined:Hi,ZodNull:qi,ZodAny:ms,ZodUnknown:pa,ZodNever:gr,ZodVoid:il,ZodArray:Nn,ZodObject:Qe,ZodUnion:Zi,ZodDiscriminatedUnion:Rl,ZodIntersection:Wi,ZodTuple:Yn,ZodRecord:Gi,ZodMap:ol,ZodSet:Ea,ZodFunction:fs,ZodLazy:Ji,ZodLiteral:Ki,ZodEnum:Zr,ZodNativeEnum:Qi,ZodPromise:gs,ZodEffects:Mn,ZodTransformer:Mn,ZodOptional:$n,ZodNullable:Wr,ZodDefault:Xi,ZodCatch:Yi,ZodNaN:ul,BRAND:n1,ZodBranded:yp,ZodPipeline:fo,ZodReadonly:eo,custom:wb,Schema:ke,ZodSchema:ke,late:r1,get ZodFirstPartyTypeKind(){return L},coerce:F1,any:d1,array:m1,bigint:i1,boolean:Eb,date:o1,discriminatedUnion:w1,effect:d_,enum:T1,function:P1,instanceof:a1,intersection:v1,lazy:O1,literal:x1,map:S1,nan:s1,nativeEnum:C1,never:h1,null:c1,nullable:R1,number:bb,object:g1,oboolean:M1,onumber:L1,optional:I1,ostring:j1,pipeline:$1,preprocess:N1,promise:A1,record:E1,set:k1,strictObject:y1,string:vb,symbol:u1,transformer:d_,tuple:b1,undefined:l1,union:_1,unknown:f1,void:p1,NEVER:D1,ZodIssueCode:W,quotelessJson:Rk,ZodError:an}),yi={exports:{}},Qd={},Xd,f_;function U1(){if(f_)return Xd;f_=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Xd=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,a=0;a<this._errors.length;a++){var o=this._errors[a],u=o.message,c=(e[u]||0)+1;e[u]=c,c>=n&&(t=o,n=c)}return t},Xd}var h_;function z1(){return h_||(h_=1,function(r){var e=U1();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in t)n[a]=t[a];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],u=0;u<n.retries;u++)o.push(this.createTimeout(u,n));return t&&t.forever&&!o.length&&o.push(this.createTimeout(u,n)),o.sort(function(c,f){return c-f}),o},r.createTimeout=function(t,n){var a=n.randomize?Math.random()+1:1,o=Math.round(a*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return o=Math.min(o,n.maxTimeout),o},r.wrap=function(t,n,a){if(n instanceof Array&&(a=n,n=null),!a){a=[];for(var o in t)typeof t[o]=="function"&&a.push(o)}for(var u=0;u<a.length;u++){var c=a[u],f=t[c];t[c]=(function(m){var y=r.operation(n),_=Array.prototype.slice.call(arguments,1),b=_.pop();_.push(function(w){y.retry(w)||(w&&(arguments[0]=y.mainError()),b.apply(this,arguments))}),y.attempt(function(){m.apply(t,_)})}).bind(t,f),t[c].options=n}}}(Qd)),Qd}var Yd,p_;function B1(){return p_||(p_=1,Yd=z1()),Yd}var m_;function V1(){if(m_)return yi.exports;m_=1;const r=B1(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(c){super(),c instanceof Error?(this.originalError=c,{message:c}=c):(this.originalError=new Error(c),this.originalError.stack=this.stack),this.name="AbortError",this.message=c}}const n=(u,c,f)=>{const h=f.retries-(c-1);return u.attemptNumber=c,u.retriesLeft=h,u},a=u=>e.includes(u),o=(u,c)=>new Promise((f,h)=>{c={onFailedAttempt:()=>{},retries:10,...c};const m=r.operation(c);m.attempt(async y=>{try{f(await u(y))}catch(_){if(!(_ instanceof Error)){h(new TypeError(`Non-error was thrown: "${_}". You should only throw errors.`));return}if(_ instanceof t)m.stop(),h(_.originalError);else if(_ instanceof TypeError&&!a(_.message))m.stop(),h(_);else{n(_,y,c);try{await c.onFailedAttempt(_)}catch(b){h(b);return}m.retry(_)||h(m.mainError())}}})});return yi.exports=o,yi.exports.default=o,yi.exports.AbortError=t,yi.exports}var H1=V1();const ll=so(H1),q1=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Ii(r){return typeof r=="string"&&q1.test(r)}var _t=[];for(var ef=0;ef<256;++ef)_t.push((ef+256).toString(16).slice(1));function Z1(r,e=0){return(_t[r[e+0]]+_t[r[e+1]]+_t[r[e+2]]+_t[r[e+3]]+"-"+_t[r[e+4]]+_t[r[e+5]]+"-"+_t[r[e+6]]+_t[r[e+7]]+"-"+_t[r[e+8]]+_t[r[e+9]]+"-"+_t[r[e+10]]+_t[r[e+11]]+_t[r[e+12]]+_t[r[e+13]]+_t[r[e+14]]+_t[r[e+15]]).toLowerCase()}var ju,W1=new Uint8Array(16);function G1(){if(!ju&&(ju=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ju))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ju(W1)}var J1=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const g_={randomUUID:J1};function Zt(r,e,t){if(g_.randomUUID&&!r)return g_.randomUUID();r=r||{};var n=r.random||(r.rng||G1)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Z1(n)}var Lu={},tf={exports:{}},y_;function K1(){return y_||(y_=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function a(f,h,m){this.fn=f,this.context=h,this.once=m||!1}function o(f,h,m,y,_){if(typeof m!="function")throw new TypeError("The listener must be a function");var b=new a(m,y||f,_),w=t?t+h:h;return f._events[w]?f._events[w].fn?f._events[w]=[f._events[w],b]:f._events[w].push(b):(f._events[w]=b,f._eventsCount++),f}function u(f,h){--f._eventsCount===0?f._events=new n:delete f._events[h]}function c(){this._events=new n,this._eventsCount=0}c.prototype.eventNames=function(){var h=[],m,y;if(this._eventsCount===0)return h;for(y in m=this._events)e.call(m,y)&&h.push(t?y.slice(1):y);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(m)):h},c.prototype.listeners=function(h){var m=t?t+h:h,y=this._events[m];if(!y)return[];if(y.fn)return[y.fn];for(var _=0,b=y.length,w=new Array(b);_<b;_++)w[_]=y[_].fn;return w},c.prototype.listenerCount=function(h){var m=t?t+h:h,y=this._events[m];return y?y.fn?1:y.length:0},c.prototype.emit=function(h,m,y,_,b,w){var S=t?t+h:h;if(!this._events[S])return!1;var E=this._events[S],P=arguments.length,C,T;if(E.fn){switch(E.once&&this.removeListener(h,E.fn,void 0,!0),P){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,m),!0;case 3:return E.fn.call(E.context,m,y),!0;case 4:return E.fn.call(E.context,m,y,_),!0;case 5:return E.fn.call(E.context,m,y,_,b),!0;case 6:return E.fn.call(E.context,m,y,_,b,w),!0}for(T=1,C=new Array(P-1);T<P;T++)C[T-1]=arguments[T];E.fn.apply(E.context,C)}else{var M=E.length,j;for(T=0;T<M;T++)switch(E[T].once&&this.removeListener(h,E[T].fn,void 0,!0),P){case 1:E[T].fn.call(E[T].context);break;case 2:E[T].fn.call(E[T].context,m);break;case 3:E[T].fn.call(E[T].context,m,y);break;case 4:E[T].fn.call(E[T].context,m,y,_);break;default:if(!C)for(j=1,C=new Array(P-1);j<P;j++)C[j-1]=arguments[j];E[T].fn.apply(E[T].context,C)}}return!0},c.prototype.on=function(h,m,y){return o(this,h,m,y,!1)},c.prototype.once=function(h,m,y){return o(this,h,m,y,!0)},c.prototype.removeListener=function(h,m,y,_){var b=t?t+h:h;if(!this._events[b])return this;if(!m)return u(this,b),this;var w=this._events[b];if(w.fn)w.fn===m&&(!_||w.once)&&(!y||w.context===y)&&u(this,b);else{for(var S=0,E=[],P=w.length;S<P;S++)(w[S].fn!==m||_&&!w[S].once||y&&w[S].context!==y)&&E.push(w[S]);E.length?this._events[b]=E.length===1?E[0]:E:u(this,b)}return this},c.prototype.removeAllListeners=function(h){var m;return h?(m=t?t+h:h,this._events[m]&&u(this,m)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,r.exports=c}(tf)),tf.exports}var _i={exports:{}},nf,__;function Q1(){return __||(__=1,nf=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),nf}var w_;function X1(){if(w_)return _i.exports;w_=1;const r=Q1();class e extends Error{constructor(a){super(a),this.name="TimeoutError"}}const t=(n,a,o)=>new Promise((u,c)=>{if(typeof a!="number"||a<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(a===1/0){u(n);return}const f=setTimeout(()=>{if(typeof o=="function"){try{u(o())}catch(y){c(y)}return}const h=typeof o=="string"?o:`Promise timed out after ${a} milliseconds`,m=o instanceof Error?o:new e(h);typeof n.cancel=="function"&&n.cancel(),c(m)},a);r(n.then(u,c),()=>{clearTimeout(f)})});return _i.exports=t,_i.exports.default=t,_i.exports.TimeoutError=e,_i.exports}var Mu={},Fu={},v_;function Y1(){if(v_)return Fu;v_=1,Object.defineProperty(Fu,"__esModule",{value:!0});function r(e,t,n){let a=0,o=e.length;for(;o>0;){const u=o/2|0;let c=a+u;n(e[c],t)<=0?(a=++c,o-=u+1):o=u}return a}return Fu.default=r,Fu}var b_;function eP(){if(b_)return Mu;b_=1,Object.defineProperty(Mu,"__esModule",{value:!0});const r=Y1();class e{constructor(){this._queue=[]}enqueue(n,a){a=Object.assign({priority:0},a);const o={priority:a.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=a.priority){this._queue.push(o);return}const u=r.default(this._queue,o,(c,f)=>f.priority-c.priority);this._queue.splice(u,0,o)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(a=>a.priority===n.priority).map(a=>a.run)}get size(){return this._queue.length}}return Mu.default=e,Mu}var E_;function tP(){if(E_)return Lu;E_=1,Object.defineProperty(Lu,"__esModule",{value:!0});const r=K1(),e=X1(),t=eP(),n=()=>{},a=new e.TimeoutError;class o extends r{constructor(c){var f,h,m,y;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,c=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},c),!(typeof c.intervalCap=="number"&&c.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(h=(f=c.intervalCap)===null||f===void 0?void 0:f.toString())!==null&&h!==void 0?h:""}\` (${typeof c.intervalCap})`);if(c.interval===void 0||!(Number.isFinite(c.interval)&&c.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(y=(m=c.interval)===null||m===void 0?void 0:m.toString())!==null&&y!==void 0?y:""}\` (${typeof c.interval})`);this._carryoverConcurrencyCount=c.carryoverConcurrencyCount,this._isIntervalIgnored=c.intervalCap===1/0||c.interval===0,this._intervalCap=c.intervalCap,this._interval=c.interval,this._queue=new c.queueClass,this._queueClass=c.queueClass,this.concurrency=c.concurrency,this._timeout=c.timeout,this._throwOnTimeout=c.throwOnTimeout===!0,this._isPaused=c.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const c=Date.now();if(this._intervalId===void 0){const f=this._intervalEnd-c;if(f<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},f)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const c=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const f=this._queue.dequeue();return f?(this.emit("active"),f(),c&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(c){if(!(typeof c=="number"&&c>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${c}\` (${typeof c})`);this._concurrency=c,this._processQueue()}async add(c,f={}){return new Promise((h,m)=>{const y=async()=>{this._pendingCount++,this._intervalCount++;try{const _=this._timeout===void 0&&f.timeout===void 0?c():e.default(Promise.resolve(c()),f.timeout===void 0?this._timeout:f.timeout,()=>{(f.throwOnTimeout===void 0?this._throwOnTimeout:f.throwOnTimeout)&&m(a)});h(await _)}catch(_){m(_)}this._next()};this._queue.enqueue(y,f),this._tryToStartAnother(),this.emit("add")})}async addAll(c,f){return Promise.all(c.map(async h=>this.add(h,f)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(c=>{const f=this._resolveEmpty;this._resolveEmpty=()=>{f(),c()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(c=>{const f=this._resolveIdle;this._resolveIdle=()=>{f(),c()}})}get size(){return this._queue.size}sizeBy(c){return this._queue.filter(c).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(c){this._timeout=c}}return Lu.default=o,Lu}var nP=tP();const mr=so(nP),rP=(...r)=>fetch(...r),aP=Symbol.for("ls:fetch_implementation"),ue=()=>globalThis[aP]??rP,sP=[400,401,403,404,405,406,407,408],iP=[409];let S_=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in mr?this.queue=new mr.default({concurrency:this.maxConcurrency}):this.queue=new mr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>ll(()=>e(...t).catch(a=>{throw a instanceof Error?a:new Error(a)}),{async onFailedAttempt(a){if(a.message.startsWith("Cancel")||a.message.startsWith("TimeoutError")||a.message.startsWith("AbortError")||(a==null?void 0:a.code)==="ECONNABORTED")throw a;const o=a==null?void 0:a.response,u=o==null?void 0:o.status;if(u){if(sP.includes(+u))throw a;if(iP.includes(+u))return;n&&await n(o)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((a,o)=>{var u;(u=e.signal)==null||u.addEventListener("abort",()=>{o(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>ue()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function k_(r){return typeof(r==null?void 0:r._getType)=="function"}function P_(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}function Ee(r,e){if(!Ii(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}const O_={};function Sb(r){O_[r]||(console.warn(r),O_[r]=!0)}var Du={exports:{}},rf,x_;function Nl(){if(x_)return rf;x_=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,a=e-6;return rf={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},rf}var af,T_;function $l(){if(T_)return af;T_=1;var r={};return af=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},af}var C_;function ho(){return C_||(C_=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=Nl(),o=$l();e=r.exports={};const u=e.re=[],c=e.safeRe=[],f=e.src=[],h=e.t={};let m=0;const y="[a-zA-Z0-9-]",_=[["\\s",1],["\\d",a],[y,n]],b=S=>{for(const[E,P]of _)S=S.split(`${E}*`).join(`${E}{0,${P}}`).split(`${E}+`).join(`${E}{1,${P}}`);return S},w=(S,E,P)=>{const C=b(E),T=m++;o(S,T,E),h[S]=T,f[T]=E,u[T]=new RegExp(E,P?"g":void 0),c[T]=new RegExp(C,P?"g":void 0)};w("NUMERICIDENTIFIER","0|[1-9]\\d*"),w("NUMERICIDENTIFIERLOOSE","\\d+"),w("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${y}*`),w("MAINVERSION",`(${f[h.NUMERICIDENTIFIER]})\\.(${f[h.NUMERICIDENTIFIER]})\\.(${f[h.NUMERICIDENTIFIER]})`),w("MAINVERSIONLOOSE",`(${f[h.NUMERICIDENTIFIERLOOSE]})\\.(${f[h.NUMERICIDENTIFIERLOOSE]})\\.(${f[h.NUMERICIDENTIFIERLOOSE]})`),w("PRERELEASEIDENTIFIER",`(?:${f[h.NUMERICIDENTIFIER]}|${f[h.NONNUMERICIDENTIFIER]})`),w("PRERELEASEIDENTIFIERLOOSE",`(?:${f[h.NUMERICIDENTIFIERLOOSE]}|${f[h.NONNUMERICIDENTIFIER]})`),w("PRERELEASE",`(?:-(${f[h.PRERELEASEIDENTIFIER]}(?:\\.${f[h.PRERELEASEIDENTIFIER]})*))`),w("PRERELEASELOOSE",`(?:-?(${f[h.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${f[h.PRERELEASEIDENTIFIERLOOSE]})*))`),w("BUILDIDENTIFIER",`${y}+`),w("BUILD",`(?:\\+(${f[h.BUILDIDENTIFIER]}(?:\\.${f[h.BUILDIDENTIFIER]})*))`),w("FULLPLAIN",`v?${f[h.MAINVERSION]}${f[h.PRERELEASE]}?${f[h.BUILD]}?`),w("FULL",`^${f[h.FULLPLAIN]}$`),w("LOOSEPLAIN",`[v=\\s]*${f[h.MAINVERSIONLOOSE]}${f[h.PRERELEASELOOSE]}?${f[h.BUILD]}?`),w("LOOSE",`^${f[h.LOOSEPLAIN]}$`),w("GTLT","((?:<|>)?=?)"),w("XRANGEIDENTIFIERLOOSE",`${f[h.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),w("XRANGEIDENTIFIER",`${f[h.NUMERICIDENTIFIER]}|x|X|\\*`),w("XRANGEPLAIN",`[v=\\s]*(${f[h.XRANGEIDENTIFIER]})(?:\\.(${f[h.XRANGEIDENTIFIER]})(?:\\.(${f[h.XRANGEIDENTIFIER]})(?:${f[h.PRERELEASE]})?${f[h.BUILD]}?)?)?`),w("XRANGEPLAINLOOSE",`[v=\\s]*(${f[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${f[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${f[h.XRANGEIDENTIFIERLOOSE]})(?:${f[h.PRERELEASELOOSE]})?${f[h.BUILD]}?)?)?`),w("XRANGE",`^${f[h.GTLT]}\\s*${f[h.XRANGEPLAIN]}$`),w("XRANGELOOSE",`^${f[h.GTLT]}\\s*${f[h.XRANGEPLAINLOOSE]}$`),w("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),w("COERCE",`${f[h.COERCEPLAIN]}(?:$|[^\\d])`),w("COERCEFULL",f[h.COERCEPLAIN]+`(?:${f[h.PRERELEASE]})?(?:${f[h.BUILD]})?(?:$|[^\\d])`),w("COERCERTL",f[h.COERCE],!0),w("COERCERTLFULL",f[h.COERCEFULL],!0),w("LONETILDE","(?:~>?)"),w("TILDETRIM",`(\\s*)${f[h.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",w("TILDE",`^${f[h.LONETILDE]}${f[h.XRANGEPLAIN]}$`),w("TILDELOOSE",`^${f[h.LONETILDE]}${f[h.XRANGEPLAINLOOSE]}$`),w("LONECARET","(?:\\^)"),w("CARETTRIM",`(\\s*)${f[h.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",w("CARET",`^${f[h.LONECARET]}${f[h.XRANGEPLAIN]}$`),w("CARETLOOSE",`^${f[h.LONECARET]}${f[h.XRANGEPLAINLOOSE]}$`),w("COMPARATORLOOSE",`^${f[h.GTLT]}\\s*(${f[h.LOOSEPLAIN]})$|^$`),w("COMPARATOR",`^${f[h.GTLT]}\\s*(${f[h.FULLPLAIN]})$|^$`),w("COMPARATORTRIM",`(\\s*)${f[h.GTLT]}\\s*(${f[h.LOOSEPLAIN]}|${f[h.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",w("HYPHENRANGE",`^\\s*(${f[h.XRANGEPLAIN]})\\s+-\\s+(${f[h.XRANGEPLAIN]})\\s*$`),w("HYPHENRANGELOOSE",`^\\s*(${f[h.XRANGEPLAINLOOSE]})\\s+-\\s+(${f[h.XRANGEPLAINLOOSE]})\\s*$`),w("STAR","(<|>)?=?\\s*\\*"),w("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),w("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Du,Du.exports)),Du.exports}var sf,A_;function _p(){if(A_)return sf;A_=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return sf=n=>n?typeof n!="object"?r:n:e,sf}var of,I_;function kb(){if(I_)return of;I_=1;const r=/^[0-9]+$/,e=(n,a)=>{const o=r.test(n),u=r.test(a);return o&&u&&(n=+n,a=+a),n===a?0:o&&!u?-1:u&&!o?1:n<a?-1:1};return of={compareIdentifiers:e,rcompareIdentifiers:(n,a)=>e(a,n)},of}var uf,R_;function jt(){if(R_)return uf;R_=1;const r=$l(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Nl(),{safeRe:n,t:a}=ho(),o=_p(),{compareIdentifiers:u}=kb();class c{constructor(h,m){if(m=o(m),h instanceof c){if(h.loose===!!m.loose&&h.includePrerelease===!!m.includePrerelease)return h;h=h.version}else if(typeof h!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof h}".`);if(h.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",h,m),this.options=m,this.loose=!!m.loose,this.includePrerelease=!!m.includePrerelease;const y=h.trim().match(m.loose?n[a.LOOSE]:n[a.FULL]);if(!y)throw new TypeError(`Invalid Version: ${h}`);if(this.raw=h,this.major=+y[1],this.minor=+y[2],this.patch=+y[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");y[4]?this.prerelease=y[4].split(".").map(_=>{if(/^[0-9]+$/.test(_)){const b=+_;if(b>=0&&b<t)return b}return _}):this.prerelease=[],this.build=y[5]?y[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(h){if(r("SemVer.compare",this.version,this.options,h),!(h instanceof c)){if(typeof h=="string"&&h===this.version)return 0;h=new c(h,this.options)}return h.version===this.version?0:this.compareMain(h)||this.comparePre(h)}compareMain(h){return h instanceof c||(h=new c(h,this.options)),u(this.major,h.major)||u(this.minor,h.minor)||u(this.patch,h.patch)}comparePre(h){if(h instanceof c||(h=new c(h,this.options)),this.prerelease.length&&!h.prerelease.length)return-1;if(!this.prerelease.length&&h.prerelease.length)return 1;if(!this.prerelease.length&&!h.prerelease.length)return 0;let m=0;do{const y=this.prerelease[m],_=h.prerelease[m];if(r("prerelease compare",m,y,_),y===void 0&&_===void 0)return 0;if(_===void 0)return 1;if(y===void 0)return-1;if(y===_)continue;return u(y,_)}while(++m)}compareBuild(h){h instanceof c||(h=new c(h,this.options));let m=0;do{const y=this.build[m],_=h.build[m];if(r("build compare",m,y,_),y===void 0&&_===void 0)return 0;if(_===void 0)return 1;if(y===void 0)return-1;if(y===_)continue;return u(y,_)}while(++m)}inc(h,m,y){switch(h){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",m,y);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",m,y);break;case"prepatch":this.prerelease.length=0,this.inc("patch",m,y),this.inc("pre",m,y);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",m,y),this.inc("pre",m,y);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const _=Number(y)?1:0;if(!m&&y===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[_];else{let b=this.prerelease.length;for(;--b>=0;)typeof this.prerelease[b]=="number"&&(this.prerelease[b]++,b=-2);if(b===-1){if(m===this.prerelease.join(".")&&y===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(_)}}if(m){let b=[m,_];y===!1&&(b=[m]),u(this.prerelease[0],m)===0?isNaN(this.prerelease[1])&&(this.prerelease=b):this.prerelease=b}break}default:throw new Error(`invalid increment argument: ${h}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return uf=c,uf}var lf,N_;function xs(){if(N_)return lf;N_=1;const r=jt();return lf=(t,n,a=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(o){if(!a)return null;throw o}},lf}var cf,$_;function oP(){if($_)return cf;$_=1;const r=xs();return cf=(t,n)=>{const a=r(t,n);return a?a.version:null},cf}var df,j_;function uP(){if(j_)return df;j_=1;const r=xs();return df=(t,n)=>{const a=r(t.trim().replace(/^[=v]+/,""),n);return a?a.version:null},df}var ff,L_;function lP(){if(L_)return ff;L_=1;const r=jt();return ff=(t,n,a,o,u)=>{typeof a=="string"&&(u=o,o=a,a=void 0);try{return new r(t instanceof r?t.version:t,a).inc(n,o,u).version}catch{return null}},ff}var hf,M_;function cP(){if(M_)return hf;M_=1;const r=xs();return hf=(t,n)=>{const a=r(t,null,!0),o=r(n,null,!0),u=a.compare(o);if(u===0)return null;const c=u>0,f=c?a:o,h=c?o:a,m=!!f.prerelease.length;if(!!h.prerelease.length&&!m)return!h.patch&&!h.minor?"major":f.patch?"patch":f.minor?"minor":"major";const _=m?"pre":"";return a.major!==o.major?_+"major":a.minor!==o.minor?_+"minor":a.patch!==o.patch?_+"patch":"prerelease"},hf}var pf,F_;function dP(){if(F_)return pf;F_=1;const r=jt();return pf=(t,n)=>new r(t,n).major,pf}var mf,D_;function fP(){if(D_)return mf;D_=1;const r=jt();return mf=(t,n)=>new r(t,n).minor,mf}var gf,U_;function hP(){if(U_)return gf;U_=1;const r=jt();return gf=(t,n)=>new r(t,n).patch,gf}var yf,z_;function pP(){if(z_)return yf;z_=1;const r=xs();return yf=(t,n)=>{const a=r(t,n);return a&&a.prerelease.length?a.prerelease:null},yf}var _f,B_;function Un(){if(B_)return _f;B_=1;const r=jt();return _f=(t,n,a)=>new r(t,a).compare(new r(n,a)),_f}var wf,V_;function mP(){if(V_)return wf;V_=1;const r=Un();return wf=(t,n,a)=>r(n,t,a),wf}var vf,H_;function gP(){if(H_)return vf;H_=1;const r=Un();return vf=(t,n)=>r(t,n,!0),vf}var bf,q_;function wp(){if(q_)return bf;q_=1;const r=jt();return bf=(t,n,a)=>{const o=new r(t,a),u=new r(n,a);return o.compare(u)||o.compareBuild(u)},bf}var Ef,Z_;function yP(){if(Z_)return Ef;Z_=1;const r=wp();return Ef=(t,n)=>t.sort((a,o)=>r(a,o,n)),Ef}var Sf,W_;function _P(){if(W_)return Sf;W_=1;const r=wp();return Sf=(t,n)=>t.sort((a,o)=>r(o,a,n)),Sf}var kf,G_;function jl(){if(G_)return kf;G_=1;const r=Un();return kf=(t,n,a)=>r(t,n,a)>0,kf}var Pf,J_;function vp(){if(J_)return Pf;J_=1;const r=Un();return Pf=(t,n,a)=>r(t,n,a)<0,Pf}var Of,K_;function Pb(){if(K_)return Of;K_=1;const r=Un();return Of=(t,n,a)=>r(t,n,a)===0,Of}var xf,Q_;function Ob(){if(Q_)return xf;Q_=1;const r=Un();return xf=(t,n,a)=>r(t,n,a)!==0,xf}var Tf,X_;function bp(){if(X_)return Tf;X_=1;const r=Un();return Tf=(t,n,a)=>r(t,n,a)>=0,Tf}var Cf,Y_;function Ep(){if(Y_)return Cf;Y_=1;const r=Un();return Cf=(t,n,a)=>r(t,n,a)<=0,Cf}var Af,ew;function xb(){if(ew)return Af;ew=1;const r=Pb(),e=Ob(),t=jl(),n=bp(),a=vp(),o=Ep();return Af=(c,f,h,m)=>{switch(f){case"===":return typeof c=="object"&&(c=c.version),typeof h=="object"&&(h=h.version),c===h;case"!==":return typeof c=="object"&&(c=c.version),typeof h=="object"&&(h=h.version),c!==h;case"":case"=":case"==":return r(c,h,m);case"!=":return e(c,h,m);case">":return t(c,h,m);case">=":return n(c,h,m);case"<":return a(c,h,m);case"<=":return o(c,h,m);default:throw new TypeError(`Invalid operator: ${f}`)}},Af}var If,tw;function wP(){if(tw)return If;tw=1;const r=jt(),e=xs(),{safeRe:t,t:n}=ho();return If=(o,u)=>{if(o instanceof r)return o;if(typeof o=="number"&&(o=String(o)),typeof o!="string")return null;u=u||{};let c=null;if(!u.rtl)c=o.match(u.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const b=u.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let w;for(;(w=b.exec(o))&&(!c||c.index+c[0].length!==o.length);)(!c||w.index+w[0].length!==c.index+c[0].length)&&(c=w),b.lastIndex=w.index+w[1].length+w[2].length;b.lastIndex=-1}if(c===null)return null;const f=c[2],h=c[3]||"0",m=c[4]||"0",y=u.includePrerelease&&c[5]?`-${c[5]}`:"",_=u.includePrerelease&&c[6]?`+${c[6]}`:"";return e(`${f}.${h}.${m}${y}${_}`,u)},If}var Rf,nw;function vP(){if(nw)return Rf;nw=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const o=this.map.keys().next().value;this.delete(o)}this.map.set(t,n)}return this}}return Rf=r,Rf}var Nf,rw;function zn(){if(rw)return Nf;rw=1;const r=/\s+/g;class e{constructor(G,te){if(te=a(te),G instanceof e)return G.loose===!!te.loose&&G.includePrerelease===!!te.includePrerelease?G:new e(G.raw,te);if(G instanceof o)return this.raw=G.value,this.set=[[G]],this.formatted=void 0,this;if(this.options=te,this.loose=!!te.loose,this.includePrerelease=!!te.includePrerelease,this.raw=G.trim().replace(r," "),this.set=this.raw.split("||").map(Q=>this.parseRange(Q.trim())).filter(Q=>Q.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const Q=this.set[0];if(this.set=this.set.filter(F=>!S(F[0])),this.set.length===0)this.set=[Q];else if(this.set.length>1){for(const F of this.set)if(F.length===1&&E(F[0])){this.set=[F];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let G=0;G<this.set.length;G++){G>0&&(this.formatted+="||");const te=this.set[G];for(let Q=0;Q<te.length;Q++)Q>0&&(this.formatted+=" "),this.formatted+=te[Q].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(G){const Q=((this.options.includePrerelease&&b)|(this.options.loose&&w))+":"+G,F=n.get(Q);if(F)return F;const z=this.options.loose,U=z?f[h.HYPHENRANGELOOSE]:f[h.HYPHENRANGE];G=G.replace(U,qe(this.options.includePrerelease)),u("hyphen replace",G),G=G.replace(f[h.COMPARATORTRIM],m),u("comparator trim",G),G=G.replace(f[h.TILDETRIM],y),u("tilde trim",G),G=G.replace(f[h.CARETTRIM],_),u("caret trim",G);let x=G.split(" ").map(ce=>C(ce,this.options)).join(" ").split(/\s+/).map(ce=>ye(ce,this.options));z&&(x=x.filter(ce=>(u("loose invalid filter",ce,this.options),!!ce.match(f[h.COMPARATORLOOSE])))),u("range list",x);const $=new Map,ne=x.map(ce=>new o(ce,this.options));for(const ce of ne){if(S(ce))return[ce];$.set(ce.value,ce)}$.size>1&&$.has("")&&$.delete("");const le=[...$.values()];return n.set(Q,le),le}intersects(G,te){if(!(G instanceof e))throw new TypeError("a Range is required");return this.set.some(Q=>P(Q,te)&&G.set.some(F=>P(F,te)&&Q.every(z=>F.every(U=>z.intersects(U,te)))))}test(G){if(!G)return!1;if(typeof G=="string")try{G=new c(G,this.options)}catch{return!1}for(let te=0;te<this.set.length;te++)if(Ze(this.set[te],G,this.options))return!0;return!1}}Nf=e;const t=vP(),n=new t,a=_p(),o=Ll(),u=$l(),c=jt(),{safeRe:f,t:h,comparatorTrimReplace:m,tildeTrimReplace:y,caretTrimReplace:_}=ho(),{FLAG_INCLUDE_PRERELEASE:b,FLAG_LOOSE:w}=Nl(),S=K=>K.value==="<0.0.0-0",E=K=>K.value==="",P=(K,G)=>{let te=!0;const Q=K.slice();let F=Q.pop();for(;te&&Q.length;)te=Q.every(z=>F.intersects(z,G)),F=Q.pop();return te},C=(K,G)=>(u("comp",K,G),K=D(K,G),u("caret",K),K=M(K,G),u("tildes",K),K=q(K,G),u("xrange",K),K=ve(K,G),u("stars",K),K),T=K=>!K||K.toLowerCase()==="x"||K==="*",M=(K,G)=>K.trim().split(/\s+/).map(te=>j(te,G)).join(" "),j=(K,G)=>{const te=G.loose?f[h.TILDELOOSE]:f[h.TILDE];return K.replace(te,(Q,F,z,U,x)=>{u("tilde",K,Q,F,z,U,x);let $;return T(F)?$="":T(z)?$=`>=${F}.0.0 <${+F+1}.0.0-0`:T(U)?$=`>=${F}.${z}.0 <${F}.${+z+1}.0-0`:x?(u("replaceTilde pr",x),$=`>=${F}.${z}.${U}-${x} <${F}.${+z+1}.0-0`):$=`>=${F}.${z}.${U} <${F}.${+z+1}.0-0`,u("tilde return",$),$})},D=(K,G)=>K.trim().split(/\s+/).map(te=>V(te,G)).join(" "),V=(K,G)=>{u("caret",K,G);const te=G.loose?f[h.CARETLOOSE]:f[h.CARET],Q=G.includePrerelease?"-0":"";return K.replace(te,(F,z,U,x,$)=>{u("caret",K,F,z,U,x,$);let ne;return T(z)?ne="":T(U)?ne=`>=${z}.0.0${Q} <${+z+1}.0.0-0`:T(x)?z==="0"?ne=`>=${z}.${U}.0${Q} <${z}.${+U+1}.0-0`:ne=`>=${z}.${U}.0${Q} <${+z+1}.0.0-0`:$?(u("replaceCaret pr",$),z==="0"?U==="0"?ne=`>=${z}.${U}.${x}-${$} <${z}.${U}.${+x+1}-0`:ne=`>=${z}.${U}.${x}-${$} <${z}.${+U+1}.0-0`:ne=`>=${z}.${U}.${x}-${$} <${+z+1}.0.0-0`):(u("no pr"),z==="0"?U==="0"?ne=`>=${z}.${U}.${x}${Q} <${z}.${U}.${+x+1}-0`:ne=`>=${z}.${U}.${x}${Q} <${z}.${+U+1}.0-0`:ne=`>=${z}.${U}.${x} <${+z+1}.0.0-0`),u("caret return",ne),ne})},q=(K,G)=>(u("replaceXRanges",K,G),K.split(/\s+/).map(te=>me(te,G)).join(" ")),me=(K,G)=>{K=K.trim();const te=G.loose?f[h.XRANGELOOSE]:f[h.XRANGE];return K.replace(te,(Q,F,z,U,x,$)=>{u("xRange",K,Q,F,z,U,x,$);const ne=T(z),le=ne||T(U),ce=le||T(x),be=ce;return F==="="&&be&&(F=""),$=G.includePrerelease?"-0":"",ne?F===">"||F==="<"?Q="<0.0.0-0":Q="*":F&&be?(le&&(U=0),x=0,F===">"?(F=">=",le?(z=+z+1,U=0,x=0):(U=+U+1,x=0)):F==="<="&&(F="<",le?z=+z+1:U=+U+1),F==="<"&&($="-0"),Q=`${F+z}.${U}.${x}${$}`):le?Q=`>=${z}.0.0${$} <${+z+1}.0.0-0`:ce&&(Q=`>=${z}.${U}.0${$} <${z}.${+U+1}.0-0`),u("xRange return",Q),Q})},ve=(K,G)=>(u("replaceStars",K,G),K.trim().replace(f[h.STAR],"")),ye=(K,G)=>(u("replaceGTE0",K,G),K.trim().replace(f[G.includePrerelease?h.GTE0PRE:h.GTE0],"")),qe=K=>(G,te,Q,F,z,U,x,$,ne,le,ce,be)=>(T(Q)?te="":T(F)?te=`>=${Q}.0.0${K?"-0":""}`:T(z)?te=`>=${Q}.${F}.0${K?"-0":""}`:U?te=`>=${te}`:te=`>=${te}${K?"-0":""}`,T(ne)?$="":T(le)?$=`<${+ne+1}.0.0-0`:T(ce)?$=`<${ne}.${+le+1}.0-0`:be?$=`<=${ne}.${le}.${ce}-${be}`:K?$=`<${ne}.${le}.${+ce+1}-0`:$=`<=${$}`,`${te} ${$}`.trim()),Ze=(K,G,te)=>{for(let Q=0;Q<K.length;Q++)if(!K[Q].test(G))return!1;if(G.prerelease.length&&!te.includePrerelease){for(let Q=0;Q<K.length;Q++)if(u(K[Q].semver),K[Q].semver!==o.ANY&&K[Q].semver.prerelease.length>0){const F=K[Q].semver;if(F.major===G.major&&F.minor===G.minor&&F.patch===G.patch)return!0}return!1}return!0};return Nf}var $f,aw;function Ll(){if(aw)return $f;aw=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(m,y){if(y=t(y),m instanceof e){if(m.loose===!!y.loose)return m;m=m.value}m=m.trim().split(/\s+/).join(" "),u("comparator",m,y),this.options=y,this.loose=!!y.loose,this.parse(m),this.semver===r?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(m){const y=this.options.loose?n[a.COMPARATORLOOSE]:n[a.COMPARATOR],_=m.match(y);if(!_)throw new TypeError(`Invalid comparator: ${m}`);this.operator=_[1]!==void 0?_[1]:"",this.operator==="="&&(this.operator=""),_[2]?this.semver=new c(_[2],this.options.loose):this.semver=r}toString(){return this.value}test(m){if(u("Comparator.test",m,this.options.loose),this.semver===r||m===r)return!0;if(typeof m=="string")try{m=new c(m,this.options)}catch{return!1}return o(m,this.operator,this.semver,this.options)}intersects(m,y){if(!(m instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new f(m.value,y).test(this.value):m.operator===""?m.value===""?!0:new f(this.value,y).test(m.semver):(y=t(y),y.includePrerelease&&(this.value==="<0.0.0-0"||m.value==="<0.0.0-0")||!y.includePrerelease&&(this.value.startsWith("<0.0.0")||m.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&m.operator.startsWith(">")||this.operator.startsWith("<")&&m.operator.startsWith("<")||this.semver.version===m.semver.version&&this.operator.includes("=")&&m.operator.includes("=")||o(this.semver,"<",m.semver,y)&&this.operator.startsWith(">")&&m.operator.startsWith("<")||o(this.semver,">",m.semver,y)&&this.operator.startsWith("<")&&m.operator.startsWith(">")))}}$f=e;const t=_p(),{safeRe:n,t:a}=ho(),o=xb(),u=$l(),c=jt(),f=zn();return $f}var jf,sw;function Ml(){if(sw)return jf;sw=1;const r=zn();return jf=(t,n,a)=>{try{n=new r(n,a)}catch{return!1}return n.test(t)},jf}var Lf,iw;function bP(){if(iw)return Lf;iw=1;const r=zn();return Lf=(t,n)=>new r(t,n).set.map(a=>a.map(o=>o.value).join(" ").trim().split(" ")),Lf}var Mf,ow;function EP(){if(ow)return Mf;ow=1;const r=jt(),e=zn();return Mf=(n,a,o)=>{let u=null,c=null,f=null;try{f=new e(a,o)}catch{return null}return n.forEach(h=>{f.test(h)&&(!u||c.compare(h)===-1)&&(u=h,c=new r(u,o))}),u},Mf}var Ff,uw;function SP(){if(uw)return Ff;uw=1;const r=jt(),e=zn();return Ff=(n,a,o)=>{let u=null,c=null,f=null;try{f=new e(a,o)}catch{return null}return n.forEach(h=>{f.test(h)&&(!u||c.compare(h)===1)&&(u=h,c=new r(u,o))}),u},Ff}var Df,lw;function kP(){if(lw)return Df;lw=1;const r=jt(),e=zn(),t=jl();return Df=(a,o)=>{a=new e(a,o);let u=new r("0.0.0");if(a.test(u)||(u=new r("0.0.0-0"),a.test(u)))return u;u=null;for(let c=0;c<a.set.length;++c){const f=a.set[c];let h=null;f.forEach(m=>{const y=new r(m.semver.version);switch(m.operator){case">":y.prerelease.length===0?y.patch++:y.prerelease.push(0),y.raw=y.format();case"":case">=":(!h||t(y,h))&&(h=y);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${m.operator}`)}}),h&&(!u||t(u,h))&&(u=h)}return u&&a.test(u)?u:null},Df}var Uf,cw;function PP(){if(cw)return Uf;cw=1;const r=zn();return Uf=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},Uf}var zf,dw;function Sp(){if(dw)return zf;dw=1;const r=jt(),e=Ll(),{ANY:t}=e,n=zn(),a=Ml(),o=jl(),u=vp(),c=Ep(),f=bp();return zf=(m,y,_,b)=>{m=new r(m,b),y=new n(y,b);let w,S,E,P,C;switch(_){case">":w=o,S=c,E=u,P=">",C=">=";break;case"<":w=u,S=f,E=o,P="<",C="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(m,y,b))return!1;for(let T=0;T<y.set.length;++T){const M=y.set[T];let j=null,D=null;if(M.forEach(V=>{V.semver===t&&(V=new e(">=0.0.0")),j=j||V,D=D||V,w(V.semver,j.semver,b)?j=V:E(V.semver,D.semver,b)&&(D=V)}),j.operator===P||j.operator===C||(!D.operator||D.operator===P)&&S(m,D.semver))return!1;if(D.operator===C&&E(m,D.semver))return!1}return!0},zf}var Bf,fw;function OP(){if(fw)return Bf;fw=1;const r=Sp();return Bf=(t,n,a)=>r(t,n,">",a),Bf}var Vf,hw;function xP(){if(hw)return Vf;hw=1;const r=Sp();return Vf=(t,n,a)=>r(t,n,"<",a),Vf}var Hf,pw;function TP(){if(pw)return Hf;pw=1;const r=zn();return Hf=(t,n,a)=>(t=new r(t,a),n=new r(n,a),t.intersects(n,a)),Hf}var qf,mw;function CP(){if(mw)return qf;mw=1;const r=Ml(),e=Un();return qf=(t,n,a)=>{const o=[];let u=null,c=null;const f=t.sort((_,b)=>e(_,b,a));for(const _ of f)r(_,n,a)?(c=_,u||(u=_)):(c&&o.push([u,c]),c=null,u=null);u&&o.push([u,null]);const h=[];for(const[_,b]of o)_===b?h.push(_):!b&&_===f[0]?h.push("*"):b?_===f[0]?h.push(`<=${b}`):h.push(`${_} - ${b}`):h.push(`>=${_}`);const m=h.join(" || "),y=typeof n.raw=="string"?n.raw:String(n);return m.length<y.length?m:n},qf}var Zf,gw;function AP(){if(gw)return Zf;gw=1;const r=zn(),e=Ll(),{ANY:t}=e,n=Ml(),a=Un(),o=(y,_,b={})=>{if(y===_)return!0;y=new r(y,b),_=new r(_,b);let w=!1;e:for(const S of y.set){for(const E of _.set){const P=f(S,E,b);if(w=w||P!==null,P)continue e}if(w)return!1}return!0},u=[new e(">=0.0.0-0")],c=[new e(">=0.0.0")],f=(y,_,b)=>{if(y===_)return!0;if(y.length===1&&y[0].semver===t){if(_.length===1&&_[0].semver===t)return!0;b.includePrerelease?y=u:y=c}if(_.length===1&&_[0].semver===t){if(b.includePrerelease)return!0;_=c}const w=new Set;let S,E;for(const q of y)q.operator===">"||q.operator===">="?S=h(S,q,b):q.operator==="<"||q.operator==="<="?E=m(E,q,b):w.add(q.semver);if(w.size>1)return null;let P;if(S&&E){if(P=a(S.semver,E.semver,b),P>0)return null;if(P===0&&(S.operator!==">="||E.operator!=="<="))return null}for(const q of w){if(S&&!n(q,String(S),b)||E&&!n(q,String(E),b))return null;for(const me of _)if(!n(q,String(me),b))return!1;return!0}let C,T,M,j,D=E&&!b.includePrerelease&&E.semver.prerelease.length?E.semver:!1,V=S&&!b.includePrerelease&&S.semver.prerelease.length?S.semver:!1;D&&D.prerelease.length===1&&E.operator==="<"&&D.prerelease[0]===0&&(D=!1);for(const q of _){if(j=j||q.operator===">"||q.operator===">=",M=M||q.operator==="<"||q.operator==="<=",S){if(V&&q.semver.prerelease&&q.semver.prerelease.length&&q.semver.major===V.major&&q.semver.minor===V.minor&&q.semver.patch===V.patch&&(V=!1),q.operator===">"||q.operator===">="){if(C=h(S,q,b),C===q&&C!==S)return!1}else if(S.operator===">="&&!n(S.semver,String(q),b))return!1}if(E){if(D&&q.semver.prerelease&&q.semver.prerelease.length&&q.semver.major===D.major&&q.semver.minor===D.minor&&q.semver.patch===D.patch&&(D=!1),q.operator==="<"||q.operator==="<="){if(T=m(E,q,b),T===q&&T!==E)return!1}else if(E.operator==="<="&&!n(E.semver,String(q),b))return!1}if(!q.operator&&(E||S)&&P!==0)return!1}return!(S&&M&&!E&&P!==0||E&&j&&!S&&P!==0||V||D)},h=(y,_,b)=>{if(!y)return _;const w=a(y.semver,_.semver,b);return w>0?y:w<0||_.operator===">"&&y.operator===">="?_:y},m=(y,_,b)=>{if(!y)return _;const w=a(y.semver,_.semver,b);return w<0?y:w>0||_.operator==="<"&&y.operator==="<="?_:y};return Zf=o,Zf}var Wf,yw;function IP(){if(yw)return Wf;yw=1;const r=ho(),e=Nl(),t=jt(),n=kb(),a=xs(),o=oP(),u=uP(),c=lP(),f=cP(),h=dP(),m=fP(),y=hP(),_=pP(),b=Un(),w=mP(),S=gP(),E=wp(),P=yP(),C=_P(),T=jl(),M=vp(),j=Pb(),D=Ob(),V=bp(),q=Ep(),me=xb(),ve=wP(),ye=Ll(),qe=zn(),Ze=Ml(),K=bP(),G=EP(),te=SP(),Q=kP(),F=PP(),z=Sp(),U=OP(),x=xP(),$=TP(),ne=CP(),le=AP();return Wf={parse:a,valid:o,clean:u,inc:c,diff:f,major:h,minor:m,patch:y,prerelease:_,compare:b,rcompare:w,compareLoose:S,compareBuild:E,sort:P,rsort:C,gt:T,lt:M,eq:j,neq:D,gte:V,lte:q,cmp:me,coerce:ve,Comparator:ye,Range:qe,satisfies:Ze,toComparators:K,maxSatisfying:G,minSatisfying:te,minVersion:Q,validRange:F,outside:z,gtr:U,ltr:x,intersects:$,simplifyRange:ne,subset:le,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},Wf}IP();function Fr(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[a,o]=e.split("/",2);if(!a||!o)throw new Error(`Invalid identifier format: ${r}`);return[a,o,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class RP extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function _e(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}n=await r.text();const a=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;throw r.status===409?new RP(a):new Error(a)}var _w="[...]",NP={result:"[Circular]"},cl=[],ss=[];function $P(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function tn(r,e,t,n){var u;try{return JSON.stringify(r,e,t)}catch(c){if(!((u=c.message)!=null&&u.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof n>"u"&&(n=$P()),Ch(r,"",0,[],void 0,0,n);var a;try{ss.length===0?a=JSON.stringify(r,e,t):a=JSON.stringify(r,jP(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;cl.length!==0;){var o=cl.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return a}}function Gf(r,e,t,n){var a=Object.getOwnPropertyDescriptor(n,t);a.get!==void 0?a.configurable?(Object.defineProperty(n,t,{value:r}),cl.push([n,t,e,a])):ss.push([e,t,r]):(n[t]=r,cl.push([n,t,e]))}function Ch(r,e,t,n,a,o,u){o+=1;var c;if(typeof r=="object"&&r!==null){for(c=0;c<n.length;c++)if(n[c]===r){Gf(NP,r,e,a);return}if(typeof u.depthLimit<"u"&&o>u.depthLimit){Gf(_w,r,e,a);return}if(typeof u.edgesLimit<"u"&&t+1>u.edgesLimit){Gf(_w,r,e,a);return}if(n.push(r),Array.isArray(r))for(c=0;c<r.length;c++)Ch(r[c],c,c,n,r,o,u);else{var f=Object.keys(r);for(c=0;c<f.length;c++){var h=f[c];Ch(r[h],h,c,n,r,o,u)}}n.pop()}}function jP(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(ss.length>0)for(var n=0;n<ss.length;n++){var a=ss[n];if(a[1]===e&&a[0]===t){t=a[2],ss.splice(n,1);break}}return r.call(this,e,t)}}function ww(r){const e=Ab(),t=GP(),n=r.extra??{},a=n.metadata;return r.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...a}},r}const LP=()=>{const r=Br("TRACING_SAMPLING_RATE");if(r===void 0)return;const e=parseFloat(r);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},MP=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function FP(r){const e=[];for await(const t of r)e.push(t);return e}function Jf(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const DP=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};class UP{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(o=>{t=o}),a=tn(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:n,size:a}),this.sizeBytes+=a,n}pop(e){var a;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(((a=this.peek())==null?void 0:a.size)??0)<e&&this.items.length>0;){const o=this.items.shift();o&&(t.push(o),n+=o.size,this.sizeBytes-=o.size)}if(t.length===0&&this.items.length>0){const o=this.items.shift();t.push(o),n+=o.size,this.sizeBytes-=o.size}return[t.map(o=>({action:o.action,item:o.payload})),()=>t.forEach(o=>o.itemPromiseResolve())]}}const zP=20971520,BP=2500;class to{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new UP}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:ga("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=to.getDefaultClientConfig();if(this.tracingSampleRate=LP(),this.apiUrl=Jf(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Jf(e.apiKey??t.apiKey),this.webUrl=Jf(e.webUrl??t.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new S_(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new S_({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:DP}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Br("API_KEY"),t=Br("ENDPOINT")??"https://api.smith.langchain.com",n=Br("HIDE_INPUTS")==="true",a=Br("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:MP(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${Tb}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",a=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(ue(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(o,`Failed to fetch ${e}`),o}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let a=Number(t.get("offset"))||0;const o=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(o));const u=`${this.apiUrl}${e}?${t}`,c=await this.caller.call(ue(),u,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(c,`Failed to fetch ${e}`);const f=n?n(await c.json()):await c.json();if(f.length===0||(yield f,f.length<o))break;a+=f.length}}async*_getCursorPaginatedList(e,t=null,n="POST",a="runs"){const o=t?{...t}:{};for(;;){const c=await(await this.caller.call(ue(),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(o)})).json();if(!c||!c[a])break;yield c[a];const f=c.cursors;if(!f||!f.next)break;o.cursor=f.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const a of e)this.filteredPostUuids.has(a.id)?this.filteredPostUuids.delete(a.id):n.push(a);return n}else{const n=[];for(const a of e)a.id!==a.trace_id&&!this.filteredPostUuids.has(a.trace_id)||Math.random()<this.tracingSampleRate?n.push(a):this.filteredPostUuids.add(a.id);return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??zP}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,a]=this.autoBatchQueue.pop(e);if(!n.length){a();break}const o=this._processBatch(n,a).catch(console.error);t.push(o)}return Promise.all(t)}async _processBatch(e,t){var n;if(!e.length){t();return}try{const a={runCreates:e.filter(u=>u.action==="create").map(u=>u.item),runUpdates:e.filter(u=>u.action==="update").map(u=>u.item)},o=await this._ensureServerInfo();(n=o==null?void 0:o.batch_ingest_config)!=null&&n.use_multipart_endpoint?await this.multipartIngestRuns(a):await this.batchIngestRuns(a)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=ww(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await ue()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(BP),...this.fetchOptions});return await _e(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const a=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){this.processRunOperation({action:"create",item:a}).catch(console.error);return}const o=ww(a),u=await this.caller.call(ue(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:tn(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(u,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let n=(e==null?void 0:e.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[],a=(t==null?void 0:t.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[];if(n.length>0&&a.length>0){const c=n.reduce((h,m)=>(m.id&&(h[m.id]=m),h),{}),f=[];for(const h of a)h.id!==void 0&&c[h.id]?c[h.id]={...c[h.id],...h}:f.push(h);n=Object.values(c),a=f}const o={post:this._filterForSampling(n),patch:this._filterForSampling(a,!0)};if(!o.post.length&&!o.patch.length)return;const u={post:[],patch:[]};for(const c of["post","patch"]){const f=c,h=o[f].reverse();let m=h.pop();for(;m!==void 0;)u[f].push(m),m=h.pop()}(u.post.length>0||u.patch.length>0)&&await this._postBatchIngestRuns(tn(u))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(ue(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const n={};let a=[];for(const m of e??[]){const y=this.prepareRunCreateOrUpdateInputs(m);y.id!==void 0&&y.attachments!==void 0&&(n[y.id]=y.attachments),delete y.attachments,a.push(y)}let o=[];for(const m of t??[])o.push(this.prepareRunCreateOrUpdateInputs(m));if(a.find(m=>m.trace_id===void 0||m.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(o.find(m=>m.trace_id===void 0||m.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&o.length>0){const m=a.reduce((_,b)=>(b.id&&(_[b.id]=b),_),{}),y=[];for(const _ of o)_.id!==void 0&&m[_.id]?m[_.id]={...m[_.id],..._}:y.push(_);a=Object.values(m),o=y}if(a.length===0&&o.length===0)return;const f=[],h=[];for(const[m,y]of[["post",a],["patch",o]])for(const _ of y){const{inputs:b,outputs:w,events:S,attachments:E,...P}=_,C={inputs:b,outputs:w,events:S},T=tn(P);h.push({name:`${m}.${P.id}`,payload:new Blob([T],{type:`application/json; length=${T.length}`})});for(const[M,j]of Object.entries(C)){if(j===void 0)continue;const D=tn(j);h.push({name:`${m}.${P.id}.${M}`,payload:new Blob([D],{type:`application/json; length=${D.length}`})})}if(P.id!==void 0){const M=n[P.id];if(M){delete n[P.id];for(const[j,D]of Object.entries(M)){let V,q;if(Array.isArray(D)?[V,q]=D:(V=D.mimeType,q=D.data),j.includes(".")){console.warn(`Skipping attachment '${j}' for run ${P.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}h.push({name:`attachment.${P.id}.${j}`,payload:new Blob([q],{type:`${V}; length=${q.byteLength}`})})}}}f.push(`trace=${P.trace_id},id=${P.id}`)}await this._sendMultipartRequest(h,f.join("; "))}async _sendMultipartRequest(e,t){try{const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=[];for(const f of e)a.push(new Blob([`--${n}\r
`])),a.push(new Blob([`Content-Disposition: form-data; name="${f.name}"\r
`,`Content-Type: ${f.payload.type}\r
\r
`])),a.push(f.payload),a.push(new Blob([`\r
`]));a.push(new Blob([`--${n}--\r
`]));const u=await new Blob(a).arrayBuffer(),c=await this.batchIngestCaller.call(ue(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(c,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${t}`)}}async updateRun(e,t){Ee(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const a={...this.headers,"Content-Type":"application/json"},o=await this.caller.call(ue(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:tn(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(o,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){Ee(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let a;t.session_id?a=t.session_id:n!=null&&n.projectName?a=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?a=n==null?void 0:n.projectId:a=(await this.readProject({projectName:Br("PROJECT")||"default"})).id;const o=await this._getTenantId();return`${this.getHostUrl()}/o/${o}/projects/p/${a}/r/${t.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await FP(this.listRuns({id:e.child_run_ids})),n={},a={};t.sort((o,u)=>((o==null?void 0:o.dotted_order)??"").localeCompare((u==null?void 0:u.dotted_order)??""));for(const o of t){if(o.parent_run_id===null||o.parent_run_id===void 0)throw new Error(`Child run ${o.id} has no parent`);o.parent_run_id in n||(n[o.parent_run_id]=[]),n[o.parent_run_id].push(o),a[o.id]=o}e.child_runs=n[e.id]||[];for(const o in n)o!==e.id&&(a[o].child_runs=n[o]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:a,traceId:o,referenceExampleId:u,startTime:c,executionOrder:f,isRoot:h,runType:m,error:y,id:_,query:b,filter:w,traceFilter:S,treeFilter:E,limit:P,select:C}=e;let T=[];if(t&&(T=Array.isArray(t)?t:[t]),n){const V=Array.isArray(n)?n:[n],q=await Promise.all(V.map(me=>this.readProject({projectName:me}).then(ve=>ve.id)));T.push(...q)}const M=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],j={session:T.length?T:null,run_type:m,reference_example:u,query:b,filter:w,trace_filter:S,tree_filter:E,execution_order:f,parent_run:a,start_time:c?c.toISOString():null,error:y,id:_,limit:P,trace:o,select:C||M,is_root:h};let D=0;for await(const V of this._getCursorPaginatedList("/runs/query",j))if(P){if(D>=P)break;if(V.length+D>P){yield*V.slice(0,P-D);break}D+=V.length,yield*V}else yield*V}async getRunStats({id:e,trace:t,parentRun:n,runType:a,projectNames:o,projectIds:u,referenceExampleIds:c,startTime:f,endTime:h,error:m,query:y,filter:_,traceFilter:b,treeFilter:w,isRoot:S,dataSourceType:E}){let P=u||[];o&&(P=[...u||[],...await Promise.all(o.map(D=>this.readProject({projectName:D}).then(V=>V.id)))]);const T=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:a,session:P,reference_example:c,start_time:f,end_time:h,error:m,query:y,filter:_,trace_filter:b,tree_filter:w,is_root:S,data_source_type:E}).filter(([D,V])=>V!==void 0));return await(await this.caller.call(ue(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(T),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||Zt()};Ee(e);const o=await(await this.caller.call(ue(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(o===null||!("share_token"in o))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${o.share_token}/r`}async unshareRun(e){Ee(e);const t=await this.caller.call(ue(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(t,"unshare run",!0)}async readRunSharedLink(e){Ee(e);const n=await(await this.caller.call(ue(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const u of t)n.append("id",u);return Ee(e),await(await this.caller.call(ue(),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),Ee(e);const a=await(await this.caller.call(ue(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};Ee(e);const o=await(await this.caller.call(ue(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return o.url=`${this.getHostUrl()}/public/${o.share_token}/d`,o}async unshareDataset(e){Ee(e);const t=await this.caller.call(ue(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(t,"unshare dataset",!0)}async readSharedDataset(e){return Ee(e),await(await this.caller.call(ue(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const a=new URLSearchParams;Object.entries(n).forEach(([c,f])=>{Array.isArray(f)?f.forEach(h=>a.append(c,h)):a.append(c,f)});const o=await this.caller.call(ue(),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),u=await o.json();if(!o.ok)throw"detail"in u?new Error(`Failed to list shared examples.
Status: ${o.status}
Message: ${u.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${o.status} ${o.statusText}`);return u.map(c=>({...c,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:a=!1,projectExtra:o=null,referenceDatasetId:u=null}){const c=a?"?upsert=true":"",f=`${this.apiUrl}/sessions${c}`,h=o||{};n&&(h.metadata=n);const m={name:e,extra:h,description:t};u!==null&&(m.reference_dataset_id=u);const y=await this.caller.call(ue(),f,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(y,"create project"),await y.json()}async updateProject(e,{name:t=null,description:n=null,metadata:a=null,projectExtra:o=null,endTime:u=null}){const c=`${this.apiUrl}/sessions/${e}`;let f=o;a&&(f={...f||{},metadata:a});const h={name:t,extra:f,description:n,end_time:u?new Date(u).toISOString():null},m=await this.caller.call(ue(),c,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(m,"update project"),await m.json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");const o=await this.caller.call(ue(),`${this.apiUrl}${n}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const u=await o.json();return o.ok?Array.isArray(u)?u.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let a="/sessions";const o=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),a+=`/${e}`;else if(t!==void 0)o.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&o.append("include_stats",n.toString());const u=await this._get(a,o);let c;if(Array.isArray(u)){if(u.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);c=u[0]}else c=u;return c}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:a,referenceDatasetName:o,referenceFree:u,metadata:c}={}){const f=new URLSearchParams;if(e!==void 0)for(const h of e)f.append("id",h);if(t!==void 0&&f.append("name",t),n!==void 0&&f.append("name_contains",n),a!==void 0)f.append("reference_dataset",a);else if(o!==void 0){const h=await this.readDataset({datasetName:o});f.append("reference_dataset",h.id)}u!==void 0&&f.append("reference_free",u.toString()),c!==void 0&&f.append("metadata",JSON.stringify(c));for await(const h of this._getPaginated("/sessions",f))yield*h}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,Ee(n);const a=await this.caller.call(ue(),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(a,`delete session ${n} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:a,description:o,dataType:u,name:c}){const f=`${this.apiUrl}/datasets/upload`,h=new FormData;h.append("file",e,t),n.forEach(_=>{h.append("input_keys",_)}),a.forEach(_=>{h.append("output_keys",_)}),o&&h.append("description",o),u&&h.append("data_type",u),c&&h.append("name",c);const m=await this.caller.call(ue(),f,{method:"POST",headers:this.headers,body:h,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(m,"upload CSV"),await m.json()}async createDataset(e,{description:t,dataType:n,inputsSchema:a,outputsSchema:o,metadata:u}={}){const c={name:e,description:t,extra:u?{metadata:u}:void 0};n&&(c.data_type=n),a&&(c.inputs_schema_definition=a),o&&(c.outputs_schema_definition=o);const f=await this.caller.call(ue(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(f,"create dataset"),await f.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const a=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide datasetName or datasetId");const o=await this._get(n,a);let u;if(Array.isArray(o)){if(o.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);u=o[0]}else u=o;return u}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:a}){let o=e;if(o===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:t})).id);const u=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return await this._get(`/datasets/${o}/versions/diff`,u)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(c=>JSON.parse(c))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:a,datasetNameContains:o,metadata:u}={}){const c="/datasets",f=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const h of n)f.append("id",h);a!==void 0&&f.append("name",a),o!==void 0&&f.append("name_contains",o),u!==void 0&&f.append("metadata",JSON.stringify(u));for await(const h of this._getPaginated(c,f))yield*h}async updateDataset(e){const{datasetId:t,datasetName:n,...a}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const o=t??(await this.readDataset({datasetName:n})).id;Ee(o);const u=await this.caller.call(ue(),`${this.apiUrl}/datasets/${o}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(u,"update dataset"),await u.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:a,tag:o}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const u=t??(await this.readDataset({datasetName:n})).id;Ee(u);const c=await this.caller.call(ue(),`${this.apiUrl}/datasets/${u}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof a=="string"?a:a.toISOString(),tag:o}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(c,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",a=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(a=(await this.readDataset({datasetName:t})).id),a!==void 0)Ee(a),n+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");const o=await this.caller.call(ue(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(o,`delete ${n}`),await o.json()}async indexDataset({datasetId:e,datasetName:t,tag:n}){let a=e;if(!a&&!t)throw new Error("Must provide either datasetName or datasetId");if(a&&t)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:t})).id),Ee(a);const o={tag:n},u=await this.caller.call(ue(),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(u,"index dataset"),await u.json()}async similarExamples(e,t,n,{filter:a}={}){const o={limit:n,inputs:e};a!==void 0&&(o.filter=a),Ee(t);const u=await this.caller.call(ue(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(u,"fetch similar examples"),(await u.json()).examples}async createExample(e,t,{datasetId:n,datasetName:a,createdAt:o,exampleId:u,metadata:c,split:f,sourceRunId:h}){let m=n;if(m===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(m!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");m===void 0&&(m=(await this.readDataset({datasetName:a})).id);const y=o||new Date,_={dataset_id:m,inputs:e,outputs:t,created_at:y==null?void 0:y.toISOString(),id:u,metadata:c,split:f,source_run_id:h},b=await this.caller.call(ue(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(_),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(b,"create example"),await b.json()}async createExamples(e){const{inputs:t,outputs:n,metadata:a,sourceRunIds:o,exampleIds:u,datasetId:c,datasetName:f}=e;let h=c;if(h===void 0&&f===void 0)throw new Error("Must provide either datasetName or datasetId");if(h!==void 0&&f!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");h===void 0&&(h=(await this.readDataset({datasetName:f})).id);const m=t.map((b,w)=>({dataset_id:h,inputs:b,outputs:n?n[w]:void 0,metadata:a?a[w]:void 0,split:e.splits?e.splits[w]:void 0,id:u?u[w]:void 0,source_run_id:o?o[w]:void 0})),y=await this.caller.call(ue(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(y,"create examples"),await y.json()}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const a=e.map(u=>k_(u)?P_(u):u),o=k_(t)?P_(t):t;return this.createExample({input:a},{output:o},n)}async readExample(e){Ee(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:a,...o}=n,u=o;return a&&(u.attachments=Object.entries(a).reduce((c,[f,h])=>(c[f.slice(11)]={presigned_url:h.presigned_url,mime_type:h.mime_type},c),{})),u}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:a,splits:o,inlineS3Urls:u,metadata:c,limit:f,offset:h,filter:m,includeAttachments:y}={}){let _;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)_=e;else if(t!==void 0)_=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const b=new URLSearchParams({dataset:_}),w=a?typeof a=="string"?a:a==null?void 0:a.toISOString():void 0;w&&b.append("as_of",w);const S=u??!0;if(b.append("inline_s3_urls",S.toString()),n!==void 0)for(const P of n)b.append("id",P);if(o!==void 0)for(const P of o)b.append("splits",P);if(c!==void 0){const P=JSON.stringify(c);b.append("metadata",P)}f!==void 0&&b.append("limit",f.toString()),h!==void 0&&b.append("offset",h.toString()),m!==void 0&&b.append("filter",m),y===!0&&["attachment_urls","outputs","metadata"].forEach(P=>b.append("select",P));let E=0;for await(const P of this._getPaginated("/examples",b)){for(const C of P){const{attachment_urls:T,...M}=C,j=M;T&&(j.attachments=Object.entries(T).reduce((D,[V,q])=>(D[V.slice(11)]={presigned_url:q.presigned_url,mime_type:q.mime_type||void 0},D),{})),yield j,E++}if(f!==void 0&&E>=f)break}}async deleteExample(e){Ee(e);const t=`/examples/${e}`,n=await this.caller.call(ue(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(n,`delete ${t}`),await n.json()}async updateExample(e,t){Ee(e);const n=await this.caller.call(ue(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(n,"update example"),await n.json()}async updateExamples(e){const t=await this.caller.call(ue(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(t,"update examples"),await t.json()}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:a}){let o;if(e?o=e:o=(await this.readDataset({datasetName:t})).id,Ee(o),n&&a||!n&&!a)throw new Error("Exactly one of asOf and tag must be specified.");const u=new URLSearchParams;n!==void 0&&u.append("as_of",typeof n=="string"?n:n.toISOString()),a!==void 0&&u.append("tag",a);const c=await this.caller.call(ue(),`${this.apiUrl}/datasets/${o}/version?${u.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(c,"read dataset version"),await c.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,Ee(a);const o=new URLSearchParams,u=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return u&&o.append("as_of",u),await this._get(`/datasets/${a}/splits`,o)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:a,remove:o=!1}){let u;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?u=(await this.readDataset({datasetName:t})).id:u=e,Ee(u);const c={split_name:n,examples:a.map(h=>(Ee(h),h)),remove:o},f=await this.caller.call(ue(),`${this.apiUrl}/datasets/${u}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(f,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:a,referenceExample:o}={loadChildRuns:!1}){Sb("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let u;if(typeof e=="string")u=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)u=e;else throw new Error(`Invalid run type: ${typeof e}`);u.reference_example_id!==null&&u.reference_example_id!==void 0&&(o=await this.readExample(u.reference_example_id));const c=await t.evaluateRun(u,o),[f,h]=await this._logEvaluationFeedback(c,u,n);return h[0]}async createFeedback(e,t,{score:n,value:a,correction:o,comment:u,sourceInfo:c,feedbackSourceType:f="api",sourceRunId:h,feedbackId:m,feedbackConfig:y,projectId:_,comparativeExperimentId:b}){var C;if(!e&&!_)throw new Error("One of runId or projectId must be provided");if(e&&_)throw new Error("Only one of runId or projectId can be provided");const w={type:f??"api",metadata:c??{}};h!==void 0&&(w==null?void 0:w.metadata)!==void 0&&!w.metadata.__run&&(w.metadata.__run={run_id:h}),(w==null?void 0:w.metadata)!==void 0&&((C=w.metadata.__run)==null?void 0:C.run_id)!==void 0&&Ee(w.metadata.__run.run_id);const S={id:m??Zt(),run_id:e,key:t,score:n,value:a,correction:o,comment:u,feedback_source:w,comparative_experiment_id:b,feedbackConfig:y,session_id:_},E=`${this.apiUrl}/feedback`,P=await this.caller.call(ue(),E,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(S),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(P,"create feedback",!0),S}async updateFeedback(e,{score:t,value:n,correction:a,comment:o}){const u={};t!=null&&(u.score=t),n!=null&&(u.value=n),a!=null&&(u.correction=a),o!=null&&(u.comment=o),Ee(e);const c=await this.caller.call(ue(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(c,"update feedback",!0)}async readFeedback(e){Ee(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Ee(e);const t=`/feedback/${e}`,n=await this.caller.call(ue(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(n,`delete ${t}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(const o of t)a.append("key",o);if(n)for(const o of n)a.append("source",o);for await(const o of this._getPaginated("/feedback",a))yield*o}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:a}={}){const o={run_id:e,feedback_key:t,feedback_config:a};return n?typeof n=="string"?o.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(o.expires_in=n):o.expires_in={hours:3},await(await this.caller.call(ue(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:a,description:o,metadata:u,id:c}){var m;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const f={id:c,name:e,experiment_ids:t,reference_dataset_id:n,description:o,created_at:(m=a??new Date)==null?void 0:m.toISOString(),extra:{}};return u&&(f.extra.metadata=u),await(await this.caller.call(ue(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Ee(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,n){const a=this._selectEvalResults(e),o=[];for(const u of a){let c=n||{};u.evaluatorInfo&&(c={...u.evaluatorInfo,...c});let f=null;u.targetRunId?f=u.targetRunId:t&&(f=t.id),o.push(await this.createFeedback(f,u.key,{score:u.score,value:u.value,comment:u.comment,correction:u.correction,sourceInfo:c,sourceRunId:u.sourceRunId,feedbackConfig:u.feedbackConfig,feedbackSourceType:"model"}))}return[a,o]}async logEvaluationFeedback(e,t,n){const[a]=await this._logEvaluationFeedback(e,t,n);return a}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:a,limit:o}=e,u=new URLSearchParams;t&&t.forEach((f,h)=>{Ee(f,`queueIds[${h}]`),u.append("ids",f)}),n&&u.append("name",n),a&&u.append("name_contains",a),u.append("limit",(o!==void 0?Math.min(o,100):100).toString());let c=0;for await(const f of this._getPaginated("/annotation-queues",u))if(yield*f,c++,o!==void 0&&c>=o)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:a}=e,o={name:t,description:n,id:a||Zt()},u=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(o).filter(([f,h])=>h!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(u,"create annotation queue"),await u.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:n,description:a}=t,o=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(o,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((a,o)=>Ee(a,`runIds[${o}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${Ee(e,"queueId")}/run`,a=await this.caller.call(ue(),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(a,"get run from annotation queue"),await a.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs/${Ee(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(ue(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const a=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),o=new Error(`Error ${t.status}: ${t.statusText}
${a}`);throw o.statusCode=t.status,o}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,a,o]=Fr(e),u=await this.caller.call(ue(),`${this.apiUrl}/likes/${n}/${a}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(u,`${t?"like":"unlike"} prompt`),await u.json()}async _getPromptUrl(e){const[t,n,a]=Fr(e);if(await this._currentTenantIsOwner(t)){const o=await this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${n}/${a.substring(0,8)}?organizationId=${o.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${o.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,a=>a.repos))yield*n}async getPrompt(e){const[t,n,a]=Fr(e),o=await this.caller.call(ue(),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(o.status===404)return null;await _e(o,"get prompt");const u=await o.json();return u.repo?u.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[a,o,u]=Fr(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);const c={repo_handle:o,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},f=await this.caller.call(ue(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(f,"create prompt");const{repo:h}=await f.json();return h}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[a,o,u]=Fr(e),c=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${a}/${o}`):n==null?void 0:n.parentCommitHash,f={manifest:JSON.parse(JSON.stringify(t)),parent_commit:c},h=await this.caller.call(ue(),`${this.apiUrl}/commits/${a}/${o}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(h,"create commit");const m=await h.json();return this._getPromptUrl(`${a}/${o}${m.commit_hash?`:${m.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const n=new FormData;for(const u of t){const c=u.id,f={...u.metadata&&{metadata:u.metadata},...u.split&&{split:u.split}},h=tn(f),m=new Blob([h],{type:"application/json"});if(n.append(c,m),u.inputs){const y=tn(u.inputs),_=new Blob([y],{type:"application/json"});n.append(`${c}.inputs`,_)}if(u.outputs){const y=tn(u.outputs),_=new Blob([y],{type:"application/json"});n.append(`${c}.outputs`,_)}if(u.attachments)for(const[y,_]of Object.entries(u.attachments)){let b,w;Array.isArray(_)?[b,w]=_:(b=_.mimeType,w=_.data);const S=new Blob([w],{type:`${b}; length=${w.byteLength}`});n.append(`${c}.attachment.${y}`,S)}if(u.attachments_operations){const y=tn(u.attachments_operations),_=new Blob([y],{type:"application/json"});n.append(`${c}.attachments_operations`,_)}}return await(await this.caller.call(ue(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const n=new FormData;for(const u of t){const c=(u.id??Zt()).toString(),f={created_at:u.created_at,...u.metadata&&{metadata:u.metadata},...u.split&&{split:u.split}},h=tn(f),m=new Blob([h],{type:"application/json"});n.append(c,m);const y=tn(u.inputs),_=new Blob([y],{type:"application/json"});if(n.append(`${c}.inputs`,_),u.outputs){const b=tn(u.outputs),w=new Blob([b],{type:"application/json"});n.append(`${c}.outputs`,w)}if(u.attachments)for(const[b,w]of Object.entries(u.attachments)){let S,E;Array.isArray(w)?[S,E]=w:(S=w.mimeType,E=w.data);const P=new Blob([E],{type:`${S}; length=${E.byteLength}`});n.append(`${c}.attachment.${b}`,P)}}return await(await this.caller.call(ue(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,a]=Fr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const o={};if((t==null?void 0:t.description)!==void 0&&(o.description=t.description),(t==null?void 0:t.readme)!==void 0&&(o.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(o.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(o.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(o.is_archived=t.isArchived),Object.keys(o).length===0)throw new Error("No valid update options provided");const u=await this.caller.call(ue(),`${this.apiUrl}/repos/${n}/${a}`,{method:"PATCH",body:JSON.stringify(o),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _e(u,"update prompt"),u.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,a]=Fr(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(ue(),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[n,a,o]=Fr(e),u=await this.caller.call(ue(),`${this.apiUrl}/commits/${n}/${a}/${o}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _e(u,"pull prompt commit");const c=await u.json();return{owner:n,repo:a,commit_hash:c.commit_hash,manifest:c.manifest,examples:c.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(a=>a!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:a}=t,[o,u]=this.parseTokenOrUrl(e,n),c=new to({apiUrl:o,apiKey:"placeholder"}),f=await c.readSharedDataset(u),h=a||f.name;try{if(await this.hasDataset({datasetId:h})){console.log(`Dataset ${h} already exists in your tenant. Skipping.`);return}}catch{}const m=await c.listSharedExamples(u),y=await this.createDataset(h,{description:f.description,dataType:f.data_type||"kv",inputsSchema:f.inputs_schema_definition??void 0,outputsSchema:f.outputs_schema_definition??void 0});try{await this.createExamples({inputs:m.map(_=>_.inputs),outputs:m.flatMap(_=>_.outputs?[_.outputs]:[]),datasetId:y.id})}catch(_){throw console.error(`An error occurred while creating dataset ${h}. You should delete it manually.`),_}}parseTokenOrUrl(e,t,n=2,a="dataset"){try{return Ee(e),[t,e]}catch{}try{const u=new URL(e).pathname.split("/").filter(c=>c!=="");if(u.length>=n){const c=u[u.length-n];return[t,c]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch{throw new Error(`Invalid public ${a} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}const Tb="0.3.1";var Ri={};let lr;const VP=()=>typeof window<"u"&&typeof window.document<"u",HP=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",qP=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Cb=()=>typeof Deno<"u",ZP=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Cb(),WP=()=>lr||(VP()?lr="browser":ZP()?lr="node":HP()?lr="webworker":qP()?lr="jsdom":Cb()?lr="deno":lr="other",lr);let Kf;function Ab(){if(Kf===void 0){const r=WP(),e=KP();Kf={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:Tb,...e}}return Kf}function GP(){const r=JP()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,a]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof a=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[n]=a);return e}function JP(){try{return typeof process<"u"&&Ri?Object.entries(Ri).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function ga(r){try{return typeof process<"u"?Ri==null?void 0:Ri[r]:void 0}catch{return}}function Br(r){return ga(`LANGSMITH_${r}`)||ga(`LANGCHAIN_${r}`)}let Qf;function KP(){if(Qf!==void 0)return Qf;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=ga(t);n!==void 0&&(e[t]=n)}return Qf=e,e}const QP=r=>!!["TRACING_V2","TRACING"].find(t=>Br(t)==="true"),Xf=Symbol.for("lc:context_variables");function XP(r){return r.replace(/[-:.]/g,"")}function YP(r,e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return XP(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}class dl{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let n={},a=[];for(const o of t){const[u,c]=o.split("="),f=decodeURIComponent(c);u==="langsmith-metadata"?n=JSON.parse(f):u==="langsmith-tags"&&(a=f.split(","))}return new dl(n,a)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class rn{constructor(e){var c;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Ib(e)){Object.assign(this,{...e});return}const t=rn.getDefaultConfig(),{metadata:n,...a}=e,o=a.client??rn.getSharedClient(),u={...n,...(c=a==null?void 0:a.extra)==null?void 0:c.metadata};if(a.extra={...a.extra,metadata:u},Object.assign(this,{...t,...a,client:o}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const f=YP(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+f:this.dotted_order=f}}static getDefaultConfig(){return{id:Zt(),run_type:"chain",project_name:Br("PROJECT")??ga("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:ga("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:ga("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return rn.sharedClient||(rn.sharedClient=new to),rn.sharedClient}createChild(e){var f,h,m,y,_,b;const t=this.child_execution_order+1,n=new rn({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});Xf in this&&(n[Xf]=this[Xf]);const a=Symbol.for("lc:child_config"),o=((f=e.extra)==null?void 0:f[a])??this.extra[a];if(tO(o)){const w={...o},S=eO(w.callbacks)?(m=(h=w.callbacks).copy)==null?void 0:m.call(h):void 0;S&&(Object.assign(S,{_parentRunId:n.id}),(b=(_=(y=S.handlers)==null?void 0:y.find(Rb))==null?void 0:_.updateFromRunTree)==null||b.call(_,n),w.callbacks=S),n.extra[a]=w}const u=new Set;let c=this;for(;c!=null&&!u.has(c.id);)u.add(c.id),c.child_execution_order=Math.max(c.child_execution_order,t),c=c.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,t,n=!0){var f;const a=e.extra??{};if(a.runtime||(a.runtime={}),t)for(const[h,m]of Object.entries(t))a.runtime[h]||(a.runtime[h]=m);let o,u;return n?(u=(f=e.parent_run)==null?void 0:f.id,o=[]):(o=e.child_runs.map(h=>this._convertToCreate(h,t,n)),u=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:o,parent_run_id:u,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=Ab(),n=await this._convertToCreate(this,t,!0);if(await this.client.createRun(n),!e){Sb("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const a of this.child_runs)await a.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){var h,m,y,_;const n=e==null?void 0:e.callbacks;let a,o,u,c=QP();if(n){const b=((h=n==null?void 0:n.getParentRunId)==null?void 0:h.call(n))??"",w=(m=n==null?void 0:n.handlers)==null?void 0:m.find(S=>(S==null?void 0:S.name)=="langchain_tracer");a=(y=w==null?void 0:w.getRun)==null?void 0:y.call(w,b),o=w==null?void 0:w.projectName,u=w==null?void 0:w.client,c=c||!!w}return a?new rn({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:u,tracingEnabled:c,project_name:o,tags:[...new Set(((a==null?void 0:a.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(_=a==null?void 0:a.extra)==null?void 0:_.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new rn({...t,client:u,tracingEnabled:c,project_name:o})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var h;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=n["langsmith-trace"];if(!a||typeof a!="string")return;const o=a.trim(),u=o.split(".").map(m=>{const[y,_]=m.split("Z");return{strTime:y,time:Date.parse(y+"Z"),uuid:_}}),c=u[0].uuid,f={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(h=u.at(-1))==null?void 0:h.uuid,trace_id:c,dotted_order:o};if(n.baggage&&typeof n.baggage=="string"){const m=dl.fromHeader(n.baggage);f.metadata=m.metadata,f.tags=m.tags}return new rn(f)}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new dl((n=this.extra)==null?void 0:n.metadata,this.tags).toHeader()};if(e)for(const[a,o]of Object.entries(t))e.set(a,o);return t}}Object.defineProperty(rn,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function Ib(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function Rb(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function vw(r){return Array.isArray(r)&&r.some(e=>Rb(e))}function eO(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function tO(r){var e;return r!==void 0&&typeof r.callbacks=="object"&&(vw((e=r.callbacks)==null?void 0:e.handlers)||vw(r.callbacks))}let nO=class{getStore(){}run(e,t){return t()}};const Yf=Symbol.for("ls:tracing_async_local_storage"),rO=new nO;let aO=class{getInstance(){return globalThis[Yf]??rO}initializeGlobalInstance(e){globalThis[Yf]===void 0&&(globalThis[Yf]=e)}};const sO=new aO,iO=()=>{const r=sO.getInstance().getStore();if(!Ib(r))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return r};function kp(r){return typeof r=="function"&&"langsmith:traceable"in r}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const oO=Object.prototype.hasOwnProperty;function Ah(r,e){return oO.call(r,e)}function Ih(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)Ah(r,t)&&e.push(t);return e}function Qn(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Rh(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Ya(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function uO(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function Nh(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Nh(r[t]))return!0}else if(typeof r=="object"){const t=Ih(r),n=t.length;for(var e=0;e<n;e++)if(Nh(r[t[e]]))return!0}}return!1}function bw(r,e){const t=[r];for(const n in e){const a=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof a<"u"&&t.push(`${n}: ${a}`)}return t.join(`
`)}class lO extends Error{constructor(e,t,n,a,o){super(bw(e,{name:t,index:n,operation:a,tree:o})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.setPrototypeOf(this,new.target.prototype),this.message=bw(e,{name:t,index:n,operation:a,tree:o})}}const nt=lO,is={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=$h(t,this.path);n&&(n=Qn(n));const a=Ni(t,{op:"remove",path:this.from}).removed;return Ni(t,{op:"add",path:this.path,value:a}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=$h(t,this.from);return Ni(t,{op:"add",path:this.path,value:Qn(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:hl(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var cO={add:function(r,e,t){return Rh(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:is.move,copy:is.copy,test:is.test,_get:is._get};function $h(r,e){if(e=="")return r;var t={op:"_get",path:e};return Ni(r,t),t.value}function Ni(r,e,t=!1,n=!0,a=!0,o=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):jh(e,0)),e.path===""){let u={newDocument:r};if(e.op==="add")return u.newDocument=e.value,u;if(e.op==="replace")return u.newDocument=e.value,u.removed=r,u;if(e.op==="move"||e.op==="copy")return u.newDocument=$h(r,e.from),e.op==="move"&&(u.removed=r),u;if(e.op==="test"){if(u.test=hl(r,e.value),u.test===!1)throw new nt("Test operation failed","TEST_OPERATION_FAILED",o,e,r);return u.newDocument=r,u}else{if(e.op==="remove")return u.removed=r,u.newDocument=null,u;if(e.op==="_get")return e.value=r,u;if(t)throw new nt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,r);return u}}else{n||(r=Qn(r));const c=(e.path||"").split("/");let f=r,h=1,m=c.length,y,_,b;for(typeof t=="function"?b=t:b=jh;;){if(_=c[h],_&&_.indexOf("~")!=-1&&(_=uO(_)),a&&(_=="__proto__"||_=="prototype"&&h>0&&c[h-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&y===void 0&&(f[_]===void 0?y=c.slice(0,h).join("/"):h==m-1&&(y=e.path),y!==void 0&&b(e,0,r,y)),h++,Array.isArray(f)){if(_==="-")_=f.length;else{if(t&&!Rh(_))throw new nt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,r);Rh(_)&&(_=~~_)}if(h>=m){if(t&&e.op==="add"&&_>f.length)throw new nt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,r);const w=cO[e.op].call(e,f,_,r);if(w.test===!1)throw new nt("Test operation failed","TEST_OPERATION_FAILED",o,e,r);return w}}else if(h>=m){const w=is[e.op].call(e,f,_,r);if(w.test===!1)throw new nt("Test operation failed","TEST_OPERATION_FAILED",o,e,r);return w}if(f=f[_],t&&h<m&&(!f||typeof f!="object"))throw new nt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,e,r)}}}function fl(r,e,t,n=!0,a=!0){if(t&&!Array.isArray(e))throw new nt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=Qn(r));const o=new Array(e.length);for(let u=0,c=e.length;u<c;u++)o[u]=Ni(r,e[u],t,!0,a,u),r=o[u].newDocument;return o.newDocument=r,o}function jh(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new nt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(is[r.op]){if(typeof r.path!="string")throw new nt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new nt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new nt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new nt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&Nh(r.value))throw new nt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var a=r.path.split("/").length,o=n.split("/").length;if(a!==o+1&&a!==o)throw new nt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new nt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var u={op:"_get",path:r.from,value:void 0},c=dO([u],t);if(c&&c.name==="OPERATION_PATH_UNRESOLVABLE")throw new nt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new nt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function dO(r,e,t){try{if(!Array.isArray(r))throw new nt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)fl(Qn(e),Qn(r),t||!0);else{t=t||jh;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(a){if(a instanceof nt)return a;throw a}}function hl(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),a,o,u;if(t&&n){if(o=r.length,o!=e.length)return!1;for(a=o;a--!==0;)if(!hl(r[a],e[a]))return!1;return!0}if(t!=n)return!1;var c=Object.keys(r);if(o=c.length,o!==Object.keys(e).length)return!1;for(a=o;a--!==0;)if(!e.hasOwnProperty(c[a]))return!1;for(a=o;a--!==0;)if(u=c[a],!hl(r[u],e[u]))return!1;return!0}return r!==r&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function Nb(r,e,t,n,a){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var o=Ih(e),u=Ih(r),c=!1,f=u.length-1;f>=0;f--){var h=u[f],m=r[h];if(Ah(e,h)&&!(e[h]===void 0&&m!==void 0&&Array.isArray(e)===!1)){var y=e[h];typeof m=="object"&&m!=null&&typeof y=="object"&&y!=null&&Array.isArray(m)===Array.isArray(y)?Nb(m,y,t,n+"/"+Ya(h),a):m!==y&&(a&&t.push({op:"test",path:n+"/"+Ya(h),value:Qn(m)}),t.push({op:"replace",path:n+"/"+Ya(h),value:Qn(y)}))}else Array.isArray(r)===Array.isArray(e)?(a&&t.push({op:"test",path:n+"/"+Ya(h),value:Qn(m)}),t.push({op:"remove",path:n+"/"+Ya(h)}),c=!0):(a&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!c&&o.length==u.length))for(var f=0;f<o.length;f++){var h=o[f];!Ah(r,h)&&e[h]!==void 0&&t.push({op:"add",path:n+"/"+Ya(h),value:Qn(e[h])})}}}function fO(r,e,t=!1){var n=[];return Nb(r,e,n,"",t),n}var eh={};const hO=()=>typeof window<"u"&&typeof window.document<"u",pO=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",mO=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Pp=()=>typeof Deno<"u",gO=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Pp(),yO=()=>{let r;return hO()?r="browser":gO()?r="node":pO()?r="webworker":mO()?r="jsdom":Pp()?r="deno":r="other",r};let th;async function _O(){return th===void 0&&(th={library:"langchain-js",runtime:yO()}),th}function Ot(r){try{return typeof process<"u"?eh==null?void 0:eh[r]:Pp()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}class wO{}function vO(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}class po extends wO{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,cb(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Ot("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return wa.prototype.toJSON.call(this)}toJSONNotImplemented(){return wa.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends po{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Zt()}),Object.assign(this,e)}}return new t}}const bO=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function nh(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function EO(r){return r.replace(/[-:.]/g,"")}function SO(r,e,t){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return EO(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}function wi(r){return typeof r._addRunToRunMap=="function"}class mo extends po{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=SO(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){const a=this.runMap.get(n.parent_run_id);a&&(this._addChildRun(a,n),a.child_execution_order=Math.max(a.child_execution_order,n.child_execution_order),n.trace_id=a.trace_id,a.dotted_order!==void 0&&(n.dotted_order=[a.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;return this.runMap.set(n.id,n),n}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,a,o,u,c,f){const h=this._getExecutionOrder(a),m=Date.now(),y=c?{...o,metadata:c}:o,_={id:n,name:f??e.id[e.id.length-1],parent_run_id:a,start_time:m,serialized:e,events:[{name:"start",time:new Date(m).toISOString()}],inputs:{prompts:t},execution_order:h,child_runs:[],child_execution_order:h,run_type:"llm",extra:y??{},tags:u||[]};return this._addRunToRunMap(_)}async handleLLMStart(e,t,n,a,o,u,c,f){var m,y;const h=this.runMap.get(n)??this._createRunForLLMStart(e,t,n,a,o,u,c,f);return await((m=this.onRunCreate)==null?void 0:m.call(this,h)),await((y=this.onLLMStart)==null?void 0:y.call(this,h)),h}_createRunForChatModelStart(e,t,n,a,o,u,c,f){const h=this._getExecutionOrder(a),m=Date.now(),y=c?{...o,metadata:c}:o,_={id:n,name:f??e.id[e.id.length-1],parent_run_id:a,start_time:m,serialized:e,events:[{name:"start",time:new Date(m).toISOString()}],inputs:{messages:t},execution_order:h,child_runs:[],child_execution_order:h,run_type:"llm",extra:y??{},tags:u||[]};return this._addRunToRunMap(_)}async handleChatModelStart(e,t,n,a,o,u,c,f){var m,y;const h=this.runMap.get(n)??this._createRunForChatModelStart(e,t,n,a,o,u,c,f);return await((m=this.onRunCreate)==null?void 0:m.call(this,h)),await((y=this.onLLMStart)==null?void 0:y.call(this,h)),h}async handleLLMEnd(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onLLMEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleLLMError(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onLLMError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}_createRunForChainStart(e,t,n,a,o,u,c,f){const h=this._getExecutionOrder(a),m=Date.now(),y={id:n,name:f??e.id[e.id.length-1],parent_run_id:a,start_time:m,serialized:e,events:[{name:"start",time:new Date(m).toISOString()}],inputs:t,execution_order:h,child_execution_order:h,run_type:c??"chain",child_runs:[],extra:u?{metadata:u}:{},tags:o||[]};return this._addRunToRunMap(y)}async handleChainStart(e,t,n,a,o,u,c,f){var m,y;const h=this.runMap.get(n)??this._createRunForChainStart(e,t,n,a,o,u,c,f);return await((m=this.onRunCreate)==null?void 0:m.call(this,h)),await((y=this.onChainStart)==null?void 0:y.call(this,h)),h}async handleChainEnd(e,t,n,a,o){var c;const u=this.runMap.get(t);if(!u)throw new Error("No chain run to end.");return u.end_time=Date.now(),u.outputs=nh(e,"output"),u.events.push({name:"end",time:new Date(u.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(u.inputs=nh(o.inputs,"input")),await((c=this.onChainEnd)==null?void 0:c.call(this,u)),await this._endTrace(u),u}async handleChainError(e,t,n,a,o){var c;const u=this.runMap.get(t);if(!u)throw new Error("No chain run to end.");return u.end_time=Date.now(),u.error=this.stringifyError(e),u.events.push({name:"error",time:new Date(u.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(u.inputs=nh(o.inputs,"input")),await((c=this.onChainError)==null?void 0:c.call(this,u)),await this._endTrace(u),u}_createRunForToolStart(e,t,n,a,o,u,c){const f=this._getExecutionOrder(a),h=Date.now(),m={id:n,name:c??e.id[e.id.length-1],parent_run_id:a,start_time:h,serialized:e,events:[{name:"start",time:new Date(h).toISOString()}],inputs:{input:t},execution_order:f,child_execution_order:f,run_type:"tool",child_runs:[],extra:u?{metadata:u}:{},tags:o||[]};return this._addRunToRunMap(m)}async handleToolStart(e,t,n,a,o,u,c){var h,m;const f=this.runMap.get(n)??this._createRunForToolStart(e,t,n,a,o,u,c);return await((h=this.onRunCreate)==null?void 0:h.call(this,f)),await((m=this.onToolStart)==null?void 0:m.call(this,f)),f}async handleToolEnd(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var o;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const a=n;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((o=this.onAgentAction)==null?void 0:o.call(this,n))}async handleAgentEnd(e,t){var a;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,n)))}_createRunForRetrieverStart(e,t,n,a,o,u,c){const f=this._getExecutionOrder(a),h=Date.now(),m={id:n,name:c??e.id[e.id.length-1],parent_run_id:a,start_time:h,serialized:e,events:[{name:"start",time:new Date(h).toISOString()}],inputs:{query:t},execution_order:f,child_execution_order:f,run_type:"retriever",child_runs:[],extra:u?{metadata:u}:{},tags:o||[]};return this._addRunToRunMap(m)}async handleRetrieverStart(e,t,n,a,o,u,c){var h,m;const f=this.runMap.get(n)??this._createRunForRetrieverStart(e,t,n,a,o,u,c);return await((h=this.onRunCreate)==null?void 0:h.call(this,f)),await((m=this.onRetrieverStart)==null?void 0:m.call(this,f)),f}async handleRetrieverEnd(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var a;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,n)))}async handleLLMNewToken(e,t,n,a,o,u){var f;const c=this.runMap.get(n);if(!c||(c==null?void 0:c.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return c.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:u==null?void 0:u.chunk}}),await((f=this.onLLMNewToken)==null?void 0:f.call(this,c,e,{chunk:u==null?void 0:u.chunk})),c}}var Ku={exports:{}};Ku.exports;var Ew;function kO(){return Ew||(Ew=1,function(r){const t=(o=0)=>u=>`\x1B[${38+o};5;${u}m`,n=(o=0)=>(u,c,f)=>`\x1B[${38+o};2;${u};${c};${f}m`;function a(){const o=new Map,u={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};u.color.gray=u.color.blackBright,u.bgColor.bgGray=u.bgColor.bgBlackBright,u.color.grey=u.color.blackBright,u.bgColor.bgGrey=u.bgColor.bgBlackBright;for(const[c,f]of Object.entries(u)){for(const[h,m]of Object.entries(f))u[h]={open:`\x1B[${m[0]}m`,close:`\x1B[${m[1]}m`},f[h]=u[h],o.set(m[0],m[1]);Object.defineProperty(u,c,{value:f,enumerable:!1})}return Object.defineProperty(u,"codes",{value:o,enumerable:!1}),u.color.close="\x1B[39m",u.bgColor.close="\x1B[49m",u.color.ansi256=t(),u.color.ansi16m=n(),u.bgColor.ansi256=t(10),u.bgColor.ansi16m=n(10),Object.defineProperties(u,{rgbToAnsi256:{value:(c,f,h)=>c===f&&f===h?c<8?16:c>248?231:Math.round((c-8)/247*24)+232:16+36*Math.round(c/255*5)+6*Math.round(f/255*5)+Math.round(h/255*5),enumerable:!1},hexToRgb:{value:c=>{const f=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(c.toString(16));if(!f)return[0,0,0];let{colorString:h}=f.groups;h.length===3&&(h=h.split("").map(y=>y+y).join(""));const m=Number.parseInt(h,16);return[m>>16&255,m>>8&255,m&255]},enumerable:!1},hexToAnsi256:{value:c=>u.rgbToAnsi256(...u.hexToRgb(c)),enumerable:!1}}),u}Object.defineProperty(r,"exports",{enumerable:!0,get:a})}(Ku)),Ku.exports}var PO=kO();const $b=so(PO);function It(r,e){return`${r.open}${e}${r.close}`}function hn(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function Sw(r){return typeof r=="string"?r.trim():r==null?r:hn(r,r.toString())}function Dr(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Vt}=$b;class kw extends mo{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const a=this.runMap.get(n.parent_run_id);if(a)t.push(a),n=a;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((a,o,u)=>{const c=`${a.execution_order}:${a.run_type}:${a.name}`;return o===u.length-1?It($b.bold,c):c}).join(" > ");return It(Vt.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${hn(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.cyan,"[chain/end]")} [${t}] [${Dr(e)}] Exiting Chain run with output: ${hn(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.red,"[chain/error]")} [${t}] [${Dr(e)}] Chain run errored with error: ${hn(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${It(Vt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${hn(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.cyan,"[llm/end]")} [${t}] [${Dr(e)}] Exiting LLM run with output: ${hn(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.red,"[llm/error]")} [${t}] [${Dr(e)}] LLM run errored with error: ${hn(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Sw(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${It(Vt.cyan,"[tool/end]")} [${t}] [${Dr(e)}] Exiting Tool run with output: "${Sw((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.red,"[tool/error]")} [${t}] [${Dr(e)}] Tool run errored with error: ${hn(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${hn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.cyan,"[retriever/end]")} [${t}] [${Dr(e)}] Exiting Retriever run with output: ${hn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${It(Vt.red,"[retriever/error]")} [${t}] [${Dr(e)}] Retriever run errored with error: ${hn(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${It(Vt.blue,"[agent/action]")} [${n}] Agent selected action: ${hn(t.actions[t.actions.length-1],"[action]")}`)}}let rh;const OO=()=>{if(rh===void 0){const r=Ot("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};rh=new to(r)}return rh};class $i extends mo{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:a}=e;this.projectName=n??Ot("LANGCHAIN_PROJECT")??Ot("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??OO();const o=$i.getTraceableRunTree();o&&this.updateFromRunTree(o)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await _O()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();const a=[t];for(;a.length>0;){const o=a.shift();!o||n.has(o.id)||(n.add(o.id),this.runMap.set(o.id,o),o.child_runs&&a.push(...o.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},n=[];for(const[a,o]of this.runMap){const u=new rn({...o,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[a]=u,n.push([a,o.dotted_order])}n.sort((a,o)=>!a[1]||!o[1]?0:a[1].localeCompare(o[1]));for(const[a]of n){const o=this.runMap.get(a),u=t[a];if(!(!o||!u)&&o.parent_run_id){const c=t[o.parent_run_id];c&&(c.child_runs.push(u),u.parent_run=c)}}return t[e]}static getTraceableRunTree(){try{return iO()}catch{return}}}const jb=Symbol.for("ls:tracing_async_local_storage"),Qu=Symbol.for("lc:context_variables"),xO=r=>{globalThis[jb]=r},no=()=>globalThis[jb];let ji;function TO(){const r="default"in mr?mr.default:mr;return new r({autoStart:!0,concurrency:1})}function CO(){return typeof ji>"u"&&(ji=TO()),ji}async function ut(r,e){if(e===!0){const t=no();t!==void 0?await t.run(void 0,async()=>r()):await r()}else ji=CO(),ji.add(async()=>{const t=no();t!==void 0?await t.run(void 0,async()=>r()):await r()})}const AO=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Ot(t)==="true");function Lb(r){var n;const e=no();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[Qu])==null?void 0:n[r]}const IO=Symbol("lc:configure_hooks"),RO=()=>Lb(IO)||[];class NO{setHandler(e){return this.setHandlers([e])}}class Fl{constructor(e,t,n,a,o,u,c,f){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:u}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:c}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:f})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>ut(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,a,o){await Promise.all(this.handlers.map(u=>ut(async()=>{var c;try{await((c=u.handleCustomEvent)==null?void 0:c.call(u,e,t,this.runId,this.tags,this.metadata))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleCustomEvent: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}}class $O extends Fl{getChild(e){const t=new Wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>ut(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw a}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>ut(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${a}`),t.raiseError)throw e}},t.awaitHandlers)))}}class Pw extends Fl{async handleLLMNewToken(e,t,n,a,o,u){await Promise.all(this.handlers.map(c=>ut(async()=>{var f;if(!c.ignoreLLM)try{await((f=c.handleLLMNewToken)==null?void 0:f.call(c,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,u))}catch(h){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleLLMNewToken: ${h}`),c.raiseError)throw h}},c.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>ut(async()=>{var n;if(!t.ignoreLLM)try{await((n=t.handleLLMError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>ut(async()=>{var n;if(!t.ignoreLLM)try{await((n=t.handleLLMEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}}class jO extends Fl{getChild(e){const t=new Wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,a,o){await Promise.all(this.handlers.map(u=>ut(async()=>{var c;if(!u.ignoreChain)try{await((c=u.handleChainError)==null?void 0:c.call(u,e,this.runId,this._parentRunId,this.tags,o))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainError: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}async handleChainEnd(e,t,n,a,o){await Promise.all(this.handlers.map(u=>ut(async()=>{var c;if(!u.ignoreChain)try{await((c=u.handleChainEnd)==null?void 0:c.call(u,e,this.runId,this._parentRunId,this.tags,o))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainEnd: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>ut(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>ut(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}}class LO extends Fl{getChild(e){const t=new Wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>ut(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>ut(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}}class Wt extends NO{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,a=void 0,o=void 0,u=void 0,c=void 0,f=void 0){return Promise.all(t.map(async(h,m)=>{const y=m===0&&n?n:Zt();return await Promise.all(this.handlers.map(_=>{if(!_.ignoreLLM)return wi(_)&&_._createRunForLLMStart(e,[h],y,this._parentRunId,o,this.tags,this.metadata,f),ut(async()=>{var b;try{await((b=_.handleLLMStart)==null?void 0:b.call(_,e,[h],y,this._parentRunId,o,this.tags,this.metadata,f))}catch(w){if((_.raiseError?console.error:console.warn)(`Error in handler ${_.constructor.name}, handleLLMStart: ${w}`),_.raiseError)throw w}},_.awaitHandlers)})),new Pw(y,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,a=void 0,o=void 0,u=void 0,c=void 0,f=void 0){return Promise.all(t.map(async(h,m)=>{const y=m===0&&n?n:Zt();return await Promise.all(this.handlers.map(_=>{if(!_.ignoreLLM)return wi(_)&&_._createRunForChatModelStart(e,[h],y,this._parentRunId,o,this.tags,this.metadata,f),ut(async()=>{var b,w;try{if(_.handleChatModelStart)await((b=_.handleChatModelStart)==null?void 0:b.call(_,e,[h],y,this._parentRunId,o,this.tags,this.metadata,f));else if(_.handleLLMStart){const S=fb(h);await((w=_.handleLLMStart)==null?void 0:w.call(_,e,[S],y,this._parentRunId,o,this.tags,this.metadata,f))}}catch(S){if((_.raiseError?console.error:console.warn)(`Error in handler ${_.constructor.name}, handleLLMStart: ${S}`),_.raiseError)throw S}},_.awaitHandlers)})),new Pw(y,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=Zt(),a=void 0,o=void 0,u=void 0,c=void 0){return await Promise.all(this.handlers.map(f=>{if(!f.ignoreChain)return wi(f)&&f._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,a,c),ut(async()=>{var h;try{await((h=f.handleChainStart)==null?void 0:h.call(f,e,t,n,this._parentRunId,this.tags,this.metadata,a,c))}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleChainStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new jO(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=Zt(),a=void 0,o=void 0,u=void 0,c=void 0){return await Promise.all(this.handlers.map(f=>{if(!f.ignoreAgent)return wi(f)&&f._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,c),ut(async()=>{var h;try{await((h=f.handleToolStart)==null?void 0:h.call(f,e,t,n,this._parentRunId,this.tags,this.metadata,c))}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleToolStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new LO(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=Zt(),a=void 0,o=void 0,u=void 0,c=void 0){return await Promise.all(this.handlers.map(f=>{if(!f.ignoreRetriever)return wi(f)&&f._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,c),ut(async()=>{var h;try{await((h=f.handleRetrieverStart)==null?void 0:h.call(f,e,t,n,this._parentRunId,this.tags,this.metadata,c))}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleRetrieverStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new $O(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,a,o){await Promise.all(this.handlers.map(u=>ut(async()=>{var c;if(!u.ignoreCustomEvent)try{await((c=u.handleCustomEvent)==null?void 0:c.call(u,e,t,n,this.tags,this.metadata))}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleCustomEvent: ${f}`),u.raiseError)throw f}},u.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new Wt(this._parentRunId);for(const a of this.handlers){const o=this.inheritableHandlers.includes(a);n.addHandler(a,o)}for(const a of this.tags){const o=this.inheritableTags.includes(a);n.addTags([a],o)}for(const a of Object.keys(this.metadata)){const o=Object.keys(this.inheritableMetadata).includes(a);n.addMetadata({[a]:this.metadata[a]},o)}for(const a of e)n.handlers.filter(o=>o.name==="console_callback_handler").some(o=>o.name===a.name)||n.addHandler(a,t);return n}static fromHandlers(e){class t extends po{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Zt()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static configure(e,t,n,a,o,u,c){return this._configureSync(e,t,n,a,o,u,c)}static _configureSync(e,t,n,a,o,u,c){var _,b;let f;(e||t)&&(Array.isArray(e)||!e?(f=new Wt,f.setHandlers((e==null?void 0:e.map(pl))??[],!0)):f=e,f=f.copy(Array.isArray(t)?t.map(pl):t==null?void 0:t.handlers,!1));const h=Ot("LANGCHAIN_VERBOSE")==="true"||(c==null?void 0:c.verbose),m=((_=$i.getTraceableRunTree())==null?void 0:_.tracingEnabled)||AO(),y=m||(Ot("LANGCHAIN_TRACING")??!1);if(h||y){if(f||(f=new Wt),h&&!f.handlers.some(w=>w.name===kw.prototype.name)){const w=new kw;f.addHandler(w,!0)}if(y&&!f.handlers.some(w=>w.name==="langchain_tracer")&&m){const w=new $i;f.addHandler(w,!0),f._parentRunId=((b=$i.getTraceableRunTree())==null?void 0:b.id)??f._parentRunId}}for(const{contextVar:w,inheritable:S=!0,handlerClass:E,envVar:P}of RO()){const C=P&&Ot(P)==="true"&&E;let T;const M=w!==void 0?Lb(w):void 0;M&&bO(M)?T=M:C&&(T=new E({})),T!==void 0&&(f||(f=new Wt),f.handlers.some(j=>j.name===T.name)||f.addHandler(T,S))}return(n||a)&&f&&(f.addTags(n??[]),f.addTags(a??[],!1)),(o||u)&&f&&(f.addMetadata(o??{}),f.addMetadata(u??{},!1)),f}}function pl(r){return"name"in r?r:po.fromMethods(r)}class MO{getStore(){}run(e,t){return t()}enterWith(e){}}const FO=new MO,Ow=Symbol.for("lc:child_config");class DO{getInstance(){return no()??FO}getRunnableConfig(){var t,n;return(n=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:n[Ow]}runWithConfig(e,t,n){var m;const a=Wt._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),o=this.getInstance(),u=o.getStore(),c=a==null?void 0:a.getParentRunId(),f=(m=a==null?void 0:a.handlers)==null?void 0:m.find(y=>(y==null?void 0:y.name)==="langchain_tracer");let h;return f&&c?h=f.convertToRunTree(c):n||(h=new rn({name:"<runnable_lambda>",tracingEnabled:!1})),h&&(h.extra={...h.extra,[Ow]:e}),u!==void 0&&u[Qu]!==void 0&&(h[Qu]=u[Qu]),o.run(h,t)}initializeGlobalInstance(e){no()===void 0&&xO(e)}}const Gr=new DO,ah=25;async function jn(r){return Wt._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function xw(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const a=e[n]??[];e[n]=[...new Set(a.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const a=e.callbacks,o=t.callbacks;if(Array.isArray(o))if(!a)e.callbacks=o;else if(Array.isArray(a))e.callbacks=a.concat(o);else{const u=a.copy();for(const c of o)u.addHandler(pl(c),!0);e.callbacks=u}else if(o)if(!a)e.callbacks=o;else if(Array.isArray(a)){const u=o.copy();for(const c of a)u.addHandler(pl(c),!0);e.callbacks=u}else e.callbacks=new Wt(o._parentRunId,{handlers:a.handlers.concat(o.handlers),inheritableHandlers:a.inheritableHandlers.concat(o.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(o.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(o.inheritableTags))),metadata:{...a.metadata,...o.metadata}})}else{const a=n;e[a]=t[a]??e[a]}return e}const UO=new Set(["string","number","boolean"]);function Le(r){var n;const e=Gr.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:a,runName:o,...u}=e;t=Object.entries(u).reduce((c,[f,h])=>(h!==void 0&&(c[f]=h),c),t)}if(r&&(t=Object.entries(r).reduce((a,[o,u])=>(u!==void 0&&(a[o]=u),a),t)),t!=null&&t.configurable)for(const a of Object.keys(t.configurable))UO.has(typeof t.configurable[a])&&!((n=t.metadata)!=null&&n[a])&&(t.metadata||(t.metadata={}),t.metadata[a]=t.configurable[a]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const a=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,a])):t.signal=a,delete t.timeout}return t}function xt(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:a,configurable:o,runId:u}={}){const c=Le(r);return e!==void 0&&(delete c.runName,c.callbacks=e),n!==void 0&&(c.recursionLimit=n),t!==void 0&&(c.maxConcurrency=t),a!==void 0&&(c.runName=a),o!==void 0&&(c.configurable={...c.configurable,...o}),u!==void 0&&delete c.runId,c}function ys(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function Jr(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,a)=>{t=()=>{a(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&a(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class sn extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new sn({start(n){return a();function a(){return t.read().then(({done:o,value:u})=>{if(o){n.close();return}return n.enqueue(u),a()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new sn({async pull(t){const{value:n,done:a}=await e.next();a&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function Mb(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(a){for(;;)if(a.length===0){const o=await r.next();for(const u of t)u.push(o)}else{if(a[0].done)return;yield a.shift().value}})}function Ln(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,a]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=Ln(t[n],a):t[n]=a;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}class Ts{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((n,a)=>{Gr.runWithConfig(ys(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,a):this.firstResult.then(o=>n(void 0),a)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Gr.runWithConfig(ys(this.config),this.signal?async()=>Jr(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function zO(r,e,t,n,...a){const o=new Ts({generator:e,startSetup:t,signal:n}),u=await o.setup;return{output:r(o,u,...a),setup:u}}class Ur{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=fl({},t);return new ro({ops:t,state:n[n.length-1].newDocument})}}class ro extends Ur{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=fl(this.state,e.ops);return new ro({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=fl({},e.ops);return new ro({ops:e.ops,state:t[t.length-1].newDocument})}}const BO=r=>r.name==="log_stream_tracer";async function Tw(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function Cw(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function VO(r){return r!==void 0&&r.message!==void 0}class Aw extends mo{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=sn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const a=this.keyMapByRunId[e];a&&await this.writer.write(new Ur({ops:[{op:"add",path:`/logs/${a}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var a;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Ur({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Tw(e,this._schemaFormat)),await this.writer.write(new Ur({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Tw(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await Cw(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const a=new Ur({ops:n});await this.writer.write(a)}finally{if(e.id===this.rootId){const t=new Ur({ops:[{op:"replace",path:"/final_output",value:await Cw(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const a=this.keyMapByRunId[e.id];if(a===void 0)return;const o=e.inputs.messages!==void 0;let u;o?VO(n==null?void 0:n.chunk)?u=n==null?void 0:n.chunk:u=new Sa({id:`run-${e.id}`,content:t}):u=t;const c=new Ur({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${a}/streamed_output/-`,value:u}]});await this.writer.write(c)}}const Iw="__run";class _s{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new _s({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class ws extends _s{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new ws({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function Uu({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const HO=r=>r.name==="event_stream_tracer";class qO extends mo{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=sn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const a=this.runInfoMap.get(e);if(a===void 0){yield n.value;return}function o(c,f){return c==="llm"&&typeof f=="string"?new _s({text:f}):f}let u=this.tappedPromises.get(e);if(u===void 0){let c;u=new Promise(f=>{c=f}),this.tappedPromises.set(e,u);try{const f={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...f,data:{chunk:o(a.runType,n.value)}},a),yield n.value;for await(const h of t)a.runType!=="tool"&&a.runType!=="retriever"&&await this.send({...f,data:{chunk:o(a.runType,h)}},a),yield h}finally{c()}}else{yield n.value;for await(const c of t)yield c}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var u,c;const t=Uu(e),n=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:e.tags??[],metadata:((u=e.extra)==null?void 0:u.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,a);const o=`on_${n}_start`;await this.send({event:o,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((c=e.extra)==null?void 0:c.metadata)??{}},a)}async onLLMNewToken(e,t,n){const a=this.runInfoMap.get(e.id);let o,u;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(a.runType==="chat_model")u="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?o=new Sa({content:t,id:`run-${e.id}`}):o=n.chunk.message;else if(a.runType==="llm")u="on_llm_stream",(n==null?void 0:n.chunk)===void 0?o=new _s({text:t}):o=n.chunk;else throw new Error(`Unexpected run type ${a.runType}`);await this.send({event:u,data:{chunk:o},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){var u,c,f;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const a=(u=e.outputs)==null?void 0:u.generations;let o;if(t.runType==="chat_model"){for(const h of a??[]){if(o!==void 0)break;o=(c=h[0])==null?void 0:c.message}n="on_chat_model_end"}else if(t.runType==="llm")o={generations:a==null?void 0:a.map(h=>h.map(m=>({text:m.text,generationInfo:m.generationInfo}))),llmOutput:((f=e.outputs)==null?void 0:f.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:o,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var u,c;const t=Uu(e),n=e.run_type??"chain",a={tags:e.tags??[],metadata:((u=e.extra)==null?void 0:u.metadata)??{},name:t,runType:e.run_type};let o={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(o={},a.inputs={}):e.inputs.input!==void 0?(o.input=e.inputs.input,a.inputs=e.inputs.input):(o.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${n}_start`,data:o,name:t,tags:e.tags??[],run_id:e.id,metadata:((c=e.extra)==null?void 0:c.metadata)??{}},a)}async onChainEnd(e){var c;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,a=e.inputs??t.inputs??{},u={output:((c=e.outputs)==null?void 0:c.output)??e.outputs,input:a};a.input&&Object.keys(a).length===1&&(u.input=a.input,t.inputs=a.input),await this.sendEndEvent({event:n,data:u,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var a,o;const t=Uu(e),n={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((o=e.extra)==null?void 0:o.metadata)??{}},n)}async onToolEnd(e){var a;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((a=e.outputs)==null?void 0:a.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var o,u;const t=Uu(e),a={tags:e.tags??[],metadata:((o=e.extra)==null?void 0:o.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,a),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((u=e.extra)==null?void 0:u.metadata)??{}},a)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const a=this.runInfoMap.get(n);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:a.tags,metadata:a.metadata,data:t},a)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const ZO=[400,401,402,403,404,405,406,407,409],WO=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&ZO.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const a=new Error(r==null?void 0:r.message);throw a.name="InsufficientQuotaError",a}};class Op{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??WO;const t="default"in mr?mr.default:mr;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>ll(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((a,o)=>{var u;(u=e.signal)==null||u.addEventListener("abort",()=>{o(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class Fb extends mo{constructor({config:e,onStart:t,onEnd:n,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function xp(r){return r?r.lc_runnable:!1}class GO{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const a=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||a.some(o=>{var u;return(u=this.includeTags)==null?void 0:u.includes(o)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&a.every(o=>{var u;return!((u=this.excludeTags)!=null&&u.includes(o))})),n}}const JO=Symbol("Let zodToJsonSchema decide on which parser to use"),KO={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},QO=r=>({...KO,...r}),XO=r=>{const e=QO(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Db(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Fe(r,e,t,n,a){r[e]=t,Db(r,e,n,a)}function YO(){return{}}function ex(r,e){var n,a,o;const t={type:"array"};return(n=r.type)!=null&&n._def&&((o=(a=r.type)==null?void 0:a._def)==null?void 0:o.typeName)!==L.ZodAny&&(t.items=$e(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Fe(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Fe(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Fe(t,"minItems",r.exactLength.value,r.exactLength.message,e),Fe(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function tx(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Fe(t,"minimum",n.value,n.message,e):Fe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Fe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Fe(t,"maximum",n.value,n.message,e):Fe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Fe(t,"maximum",n.value,n.message,e));break;case"multipleOf":Fe(t,"multipleOf",n.value,n.message,e);break}return t}function nx(){return{type:"boolean"}}function Ub(r,e){return $e(r.type._def,e)}const rx=(r,e)=>$e(r.innerType._def,e);function zb(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>zb(r,e,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return ax(r,e)}}const ax=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Fe(t,"minimum",n.value,n.message,e);break;case"max":Fe(t,"maximum",n.value,n.message,e);break}return t};function sx(r,e){return{...$e(r.innerType._def,e),default:r.defaultValue()}}function ix(r,e){return e.effectStrategy==="input"?$e(r.schema._def,e):{}}function ox(r){return{type:"string",enum:Array.from(r.values)}}const ux=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function lx(r,e){const t=[$e(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),$e(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return t.forEach(o=>{if(ux(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let u=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:c,...f}=o;u=f}else n=void 0;a.push(u)}}),a.length?{allOf:a,...n}:void 0}function cx(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let sh;const En={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(sh===void 0&&(sh=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),sh),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Bb(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":Fe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":Fe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Sn(t,"email",n.message,e);break;case"format:idn-email":Sn(t,"idn-email",n.message,e);break;case"pattern:zod":Rt(t,En.email,n.message,e);break}break;case"url":Sn(t,"uri",n.message,e);break;case"uuid":Sn(t,"uuid",n.message,e);break;case"regex":Rt(t,n.regex,n.message,e);break;case"cuid":Rt(t,En.cuid,n.message,e);break;case"cuid2":Rt(t,En.cuid2,n.message,e);break;case"startsWith":Rt(t,RegExp(`^${ih(n.value,e)}`),n.message,e);break;case"endsWith":Rt(t,RegExp(`${ih(n.value,e)}$`),n.message,e);break;case"datetime":Sn(t,"date-time",n.message,e);break;case"date":Sn(t,"date",n.message,e);break;case"time":Sn(t,"time",n.message,e);break;case"duration":Sn(t,"duration",n.message,e);break;case"length":Fe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),Fe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{Rt(t,RegExp(ih(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&Sn(t,"ipv4",n.message,e),n.version!=="v4"&&Sn(t,"ipv6",n.message,e);break}case"base64url":Rt(t,En.base64url,n.message,e);break;case"jwt":Rt(t,En.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Rt(t,En.ipv4Cidr,n.message,e),n.version!=="v4"&&Rt(t,En.ipv6Cidr,n.message,e);break}case"emoji":Rt(t,En.emoji(),n.message,e);break;case"ulid":{Rt(t,En.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Sn(t,"binary",n.message,e);break}case"contentEncoding:base64":{Fe(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Rt(t,En.base64,n.message,e);break}}break}case"nanoid":Rt(t,En.nanoid,n.message,e)}return t}function ih(r,e){return e.patternStrategy==="escape"?fx(r):r}const dx=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function fx(r){let e="";for(let t=0;t<r.length;t++)dx.has(r[t])||(e+="\\"),e+=r[t];return e}function Sn(r,e,t,n){var a;r.format||(a=r.anyOf)!=null&&a.some(o=>o.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Fe(r,"format",e,t,n)}function Rt(r,e,t,n){var a;r.pattern||(a=r.allOf)!=null&&a.some(o=>o.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Rw(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Fe(r,"pattern",Rw(e,n),t,n)}function Rw(r,e){var f;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let a="",o=!1,u=!1,c=!1;for(let h=0;h<n.length;h++){if(o){a+=n[h],o=!1;continue}if(t.i){if(u){if(n[h].match(/[a-z]/)){c?(a+=n[h],a+=`${n[h-2]}-${n[h]}`.toUpperCase(),c=!1):n[h+1]==="-"&&((f=n[h+2])!=null&&f.match(/[a-z]/))?(a+=n[h],c=!0):a+=`${n[h]}${n[h].toUpperCase()}`;continue}}else if(n[h].match(/[a-z]/)){a+=`[${n[h]}${n[h].toUpperCase()}]`;continue}}if(t.m){if(n[h]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(n[h]==="$"){a+=`($|(?=[\r
]))`;continue}}if(t.s&&n[h]==="."){a+=u?`${n[h]}\r
`:`[${n[h]}\r
]`;continue}a+=n[h],n[h]==="\\"?o=!0:u&&n[h]==="]"?u=!1:!u&&n[h]==="["&&(u=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return a}function Vb(r,e){var n,a,o,u,c,f;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===L.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((h,m)=>({...h,[m]:$e(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",m]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:$e(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((a=r.keyType)==null?void 0:a._def.typeName)===L.ZodString&&((o=r.keyType._def.checks)!=null&&o.length)){const{type:h,...m}=Bb(r.keyType._def,e);return{...t,propertyNames:m}}else{if(((u=r.keyType)==null?void 0:u._def.typeName)===L.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((c=r.keyType)==null?void 0:c._def.typeName)===L.ZodBranded&&r.keyType._def.type._def.typeName===L.ZodString&&((f=r.keyType._def.type._def.checks)!=null&&f.length)){const{type:h,...m}=Ub(r.keyType._def,e);return{...t,propertyNames:m}}}return t}function hx(r,e){if(e.mapStrategy==="record")return Vb(r,e);const t=$e(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=$e(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function px(r){const e=r.values,n=Object.keys(r.values).filter(o=>typeof e[e[o]]!="number").map(o=>e[o]),a=Array.from(new Set(n.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function mx(){return{not:{}}}function gx(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const ml={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function yx(r,e){if(e.target==="openApi3")return Nw(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in ml&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((a,o)=>{const u=ml[o._def.typeName];return u&&!a.includes(u)?[...a,u]:a},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((a,o)=>{const u=typeof o._def.value;switch(u){case"string":case"number":case"boolean":return[...a,u];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===t.length){const a=n.filter((o,u,c)=>c.indexOf(o)===u);return{type:a.length>1?a:a[0],enum:t.reduce((o,u)=>o.includes(u._def.value)?o:[...o,u._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return Nw(r,e)}const Nw=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,a)=>$e(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function _x(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:ml[r.innerType._def.typeName],nullable:!0}:{type:[ml[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=$e(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=$e(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function wx(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",Db(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Fe(t,"minimum",n.value,n.message,e):Fe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Fe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Fe(t,"maximum",n.value,n.message,e):Fe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Fe(t,"maximum",n.value,n.message,e));break;case"multipleOf":Fe(t,"multipleOf",n.value,n.message,e);break}return t}function vx(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":$e(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":$e(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function bx(r,e){const t=e.target==="openAi",n={type:"object",...Object.entries(r.shape()).reduce((a,[o,u])=>{if(u===void 0||u._def===void 0)return a;let c=u.isOptional();c&&t&&(u instanceof $n&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=!1);const f=$e(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});return f===void 0?a:{properties:{...a.properties,[o]:f},required:c?a.required:[...a.required,o]}},{properties:{},required:[]}),additionalProperties:vx(r,e)};return n.required.length||delete n.required,n}const Ex=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return $e(r.innerType._def,e);const t=$e(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},Sx=(r,e)=>{if(e.pipeStrategy==="input")return $e(r.in._def,e);if(e.pipeStrategy==="output")return $e(r.out._def,e);const t=$e(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=$e(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(a=>a!==void 0)}};function kx(r,e){return $e(r.type._def,e)}function Px(r,e){const n={type:"array",uniqueItems:!0,items:$e(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Fe(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Fe(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function Ox(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>$e(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:$e(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>$e(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function xx(){return{not:{}}}function Tx(){return{}}const Cx=(r,e)=>$e(r.innerType._def,e);function $e(r,e,t=!1){var u;const n=e.seen.get(r);if(e.override){const c=(u=e.override)==null?void 0:u.call(e,r,e,n,t);if(c!==JO)return c}if(n&&!t){const c=Ax(n,e);if(c!==void 0)return c}const a={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,a);const o=Rx(r,r.typeName,e);return o&&Nx(r,e,o),a.jsonSchema=o,o}const Ax=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:Ix(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},Ix=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},Rx=(r,e,t)=>{switch(e){case L.ZodString:return Bb(r,t);case L.ZodNumber:return wx(r,t);case L.ZodObject:return bx(r,t);case L.ZodBigInt:return tx(r,t);case L.ZodBoolean:return nx();case L.ZodDate:return zb(r,t);case L.ZodUndefined:return xx();case L.ZodNull:return gx(t);case L.ZodArray:return ex(r,t);case L.ZodUnion:case L.ZodDiscriminatedUnion:return yx(r,t);case L.ZodIntersection:return lx(r,t);case L.ZodTuple:return Ox(r,t);case L.ZodRecord:return Vb(r,t);case L.ZodLiteral:return cx(r,t);case L.ZodEnum:return ox(r);case L.ZodNativeEnum:return px(r);case L.ZodNullable:return _x(r,t);case L.ZodOptional:return Ex(r,t);case L.ZodMap:return hx(r,t);case L.ZodSet:return Px(r,t);case L.ZodLazy:return $e(r.getter()._def,t);case L.ZodPromise:return kx(r,t);case L.ZodNaN:case L.ZodNever:return mx();case L.ZodEffects:return ix(r,t);case L.ZodAny:return YO();case L.ZodUnknown:return Tx();case L.ZodDefault:return sx(r,t);case L.ZodBranded:return Ub(r,t);case L.ZodReadonly:return Cx(r,t);case L.ZodCatch:return rx(r,t);case L.ZodPipeline:return Sx(r,t);case L.ZodFunction:case L.ZodVoid:case L.ZodSymbol:return;default:return(n=>{})()}},Nx=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),go=(r,e)=>{const t=XO(e),n=void 0,a=e==null?void 0:e.name,o=$e(r._def,t,!1)??{},u=a===void 0?n?{...o,[t.definitionPath]:n}:o:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,a].join("/"),[t.definitionPath]:{...n,[a]:o}};return t.target==="jsonSchema7"?u.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in u||"oneOf"in u||"allOf"in u||"type"in u&&Array.isArray(u.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),u};function oh(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const $x=["*","_","`"];function jx(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function Lx(r,e,t){const{firstNode:n,lastNode:a,nodeColors:o,withStyles:u=!0,curveStyle:c="linear",wrapLabelNWords:f=9}=t;let h=u?`%%{init: {'flowchart': {'curve': '${c}'}}}%%
graph TD;
`:`graph TD;
`;if(u){const b="default",w={[b]:"{0}({1})"};n!==void 0&&(w[n]="{0}([{1}]):::first"),a!==void 0&&(w[a]="{0}([{1}]):::last");for(const[S,E]of Object.entries(r)){const P=E.name.split(":").pop()??"";let T=$x.some(j=>P.startsWith(j)&&P.endsWith(j))?`<p>${P}</p>`:P;Object.keys(E.metadata??{}).length&&(T+=`<hr/><small><em>${Object.entries(E.metadata??{}).map(([j,D])=>`${j} = ${D}`).join(`
`)}</em></small>`);const M=(w[S]??w[b]).replace("{0}",oh(S)).replace("{1}",T);h+=`	${M}
`}}const m={};for(const b of e){const w=b.source.split(":"),S=b.target.split(":"),E=w.filter((P,C)=>P===S[C]).join(":");m[E]||(m[E]=[]),m[E].push(b)}const y=new Set;function _(b,w){const S=b.length===1&&b[0].source===b[0].target;if(w&&!S){const E=w.split(":").pop();if(y.has(E))throw new Error(`Found duplicate subgraph '${E}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);y.add(E),h+=`	subgraph ${E}
`}for(const E of b){const{source:P,target:C,data:T,conditional:M}=E;let j="";if(T!==void 0){let D=T;const V=D.split(" ");V.length>f&&(D=Array.from({length:Math.ceil(V.length/f)},(q,me)=>V.slice(me*f,(me+1)*f).join(" ")).join("&nbsp;<br>&nbsp;")),j=M?` -. &nbsp;${D}&nbsp; .-> `:` -- &nbsp;${D}&nbsp; --> `}else j=M?" -.-> ":" --> ";h+=`	${oh(P)}${j}${oh(C)};
`}for(const E in m)E.startsWith(`${w}:`)&&E!==w&&_(m[E],E);w&&!S&&(h+=`	end
`)}_(m[""]??[],"");for(const b in m)!b.includes(":")&&b!==""&&_(m[b],b);return u&&(h+=jx(o??{})),h}async function Mx(r,e){let{backgroundColor:t="white"}=e;const n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const a=`https://mermaid.ink/img/${n}?bgColor=${t}`,o=await fetch(a);if(!o.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${o.status}`,`Status text: ${o.statusText}`].join(`
`));return await o.blob()}function Fx(r,e){if(r!==void 0&&!Ii(r))return r;if(xp(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function Dx(r){return xp(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...go(r.data.schema),title:r.data.name}}}class Dl{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=Ii(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...Dx(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const a=t??Zt(),o={id:a,data:e,name:Fx(t,e),metadata:n};return this.nodes[a]=o,o}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const o={source:e.id,target:t.id,data:n,conditional:a};return this.edges.push(o),o}firstNode(){return $w(this)}lastNode(){return jw(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(h=>h.id).every(Ii)&&(n="");const o=h=>n?`${n}:${h}`:h;Object.entries(e.nodes).forEach(([h,m])=>{this.nodes[o(h)]={...m,id:o(h)}});const u=e.edges.map(h=>({...h,source:o(h.source),target:o(h.target)}));this.edges=[...this.edges,...u];const c=e.firstNode(),f=e.lastNode();return[c?{id:o(c.id),data:c.data}:void 0,f?{id:o(f.id),data:f.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&$w(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&jw(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(a=>[a.id,a.name])),t=new Map;Object.values(e).forEach(a=>{t.set(a,(t.get(a)||0)+1)});const n=a=>{const o=e[a];return Ii(a)&&t.get(o)===1?o:a};return new Dl({nodes:Object.fromEntries(Object.entries(this.nodes).map(([a,o])=>[n(a),{...o,id:n(a)}])),edges:this.edges.map(a=>({...a,source:n(a.source),target:n(a.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:o}=e??{},u=this.reid(),c=u.firstNode(),f=u.lastNode();return Lx(u.nodes,u.edges,{firstNode:c==null?void 0:c.id,lastNode:f==null?void 0:f.id,withStyles:t,curveStyle:n,nodeColors:a,wrapLabelNWords:o})}async drawMermaidPng(e){const t=this.drawMermaid(e);return Mx(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function $w(r,e=[]){const t=new Set(r.edges.filter(a=>!e.includes(a.source)).map(a=>a.target)),n=[];for(const a of Object.values(r.nodes))!e.includes(a.id)&&!t.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function jw(r,e=[]){const t=new Set(r.edges.filter(a=>!e.includes(a.target)).map(a=>a.source)),n=[];for(const a of Object.values(r.nodes))!e.includes(a.id)&&!t.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function Ux(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const a of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(a)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return sn.fromReadableStream(t)}function Lw(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const zx=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function Lh(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*Mw(r,e){for(;;){const{value:t,done:n}=Gr.runWithConfig(ys(r),e.next.bind(e),!0);if(n)break;yield t}}async function*Mh(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:a}=await Gr.runWithConfig(ys(r),t.next.bind(e),!0);if(a)break;yield n}}function pt(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}class rt extends wa{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new ya({bound:this,kwargs:e,config:{}})}map(){return new gl({bound:this})}withRetry(e){return new Bx({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new ya({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new Hx({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Le);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([a])=>a!=="runId"));return Array.from({length:t},(a,o)=>Le(o===0?e:n))}return Array.from({length:t},()=>Le(e))}async batch(e,t,n){var f;const a=this._getOptionsList(t??{},e.length),o=((f=a[0])==null?void 0:f.maxConcurrency)??(n==null?void 0:n.maxConcurrency),u=new Op({maxConcurrency:o,onFailedAttempt:h=>{throw h}}),c=e.map((h,m)=>u.call(async()=>{try{return await this.invoke(h,a[m])}catch(y){if(n!=null&&n.returnExceptions)return y;throw y}}));return Promise.all(c)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=Le(t),a=new Ts({generator:this._streamIterator(e,n),config:n});return await a.setup,sn.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Le(e):t=Le({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const a=Le(n),o=await jn(a),u=await(o==null?void 0:o.handleChainStart(this.toJSON(),pt(t,"input"),a.runId,a==null?void 0:a.runType,void 0,void 0,(a==null?void 0:a.runName)??this.getName()));delete a.runId;let c;try{const f=e.call(this,t,a,u);c=await Jr(f,n==null?void 0:n.signal)}catch(f){throw await(u==null?void 0:u.handleChainError(f)),f}return await(u==null?void 0:u.handleChainEnd(pt(c,"output"))),c}async _batchWithConfig(e,t,n,a){var h;const o=this._getOptionsList(n??{},t.length),u=await Promise.all(o.map(jn)),c=await Promise.all(u.map(async(m,y)=>{const _=await(m==null?void 0:m.handleChainStart(this.toJSON(),pt(t[y],"input"),o[y].runId,o[y].runType,void 0,void 0,o[y].runName??this.getName()));return delete o[y].runId,_}));let f;try{const m=e.call(this,t,o,c,a);f=await Jr(m,(h=o==null?void 0:o[0])==null?void 0:h.signal)}catch(m){throw await Promise.all(c.map(y=>y==null?void 0:y.handleChainError(m))),m}return await Promise.all(c.map(m=>m==null?void 0:m.handleChainEnd(pt(f,"output")))),f}async*_transformStreamWithConfig(e,t,n){let a,o=!0,u,c=!0;const f=Le(n),h=await jn(f);async function*m(){for await(const _ of e){if(o)if(a===void 0)a=_;else try{a=Ln(a,_)}catch{a=void 0,o=!1}yield _}}let y;try{const _=await zO(t.bind(this),m(),async()=>h==null?void 0:h.handleChainStart(this.toJSON(),{input:""},f.runId,f.runType,void 0,void 0,f.runName??this.getName()),n==null?void 0:n.signal,f);delete f.runId,y=_.setup;const b=y==null?void 0:y.handlers.find(HO);let w=_.output;b!==void 0&&y!==void 0&&(w=b.tapOutputIterable(y.runId,w));const S=y==null?void 0:y.handlers.find(BO);S!==void 0&&y!==void 0&&(w=S.tapOutputIterable(y.runId,w));for await(const E of w)if(yield E,c)if(u===void 0)u=E;else try{u=Ln(u,E)}catch{u=void 0,c=!1}}catch(_){throw await(y==null?void 0:y.handleChainError(_,void 0,void 0,void 0,{inputs:pt(a,"input")})),_}await(y==null?void 0:y.handleChainEnd(u??{},void 0,void 0,void 0,{inputs:pt(a,"input")}))}getGraph(e){const t=new Dl,n=t.addNode({name:`${this.getName()}Input`,schema:ma.any()}),a=t.addNode(this),o=t.addNode({name:`${this.getName()}Output`,schema:ma.any()});return t.addEdge(n,a),t.addEdge(a,o),t}pipe(e){return new hr({first:this,last:ha(e)})}pick(e){return this.pipe(new qx(e))}assign(e){return this.pipe(new Hb(new Cs({steps:e})))}async*transform(e,t){let n;for await(const a of e)n===void 0?n=a:n=Ln(n,a);yield*this._streamIterator(n,Le(t))}async*streamLog(e,t,n){const a=new Aw({...n,autoClose:!1,_schemaFormat:"original"}),o=Le(t);yield*this._streamLog(e,a,o)}async*_streamLog(e,t,n){const{callbacks:a}=n;if(a===void 0)n.callbacks=[t];else if(Array.isArray(a))n.callbacks=a.concat([t]);else{const f=a.copy();f.addHandler(t,!0),n.callbacks=f}const o=this.stream(e,n);async function u(){try{const f=await o;for await(const h of f){const m=new Ur({ops:[{op:"add",path:"/streamed_output/-",value:h}]});await t.writer.write(m)}}finally{await t.writer.close()}}const c=u();try{for await(const f of t)yield f}finally{await c}}streamEvents(e,t,n){let a;if(t.version==="v1")a=this._streamEventsV1(e,t,n);else if(t.version==="v2")a=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?Ux(a):sn.fromAsyncGenerator(a)}async*_streamEventsV2(e,t,n){var b;const a=new qO({...n,autoClose:!1}),o=Le(t),u=o.runId??Zt();o.runId=u;const c=o.callbacks;if(c===void 0)o.callbacks=[a];else if(Array.isArray(c))o.callbacks=c.concat(a);else{const w=c.copy();w.addHandler(a,!0),o.callbacks=w}const f=this;async function h(){try{const w=await f.stream(e,o),S=a.tapOutputIterable(u,w);for await(const E of S);}finally{await a.finish()}}const m=h();let y=!1,_;try{for await(const w of a){if(!y){w.data.input=e,y=!0,_=w.run_id,yield w;continue}w.run_id===_&&w.event.endsWith("_end")&&(b=w.data)!=null&&b.input&&delete w.data.input,yield w}}finally{await m}}async*_streamEventsV1(e,t,n){let a,o=!1;const u=Le(t),c=u.tags??[],f=u.metadata??{},h=u.runName??this.getName(),m=new Aw({...n,autoClose:!1,_schemaFormat:"streaming_events"}),y=new GO({...n}),_=this._streamLog(e,m,u);for await(const w of _){if(a?a=a.concat(w):a=ro.fromRunLogPatch(w),a.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!o){o=!0;const C={...a.state},T={run_id:C.id,event:`on_${C.type}_start`,name:h,tags:c,metadata:f,data:{input:e}};y.includeEvent(T,C.type)&&(yield T)}const S=w.ops.filter(C=>C.path.startsWith("/logs/")).map(C=>C.path.split("/")[2]),E=[...new Set(S)];for(const C of E){let T,M={};const j=a.state.logs[C];if(j.end_time===void 0?j.streamed_output.length>0?T="stream":T="start":T="end",T==="start")j.inputs!==void 0&&(M.input=j.inputs);else if(T==="end")j.inputs!==void 0&&(M.input=j.inputs),M.output=j.final_output;else if(T==="stream"){const D=j.streamed_output.length;if(D!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${D} instead. Encountered in: "${j.name}"`);M={chunk:j.streamed_output[0]},j.streamed_output=[]}yield{event:`on_${j.type}_${T}`,name:j.name,run_id:j.id,tags:j.tags,metadata:j.metadata,data:M}}const{state:P}=a;if(P.streamed_output.length>0){const C=P.streamed_output.length;if(C!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${C} instead. Encountered in: "${P.name}"`);const T={chunk:P.streamed_output[0]};P.streamed_output=[];const M={event:`on_${P.type}_stream`,run_id:P.id,tags:c,metadata:f,name:h,data:T};y.includeEvent(M,P.type)&&(yield M)}}const b=a==null?void 0:a.state;if(b!==void 0){const w={event:`on_${b.type}_end`,name:h,run_id:b.id,tags:c,metadata:f,data:{output:b.final_output}};y.includeEvent(w,b.type)&&(yield w)}}static isRunnable(e){return xp(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new ya({bound:this,config:{},configFactories:[a=>({callbacks:[new Fb({config:a,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return Zx(this,e)}}class ya extends rt{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=xw(this.config,...e);return xw(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Le(t),this.kwargs))}async batch(e,t,n){const a=Array.isArray(t)?await Promise.all(t.map(async o=>this._mergeConfig(Le(o),this.kwargs))):await this._mergeConfig(Le(t),this.kwargs);return this.bound.batch(e,a,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Le(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Le(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Le(t),this.kwargs))}streamEvents(e,t,n){const a=this,o=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig(Le(t),a.kwargs),version:t.version},n)};return sn.fromAsyncGenerator(o())}static isRunnableBinding(e){return e.bound&&rt.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new ya({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new Fb({config:a,onStart:e,onEnd:t,onError:n})]})]})}}class gl extends rt{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new gl({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,xt(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new gl({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class Bx extends ya{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const a=e>1?`retry:attempt:${e}`:void 0;return xt(t,{callbacks:n==null?void 0:n.getChild(a)})}async _invoke(e,t,n){return ll(a=>super.invoke(e,this._patchConfigForRetry(a,t,n)),{onFailedAttempt:a=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,a){const o={};try{await ll(async u=>{const c=e.map((_,b)=>b).filter(_=>o[_.toString()]===void 0||o[_.toString()]instanceof Error),f=c.map(_=>e[_]),h=c.map(_=>this._patchConfigForRetry(u,t==null?void 0:t[_],n==null?void 0:n[_])),m=await super.batch(f,h,{...a,returnExceptions:!0});let y;for(let _=0;_<m.length;_+=1){const b=m[_],w=c[_];b instanceof Error&&y===void 0&&(y=b,y.input=f[_]),o[w.toString()]=b}if(y)throw y;return m},{onFailedAttempt:u=>this.onFailedAttempt(u,u.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(u){if((a==null?void 0:a.returnExceptions)!==!0)throw u}return Object.keys(o).sort((u,c)=>parseInt(u,10)-parseInt(c,10)).map(u=>o[parseInt(u,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class hr extends rt{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var f;const n=Le(t),a=await jn(n),o=await(a==null?void 0:a.handleChainStart(this.toJSON(),pt(e,"input"),n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;let u=e,c;try{const h=[this.first,...this.middle];for(let m=0;m<h.length;m+=1){const _=h[m].invoke(u,xt(n,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${m+1}`)}));u=await Jr(_,t==null?void 0:t.signal)}if((f=t==null?void 0:t.signal)!=null&&f.aborted)throw new Error("Aborted");c=await this.last.invoke(u,xt(n,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(h){throw await(o==null?void 0:o.handleChainError(h)),h}return await(o==null?void 0:o.handleChainEnd(pt(c,"output"))),c}async batch(e,t,n){var f;const a=this._getOptionsList(t??{},e.length),o=await Promise.all(a.map(jn)),u=await Promise.all(o.map(async(h,m)=>{const y=await(h==null?void 0:h.handleChainStart(this.toJSON(),pt(e[m],"input"),a[m].runId,void 0,void 0,void 0,a[m].runName));return delete a[m].runId,y}));let c=e;try{for(let h=0;h<this.steps.length;h+=1){const y=this.steps[h].batch(c,u.map((_,b)=>{const w=_==null?void 0:_.getChild(this.omitSequenceTags?void 0:`seq:step:${h+1}`);return xt(a[b],{callbacks:w})}),n);c=await Jr(y,(f=a[0])==null?void 0:f.signal)}}catch(h){throw await Promise.all(u.map(m=>m==null?void 0:m.handleChainError(h))),h}return await Promise.all(u.map(h=>h==null?void 0:h.handleChainEnd(pt(c,"output")))),c}async*_streamIterator(e,t){var y;const n=await jn(t),{runId:a,...o}=t??{},u=await(n==null?void 0:n.handleChainStart(this.toJSON(),pt(e,"input"),a,void 0,void 0,void 0,o==null?void 0:o.runName)),c=[this.first,...this.middle,this.last];let f=!0,h;async function*m(){yield e}try{let _=c[0].transform(m(),xt(o,{callbacks:u==null?void 0:u.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let b=1;b<c.length;b+=1)_=await c[b].transform(_,xt(o,{callbacks:u==null?void 0:u.getChild(this.omitSequenceTags?void 0:`seq:step:${b+1}`)}));for await(const b of _)if((y=t==null?void 0:t.signal)==null||y.throwIfAborted(),yield b,f)if(h===void 0)h=b;else try{h=Ln(h,b)}catch{h=void 0,f=!1}}catch(_){throw await(u==null?void 0:u.handleChainError(_)),_}await(u==null?void 0:u.handleChainEnd(pt(h,"output")))}getGraph(e){const t=new Dl;let n=null;return this.steps.forEach((a,o)=>{const u=a.getGraph(e);o!==0&&u.trimFirstNode(),o!==this.steps.length-1&&u.trimLastNode(),t.extend(u);const c=u.firstNode();if(!c)throw new Error(`Runnable ${a} has no first node`);n&&t.addEdge(n,c),n=u.lastNode()}),t}pipe(e){return hr.isRunnableSequence(e)?new hr({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new hr({first:this.first,middle:[...this.middle,this.last],last:ha(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&rt.isRunnable(e)}static from([e,...t],n){let a={};return typeof n=="string"?a.name=n:n!==void 0&&(a=n),new hr({...a,first:ha(e),middle:t.slice(0,-1).map(ha),last:ha(t[t.length-1])})}}class Cs extends rt{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=ha(n)}static from(e){return new Cs({steps:e})}async invoke(e,t){const n=Le(t),a=await jn(n),o=await(a==null?void 0:a.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;const u={};try{const c=Object.entries(this.steps).map(async([f,h])=>{u[f]=await h.invoke(e,xt(n,{callbacks:o==null?void 0:o.getChild(`map:key:${f}`)}))});await Jr(Promise.all(c),t==null?void 0:t.signal)}catch(c){throw await(o==null?void 0:o.handleChainError(c)),c}return await(o==null?void 0:o.handleChainEnd(u)),u}async*_transform(e,t,n){const a={...this.steps},o=Mb(e,Object.keys(a).length),u=new Map(Object.entries(a).map(([c,f],h)=>{const m=f.transform(o[h],xt(n,{callbacks:t==null?void 0:t.getChild(`map:key:${c}`)}));return[c,m.next().then(y=>({key:c,gen:m,result:y}))]}));for(;u.size;){const c=Promise.race(u.values()),{key:f,result:h,gen:m}=await Jr(c,n==null?void 0:n.signal);u.delete(f),h.done||(yield{[f]:h.value},u.set(f,m.next().then(y=>({key:f,gen:m,result:y}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Le(t),o=new Ts({generator:this.transform(n(),a),config:a});return await o.setup,sn.fromAsyncGenerator(o)}}class Tp extends rt{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!kp(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),a=await jn(n),o=this.func(xt(n,{callbacks:a}),e);return Jr(o,n==null?void 0:n.signal)}async*_streamIterator(e,t){var o,u;const[n]=this._getOptionsList(t??{},1),a=await this.invoke(e,t);if(Lh(a)){for await(const c of a)(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield c;return}if(zx(a)){for(;;){(u=n==null?void 0:n.signal)==null||u.throwIfAborted();const c=a.next();if(c.done)break;yield c.value}return}yield a}static from(e){return new Tp({func:e})}}function Vx(r){if(kp(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class yo extends rt{static lc_name(){return"RunnableLambda"}constructor(e){if(kp(e.func))return Tp.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Vx(e.func),this.func=e.func}static from(e){return new yo({func:e})}async _invoke(e,t,n){return new Promise((a,o)=>{const u=xt(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??ah)-1});Gr.runWithConfig(ys(u),async()=>{var c,f;try{let h=await this.func(e,{...u});if(h&&rt.isRunnable(h)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");h=await h.invoke(e,{...u,recursionLimit:(u.recursionLimit??ah)-1})}else if(Lh(h)){let m;for await(const y of Mh(u,h))if((c=t==null?void 0:t.signal)==null||c.throwIfAborted(),m===void 0)m=y;else try{m=Ln(m,y)}catch{m=y}h=m}else if(Lw(h)){let m;for(const y of Mw(u,h))if((f=t==null?void 0:t.signal)==null||f.throwIfAborted(),m===void 0)m=y;else try{m=Ln(m,y)}catch{m=y}h=m}a(h)}catch(h){o(h)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){var c,f;let a;for await(const h of e)if(a===void 0)a=h;else try{a=Ln(a,h)}catch{a=h}const o=xt(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??ah)-1}),u=await new Promise((h,m)=>{Gr.runWithConfig(ys(o),async()=>{try{const y=await this.func(a,{...o,config:o});h(y)}catch(y){m(y)}})});if(u&&rt.isRunnable(u)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");const h=await u.stream(a,o);for await(const m of h)yield m}else if(Lh(u))for await(const h of Mh(o,u))(c=n==null?void 0:n.signal)==null||c.throwIfAborted(),yield h;else if(Lw(u))for(const h of Mw(o,u))(f=n==null?void 0:n.signal)==null||f.throwIfAborted(),yield h;else yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Le(t),o=new Ts({generator:this.transform(n(),a),config:a});return await o.setup,sn.fromAsyncGenerator(o)}}class Hx extends rt{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=Le(t),a=await jn(n),{runId:o,...u}=n,c=await(a==null?void 0:a.handleChainStart(this.toJSON(),pt(e,"input"),o,void 0,void 0,void 0,u==null?void 0:u.runName)),f=xt(u,{callbacks:c==null?void 0:c.getChild()});return await Gr.runWithConfig(f,async()=>{var y;let m;for(const _ of this.runnables()){(y=n==null?void 0:n.signal)==null||y.throwIfAborted();try{const b=await _.invoke(e,f);return await(c==null?void 0:c.handleChainEnd(pt(b,"output"))),b}catch(b){m===void 0&&(m=b)}}throw m===void 0?new Error("No error stored at end of fallback."):(await(c==null?void 0:c.handleChainError(m)),m)})}async*_streamIterator(e,t){var y;const n=Le(t),a=await jn(n),{runId:o,...u}=n,c=await(a==null?void 0:a.handleChainStart(this.toJSON(),pt(e,"input"),o,void 0,void 0,void 0,u==null?void 0:u.runName));let f,h;for(const _ of this.runnables()){(y=n==null?void 0:n.signal)==null||y.throwIfAborted();const b=xt(u,{callbacks:c==null?void 0:c.getChild()});try{const w=await _.stream(e,b);h=Mh(b,w);break}catch(w){f===void 0&&(f=w)}}if(h===void 0){const _=f??new Error("No error stored at end of fallback.");throw await(c==null?void 0:c.handleChainError(_)),_}let m;try{for await(const _ of h){yield _;try{m=m===void 0?m:Ln(m,_)}catch{m=void 0}}}catch(_){throw await(c==null?void 0:c.handleChainError(_)),_}await(c==null?void 0:c.handleChainEnd(pt(m,"output")))}async batch(e,t,n){var f;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(t??{},e.length),o=await Promise.all(a.map(h=>jn(h))),u=await Promise.all(o.map(async(h,m)=>{const y=await(h==null?void 0:h.handleChainStart(this.toJSON(),pt(e[m],"input"),a[m].runId,void 0,void 0,void 0,a[m].runName));return delete a[m].runId,y}));let c;for(const h of this.runnables()){(f=a[0].signal)==null||f.throwIfAborted();try{const m=await h.batch(e,u.map((y,_)=>xt(a[_],{callbacks:y==null?void 0:y.getChild()})),n);return await Promise.all(u.map((y,_)=>y==null?void 0:y.handleChainEnd(pt(m[_],"output")))),m}catch(m){c===void 0&&(c=m)}}throw c?(await Promise.all(u.map(h=>h==null?void 0:h.handleChainError(c))),c):new Error("No error stored at end of fallbacks.")}}function ha(r){if(typeof r=="function")return new yo({func:r});if(rt.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=ha(n);return new Cs({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class Hb extends rt{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Cs&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const a=this.mapper.getStepsKeys(),[o,u]=Mb(e),c=this.mapper.transform(u,xt(n,{callbacks:t==null?void 0:t.getChild()})),f=c.next();for await(const h of o){if(typeof h!="object"||Array.isArray(h))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof h}`);const m=Object.fromEntries(Object.entries(h).filter(([y])=>!a.includes(y)));Object.keys(m).length>0&&(yield m)}yield(await f).value;for await(const h of c)yield h}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Le(t),o=new Ts({generator:this.transform(n(),a),config:a});return await o.setup,sn.fromAsyncGenerator(o)}}class qx extends rt{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Le(t),o=new Ts({generator:this.transform(n(),a),config:a});return await o.setup,sn.fromAsyncGenerator(o)}}class Fw extends ya{constructor(e){const t=hr.from([yo.from(async n=>{let a;if(db(n))try{a=await this.schema.parseAsync(n.args)}catch{throw new Tk("Received tool input did not match expected schema",JSON.stringify(n.args))}else a=n;return a}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function Zx(r,e){var a;const t=e.name??r.getName(),n=e.description??((a=e.schema)==null?void 0:a.description);return e.schema.constructor===ma.ZodString?new Fw({name:t,description:n,schema:ma.object({input:ma.string()}).transform(o=>o.input),bound:r}):new Fw({name:t,description:n,schema:e.schema,bound:r})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var Wx=typeof window=="object"?window:{},Se="0123456789abcdef".split(""),Gx=[-2147483648,8388608,32768,128],kn=[24,16,8,0],ft=[];function Fn(r){r?(ft[0]=ft[16]=ft[1]=ft[2]=ft[3]=ft[4]=ft[5]=ft[6]=ft[7]=ft[8]=ft[9]=ft[10]=ft[11]=ft[12]=ft[13]=ft[14]=ft[15]=0,this.blocks=ft):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Fn.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===Wx.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,a,o=r.length||0,u=this.blocks;n<o;){if(this.hashed&&(this.hashed=!1,u[0]=this.block,u[16]=u[1]=u[2]=u[3]=u[4]=u[5]=u[6]=u[7]=u[8]=u[9]=u[10]=u[11]=u[12]=u[13]=u[14]=u[15]=0),e)for(a=this.start;n<o&&a<64;++n)u[a>>2]|=r[n]<<kn[a++&3];else for(a=this.start;n<o&&a<64;++n)t=r.charCodeAt(n),t<128?u[a>>2]|=t<<kn[a++&3]:t<2048?(u[a>>2]|=(192|t>>6)<<kn[a++&3],u[a>>2]|=(128|t&63)<<kn[a++&3]):t<55296||t>=57344?(u[a>>2]|=(224|t>>12)<<kn[a++&3],u[a>>2]|=(128|t>>6&63)<<kn[a++&3],u[a>>2]|=(128|t&63)<<kn[a++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),u[a>>2]|=(240|t>>18)<<kn[a++&3],u[a>>2]|=(128|t>>12&63)<<kn[a++&3],u[a>>2]|=(128|t>>6&63)<<kn[a++&3],u[a>>2]|=(128|t&63)<<kn[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=u[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Fn.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=Gx[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};Fn.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,a=this.h4,o,u,c,f=this.blocks;for(u=16;u<80;++u)c=f[u-3]^f[u-8]^f[u-14]^f[u-16],f[u]=c<<1|c>>>31;for(u=0;u<20;u+=5)o=e&t|~e&n,c=r<<5|r>>>27,a=c+o+a+1518500249+f[u]<<0,e=e<<30|e>>>2,o=r&e|~r&t,c=a<<5|a>>>27,n=c+o+n+1518500249+f[u+1]<<0,r=r<<30|r>>>2,o=a&r|~a&e,c=n<<5|n>>>27,t=c+o+t+1518500249+f[u+2]<<0,a=a<<30|a>>>2,o=n&a|~n&r,c=t<<5|t>>>27,e=c+o+e+1518500249+f[u+3]<<0,n=n<<30|n>>>2,o=t&n|~t&a,c=e<<5|e>>>27,r=c+o+r+1518500249+f[u+4]<<0,t=t<<30|t>>>2;for(;u<40;u+=5)o=e^t^n,c=r<<5|r>>>27,a=c+o+a+1859775393+f[u]<<0,e=e<<30|e>>>2,o=r^e^t,c=a<<5|a>>>27,n=c+o+n+1859775393+f[u+1]<<0,r=r<<30|r>>>2,o=a^r^e,c=n<<5|n>>>27,t=c+o+t+1859775393+f[u+2]<<0,a=a<<30|a>>>2,o=n^a^r,c=t<<5|t>>>27,e=c+o+e+1859775393+f[u+3]<<0,n=n<<30|n>>>2,o=t^n^a,c=e<<5|e>>>27,r=c+o+r+1859775393+f[u+4]<<0,t=t<<30|t>>>2;for(;u<60;u+=5)o=e&t|e&n|t&n,c=r<<5|r>>>27,a=c+o+a-1894007588+f[u]<<0,e=e<<30|e>>>2,o=r&e|r&t|e&t,c=a<<5|a>>>27,n=c+o+n-1894007588+f[u+1]<<0,r=r<<30|r>>>2,o=a&r|a&e|r&e,c=n<<5|n>>>27,t=c+o+t-1894007588+f[u+2]<<0,a=a<<30|a>>>2,o=n&a|n&r|a&r,c=t<<5|t>>>27,e=c+o+e-1894007588+f[u+3]<<0,n=n<<30|n>>>2,o=t&n|t&a|n&a,c=e<<5|e>>>27,r=c+o+r-1894007588+f[u+4]<<0,t=t<<30|t>>>2;for(;u<80;u+=5)o=e^t^n,c=r<<5|r>>>27,a=c+o+a-899497514+f[u]<<0,e=e<<30|e>>>2,o=r^e^t,c=a<<5|a>>>27,n=c+o+n-899497514+f[u+1]<<0,r=r<<30|r>>>2,o=a^r^e,c=n<<5|n>>>27,t=c+o+t-899497514+f[u+2]<<0,a=a<<30|a>>>2,o=n^a^r,c=t<<5|t>>>27,e=c+o+e-899497514+f[u+3]<<0,n=n<<30|n>>>2,o=t^n^a,c=e<<5|e>>>27,r=c+o+r-899497514+f[u+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+a<<0};Fn.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,a=this.h4;return Se[r>>28&15]+Se[r>>24&15]+Se[r>>20&15]+Se[r>>16&15]+Se[r>>12&15]+Se[r>>8&15]+Se[r>>4&15]+Se[r&15]+Se[e>>28&15]+Se[e>>24&15]+Se[e>>20&15]+Se[e>>16&15]+Se[e>>12&15]+Se[e>>8&15]+Se[e>>4&15]+Se[e&15]+Se[t>>28&15]+Se[t>>24&15]+Se[t>>20&15]+Se[t>>16&15]+Se[t>>12&15]+Se[t>>8&15]+Se[t>>4&15]+Se[t&15]+Se[n>>28&15]+Se[n>>24&15]+Se[n>>20&15]+Se[n>>16&15]+Se[n>>12&15]+Se[n>>8&15]+Se[n>>4&15]+Se[n&15]+Se[a>>28&15]+Se[a>>24&15]+Se[a>>20&15]+Se[a>>16&15]+Se[a>>12&15]+Se[a>>8&15]+Se[a>>4&15]+Se[a&15]};Fn.prototype.toString=Fn.prototype.hex;Fn.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,a=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,a>>24&255,a>>16&255,a>>8&255,a&255]};Fn.prototype.array=Fn.prototype.digest;Fn.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};const Jx=r=>new Fn(!0).update(r).hex(),Dw=(...r)=>Jx(r.join("_"));class Kx{}const Qx=new Map;class Cp extends Kx{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Dw(e,t))??null)}async update(e,t,n){this.cache.set(Dw(e,t),n)}static global(){return new Cp(Qx)}}class Ap extends wa{}class qb extends Ap{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Os(this.value)]}}class Zb extends Ap{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return fb(this.messages)}toChatMessages(){return this.messages}}class Xx extends Ap{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new Os({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}var vi={},Uw;function Yx(){if(Uw)return vi;Uw=1,vi.byteLength=c,vi.toByteArray=h,vi.fromByteArray=_;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=n.length;a<o;++a)r[a]=n[a],e[n.charCodeAt(a)]=a;e[45]=62,e[95]=63;function u(b){var w=b.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var S=b.indexOf("=");S===-1&&(S=w);var E=S===w?0:4-S%4;return[S,E]}function c(b){var w=u(b),S=w[0],E=w[1];return(S+E)*3/4-E}function f(b,w,S){return(w+S)*3/4-S}function h(b){var w,S=u(b),E=S[0],P=S[1],C=new t(f(b,E,P)),T=0,M=P>0?E-4:E,j;for(j=0;j<M;j+=4)w=e[b.charCodeAt(j)]<<18|e[b.charCodeAt(j+1)]<<12|e[b.charCodeAt(j+2)]<<6|e[b.charCodeAt(j+3)],C[T++]=w>>16&255,C[T++]=w>>8&255,C[T++]=w&255;return P===2&&(w=e[b.charCodeAt(j)]<<2|e[b.charCodeAt(j+1)]>>4,C[T++]=w&255),P===1&&(w=e[b.charCodeAt(j)]<<10|e[b.charCodeAt(j+1)]<<4|e[b.charCodeAt(j+2)]>>2,C[T++]=w>>8&255,C[T++]=w&255),C}function m(b){return r[b>>18&63]+r[b>>12&63]+r[b>>6&63]+r[b&63]}function y(b,w,S){for(var E,P=[],C=w;C<S;C+=3)E=(b[C]<<16&16711680)+(b[C+1]<<8&65280)+(b[C+2]&255),P.push(m(E));return P.join("")}function _(b){for(var w,S=b.length,E=S%3,P=[],C=16383,T=0,M=S-E;T<M;T+=C)P.push(y(b,T,T+C>M?M:T+C));return E===1?(w=b[S-1],P.push(r[w>>2]+r[w<<4&63]+"==")):E===2&&(w=(b[S-2]<<8)+b[S-1],P.push(r[w>>10]+r[w>>4&63]+r[w<<2&63]+"=")),P.join("")}return vi}var eT=Yx();const tT=so(eT);var nT=Object.defineProperty,rT=(r,e,t)=>e in r?nT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,aT=(r,e,t)=>(rT(r,e+"",t),t);function sT(r,e){let t=Array.from({length:r.length},(n,a)=>({start:a,end:a+1}));for(;t.length>1;){let n=null;for(let a=0;a<t.length-1;a++){const o=r.slice(t[a].start,t[a+1].end),u=e.get(o.join(","));u!=null&&(n==null||u<n[0])&&(n=[u,a])}if(n!=null){const a=n[1];t[a]={start:t[a].start,end:t[a+1].end},t.splice(a+1,1)}else break}return t}function iT(r,e){return r.length===1?[e.get(r.join(","))]:sT(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function oT(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Fh=class{constructor(r,e){Lr(this,"specialTokens");Lr(this,"inverseSpecialTokens");Lr(this,"patStr");Lr(this,"textEncoder",new TextEncoder);Lr(this,"textDecoder",new TextDecoder("utf-8"));Lr(this,"rankMap",new Map);Lr(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,a)=>{const[o,u,...c]=a.split(" "),f=Number.parseInt(u,10);return c.forEach((h,m)=>n[h]=f+m),n},{});for(const[n,a]of Object.entries(t)){const o=tT.toByteArray(n);this.rankMap.set(o.join(","),a),this.textMap.set(a,o)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[a,o])=>(n[o]=this.textEncoder.encode(a),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),a=Fh.specialTokenRegex(Object.keys(this.specialTokens)),o=[],u=new Set(e==="all"?Object.keys(this.specialTokens):e),c=new Set(t==="all"?Object.keys(this.specialTokens).filter(h=>!u.has(h)):t);if(c.size>0){const h=Fh.specialTokenRegex([...c]),m=r.match(h);if(m!=null)throw new Error(`The text contains a special token that is not allowed: ${m[0]}`)}let f=0;for(;;){let h=null,m=f;for(;a.lastIndex=m,h=a.exec(r),!(h==null||u.has(h[0]));)m=h.index+1;const y=(h==null?void 0:h.index)??r.length;for(const b of r.substring(f,y).matchAll(n)){const w=this.textEncoder.encode(b[0]),S=this.rankMap.get(w.join(","));if(S!=null){o.push(S);continue}o.push(...iT(w,this.rankMap))}if(h==null)break;let _=this.specialTokens[h[0]];o.push(_),f=h.index+h[0].length}return o}decode(r){const e=[];let t=0;for(let o=0;o<r.length;++o){const u=r[o],c=this.textMap.get(u)??this.inverseSpecialTokens[u];c!=null&&(e.push(c),t+=c.length)}const n=new Uint8Array(t);let a=0;for(const o of e)n.set(o,a),a+=o.length;return this.textDecoder.decode(n)}},Wb=Fh;aT(Wb,"specialTokenRegex",r=>new RegExp(r.map(e=>oT(e)).join("|"),"g"));function uT(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const zu={},lT=new Op({});async function cT(r){return r in zu||(zu[r]=lT.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new Wb(e)).catch(e=>{throw delete zu[r],e})),await zu[r]}async function dT(r){return cT(uT(r))}const fT=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function hT(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const pT=()=>!1;class mT extends rt{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??pT(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class gT extends mT{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){const{cache:a,...o}=n;super({callbacks:e??t,...o}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof a=="object"?this.cache=a:a?this.cache=Cp.global():this.cache=void 0,this.caller=new Op(n??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await dT("modelName"in this?fT(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new qb(e):Array.isArray(e)?new Zb(e.map(Vr)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([u,c])=>c!==void 0).map(([u,c])=>`${u}:${JSON.stringify(c)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class yl extends rt{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=Le(t);return this.func&&await this.func(e,n),this._callWithConfig(a=>Promise.resolve(a),e,n)}async*transform(e,t){const n=Le(t);let a,o=!0;for await(const u of this._transformStreamWithConfig(e,c=>c,n))if(yield u,o)if(a===void 0)a=u;else try{a=Ln(a,u)}catch{a=void 0,o=!1}this.func&&a!==void 0&&await this.func(a,n)}static assign(e){return new Hb(new Cs({steps:e}))}}function Gb(r){return typeof(r==null?void 0:r.parse)=="function"}class zr extends gT{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){const n=zr._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){var n;if(this._streamResponseChunks===zr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const o=zr._convertInputToPromptValue(e).toChatMessages(),[u,c]=this._separateRunnableConfigFromCallOptionsCompat(t),f={...u.metadata,...this.getLsParams(c)},h=await Wt.configure(u.callbacks,this.callbacks,u.tags,this.tags,f,this.metadata,{verbose:this.verbose}),m={options:c,invocation_params:this==null?void 0:this.invocationParams(c),batch_size:1},y=await(h==null?void 0:h.handleChatModelStart(this.toJSON(),[o],u.runId,void 0,m,void 0,void 0,u.runName));let _,b;try{for await(const w of this._streamResponseChunks(o,c,y==null?void 0:y[0])){if(w.message.id==null){const S=(n=y==null?void 0:y.at(0))==null?void 0:n.runId;S!=null&&w.message._updateId(`run-${S}`)}w.message.response_metadata={...w.generationInfo,...w.message.response_metadata},yield w.message,_?_=_.concat(w):_=w,l_(w.message)&&w.message.usage_metadata!==void 0&&(b={tokenUsage:{promptTokens:w.message.usage_metadata.input_tokens,completionTokens:w.message.usage_metadata.output_tokens,totalTokens:w.message.usage_metadata.total_tokens}})}}catch(w){throw await Promise.all((y??[]).map(S=>S==null?void 0:S.handleLLMError(w))),w}await Promise.all((y??[]).map(w=>w==null?void 0:w.handleLLMEnd({generations:[[_]],llmOutput:b})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n){var b,w;const a=e.map(S=>S.map(Vr)),o={...n.metadata,...this.getLsParams(t)},u=await Wt.configure(n.callbacks,this.callbacks,n.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1},f=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),a,n.runId,void 0,c,void 0,void 0,n.runName)),h=[],m=[];if(!!(f!=null&&f[0].handlers.find(vO))&&a.length===1&&this._streamResponseChunks!==zr.prototype._streamResponseChunks)try{const S=await this._streamResponseChunks(a[0],t,f==null?void 0:f[0]);let E,P;for await(const C of S){if(C.message.id==null){const T=(b=f==null?void 0:f.at(0))==null?void 0:b.runId;T!=null&&C.message._updateId(`run-${T}`)}E===void 0?E=C:E=Ln(E,C),l_(C.message)&&C.message.usage_metadata!==void 0&&(P={tokenUsage:{promptTokens:C.message.usage_metadata.input_tokens,completionTokens:C.message.usage_metadata.output_tokens,totalTokens:C.message.usage_metadata.total_tokens}})}if(E===void 0)throw new Error("Received empty response from chat model call.");h.push([E]),await(f==null?void 0:f[0].handleLLMEnd({generations:h,llmOutput:P}))}catch(S){throw await(f==null?void 0:f[0].handleLLMError(S)),S}else{const S=await Promise.allSettled(a.map((E,P)=>this._generate(E,{...t,promptIndex:P},f==null?void 0:f[P])));await Promise.all(S.map(async(E,P)=>{var C,T,M;if(E.status==="fulfilled"){const j=E.value;for(const D of j.generations){if(D.message.id==null){const V=(C=f==null?void 0:f.at(0))==null?void 0:C.runId;V!=null&&D.message._updateId(`run-${V}`)}D.message.response_metadata={...D.generationInfo,...D.message.response_metadata}}return j.generations.length===1&&(j.generations[0].message.response_metadata={...j.llmOutput,...j.generations[0].message.response_metadata}),h[P]=j.generations,m[P]=j.llmOutput,(T=f==null?void 0:f[P])==null?void 0:T.handleLLMEnd({generations:[j.generations],llmOutput:j.llmOutput})}else return await((M=f==null?void 0:f[P])==null?void 0:M.handleLLMError(E.reason)),Promise.reject(E.reason)}))}const _={generations:h,llmOutput:m.length?(w=this._combineLLMOutput)==null?void 0:w.call(this,...m):void 0};return Object.defineProperty(_,Iw,{value:f?{runIds:f==null?void 0:f.map(S=>S.runId)}:void 0,configurable:!0}),_}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:a,handledOptions:o}){const u=e.map(E=>E.map(Vr)),c={...o.metadata,...this.getLsParams(a)},f=await Wt.configure(o.callbacks,this.callbacks,o.tags,this.tags,c,this.metadata,{verbose:this.verbose}),h={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1,cached:!0},m=await(f==null?void 0:f.handleChatModelStart(this.toJSON(),u,o.runId,void 0,h,void 0,void 0,o.runName)),y=[],b=(await Promise.allSettled(u.map(async(E,P)=>{const C=zr._convertInputToPromptValue(E).toString(),T=await t.lookup(C,n);return T==null&&y.push(P),T}))).map((E,P)=>({result:E,runManager:m==null?void 0:m[P]})).filter(({result:E})=>E.status==="fulfilled"&&E.value!=null||E.status==="rejected"),w=[];await Promise.all(b.map(async({result:E,runManager:P},C)=>{if(E.status==="fulfilled"){const T=E.value;return w[C]=T,T.length&&await(P==null?void 0:P.handleLLMNewToken(T[0].text)),P==null?void 0:P.handleLLMEnd({generations:[T]})}else return await(P==null?void 0:P.handleLLMError(E.reason)),Promise.reject(E.reason)}));const S={generations:w,missingPromptIndices:y};return Object.defineProperty(S,Iw,{value:m?{runIds:m==null?void 0:m.map(E=>E.runId)}:void 0,configurable:!0}),S}async generate(e,t,n){let a;Array.isArray(t)?a={stop:t}:a=t;const o=e.map(b=>b.map(Vr)),[u,c]=this._separateRunnableConfigFromCallOptionsCompat(a);if(u.callbacks=u.callbacks??n,!this.cache)return this._generateUncached(o,c,u);const{cache:f}=this,h=this._getSerializedCacheKeyParametersForCall(c),{generations:m,missingPromptIndices:y}=await this._generateCached({messages:o,cache:f,llmStringKey:h,parsedOptions:c,handledOptions:u});let _={};if(y.length>0){const b=await this._generateUncached(y.map(w=>o[w]),c,u);await Promise.all(b.generations.map(async(w,S)=>{const E=y[S];m[E]=w;const P=zr._convertInputToPromptValue(o[E]).toString();return f.update(P,h,w)})),_=b.llmOutput??{}}return{generations:m,llmOutput:_}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const a=e.map(o=>o.toChatMessages());return this.generate(a,t,n)}async call(e,t,n){return(await this.generate([e.map(Vr)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const a=e.toChatMessages();return this.call(a,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const a=new Os(e),o=await this.call([a],t,n);if(typeof o.content!="string")throw new Error("Cannot use predict when output is not a string.");return o.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const n=e,a=t==null?void 0:t.name,o=n.description??"A function available to call.",u=t==null?void 0:t.method,c=t==null?void 0:t.includeRaw;if(u==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let f=a??"extract",h;Gb(n)?h=[{type:"function",function:{name:f,description:o,parameters:go(n)}}]:("name"in n&&(f=n.name),h=[{type:"function",function:{name:f,description:o,parameters:n}}]);const m=this.bindTools(h),y=yo.from(S=>{if(!S.tool_calls||S.tool_calls.length===0)throw new Error("No tool calls found in the response.");const E=S.tool_calls.find(P=>P.name===f);if(!E)throw new Error(`No tool call found with name ${f}.`);return E.args});if(!c)return m.pipe(y).withConfig({runName:"StructuredOutput"});const _=yl.assign({parsed:(S,E)=>y.invoke(S.raw,E)}),b=yl.assign({parsed:()=>null}),w=_.withFallbacks({fallbacks:[b]});return hr.from([{raw:m},w]).withConfig({runName:"StructuredOutputRunnable"})}}class yT extends rt{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,a)=>this.parseResult([{text:n}],a==null?void 0:a.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,a)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],a==null?void 0:a.callbacks),e,{...t,runType:"parser"})}}class Jb extends yT{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class Ip extends Error{constructor(e,t,n,a=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=a,a&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Il(this,"OUTPUT_PARSING_FAILURE")}}function Dh(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let a=0;a<n;a++)if(!Dh(r[a],e[a]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),a=Object.keys(e);if(n.length!==a.length)return!1;for(const u of n)if(!Dh(r[u],e[u]))return!1;return!0}return r===e}class _T extends Jb{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class Kb extends _T{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const a of e){if(typeof a!="string"&&typeof a.content!="string")throw new Error("Cannot handle non-string output.");let o;if(Pk(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");o=new ws({message:a,text:a.content})}else if(xl(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");o=new ws({message:Ik(a),text:a.content})}else o=new _s({text:a});n===void 0?n=o:n=n.concat(o);const u=await this.parsePartialResult([n]);u!=null&&!Dh(u,t)&&(this.diff?yield this._diff(t,u):yield u,t=u)}}getFormatInstructions(){return""}}class zw extends Jb{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=ma.object(Object.fromEntries(Object.entries(e).map(([n,a])=>[n,ma.string().describe(a)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(go(this.schema))}
\`\`\`
`}async parse(e){try{const n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(a,o)=>`"${o.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(n))}catch(t){throw new Ip(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class Bw extends Kb{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?fO(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return s_(e[0].text)}async parse(e){return s_(e,JSON.parse)}getFormatInstructions(){return""}}function Qb(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=pp(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(a){throw new Ip([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${a.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function wT(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function vT(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}class bT extends Kb{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var u;const n=e[0].message;let a;if(gp(n)&&((u=n.tool_calls)!=null&&u.length)?a=n.tool_calls.map(c=>{const{id:f,...h}=c;return this.returnId?{id:f,...h}:h}):n.additional_kwargs.tool_calls!==void 0&&(a=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(f=>Qb(f,{returnId:this.returnId,partial:t}))),!a)return[];const o=[];for(const c of a)if(c!==void 0){const f={type:c.name,args:c.args,id:c.id};o.push(f)}return o}}class Vw extends bT{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new Ip(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(o=>o.type===this.keyName);let a=n;if(n.length)return this.returnId||(a=n.map(o=>o.args)),this.returnSingle?a[0]:a}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(u=>u.type===this.keyName);let a=n;return n.length?(this.returnId||(a=n.map(u=>u.args)),this.returnSingle?this._validateResult(a[0]):await Promise.all(a.map(u=>this._validateResult(u)))):void 0}}const ET=Symbol("Let zodToJsonSchema decide on which parser to use"),Hw={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},ST=r=>typeof r=="string"?{...Hw,basePath:["#"],definitions:{},name:r}:{...Hw,basePath:["#"],definitions:{},...r},Uh=r=>"_def"in r?r._def:r;function kT(r){if(!r)return!0;for(const e in r)return!1;return!0}const PT=r=>{const e=ST(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,a])=>[Uh(a),{def:Uh(a),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Xb(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function De(r,e,t,n,a){r[e]=t,Xb(r,e,n,a)}function OT(){return{}}function xT(r,e){var n,a;const t={type:"array"};return((a=(n=r.type)==null?void 0:n._def)==null?void 0:a.typeName)!==L.ZodAny&&(t.items=Ne(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&De(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&De(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(De(t,"minItems",r.exactLength.value,r.exactLength.message,e),De(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function TT(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?De(t,"minimum",n.value,n.message,e):De(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),De(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?De(t,"maximum",n.value,n.message,e):De(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),De(t,"maximum",n.value,n.message,e));break;case"multipleOf":De(t,"multipleOf",n.value,n.message,e);break}return t}function CT(){return{type:"boolean"}}function AT(r,e){return Ne(r.type._def,e)}const IT=(r,e)=>Ne(r.innerType._def,e);function Yb(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>Yb(r,e,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return RT(r,e)}}const RT=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":De(t,"minimum",n.value,n.message,e);break;case"max":De(t,"maximum",n.value,n.message,e);break}return t};function NT(r,e){return{...Ne(r.innerType._def,e),default:r.defaultValue()}}function $T(r,e,t){return e.effectStrategy==="input"?Ne(r.schema._def,e,t):{}}function jT(r){return{type:"string",enum:[...r.values]}}const LT=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function MT(r,e){const t=[Ne(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Ne(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return t.forEach(o=>{if(LT(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let u=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:c,...f}=o;u=f}else n=void 0;a.push(u)}}),a.length?{allOf:a,...n}:void 0}function FT(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let uh;const ca={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(uh===void 0&&(uh=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),uh),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function e0(r,e){const t={type:"string"};function n(a){return e.patternStrategy==="escape"?DT(a):a}if(r.checks)for(const a of r.checks)switch(a.kind){case"min":De(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,a.value):a.value,a.message,e);break;case"max":De(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Pn(t,"email",a.message,e);break;case"format:idn-email":Pn(t,"idn-email",a.message,e);break;case"pattern:zod":On(t,ca.email,a.message,e);break}break;case"url":Pn(t,"uri",a.message,e);break;case"uuid":Pn(t,"uuid",a.message,e);break;case"regex":On(t,a.regex,a.message,e);break;case"cuid":On(t,ca.cuid,a.message,e);break;case"cuid2":On(t,ca.cuid2,a.message,e);break;case"startsWith":On(t,RegExp(`^${n(a.value)}`),a.message,e);break;case"endsWith":On(t,RegExp(`${n(a.value)}$`),a.message,e);break;case"datetime":Pn(t,"date-time",a.message,e);break;case"date":Pn(t,"date",a.message,e);break;case"time":Pn(t,"time",a.message,e);break;case"duration":Pn(t,"duration",a.message,e);break;case"length":De(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,a.value):a.value,a.message,e),De(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,a.value):a.value,a.message,e);break;case"includes":{On(t,RegExp(n(a.value)),a.message,e);break}case"ip":{a.version!=="v6"&&Pn(t,"ipv4",a.message,e),a.version!=="v4"&&Pn(t,"ipv6",a.message,e);break}case"emoji":On(t,ca.emoji,a.message,e);break;case"ulid":{On(t,ca.ulid,a.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Pn(t,"binary",a.message,e);break}case"contentEncoding:base64":{De(t,"contentEncoding","base64",a.message,e);break}case"pattern:zod":{On(t,ca.base64,a.message,e);break}}break}case"nanoid":On(t,ca.nanoid,a.message,e)}return t}const DT=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Pn=(r,e,t,n)=>{var a;r.format||(a=r.anyOf)!=null&&a.some(o=>o.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):De(r,"format",e,t,n)},On=(r,e,t,n)=>{var a;r.pattern||(a=r.allOf)!=null&&a.some(o=>o.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:qw(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):De(r,"pattern",qw(e,n),t,n)},qw=(r,e)=>{var h;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},a=n.i?t.source.toLowerCase():t.source;let o="",u=!1,c=!1,f=!1;for(let m=0;m<a.length;m++){if(u){o+=a[m],u=!1;continue}if(n.i){if(c){if(a[m].match(/[a-z]/)){f?(o+=a[m],o+=`${a[m-2]}-${a[m]}`.toUpperCase(),f=!1):a[m+1]==="-"&&((h=a[m+2])!=null&&h.match(/[a-z]/))?(o+=a[m],f=!0):o+=`${a[m]}${a[m].toUpperCase()}`;continue}}else if(a[m].match(/[a-z]/)){o+=`[${a[m]}${a[m].toUpperCase()}]`;continue}}if(n.m){if(a[m]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[m]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&a[m]==="."){o+=c?`${a[m]}\r
`:`[${a[m]}\r
]`;continue}o+=a[m],a[m]==="\\"?u=!0:c&&a[m]==="]"?c=!1:!c&&a[m]==="["&&(c=!0)}try{const m=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return o};function t0(r,e){var n,a,o,u;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===L.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((c,f)=>({...c,[f]:Ne(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",f]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:Ne(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((a=r.keyType)==null?void 0:a._def.typeName)===L.ZodString&&((o=r.keyType._def.checks)!=null&&o.length)){const c=Object.entries(e0(r.keyType._def,e)).reduce((f,[h,m])=>h==="type"?f:{...f,[h]:m},{});return{...t,propertyNames:c}}else if(((u=r.keyType)==null?void 0:u._def.typeName)===L.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function UT(r,e){if(e.mapStrategy==="record")return t0(r,e);const t=Ne(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Ne(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function zT(r){const e=r.values,n=Object.keys(r.values).filter(o=>typeof e[e[o]]!="number").map(o=>e[o]),a=Array.from(new Set(n.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function BT(){return{not:{}}}function VT(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const _l={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function HT(r,e){if(e.target==="openApi3")return Zw(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in _l&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((a,o)=>{const u=_l[o._def.typeName];return u&&!a.includes(u)?[...a,u]:a},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((a,o)=>{const u=typeof o._def.value;switch(u){case"string":case"number":case"boolean":return[...a,u];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===t.length){const a=n.filter((o,u,c)=>c.indexOf(o)===u);return{type:a.length>1?a:a[0],enum:t.reduce((o,u)=>o.includes(u._def.value)?o:[...o,u._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return Zw(r,e)}const Zw=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,a)=>Ne(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function qT(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:_l[r.innerType._def.typeName],nullable:!0}:{type:[_l[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Ne(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Ne(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function ZT(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",Xb(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?De(t,"minimum",n.value,n.message,e):De(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),De(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?De(t,"maximum",n.value,n.message,e):De(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),De(t,"maximum",n.value,n.message,e));break;case"multipleOf":De(t,"multipleOf",n.value,n.message,e);break}return t}function WT(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":Ne(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":Ne(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function GT(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((n,[a,o])=>{if(o===void 0||o._def===void 0)return n;const u=Ne(o._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});return u===void 0?n:{properties:{...n.properties,[a]:u},required:o.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,a]}},{properties:{},required:[]}),additionalProperties:WT(r,e)};return t.required.length||delete t.required,t}const JT=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Ne(r.innerType._def,e);const t=Ne(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},KT=(r,e)=>{if(e.pipeStrategy==="input")return Ne(r.in._def,e);if(e.pipeStrategy==="output")return Ne(r.out._def,e);const t=Ne(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Ne(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(a=>a!==void 0)}};function QT(r,e){return Ne(r.type._def,e)}function XT(r,e){const n={type:"array",uniqueItems:!0,items:Ne(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&De(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&De(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function YT(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Ne(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Ne(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Ne(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function eC(){return{not:{}}}function tC(){return{}}const nC=(r,e)=>Ne(r.innerType._def,e);function Ne(r,e,t=!1){var u;const n=e.seen.get(r);if(e.override){const c=(u=e.override)==null?void 0:u.call(e,r,e,n,t);if(c!==ET)return c}if(n&&!t){const c=rC(n,e);if(c!==void 0)return"$ref"in c&&e.seenRefs.add(c.$ref),c}const a={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,a);const o=sC(r,r.typeName,e,t);return o&&iC(r,e,o),a.jsonSchema=o,o}const rC=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:aC(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,a)=>e.currentPath[a]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},aC=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},sC=(r,e,t,n)=>{switch(e){case L.ZodString:return e0(r,t);case L.ZodNumber:return ZT(r,t);case L.ZodObject:return GT(r,t);case L.ZodBigInt:return TT(r,t);case L.ZodBoolean:return CT();case L.ZodDate:return Yb(r,t);case L.ZodUndefined:return eC();case L.ZodNull:return VT(t);case L.ZodArray:return xT(r,t);case L.ZodUnion:case L.ZodDiscriminatedUnion:return HT(r,t);case L.ZodIntersection:return MT(r,t);case L.ZodTuple:return YT(r,t);case L.ZodRecord:return t0(r,t);case L.ZodLiteral:return FT(r,t);case L.ZodEnum:return jT(r);case L.ZodNativeEnum:return zT(r);case L.ZodNullable:return qT(r,t);case L.ZodOptional:return JT(r,t);case L.ZodMap:return UT(r,t);case L.ZodSet:return XT(r,t);case L.ZodLazy:return Ne(r.getter()._def,t);case L.ZodPromise:return QT(r,t);case L.ZodNaN:case L.ZodNever:return BT();case L.ZodEffects:return $T(r,t,n);case L.ZodAny:return OT();case L.ZodUnknown:return tC();case L.ZodDefault:return NT(r,t);case L.ZodBranded:return AT(r,t);case L.ZodReadonly:return nC(r,t);case L.ZodCatch:return IT(r,t);case L.ZodPipeline:return KT(r,t);case L.ZodFunction:case L.ZodVoid:case L.ZodSymbol:return;default:return(a=>{})()}},iC=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),oC=(r,e)=>{const t=PT(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,a=Ne(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(a.title=o);const u=(()=>{if(kT(t.definitions))return;const f={},h=new Set;for(let m=0;m<500;m++){const y=Object.entries(t.definitions).filter(([_])=>!h.has(_));if(y.length===0)break;for(const[_,b]of y)f[_]=Ne(Uh(b),{...t,currentPath:[...t.basePath,t.definitionPath,_]},!0)??{},h.add(_)}return f})(),c=n===void 0?u?{...a,[t.definitionPath]:u}:a:t.nameStrategy==="duplicate-ref"?{...a,...u||t.seenRefs.size?{[t.definitionPath]:{...u,...t.seenRefs.size?{[n]:a}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...u,[n]:a}};return t.target==="jsonSchema7"?c.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(c.$schema="https://json-schema.org/draft/2019-09/schema#"),c};function n0(r,e){return oC(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function uC(r,e,t){return ek({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:n0(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function lC(r){return tk({type:"function",function:{name:r.name,parameters:n0(r.parameters,{name:r.name}),strict:!0,...r.description?{description:r.description}:void 0}},{callback:r.function,parser:e=>r.parameters.parse(JSON.parse(e))})}function cC(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:a,baseURL:o,azureADTokenProvider:u,azureOpenAIEndpoint:c}=r;if((n||u)&&a&&e)return`${a}/${e}`;if((n||u)&&c&&e)return`${c}/openai/deployments/${e}`;if(n||u){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return o}function dC(r,e){const t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:go(r.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function fC(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function hC(r){return r!==void 0&&rt.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function pC(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&Gb(r.schema)}function mC(r){return pC(r)||hC(r)||fC(r)}function Bu(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Ww(r){let e;return r.constructor.name===El.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===pn.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=Bu(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Bu(r,"MODEL_AUTHENTICATION"):r.status===429?e=Bu(r,"MODEL_RATE_LIMIT"):r.status===404?e=Bu(r,"MODEL_NOT_FOUND"):e=r,e}function gC(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function yC(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function _C(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(r0(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function r0(r,e){var n;const t=[];for(const[a,o]of Object.entries(r.properties??{}))o.description&&e<2&&t.push(`// ${o.description}`),(n=r.required)!=null&&n.includes(a)?t.push(`${a}: ${wl(o,e)},`):t.push(`${a}?: ${wl(o,e)},`);return t.map(a=>" ".repeat(e)+a).join(`
`)}function wl(r,e){if(yC(r))return r.anyOf.map(t=>wl(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",r0(r,e+2),"}"].join(`
`);case"array":return r.items?`${wl(r.items,e)}[]`:"any[]";default:return""}}function wC(r,e){let t;if(mC(r)){const n=lC({name:r.name,parameters:r.schema,description:r.description});n.function.parameters?t={type:n.type,function:{name:n.function.name,description:n.function.description,parameters:n.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:dC(r,e)}}else t=r;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function vC(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function a0(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!ka.isInstance(r))throw new Error("Invalid generic chat message");return vC(r)}default:throw new Error(`Unknown message type: ${e}`)}}function bC(r,e,t){const n=r.tool_calls;switch(r.role){case"assistant":{const a=[],o=[];for(const f of n??[])try{a.push(Qb(f,{returnId:!0}))}catch(h){o.push(vT(f,h.message))}const u={function_call:r.function_call,tool_calls:n};t!==void 0&&(u.__raw_response=e);const c={model_name:e.model,...e.system_fingerprint?{usage:{...e.usage},system_fingerprint:e.system_fingerprint}:{}};return r.audio&&(u.audio=r.audio),new Ui({content:r.content||"",tool_calls:a,invalid_tool_calls:o,additional_kwargs:u,response_metadata:c,id:e.id})}default:return new ka(r.content||"",r.role??"unknown")}}function EC(r,e,t,n){var f,h;const a=r.role??t,o=r.content??"";let u;r.function_call?u={function_call:r.function_call}:r.tool_calls?u={tool_calls:r.tool_calls}:u={},n&&(u.__raw_response=e),r.audio&&(u.audio={...r.audio,index:e.choices[0].index});const c={usage:{...e.usage}};if(a==="user")return new Al({content:o,response_metadata:c});if(a==="assistant"){const m=[];if(Array.isArray(r.tool_calls))for(const y of r.tool_calls)m.push({name:(f=y.function)==null?void 0:f.name,args:(h=y.function)==null?void 0:h.arguments,id:y.id,index:y.index,type:"tool_call_chunk"});return new Sa({content:o,tool_call_chunks:m,additional_kwargs:u,id:e.id,response_metadata:c})}else return a==="system"?new zi({content:o,response_metadata:c}):a==="developer"?new zi({content:o,response_metadata:c,additional_kwargs:{__openai_role__:"developer"}}):a==="function"?new Cl({content:o,additional_kwargs:u,name:r.name,response_metadata:c}):a==="tool"?new mp({content:o,additional_kwargs:u,tool_call_id:r.tool_call_id,response_metadata:c}):new Tl({content:o,role:a,response_metadata:c})}function Gw(r,e){return r.flatMap(t=>{var o;let n=a0(t);n==="system"&&(e!=null&&e.startsWith("o1"))&&(n="developer");const a={role:n,content:t.content};if(t.name!=null&&(a.name=t.name),t.additional_kwargs.function_call!=null&&(a.function_call=t.additional_kwargs.function_call,a.content=null),gp(t)&&((o=t.tool_calls)!=null&&o.length)?(a.tool_calls=t.tool_calls.map(wT),a.content=null):(t.additional_kwargs.tool_calls!=null&&(a.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(a.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const u={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[a,u]}return a})}function Jw(r,e){return hT(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:wC(r,e)}class SC extends zr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var n,a,o,u,c,f,h,m,y;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIEndpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((n=e==null?void 0:e.configuration)==null?void 0:n.apiKey)??Ot("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??Ot("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=(e==null?void 0:e.azureADTokenProvider)??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??Ot("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??Ot("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??Ot("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??Ot("AZURE_OPENAI_BASE_PATH"),this.organization=((a=e==null?void 0:e.configuration)==null?void 0:a.organization)??Ot("OPENAI_ORGANIZATION"),this.azureOpenAIEndpoint=(e==null?void 0:e.azureOpenAIEndpoint)??Ot("AZURE_OPENAI_ENDPOINT"),this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath&&!this.azureOpenAIEndpoint)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName&&this.azureOpenAIBasePath){const _=this.azureOpenAIBasePath.split("/openai/deployments/");if(_.length===2){const[,b]=_;this.azureOpenAIApiDeploymentName=b}}if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??"",this.streamUsage=!1}this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((o=e==null?void 0:e.configuration)==null?void 0:o.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((u=t==null?void 0:t.baseOptions)==null?void 0:u.headers)??((f=(c=e==null?void 0:e.configuration)==null?void 0:c.baseOptions)==null?void 0:f.headers),defaultQuery:((h=t==null?void 0:t.baseOptions)==null?void 0:h.params)??((y=(m=e==null?void 0:e.configuration)==null?void 0:m.baseOptions)==null?void 0:y.params),...t,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(a=>Jw(a,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Vu(e.json_schema.schema)?uC(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var c;let n;(e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling);let a={};(e==null?void 0:e.stream_options)!==void 0?a={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(a={stream_options:{include_usage:!0}});const o={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(c=e==null?void 0:e.tools)!=null&&c.length?e.tools.map(f=>Jw(f,{strict:n})):void 0,tool_choice:gC(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...a,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(o.prediction=e.prediction);const u=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return u!==void 0&&(o.reasoning_effort=u),o}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var h,m,y,_,b,w,S,E,P,C;const a=Gw(e,this.model),o={...this.invocationParams(t,{streaming:!0}),messages:a,stream:!0};let u;const c=await this.completionWithRetry(o,t);let f;for await(const T of c){const M=(h=T==null?void 0:T.choices)==null?void 0:h[0];if(T.usage&&(f=T.usage),!M)continue;const{delta:j}=M;if(!j)continue;const D=EC(j,T,u,this.__includeRawResponse);u=j.role??u;const V={prompt:t.promptIndex??0,completion:M.index??0};if(typeof D.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const q={...V};M.finish_reason!=null&&(q.finish_reason=M.finish_reason,q.system_fingerprint=T.system_fingerprint,q.model_name=T.model),this.logprobs&&(q.logprobs=M.logprobs);const me=new ws({message:D,text:D.content,generationInfo:q});yield me,await(n==null?void 0:n.handleLLMNewToken(me.text??"",V,void 0,void 0,void 0,{chunk:me}))}if(f){const T={...((m=f.prompt_tokens_details)==null?void 0:m.audio_tokens)!==null&&{audio:(y=f.prompt_tokens_details)==null?void 0:y.audio_tokens},...((_=f.prompt_tokens_details)==null?void 0:_.cached_tokens)!==null&&{cache_read:(b=f.prompt_tokens_details)==null?void 0:b.cached_tokens}},M={...((w=f.completion_tokens_details)==null?void 0:w.audio_tokens)!==null&&{audio:(S=f.completion_tokens_details)==null?void 0:S.audio_tokens},...((E=f.completion_tokens_details)==null?void 0:E.reasoning_tokens)!==null&&{reasoning:(P=f.completion_tokens_details)==null?void 0:P.reasoning_tokens}};yield new ws({message:new Sa({content:"",response_metadata:{usage:{...f}},usage_metadata:{input_tokens:f.prompt_tokens,output_tokens:f.completion_tokens,total_tokens:f.total_tokens,...Object.keys(T).length>0&&{input_token_details:T},...Object.keys(M).length>0&&{output_token_details:M}}}),text:""})}if((C=t.signal)!=null&&C.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){var c,f;const a={},o=this.invocationParams(t),u=Gw(e,this.model);if(o.stream){const h=this._streamResponseChunks(e,t,n),m={};for await(const E of h){E.message.response_metadata={...E.generationInfo,...E.message.response_metadata};const P=((c=E.generationInfo)==null?void 0:c.completion)??0;m[P]===void 0?m[P]=E:m[P]=m[P].concat(E)}const y=Object.entries(m).sort(([E],[P])=>parseInt(E,10)-parseInt(P,10)).map(([E,P])=>P),{functions:_,function_call:b}=this.invocationParams(t),w=await this.getEstimatedTokenCountFromPrompt(e,_,b),S=await this.getNumTokensFromGenerations(y);return a.input_tokens=w,a.output_tokens=S,a.total_tokens=w+S,{generations:y,llmOutput:{estimatedTokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}else{let h;t.response_format&&t.response_format.type==="json_schema"?h=await this.betaParsedCompletionWithRetry({...o,stream:!1,messages:u},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):h=await this.completionWithRetry({...o,stream:!1,messages:u},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:m,prompt_tokens:y,total_tokens:_,prompt_tokens_details:b,completion_tokens_details:w}=(h==null?void 0:h.usage)??{};m&&(a.output_tokens=(a.output_tokens??0)+m),y&&(a.input_tokens=(a.input_tokens??0)+y),_&&(a.total_tokens=(a.total_tokens??0)+_),((b==null?void 0:b.audio_tokens)!==null||(b==null?void 0:b.cached_tokens)!==null)&&(a.input_token_details={...(b==null?void 0:b.audio_tokens)!==null&&{audio:b==null?void 0:b.audio_tokens},...(b==null?void 0:b.cached_tokens)!==null&&{cache_read:b==null?void 0:b.cached_tokens}}),((w==null?void 0:w.audio_tokens)!==null||(w==null?void 0:w.reasoning_tokens)!==null)&&(a.output_token_details={...(w==null?void 0:w.audio_tokens)!==null&&{audio:w==null?void 0:w.audio_tokens},...(w==null?void 0:w.reasoning_tokens)!==null&&{reasoning:w==null?void 0:w.reasoning_tokens}});const S=[];for(const E of(h==null?void 0:h.choices)??[]){const C={text:((f=E.message)==null?void 0:f.content)??"",message:bC(E.message??{role:"assistant"},h,this.__includeRawResponse)};C.generationInfo={...E.finish_reason?{finish_reason:E.finish_reason}:{},...E.logprobs?{logprobs:E.logprobs}:{}},gp(C.message)&&(C.message.usage_metadata=a),C.message=new Ui(Object.fromEntries(Object.entries(C.message).filter(([T])=>!T.startsWith("lc_")))),S.push(C)}return{generations:S,llmOutput:{tokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let a=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const o=_C(t);a+=await this.getNumTokens(o),a+=9}return t&&e.find(o=>o._getType()==="system")&&(a-=4),n==="none"?a+=1:typeof n=="object"&&(a+=await this.getNumTokens(n.name)+4),a}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var a;return(a=n.message.additional_kwargs)!=null&&a.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,a)=>n+a,0)}async getNumTokensFromMessages(e){let t=0,n=0,a=0;this.model==="gpt-3.5-turbo-0301"?(n=4,a=-1):(n=3,a=1);const o=await Promise.all(e.map(async u=>{var _,b,w,S,E,P;const c=await this.getNumTokens(u.content),f=await this.getNumTokens(a0(u)),h=u.name!==void 0?a+await this.getNumTokens(u.name):0;let m=c+n+f+h;const y=u;if(y._getType()==="function"&&(m-=2),(_=y.additional_kwargs)!=null&&_.function_call&&(m+=3),(b=y==null?void 0:y.additional_kwargs.function_call)!=null&&b.name&&(m+=await this.getNumTokens((w=y.additional_kwargs.function_call)==null?void 0:w.name)),(S=y.additional_kwargs.function_call)!=null&&S.arguments)try{m+=await this.getNumTokens(JSON.stringify(JSON.parse((E=y.additional_kwargs.function_call)==null?void 0:E.arguments)))}catch(C){console.error("Error parsing function arguments",C,JSON.stringify(y.additional_kwargs.function_call)),m+=await this.getNumTokens((P=y.additional_kwargs.function_call)==null?void 0:P.arguments)}return t+=m,m}));return t+=3,{totalCount:t,countPerMessage:o}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(a){throw Ww(a)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(a){throw Ww(a)}})}_getClientOptions(e){if(!this.client){const n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL,azureOpenAIEndpoint:this.azureOpenAIEndpoint},a=cC(n),o={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};o.baseURL||delete o.baseURL,this.client=new Te(o)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,a,o,u;kC(e)?(n=e.schema,a=e.name,o=e.method,u=e.includeRaw):(n=e,a=t==null?void 0:t.name,o=t==null?void 0:t.method,u=t==null?void 0:t.includeRaw);let c,f;if((t==null?void 0:t.strict)!==void 0&&o==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(o==="jsonMode")c=this.bind({response_format:{type:"json_object"}}),Vu(n)?f=zw.fromZodSchema(n):f=new Bw;else if(o==="jsonSchema")c=this.bind({response_format:{type:"json_schema",json_schema:{name:a??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),Vu(n)?f=zw.fromZodSchema(n):f=new Bw;else{let _=a??"extract";if(Vu(n)){const b=go(n);c=this.bind({tools:[{type:"function",function:{name:_,description:b.description,parameters:b}}],tool_choice:{type:"function",function:{name:_}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),f=new Vw({returnSingle:!0,keyName:_,zodSchema:n})}else{let b;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(b=n,_=n.name):(_=n.title??_,b={name:_,description:n.description??"",parameters:n}),c=this.bind({tools:[{type:"function",function:b}],tool_choice:{type:"function",function:{name:_}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),f=new Vw({returnSingle:!0,keyName:_})}}if(!u)return c.pipe(f);const h=yl.assign({parsed:(_,b)=>f.invoke(_.raw,b)}),m=yl.assign({parsed:()=>null}),y=h.withFallbacks({fallbacks:[m]});return hr.from([{raw:c},y])}}function Vu(r){return typeof(r==null?void 0:r.parse)=="function"}function kC(r){return r!==void 0&&typeof r.schema=="object"}const PC="modulepreload",OC=function(r){return"/"+r},Kw={},lh=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),c=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));a=Promise.allSettled(t.map(f=>{if(f=OC(f),f in Kw)return;Kw[f]=!0;const h=f.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${m}`))return;const y=document.createElement("link");if(y.rel=h?"stylesheet":PC,h||(y.as="script"),y.crossOrigin="",y.href=f,c&&y.setAttribute("nonce",c),document.head.appendChild(y),h)return new Promise((_,b)=>{y.addEventListener("load",_),y.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(u){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=u,window.dispatchEvent(c),!c.defaultPrevented)throw u}return a.then(u=>{for(const c of u||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})};class Rp extends rt{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},n={};for(const[o,u]of Object.entries(t))typeof u=="string"?n[o]=u:n[o]=await u();return{...n,...e}}async invoke(e,t){const n={...this.metadata,...t==null?void 0:t.metadata},a=[...this.tags??[],...(t==null?void 0:t.tags)??[]];return this._callWithConfig(o=>this.formatPromptValue(o),e,{...t,tags:a,metadata:n,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await lh(async()=>{const{PromptTemplate:n}=await Promise.resolve().then(()=>Yw);return{PromptTemplate:n}},void 0);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await lh(async()=>{const{PromptTemplate:n}=await Promise.resolve().then(()=>Yw);return{PromptTemplate:n}},void 0);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await lh(async()=>{const{FewShotPromptTemplate:n}=await import("./few_shot-hQwP0fy0.js");return{FewShotPromptTemplate:n}},[]);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class zh extends Rp{async formatPromptValue(e){const t=await this.format(e);return new qb(t)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var xC=Object.prototype.toString,As=Array.isArray||function(e){return xC.call(e)==="[object Array]"};function Np(r){return typeof r=="function"}function TC(r){return As(r)?"array":typeof r}function ch(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Qw(r,e){return r!=null&&typeof r=="object"&&e in r}function CC(r,e){return r!=null&&typeof r!="object"&&r.hasOwnProperty&&r.hasOwnProperty(e)}var AC=RegExp.prototype.test;function IC(r,e){return AC.call(r,e)}var RC=/\S/;function NC(r){return!IC(RC,r)}var $C={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function jC(r){return String(r).replace(/[&<>"'`=\/]/g,function(t){return $C[t]})}var LC=/\s*/,MC=/\s+/,Xw=/\s*=/,FC=/\s*\}/,DC=/#|\^|\/|>|\{|&|=|!/;function UC(r,e){if(!r)return[];var t=!1,n=[],a=[],o=[],u=!1,c=!1,f="",h=0;function m(){if(u&&!c)for(;o.length;)delete a[o.pop()];else o=[];u=!1,c=!1}var y,_,b;function w(q){if(typeof q=="string"&&(q=q.split(MC,2)),!As(q)||q.length!==2)throw new Error("Invalid tags: "+q);y=new RegExp(ch(q[0])+"\\s*"),_=new RegExp("\\s*"+ch(q[1])),b=new RegExp("\\s*"+ch("}"+q[1]))}w(e||Jt.tags);for(var S=new _o(r),E,P,C,T,M,j;!S.eos();){if(E=S.pos,C=S.scanUntil(y),C)for(var D=0,V=C.length;D<V;++D)T=C.charAt(D),NC(T)?(o.push(a.length),f+=T):(c=!0,t=!0,f+=" "),a.push(["text",T,E,E+1]),E+=1,T===`
`&&(m(),f="",h=0,t=!1);if(!S.scan(y))break;if(u=!0,P=S.scan(DC)||"name",S.scan(LC),P==="="?(C=S.scanUntil(Xw),S.scan(Xw),S.scanUntil(_)):P==="{"?(C=S.scanUntil(b),S.scan(FC),S.scanUntil(_),P="&"):C=S.scanUntil(_),!S.scan(_))throw new Error("Unclosed tag at "+S.pos);if(P==">"?M=[P,C,E,S.pos,f,h,t]:M=[P,C,E,S.pos],h++,a.push(M),P==="#"||P==="^")n.push(M);else if(P==="/"){if(j=n.pop(),!j)throw new Error('Unopened section "'+C+'" at '+E);if(j[1]!==C)throw new Error('Unclosed section "'+j[1]+'" at '+E)}else P==="name"||P==="{"||P==="&"?c=!0:P==="="&&w(C)}if(m(),j=n.pop(),j)throw new Error('Unclosed section "'+j[1]+'" at '+S.pos);return BC(zC(a))}function zC(r){for(var e=[],t,n,a=0,o=r.length;a<o;++a)t=r[a],t&&(t[0]==="text"&&n&&n[0]==="text"?(n[1]+=t[1],n[3]=t[3]):(e.push(t),n=t));return e}function BC(r){for(var e=[],t=e,n=[],a,o,u=0,c=r.length;u<c;++u)switch(a=r[u],a[0]){case"#":case"^":t.push(a),n.push(a),t=a[4]=[];break;case"/":o=n.pop(),o[5]=a[2],t=n.length>0?n[n.length-1][4]:e;break;default:t.push(a)}return e}function _o(r){this.string=r,this.tail=r,this.pos=0}_o.prototype.eos=function(){return this.tail===""};_o.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};_o.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=n.length,n};function vs(r,e){this.view=r,this.cache={".":this.view},this.parent=e}vs.prototype.push=function(e){return new vs(e,this)};vs.prototype.lookup=function(e){var t=this.cache,n;if(t.hasOwnProperty(e))n=t[e];else{for(var a=this,o,u,c,f=!1;a;){if(e.indexOf(".")>0)for(o=a.view,u=e.split("."),c=0;o!=null&&c<u.length;)c===u.length-1&&(f=Qw(o,u[c])||CC(o,u[c])),o=o[u[c++]];else o=a.view[e],f=Qw(a.view,e);if(f){n=o;break}a=a.parent}t[e]=n}return Np(n)&&(n=n.call(this.view)),n};function Lt(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}Lt.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Lt.prototype.parse=function(e,t){var n=this.templateCache,a=e+":"+(t||Jt.tags).join(":"),o=typeof n<"u",u=o?n.get(a):void 0;return u==null&&(u=UC(e,t),o&&n.set(a,u)),u};Lt.prototype.render=function(e,t,n,a){var o=this.getConfigTags(a),u=this.parse(e,o),c=t instanceof vs?t:new vs(t,void 0);return this.renderTokens(u,c,n,e,a)};Lt.prototype.renderTokens=function(e,t,n,a,o){for(var u="",c,f,h,m=0,y=e.length;m<y;++m)h=void 0,c=e[m],f=c[0],f==="#"?h=this.renderSection(c,t,n,a,o):f==="^"?h=this.renderInverted(c,t,n,a,o):f===">"?h=this.renderPartial(c,t,n,o):f==="&"?h=this.unescapedValue(c,t):f==="name"?h=this.escapedValue(c,t,o):f==="text"&&(h=this.rawValue(c)),h!==void 0&&(u+=h);return u};Lt.prototype.renderSection=function(e,t,n,a,o){var u=this,c="",f=t.lookup(e[1]);function h(_){return u.render(_,t,n,o)}if(f){if(As(f))for(var m=0,y=f.length;m<y;++m)c+=this.renderTokens(e[4],t.push(f[m]),n,a,o);else if(typeof f=="object"||typeof f=="string"||typeof f=="number")c+=this.renderTokens(e[4],t.push(f),n,a,o);else if(Np(f)){if(typeof a!="string")throw new Error("Cannot use higher-order sections without the original template");f=f.call(t.view,a.slice(e[3],e[5]),h),f!=null&&(c+=f)}else c+=this.renderTokens(e[4],t,n,a,o);return c}};Lt.prototype.renderInverted=function(e,t,n,a,o){var u=t.lookup(e[1]);if(!u||As(u)&&u.length===0)return this.renderTokens(e[4],t,n,a,o)};Lt.prototype.indentPartial=function(e,t,n){for(var a=t.replace(/[^ \t]/g,""),o=e.split(`
`),u=0;u<o.length;u++)o[u].length&&(u>0||!n)&&(o[u]=a+o[u]);return o.join(`
`)};Lt.prototype.renderPartial=function(e,t,n,a){if(n){var o=this.getConfigTags(a),u=Np(n)?n(e[1]):n[e[1]];if(u!=null){var c=e[6],f=e[5],h=e[4],m=u;f==0&&h&&(m=this.indentPartial(u,h,c));var y=this.parse(m,o);return this.renderTokens(y,t,n,m,a)}}};Lt.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(n!=null)return n};Lt.prototype.escapedValue=function(e,t,n){var a=this.getConfigEscape(n)||Jt.escape,o=t.lookup(e[1]);if(o!=null)return typeof o=="number"&&a===Jt.escape?String(o):a(o)};Lt.prototype.rawValue=function(e){return e[1]};Lt.prototype.getConfigTags=function(e){return As(e)?e:e&&typeof e=="object"?e.tags:void 0};Lt.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!As(e))return e.escape};var Jt={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(r){ao.templateCache=r},get templateCache(){return ao.templateCache}},ao=new Lt;Jt.clearCache=function(){return ao.clearCache()};Jt.parse=function(e,t){return ao.parse(e,t)};Jt.render=function(e,t,n,a){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+TC(e)+'" was given as the first argument for mustache#render(template, view, partials)');return ao.render(e,t,n,a)};Jt.escape=jC;Jt.Scanner=_o;Jt.Context=vs;Jt.Writer=Lt;function s0(){Jt.escape=r=>r}const vl=r=>{const e=r.split(""),t=[],n=(o,u)=>{for(let c=u;c<e.length;c+=1)if(o.includes(e[c]))return c;return-1};let a=0;for(;a<e.length;)if(e[a]==="{"&&a+1<e.length&&e[a+1]==="{")t.push({type:"literal",text:"{"}),a+=2;else if(e[a]==="}"&&a+1<e.length&&e[a+1]==="}")t.push({type:"literal",text:"}"}),a+=2;else if(e[a]==="{"){const o=n("}",a);if(o<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(a+1,o).join("")}),a=o+1}else{if(e[a]==="}")throw new Error("Single '}' in template.");{const o=n("{}",a),u=(o<0?e.slice(a):e.slice(a,o)).join("");t.push({type:"literal",text:u}),a=o<0?e.length:o}}return t},VC=r=>r.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),Bh=r=>{s0();const e=Jt.parse(r);return VC(e)},HC=(r,e)=>vl(r).reduce((t,n)=>{if(n.type==="variable"){if(n.name in e){const a=typeof e[n.name]=="string"?e[n.name]:JSON.stringify(e[n.name]);return t+a}throw new Error(`(f-string) Missing value for input ${n.name}`)}return t+n.text},""),qC=(r,e)=>(s0(),Jt.render(r,e)),Vh={"f-string":HC,mustache:qC},ZC={"f-string":vl,mustache:Bh},os=(r,e,t)=>{try{return Vh[e](r,t)}catch(n){throw Il(n,"INVALID_PROMPT_INPUT")}},WC=(r,e)=>ZC[e](r),i0=(r,e,t)=>{if(!(e in Vh)){const n=Object.keys(Vh);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${n}`)}try{const n=t.reduce((a,o)=>(a[o]="foo",a),{});Array.isArray(r)?r.forEach(a=>{if(a.type==="text")os(a.text,e,n);else if(a.type==="image_url")if(typeof a.image_url=="string")os(a.image_url,e,n);else{const o=a.image_url.url;os(o,e,n)}else throw new Error(`Invalid message template received. ${JSON.stringify(a,null,2)}`)}):os(r,e,n)}catch(n){throw new Error(`Invalid prompt schema: ${n.message}`)}};class Rn extends zh{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),i0(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return os(this.template,this.templateFormat,t)}static fromExamples(e,t,n,a=`

`,o=""){const u=[o,...e,t].join(a);return new Rn({inputVariables:n,template:u})}static fromTemplate(e,t){const{templateFormat:n="f-string",...a}=t??{},o=new Set;return WC(e,n).forEach(u=>{u.type==="variable"&&o.add(u.name)}),new Rn({inputVariables:[...o],templateFormat:n,template:e,...a})}async partial(e){const t=this.inputVariables.filter(o=>!(o in e)),n={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:n};return new Rn(a)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new Rn({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const Yw=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:Rn},Symbol.toStringTag,{value:"Module"}));class Li extends Rp{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),i0([{type:"image_url",image_url:this.template}],this.templateFormat,t)}}_getPromptType(){return"prompt"}async partial(e){const t=this.inputVariables.filter(o=>!(o in e)),n={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:n};return new Li(a)}async format(e){const t={};for(const[u,c]of Object.entries(this.template))typeof c=="string"?t[u]=os(c,this.templateFormat,e):t[u]=c;const n=e.url||t.url,a=e.detail||t.detail;if(!n)throw new Error("Must provide either an image URL.");if(typeof n!="string")throw new Error("url must be a string.");const o={url:n};return a&&(o.detail=a),o}async formatPromptValue(e){const t=await this.format(e);return new Xx(t)}}class $p extends rt{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(n=>this.formatMessages(n),e,{...t,runType:"prompt"})}}class GC extends $p{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){const t=e[this.variableName];if(this.optional&&!t)return[];if(!t){const a=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw a.name="InputFormatError",a}let n;try{Array.isArray(t)?n=t.map(Vr):n=[Vr(t)]}catch(a){const o=typeof t=="string"?t:JSON.stringify(t,null,2),u=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${o}`,`Additional message: ${a.message}`].join(`

`));throw u.name="InputFormatError",u.lc_error_code=a.lc_error_code,u}return n}}class JC extends $p{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class KC extends Rp{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new Zb(t)}}class QC extends JC{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new ka(await this.prompt.format(e),this.role)}static fromTemplate(e,t,n){return new this(Rn.fromTemplate(e,{templateFormat:n==null?void 0:n.templateFormat}),t)}}class jp extends $p{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let n=[];this.prompt.forEach(a=>{"inputVariables"in a&&(n=n.concat(a.inputVariables))}),this.inputVariables=n}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){const t=this.constructor;if(t._messageClass()){const n=t._messageClass();return new n({content:e})}else if(t.chatMessageClass){const n=t.chatMessageClass();return new n({content:e,role:this.getRoleFromMessageClass(n.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(Rn.fromTemplate(e,t));const n=[];for(const a of e)if(typeof a=="string"||typeof a=="object"&&"text"in a){let o="";typeof a=="string"?o=a:typeof a.text=="string"&&(o=a.text??"");const u={...t,...typeof a!="string"?{additionalContentFields:a}:{}};n.push(Rn.fromTemplate(o,u))}else if(typeof a=="object"&&"image_url"in a){let o=a.image_url??"",u,c=[];if(typeof o=="string"){let f;(t==null?void 0:t.templateFormat)==="mustache"?f=Bh(o):f=vl(o);const h=f.flatMap(m=>m.type==="variable"?[m.name]:[]);if(((h==null?void 0:h.length)??0)>0){if(h.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${h}
From: ${o}`);c=[h[0]]}else c=[];o={url:o},u=new Li({template:o,inputVariables:c,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:a})}else if(typeof o=="object"){if("url"in o){let f;(t==null?void 0:t.templateFormat)==="mustache"?f=Bh(o.url):f=vl(o.url),c=f.flatMap(h=>h.type==="variable"?[h.name]:[])}else c=[];u=new Li({template:o,inputVariables:c,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:a})}else throw new Error("Invalid image template");n.push(u)}return new this({prompt:n,additionalOptions:t})}async format(e){if(this.prompt instanceof zh){const t=await this.prompt.format(e);return this.createMessage(t)}else{const t=[];for(const n of this.prompt){let a={};if(!("inputVariables"in n))throw new Error(`Prompt ${n} does not have inputVariables defined.`);for(const o of n.inputVariables)a||(a={[o]:e[o]}),a={...a,[o]:e[o]};if(n instanceof zh){const o=await n.format(a);let u;"additionalContentFields"in n&&(u=n.additionalContentFields),t.push({...u,type:"text",text:o})}else if(n instanceof Li){const o=await n.format(a);let u;"additionalContentFields"in n&&(u=n.additionalContentFields),t.push({...u,type:"image_url",image_url:o})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}}class o0 extends jp{static _messageClass(){return Os}static lc_name(){return"HumanMessagePromptTemplate"}}class XC extends jp{static _messageClass(){return Ui}static lc_name(){return"AIMessagePromptTemplate"}}class YC extends jp{static _messageClass(){return kh}static lc_name(){return"SystemMessagePromptTemplate"}}function eA(r){return typeof r.formatMessages=="function"}function tA(r,e){if(eA(r)||xl(r))return r;if(Array.isArray(r)&&r[0]==="placeholder"){const a=r[1];if(typeof a!="string"||a[0]!=="{"||a[a.length-1]!=="}")throw new Error(`Invalid placeholder template: "${r[1]}". Expected a variable name surrounded by curly braces.`);const o=a.slice(1,-1);return new GC({variableName:o,optional:!0})}const t=Vr(r);let n;if(typeof t.content=="string"?n=t.content:n=t.content.map(a=>"text"in a?{...a,text:a.text}:"image_url"in a?{...a,image_url:a.image_url}:a),t._getType()==="human")return o0.fromTemplate(n,e);if(t._getType()==="ai")return XC.fromTemplate(n,e);if(t._getType()==="system")return YC.fromTemplate(n,e);if(ka.isInstance(t))return QC.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function nA(r){return r.constructor.lc_name()==="MessagesPlaceholder"}class Mi extends KC{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const c of this.promptMessages)if(!(c instanceof pr))for(const f of c.inputVariables)t.add(f);const n=this.inputVariables,a=new Set(this.partialVariables?n.concat(Object.keys(this.partialVariables)):n),o=new Set([...a].filter(c=>!t.has(c)));if(o.size>0)throw new Error(`Input variables \`${[...o]}\` are not used in any of the prompt messages.`);const u=new Set([...t].filter(c=>!a.has(c)));if(u.size>0)throw new Error(`Input variables \`${[...u]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if(typeof e.content=="string")return e;const n=await Promise.all(e.content.map(async a=>{if(a.type!=="image_url")return a;let o="";typeof a.image_url=="string"?o=a.image_url:o=a.image_url.url;const c=await Rn.fromTemplate(o,{templateFormat:this.templateFormat}).format(t);return typeof a.image_url!="string"&&"url"in a.image_url?a.image_url.url=c:a.image_url=c,a}));return e.content=n,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let n=[];for(const a of this.promptMessages)if(a instanceof pr)n.push(await this._parseImagePrompts(a,t));else{const o=a.inputVariables.reduce((c,f)=>{if(!(f in t)&&!(nA(a)&&a.optional))throw Il(new Error(`Missing value for input variable \`${f.toString()}\``),"INVALID_PROMPT_INPUT");return c[f]=t[f],c},{}),u=await a.formatMessages(o);n=n.concat(u)}return n}async partial(e){const t=this.inputVariables.filter(o=>!(o in e)),n={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:n};return new Mi(a)}static fromTemplate(e,t){const n=Rn.fromTemplate(e,t),a=new o0({prompt:n});return this.fromMessages([a])}static fromMessages(e,t){const n=e.reduce((u,c)=>u.concat(c instanceof Mi?c.promptMessages:[tA(c,t)]),[]),a=e.reduce((u,c)=>c instanceof Mi?Object.assign(u,c.partialVariables):u,Object.create(null)),o=new Set;for(const u of n)if(!(u instanceof pr))for(const c of u.inputVariables)c in a||o.add(c);return new this({...t,inputVariables:[...o],promptMessages:n,partialVariables:a,templateFormat:t==null?void 0:t.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}const rA="_chatContainer_1ctl8_1",aA="_messagesContainer_1ctl8_7",sA="_messageWrap_1ctl8_15",iA="_message_1ctl8_7",oA="_spacer_1ctl8_37",uA="_messageImage_1ctl8_45",lA="_ai_1ctl8_50",cA="_inputContainer_1ctl8_75",dA="_input_1ctl8_75",fA="_sendButton_1ctl8_108",xn={chatContainer:rA,messagesContainer:aA,messageWrap:sA,message:iA,spacer:oA,messageImage:uA,ai:lA,inputContainer:cA,input:dA,sendButton:fA},hA=()=>{const[r,e]=dh.useState([{text:"What can I do for you? ",isUser:!1}]),[t,n]=dh.useState(""),a=new SC({apiKey:"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",model:"gpt-4"}),o=Mi.fromMessages([["system","Act like a super drunk assistant that still wants to be helpful"],["user","{text}"]]),u=async()=>{if(t.trim()){n(""),e([{text:"Let me think...",isUser:!1},{text:t,isUser:!0},...r]);const f=await o.invoke({text:t}),h=await a.invoke(f);e([{text:h.content,isUser:!1},{text:t,isUser:!0},...r])}},c=f=>{f.key==="Enter"&&u(),f.key==="Escape"&&n("")};return qt.jsxs("div",{className:xn.chatContainer,children:[qt.jsxs("div",{className:xn.messagesContainer,children:[r.map((f,h)=>qt.jsxs("div",{className:xn.messageWrap,children:[!f.isUser&&qt.jsx("img",{src:"./assets/place.jpeg",alt:"profile",className:xn.profileImage}),qt.jsxs("div",{className:`${xn.message} ${f.isUser?"":xn.ai}`,children:[f.text,f.image&&qt.jsx("img",{src:f.image,alt:"message attachment",className:xn.messageImage})]},h)]})),qt.jsx("div",{className:`${xn.spacer}`})]}),qt.jsxs("div",{className:xn.inputContainer,children:[qt.jsx("input",{type:"text",value:t,onChange:f=>n(f.target.value),onKeyDown:c,className:xn.input,placeholder:"Explain it to me..."}),qt.jsx("button",{onClick:u,className:xn.sendButton,children:"Send"})]})]})},pA="_modalContent_1d2m5_1",mA={modalContent:pA};function gA(){return qt.jsx("div",{className:`${mA.modalContent}`,children:qt.jsx(hA,{})})}hS.createRoot(document.getElementById("root")).render(qt.jsx(dh.StrictMode,{children:qt.jsx(gA,{})}));export{zh as B,Rn as P,i0 as c,os as r};
